/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("fillomino",{MouseEvent:{mouseinput:function(){this.owner.playmode&&(this.mousestart||this.mousemove)&&(this.btn.Left?(this.mousestart&&this.checkBorderMode(),this.bordermode?this.inputborder():this.dragnumber_fillomino()):this.btn.Right&&this.inputQsubLine()),this.mouseend&&this.notInputted()&&(this.mouseCell=this.owner.board.emptycell,this.inputqnum())},dragnumber_fillomino:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){if(null===this.inputData)return this.inputData=a.getNum(),-1===this.inputData&&(this.inputData=-2),this.mouseCell=a,void 0;if(-2===this.inputData&&(this.inputData=-1===a.getNum()?-3:-1),this.inputData>=-1)a.setAnum(this.inputData),a.draw();else if(this.inputData<=-3){var b=this.mouseCell,c=this.owner.board.getb(a.bx+b.bx>>1,a.by+b.by>>1);-3===this.inputData&&(this.inputData=1===c.getQsub()?-5:-4),c.isnull||(c.setQsub(-4===this.inputData?1:0),c.draw())}this.mouseCell=a}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.owner.playmode&&(this.isCTRL||this.isX||this.isZ)?this.move_fillomino(a):this.moveTCell(a)},move_fillomino:function(b){var c=this.cursor.getTCC();if(c.isnull)return!1;var d,e,f=a.NDIR;switch(b){case this.KEYUP:d=c.up(),e=c.ub(),f=a.UP;break;case this.KEYDN:d=c.dn(),e=c.db(),f=a.DN;break;case this.KEYLT:d=c.lt(),e=c.lb(),f=a.LT;break;case this.KEYRT:d=c.rt(),e=c.rb(),f=a.RT;break;default:return!1}if(!d.isnull){var g=this.isCTRL||this.isX||this.isZ;return g?(this.isCTRL?e.isnull||(e.setQsub(0===e.getQsub()?1:0),this.cursor.pos.movedir(f,2)):this.isZ?e.isnull||e.setQans(e.isBorder()?0:1):this.isX&&(d.isnull||(d.setAnum(c.getNum()),this.cursor.pos.movedir(f,2))),c.draw(),this.stopEvent(),!0):!1}return!1}},Board:{isborder:1},AreaRoomManager:{enabled:!0},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_DLIGHT,this.setBorderColorFunc("qans")},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawNumbers(),this.drawBorders(),this.drawBorderQsubs(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(){this.decodeNumber16()},encodePzpr:function(){this.encodeNumber16()},decodeKanpen:function(){this.owner.fio.decodeCellQnum_kanpen()},encodeKanpen:function(){this.owner.fio.encodeCellQnum_kanpen()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellAnumsub(),this.decodeBorderAns()},encodeData:function(){this.encodeCellQnum(),this.encodeCellAnumsub(),this.encodeBorderAns()},kanpenOpen:function(){this.decodeCellQnum_kanpen(),this.decodeCellAnum_kanpen();for(var a=this.owner.board,b=0;b<a.bdmax;b++){var c=a.border[b],d=c.sidecell[0],e=c.sidecell[1];if(c.qans=0,!d.isnull&&!e.isnull){var f=d.getNum(),g=e.getNum();-1!==f&&-1!==g&&f!==g&&(c.qans=1)}}},kanpenSave:function(){this.encodeCellQnum_kanpen(),this.encodeCellAnum_kanpen()}},AnsCheck:{checkAns:function(){var a=this.getErrorFlag_cell();return this.checkErrorFlag_cell(a,3)?this.checkErrorFlag_cell(a,1)&&this.checkAreaSize(a,2)?this.checkSideAreaNumberSize(a)?this.checkErrorFlag_cell(a,2)&&this.checkAreaSize(a,1)?this.checkErrorFlag_cell(a,4)?this.getConfig("enbnonum")||this.checkNoNumCell()?null:"ceEmpty":"bkPlNum":"bkSizeGt":"sbSameNum":"bkSizeLt":"bkNoNum"},check1st:function(){return this.getConfig("enbnonum")||this.checkNoNumCell()?null:"ceEmpty"},checkSideAreaNumberSize:function(a){return this.checkSideAreaSize(a,function(a){return a.number})},checkAreaSize:function(a,b){for(var c=!0,d=1;d<=a.max;d++){var e=a.room[d];if(!(-1===e.error||e.number<=0))if(1===b&&e.number<e.clist.length){if(this.checkOnly)return!1;a.room[d].clist.seterr(1),c=!1}else if(2===b&&e.number>e.clist.length){if(this.checkOnly)return!1;a.room[d].clist.seterr(1),c=!1}}return c},getErrorFlag_cell:function(){for(var a=this.owner.board.getRoomInfo(),b=1,c=a.max;c>=b;b++){var d=a.room[b],e=d.clist;d.error=0,d.number=-1;for(var f=[],g=0,h=0,i=0,j=0;j<e.length;j++){var k=e[j].getNum();-1==k?g++:isNaN(f[k])?(h++,i=k,f[k]=1):f[k]++}if(h>1&&g>0)d.error=4;else if(0===h)d.error=3;else if(1===h&&i<f[i]+g)d.error=2,d.number=i;else if(1===h&&i>f[i]+g)d.error=1,d.number=i;else if(1===h)d.error=-1,d.number=i;else{for(var j=0;j<e.length;j++)a.id[e[j].id]=0;for(var j=0;j<e.length;j++)0===a.getRoomID(e[j])&&(c++,a.addRoom(),this.setNewID(a,e[j]));a.room[b]={idlist:[],error:0,number:-1}}}return a},setNewID:function(a,b){for(var c=[b];c.length>0;){var d=c.pop();if(a.emptyCell(d)){a.addCell(d);for(var e=d.getdir4clist(),f=0;f<e.length;f++)d.sameNumber(e[f][0])&&c.push(e[f][0])}}}},FailCode:{sbSameNum:["同じ数字のブロックが辺を共有しています。","Adjacent blocks have the same number."],ceEmpty:["数字の入っていないマスがあります。","There is an empty cell."]}})}();