/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("kouchoku",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart||this.mousemove?this.inputsegment():this.mouseend&&this.inputsegment_up():this.owner.editmode&&this.mousestart&&this.inputcross_kouchoku()},targetPoint:[null,null],inputsegment:function(){var a=this.getcross();if(!a.isnull&&a!==this.mouseCell){if(this.mousestart)this.inputData=1,this.targetPoint[0]=a,a.draw();else if(this.mousemove&&1===this.inputData){var b=this.targetPoint[1];this.targetPoint[1]=a,a.draw(),null!==b&&b.draw()}this.mouseCell=a}},inputsegment_up:function(){if(1===this.inputData){var a=this.targetPoint[0],b=this.targetPoint[1];if(this.targetPoint=[null,null],null!==a&&a.draw(),null!==b&&b.draw(),null!==a&&null!==b&&(!this.getConfig("enline")||-1!==a.qnum&&-1!==b.qnum)){var c,d=a.bx,e=b.bx,f=a.by,g=b.by;this.getConfig("lattice")&&0!==this.owner.board.getLatticePoint(d,f,e,g).length||(this.inputsegment_main(d,f,e,g),d>e&&(c=d,d=e,e=c),f>g&&(c=f,f=g,g=c),this.owner.painter.paintRange(d-1,f-1,e+1,g+1))}}},inputsegment_main:function(a,b,c,d){var e;if(a>c)e=a,a=c,c=e,e=b,b=d,d=e;else if(a===c&&b>d)e=b,b=d,d=e;else if(a===c&&b===d)return;var f=this.owner.board,g=f.getSegment(a,b,c,d);null===g?f.addSegmentByAddr(a,b,c,d):f.removeSegment(g)},inputcross_kouchoku:function(){var a=this.getcross();a.isnull||a===this.mouseCell||(a!==this.cursor.getTXC()?this.setcursor(a):this.inputnumber(a),this.mouseCell=a)},inputnumber:function(a){var b=a.getQnum();this.btn.Left?26===b?a.setQnum(-1):-1===b?a.setQnum(-2):-2===b?a.setQnum(1):a.setQnum(b+1):this.btn.Right&&(-2===b?a.setQnum(-1):-1===b?a.setQnum(26):1===b?a.setQnum(-2):a.setQnum(b-1)),a.draw()},e_mouseout:function(a){this.mouseout_kouchoku(a,this.inputPoint.px,this.inputPoint.py)},mouseout_kouchoku:function(a){var b=pzpr.util.getPagePos(a),c=pzpr.util.getRect(this.owner.canvas);if(b.px<=c.left||b.px>=c.right||b.py<=c.top||b.py>=c.bottom){if(1===this.inputData){var d=this.targetPoint[0],e=this.targetPoint[1];this.targetPoint=[null,null],null!==d&&d.draw(),null!==e&&e.draw()}this.mousereset()}}},KeyEvent:{enablemake:!0,moveTarget:function(a){return this.moveTCross(a)},keyinput:function(a){this.key_inputqnum_kouchoku(a)},key_inputqnum_kouchoku:function(a){var b=this.cursor.getTXC();if(!(a.length>1)){if(a>="a"&&"z">=a){var c=parseInt(a,36)-9;b.getQnum()===c?b.setQnum(-1):b.setQnum(c)}else if("-"==a)b.setQnum(-2!==b.getQnum()?-2:-1);else{if(" "!=a)return;b.setQnum(-1)}this.prev=b,b.draw()}}},TargetCursor:{crosstype:!0},Cross:{maxnum:26,initialize:function(){this.seglist=new this.owner.SegmentList}},Board:{qcols:7,qrows:7,iscross:2,segs:null,initialize:function(){this.Common.prototype.initialize.call(this),this.segment=new this.owner.SegmentList,this.segmax=0,this.seginvalid=[],this.segs=this.addInfoList("SegmentManager")},initBoardSize:function(a,b){this.segs.eraseall(),this.segment=new this.owner.SegmentList,this.segmax=0,this.seginvalid=[],this.Common.prototype.initBoardSize.call(this,a,b)},resetInfo:function(){this.segs.reset(),this.Common.prototype.resetInfo.call(this)},allclear:function(a){if(this.segs){var b=this.owner.painter;this.segment.each(function(a){b.eraseSegment1(a)})}this.segment=new this.owner.SegmentList,this.segmax=0,this.Common.prototype.allclear.call(this,a)},ansclear:function(){if(this.segs){var a=this.owner.painter;this.segment.each(function(b){a.eraseSegment1(b)})}this.segment=new this.owner.SegmentList,this.segmax=0,this.Common.prototype.ansclear.call(this)},errclear:function(){this.haserror&&(this.segs&&this.segment.each(function(a){a.error=0}),this.Common.prototype.errclear.call(this))},irowakeRemake:function(){this.segs.newIrowake()},getLatticePoint:function(a,b,c,d){for(var e=new this.owner.Segment(a,b,c,d),f=[],g=0;g<e.lattices.length;g++){var h=e.lattices[g][2];null!==h&&-1!==this.cross[h].qnum&&f.push(h)}return f},segmentinside:function(a,b,c,d){if(a<=this.minbx&&c>=this.maxbx&&b<=this.minby&&d>=this.maxby)return this.segment;var e=new this.owner.SegmentList,f=new this.owner.Segment(a,b,c,d);return this.segment.each(function(g){var h=0;g.isAreaOverLap(f)&&(g.ispositive(a,b)&&h++,g.ispositive(a,d)&&h++,g.ispositive(c,b)&&h++,g.ispositive(c,d)&&h++,h>0&&4>h&&e.add(g))}),e},addSegmentByAddr:function(a,b,c,d){var e;this.seginvalid.length>0?e=this.seginvalid.shift():(e=this.segmax,this.segmax++,this.segment.length++);var f=new this.owner.Segment(a,b,c,d);f.id=e,this.segment[e]=f,this.owner.board.isenableInfo()&&this.segs.setSegmentInfo(f,!0),this.owner.opemgr.addOpe_Segment(a,b,c,d,0,1)},removeSegmentByAddr:function(a,b,c,d){this.removeSegment(this.getSegment(a,b,c,d))},removeSegment:function(a){this.isenableInfo()&&this.segs.setSegmentInfo(a,!1),this.owner.opemgr.addOpe_Segment(a.bx1,a.by1,a.bx2,a.by2,1,0),this.owner.painter.eraseSegment1(a),this.seginvalid.push(a.id),this.segment[a.id]=new this.owner.Segment},getSegment:function(a,b,c,d){for(var e=this.getx(a,b),f=null,g=0,h=e.seglist.length;h>g;g++){var i=e.seglist[g];if(i.bx2===c&&i.by2===d){f=i;break}}return f}},BoardExec:{adjustBoardData:function(b){var c=this.owner.board;if(b&a.REDUCE){var d=(c.segment,new this.owner.SegmentList);c.segment.each(function(e){var f=e.bx1,g=e.by1,h=e.bx2,i=e.by2;switch(b){case a.REDUCEUP:(g<c.minby+2||i<c.minby+2)&&d.add(e);break;case a.REDUCEDN:(g>c.maxby-2||i>c.maxby-2)&&d.add(e);break;case a.REDUCELT:(f<c.minbx+2||h<c.minbx+2)&&d.add(e);break;case a.REDUCERT:(f>c.maxbx-2||h>c.maxbx-2)&&d.add(e)}});var e=this.owner.opemgr,f=!e.undoExec&&!e.redoExec;f&&(e.forceRecord=!0);for(var g=0;g<d.length;g++)c.removeSegment(d[g]);f&&(e.forceRecord=!1)}},adjustBoardData2:function(b,c){var d=c.x1+c.x2,e=c.y1+c.y2;this.owner.board.segment.each(function(c){var f=c.bx1,g=c.by1,h=c.bx2,i=c.by2;switch(b){case a.FLIPY:c.setpos(f,e-g,h,e-i);break;case a.FLIPX:c.setpos(d-f,g,d-h,i);break;case a.TURNR:c.setpos(e-g,f,e-i,h);break;case a.TURNL:c.setpos(g,d-f,i,d-h);break;case a.EXPANDUP:c.setpos(f,g+2,h,i+2);break;case a.EXPANDDN:c.setpos(f,g,h,i);break;case a.EXPANDLT:c.setpos(f+2,g,h+2,i);break;case a.EXPANDRT:c.setpos(f,g,h,i);break;case a.REDUCEUP:c.setpos(f,g-2,h,i-2);break;case a.REDUCEDN:c.setpos(f,g,h,i);break;case a.REDUCELT:c.setpos(f-2,g,h-2,i);break;case a.REDUCERT:c.setpos(f,g,h,i)}})}},"SegmentList:PieceList":{name:"SegmentList",getRange:function(){if(0==this.length)return null;for(var a=this.owner.board,b={x1:a.maxbx+1,x2:a.minbx-1,y1:a.maxby+1,y2:a.minby-1},c=0;c<this.length;c++){var d=this[c];b.x1>d.bx1&&(b.x1=d.bx1),b.x2<d.bx2&&(b.x2=d.bx2),b.y1>d.by1&&(b.y1=d.by1),b.y2<d.by2&&(b.y2=d.by2)}return b},each:function(a){for(var b=0;b<this.length;b++)null!==this[b]&&a(this[b])}},"SegmentOperation:Operation":{setData:function(a,b,c,d,e,f){this.bx1=a,this.by1=b,this.bx2=c,this.by2=d,this.old=e,this.num=f},decode:function(a){return"SG"!==a[0]?!1:(this.bx1=+a[1],this.by1=+a[2],this.bx2=+a[3],this.by2=+a[4],this.old=+a[5],this.num=+a[6],!0)},toString:function(){return["SG",this.bx1,this.by1,this.bx2,this.by2,this.old,this.num].join(",")},exec:function(a){var b,c=this.bx1,d=this.by1,e=this.bx2,f=this.by2,g=this.owner;1===a?g.board.addSegmentByAddr(c,d,e,f):0===a&&g.board.removeSegmentByAddr(c,d,e,f),c>e&&(b=c,c=e,e=b),d>f&&(b=d,d=f,f=b),g.painter.paintRange(c-1,d-1,e+1,f+1)}},OperationManager:{addOpe_Segment:function(a,b,c,d,e,f){this.addOpe_common(function(){var g=new this.owner.SegmentOperation;return g.setData(a,b,c,d,e,f),g})},decodeOpe:function(a){var b=new this.owner.SegmentOperation;return b.decode(a)?b:this.Common.prototype.decodeOpe.call(this,a)}},Flags:{disable_subclear:!0,irowake:!0},Graphic:{margin:.5,hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_DLIGHT},paint:function(){this.drawDashedGrid(!1),this.drawSegments(),this.drawCrosses_kouchoku(),this.drawSegmentTarget(),this.drawTarget()},repaintSegments:function(a){if(this.use.canvas){var b=a.getRange();this.paintRange(b.x1-1,b.y1-1,b.x2+1,b.y2+1)}else for(var c=(this.vinc("segment","auto"),0);c<a.length;c++)this.drawSegment1(a[c],!0)},drawSegments:function(){var a,b=(this.vinc("segment","auto"),this.owner.board);a=(this.range.x2-this.range.x1)*(this.range.y2-this.range.y1)/((b.maxbx-b.minbx)*(b.maxby-b.minby))<.3?b.segmentinside(this.range.x1,this.range.y1,this.range.x2,this.range.y2):b.segment;for(var c=0;c<a.length;c++)this.drawSegment1(a[c],!0)},eraseSegment1:function(a){this.vinc("segment","auto");this.drawSegment1(a,!1)},drawSegment1:function(a,b){var c=this.currentContext;c.lineWidth=this.lw;var d=["seg",a.bx1,a.by1,a.bx2,a.by2].join("_");if(b){if(c.strokeStyle=1===a.error?this.errlinecolor:-1===a.error?this.errlinebgcolor:this.getConfig("irowake")&&a.color?a.color:this.linecolor,this.vnop(d,this.STROKE)){var e=a.bx1*this.bw,f=a.bx2*this.bw,g=a.by1*this.bh,h=a.by2*this.bh;c.strokeLine(e,g,f,h)}}else this.vhide(d)},drawCrosses_kouchoku:function(){var a=this.vinc("cross_base","auto"),b=this.getConfig("circolor"),c=.3*this.cw+1,d=.2*this.cw,e=["x_cp_","x_cm_"];a.lineWidth=1;for(var f=this.range.crosses,g=0;g<f.length;g++){var h=f[g],i=h.id,j=["cross",i].join("_"),k=b&&0===h.error&&h.seglist.length>=2,l=h.bx*this.bw,m=h.by*this.bh;if(h.qnum>0){a.fillStyle=1===h.error?this.errbcolor1:"white",a.strokeStyle=k?"gray":"black",this.vnop(e[0]+i,this.FILL_STROKE)&&a.shapeCircle(l,m,c);var n=(h.qnum+9).toString(36).toUpperCase(),o=k?"gray":this.fontcolor;this.dispnum(j,1,n,.55,o,l,m)}else this.vhide([e[0]+i]),this.hidenum(j);-2===h.qnum?(a.fillStyle=1===h.error?this.errcolor1:this.cellcolor,k&&(a.fillStyle="gray"),this.vnop(e[1]+i,this.FILL)&&a.fillCircle(l,m,d)):this.vhide(e[1]+i)}},drawSegmentTarget:function(){var a=this.vinc("cross_target_","auto"),b=.32*this.cw,c="x_point_";a.strokeStyle="rgb(64,127,255)",a.lineWidth=1.5*this.lw;for(var d=this.range.crosses,e=0;e<d.length;e++){var f=d[e];if(this.owner.mouse.targetPoint[0]===f||this.owner.mouse.targetPoint[1]===f){if(this.vnop(c+f.id,this.STROKE)){var g=f.bx*this.bw,h=f.by*this.bh;a.strokeCircle(g,h,b)}}else this.vhide(c+f.id)}}},Encode:{decodePzpr:function(){this.decodeCrossABC()},encodePzpr:function(){this.encodeCrossABC()},decodeCrossABC:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cross[a],f=c.charAt(b);if(this.include(f,"a","z")?e.qnum=parseInt(f,36)-9:this.include(f,"0","9")?a+=parseInt(f,36):"."==f&&(e.qnum=-2),a++,a>=d.crossmax)break}this.outbstr=c.substr(b+1)},encodeCrossABC:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.crossmax;d++){var e="",f=c.cross[d].qnum;f>=0?e=(9+f).toString(36):-2===f?e=".":a++,0===a?b+=e:(e||10===a)&&(b+=(a-1).toString(36)+e,a=0)}a>0&&(b+=(a-1).toString(36)),this.outbstr+=b}},FileIO:{decodeData:function(){this.decodeCrossNum(),this.decodeSegment()},encodeData:function(){this.encodeCrossNum(),this.encodeSegment()},decodeSegment:function(){for(var a=parseInt(this.readLine(),10),b=0;a>b;b++){var c=this.readLine().split(" ");this.owner.board.addSegmentByAddr(+c[0],+c[1],+c[2],+c[3])}},encodeSegment:function(){var a=this,b=this.owner.board.segment;this.datastr+=b.length+"\n",b.each(function(b){a.datastr+=[b.bx1,b.by1,b.bx2,b.by2].join(" ")+"\n"})}},AnsCheck:{checkAns:function(){return this.checkSegmentExist()?this.checkSegmentPoint()?this.checkSegmentBranch()?this.checkSegmentOverPoint()?this.checkDuplicateSegment()?this.checkDifferentLetter()?this.checkRightAngle()?this.checkOneSegmentLoop()?this.checkSegmentDeadend()?this.checkAlonePoint()?this.checkConsequentLetter()?null:"nmNotConseq":"nmLineCount":"lnDeadEnd":"lnPlLoop":"lnRightAngle":"nmConnDiff":"lnOverlap":"lnPassOver":"lnBranch":"lnIsolate":"brNoLine"},checkSegmentExist:function(){return 0!==this.owner.board.segment.length},checkAlonePoint:function(){return this.checkSegment(function(a){return a.seglist.length<2&&-1!==a.qnum})},checkSegmentPoint:function(){return this.checkSegment(function(a){return a.seglist.length>0&&-1===a.qnum})},checkSegmentBranch:function(){return this.checkSegment(function(a){return a.seglist.length>2})},checkSegmentDeadend:function(){return this.checkSegment(function(a){return 1===a.seglist.length})},checkSegment:function(a){for(var b=!0,c=this.owner.board,d=0;d<c.crossmax;d++){var e=c.cross[d];a(e)&&(b&&c.segment.seterr(-1),e.seglist.seterr(1),b=!1)}return b},checkOneSegmentLoop:function(){for(var a=this.owner.board,b=0,c=(new this.owner.SegmentList,1);c<=a.segs.linemax;c++)if(0!==a.segs.seglist[c].length&&(b++,b>1))return a.segment.seterr(-1),a.segs.seglist[c].seterr(1),!1;return!0},checkSegmentOverPoint:function(){var a=!0,b=this.owner.board;return b.segment.each(function(c){for(var d=b.getLatticePoint(c.bx1,c.by1,c.bx2,c.by2),e=0;e<d.length;e++)a&&b.segment.seterr(-1),c.seterr(1),b.cross[d[e]].seterr(1),a=!1}),a},checkDifferentLetter:function(){var a=!0,b=this.owner.board;return b.segment.each(function(c){var d=c.cross1,e=c.cross2;-2!==d.qnum&&-2!==e.qnum&&d.qnum!==e.qnum&&(a&&b.segment.seterr(-1),c.seterr(1),d.seterr(1),e.seterr(1),a=!1)}),a},checkConsequentLetter:function(){for(var a=!0,b={},c=[],d=this.owner.board,e=0;e<d.crossmax;e++){var f=d.cross[e].qnum;f>=0&&(b[f]=[0,0,0])}for(var e=0;e<d.crossmax;e++){var f=d.cross[e].qnum;f>=0&&(0===b[f][0]&&c.push(f),b[f][0]++)}d.segment.each(function(a){var c=a.cross1,d=a.cross2;if(c.qnum>=0&&d.qnum>=0&&c.qnum===d.qnum){var e=c.qnum;e>=0&&b[e][1]++}else if(c.qnum>=0||d.qnum>=0){var e=c.qnum;e>=0&&b[e][2]++;var e=d.qnum;e>=0&&b[e][2]++}});for(var g=0;g<c.length;g++){var f=c[g];if(2!==b[f][2]||b[f][1]!==b[f][0]-1){for(var e=0;e<d.crossmax;e++){var h=d.cross[e];h.qnum===f&&h.seterr(1)}a=!1}}return a},checkDuplicateSegment:function(){for(var a=!0,b=this.owner.board.segment,c=b.length,d=0;c>d;d++)for(var e=d+1;c>e;e++){var f=b[d],g=b[e];null!==f&&null!==g&&f.isOverLapSegment(g)&&(a&&this.owner.board.segment.seterr(-1),f.seterr(1),g.seterr(1),a=!1)}return a},checkRightAngle:function(a){for(var b=!0,a=this.owner.board.segment,c=a.length,d=0;c>d;d++)for(var e=d+1;c>e;e++){var f=a[d],g=a[e];null!==f&&null!==g&&f.isCrossing(g)&&!f.isRightAngle(g)&&(b&&this.owner.board.segment.seterr(-1),f.seterr(1),g.seterr(1),b=!1)}return b}},FailCode:{lnDeadEnd:["途中で途切れている線があります。","there is a dead-end segment."],lnBranch:["分岐している線があります。","there is a branched segment."],lnPlLoop:["輪っかが一つではありません。","there are plural loops."],lnIsolate:["線が丸のないところから出ています。","A segment comes from out of circle."],lnPassOver:["線が丸を通過しています。","A segment passes over a circle."],lnOverlap:["線が同一直線上で重なっています。","Plural segments are overlapped."],lnRightAngle:["線が直角に交差していません。","Segments don't intersect at a right angle."],nmConnDiff:["異なる文字が直接繋がっています。","Different Letters are connected directly."],nmNotConseq:["同じ文字がひとつながりになっていません。","Same Letters are not consequent."],nmLineCount:["線が2本出ていない丸があります。","A circle doesn't have two segments."],brNoLine:["線が存在していません。","there is no segment."]},Segment:{initialize:function(a,b,c,d){this.id=null,this.cross1,this.cross2,this.bx1,this.by1,this.bx2,this.by2,this.dx,this.dy,this.lattices,this.color="",this.error=0,this.setpos(a,b,c,d)},setpos:function(a,b,c,d){this.cross1=this.owner.board.getx(a,b),this.cross2=this.owner.board.getx(c,d),this.bx1=a,this.by1=b,this.bx2=c,this.by2=d,this.dx=c-a,this.dy=d-b,this.setLattices()},setLattices:function(){var a,b=this.dx>>1,c=this.dy>>1;for(b=0>b?-b:b,c=0>c?-c:c,c>b&&(a=b,b=c,c=a);c>0;)a=b%c,b=c,c=a;this.lattices=[];for(var d=1;b>d;d++){var e=this.bx1+this.dx*(d/b),f=this.by1+this.dy*(d/b),g=this.owner.board.getx(e,f);this.lattices.push([e,f,g.id])}},ispositive:function(a,b){return(a-this.bx1)*(this.by2-b)-(this.bx2-a)*(b-this.by1)>0},seterr:function(a){this.owner.board.isenableSetError()&&(this.error=a)},isRightAngle:function(a){return this.dx*a.dx+this.dy*a.dy===0},isParallel:function(a){var b=0===this.dx,c=0===a.dx,d=0===this.dy,e=0===a.dy;return b&&c?!0:d&&e?!0:b||c||d||e?!1:this.dx*a.dy===a.dx*this.dy},isCrossing:function(a){if(this.isParallel(a))return!1;if(!this.isAreaOverLap(a))return!1;var b=this.bx1,c=this.bx2,d=this.by1,e=this.by2,f=this.dx,g=this.dy,h=a.bx1,i=a.bx2,j=a.by1,k=a.by2,l=a.dx,m=a.dy;if(0===f){var n=m*(b-h)+j*l,o=l;0>o&&(n*=-1,o*=-1);var p=d*o,q=e*o;if(n>p&&q>n)return!0}else if(0===l){var n=g*(h-b)+d*f,o=f;0>o&&(n*=-1,o*=-1);var r=j*f,s=k*f;if(n>r&&s>n)return!0}else{var t=(h*m-j*l)*f-(b*g-d*f)*l,o=m*f-g*l;0>o&&(t*=-1,o*=-1);var u=b*o,v=c*o,w=h*o,x=i*o;if(t>u&&v>t&&t>w&&x>t)return!0}return!1},isAreaOverLap:function(a){return this.isOverLap(this.bx1,this.bx2,a.bx1,a.bx2)&&this.isOverLap(this.by1,this.by2,a.by1,a.by2)},isOverLapSegment:function(a){if(!this.isParallel(a))return!1;if(0===this.dx&&0===a.dx){if(this.bx1===a.bx1&&this.isOverLap(this.by1,this.by2,a.by1,a.by2))return!0}else if((this.dx*this.by1-this.bx1*this.dy)*a.dx===(a.dx*a.by1-a.bx1*a.dy)*this.dx&&this.isOverLap(this.bx1,this.bx2,a.bx1,a.bx2))return!0;return!1},isOverLap:function(a,b,c,d){var e;return a>b&&(e=a,a=b,b=e),c>d&&(e=c,c=d,d=e),b>c&&d>a}},SegmentManager:{initialize:function(){this.eraseall()},eraseall:function(){this.lineid=[],this.seglist=[],this.linemax=0,this.invalidid=[]},init:function(){this.owner.board.validinfo.all.push(this)},typeA:"A",typeB:"B",reset:function(){this.lineid=[],this.seglist=[],this.linemax=0,this.invalidid=[];for(var a=this.owner,b=a.board,c=0,d=b.crossmax;d>c;c++)b.cross[c].seglist=new a.SegmentList;this.rebuild()},rebuild:function(){var a=new this.owner.SegmentList,b=this;this.owner.board.segment.each(function(c){b.lineid[c.id]=0,a.add(c),c.cross1.seglist.add(c),c.cross2.seglist.add(c)}),this.searchLine(a),this.owner.flags.irowake&&this.newIrowake()},newIrowake:function(){for(var a=1;a<=this.linemax;a++)if(this.seglist[a].length>0)for(var b=this.owner.painter.getNewLineColor(),c=0;c<this.seglist[a].length;c++)this.seglist[a][c].color=b},setSegmentInfo:function(a,b){if(b||null!==this.lineid[a.id]){var c=this,d=function(a){return a.isnull?c.typeA:a.seglist.length===(b?0:1)?c.typeA:c.typeB},e=(a.id,a.cross1),f=a.cross2,g=d(e),h=d(f);b?(e.isnull||e.seglist.add(a),f.isnull||f.seglist.add(a),this.lineid[a.id]=null,g===this.typeA&&h===this.typeA?this.assignLineInfo(a,null):g===this.typeA&&h===this.typeB||g===this.typeB&&h===this.typeA?this.assignLineInfo(a,this.getaround(a)[0]):this.remakeLineInfo(a,b)):(g===this.typeA&&h===this.typeA||g===this.typeA&&h===this.typeB||g===this.typeB&&h===this.typeA?this.removeLineInfo(a):this.remakeLineInfo(a,b),e.isnull||e.seglist.remove(a),f.isnull||f.seglist.remove(a))}},assignLineInfo:function(a,b){var c=this.lineid[a.id];(null===c||0===c)&&(null===b?(c=this.addPath(),a.color=this.owner.painter.getNewLineColor()):(c=this.lineid[b.id],a.color=b.color),this.seglist[c].add(a),this.lineid[a.id]=c)},removeLineInfo:function(a){var b=this.lineid[a.id];null!==b&&0!==b&&(this.seglist[b].remove(a),0===this.seglist[b].length&&this.removePath(b),this.lineid[a.id]=null,a.color="")},remakeLineInfo:function(a,b){var c=this.getaround(a);b?c.unshift(a):this.removeLineInfo(a);for(var d=this.getLongColor(c),e=new this.owner.SegmentList,f=0,g=c.length;g>f;f++){var h=c[f].id,i=this.lineid[h];null!==i&&0!==i?e.extend(this.removePath(i)):null===i&&e.add(c[f])}var j=this.searchLine(e);this.setLongColor(j,d)},addPath:function(){var a;return this.invalidid.length>0?a=this.invalidid.shift():(this.linemax++,a=this.linemax),this.seglist[a]=new this.owner.SegmentList,a},removePath:function(a){for(var b=this.seglist[a],c=0,d=b.length;d>c;c++)this.lineid[b[c].id]=null;return this.seglist[a]=new this.owner.SegmentList,this.invalidid.push(a),b},getLongColor:function(a){for(var b=null,c="",d=0,e=a.length;e>d;d++){var f=this.lineid[a[d].id];null===f||0>=f||(null===b||this.seglist[b].length<this.seglist[f].length)&&(b=f,c=a[d].color)}return c?c:this.owner.painter.getNewLineColor()},setLongColor:function(a,b){for(var c=new this.owner.SegmentList,d=a[0],e=1;e<a.length;e++)this.seglist[d].length<this.seglist[a[e]].length&&(d=a[e]);for(var e=0;e<a.length;e++){for(var f=a[e]===d?b:this.owner.painter.getNewLineColor(),g=this.seglist[a[e]],h=0,i=g.length;i>h;h++)g[h].color=f;c.extend(g)}this.getConfig("irowake")&&this.owner.painter.repaintSegments(c)},getaround:function(a){for(var b=new this.owner.SegmentList,c=a.cross1,d=a.cross2,e=0,f=c.seglist.length;f>e;e++)c.seglist[e].id!==a.id&&b.add(c.seglist[e]);for(var e=0,f=d.seglist.length;f>e;e++)d.seglist[e].id!==a.id&&b.add(d.seglist[e]);return b},searchLine:function(a){for(var b=[],c=0,d=a.length;d>c;c++)this.lineid[a[c].id]=0;for(var c=0,d=a.length;d>c;c++)if(0===this.lineid[a[c].id]){var e=this.addPath();this.searchSingle(a[c],e),b.push(e)}return b},searchSingle:function(a,b){for(var c=[a];c.length>0;){var d=c.pop();if(0===this.lineid[d.id]){this.lineid[d.id]=b,this.seglist[b].add(d);for(var e=this.getaround(d),f=0;f<e.length;f++)0===this.lineid[e[f].id]&&c.push(e[f])}}}}})}();