/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("kakuru",{MouseEvent:{mouseinput:function(){this.mousestart&&this.inputqnum_kakuru()},inputqnum_kakuru:function(){var a=this.getcell();a.isnull||1===a.getQues()&&a===this.cursor.getTCC()||this.inputqnum()}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(a){this.key_inputqnum_kakuru(a)},key_inputqnum_kakuru:function(a){var b=this.cursor.getTCC();if(a>="0"&&"9">=a||"-"===a){if(1===b.getQues())return;if(!this.key_inputqnum_main(b,a))return}else if(" "===a)this.owner.editmode&&b.setQues(0),b.setNum(-1);else{if(!this.owner.editmode||"q"!==a&&"q1"!==a&&"q2"!==a)return;"q"===a&&(a=1!==b.getQues()?"q1":"q2"),"q1"===a?(b.setQues(1),b.setNum(-1)):"q2"==a&&b.setQues(0)}this.prev=b,b.draw()}},Cell:{nummaxfunc:function(){return this.owner.editmode?44:9}},Board:{qcols:7,qrows:7},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.errbcolor1=this.errbcolor1_DARK},paint:function(){this.drawBGCells(),this.drawGrid(),this.drawBlackCells(),this.drawNumbers(),this.drawChassis(),this.drawCursor()},getBGCellColor:function(a){return-1!==a.qnum?"rgb(208, 208, 208)":1===a.error?this.errbcolor1:null},getCellColor:function(a){return 1===a.ques?this.cellcolor:null}},Encode:{decodePzpr:function(){this.decodeKakuru()},encodePzpr:function(){this.encodeKakuru()},decodeKakuru:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if("+"===e?f.ques=1:this.include(e,"k","z")?a+=parseInt(e,36)-19:"."!==e&&(f.qnum=this.decval(e)),a++,a>=d.cellmax)break}this.outbstr=c.substr(b)},encodeKakuru:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d];1===f.ques?e="+":-1!==f.qnum?e=this.encval(f.qnum):b++,0===b?a+=e:(e||17===b)&&(a+=1===b?"."+e:(b+18).toString(36)+e,b=0)}1===b?a+=".":b>1&&(a+=(b+18).toString(36)),this.outbstr+=a},decval:function(a){return"_"===a?-2:a>="0"&&"9">=a?parseInt(a,36):a>="a"&&"j">=a?parseInt(a,36):a>="A"&&"Z">=a?parseInt(a,36)+10:""},encval:function(a){return-2===a?"_":a>=1&&19>=a?a.toString(36).toLowerCase():a>=20&&45>=a?(a-10).toString(36).toUpperCase():"0"}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"b"===b?a.ques=1:"?"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))}),this.decodeCell(function(a,b){"."!==b&&"0"!==b&&(a.anum=parseInt(b))})},encodeData:function(){this.encodeCell(function(a){return 1===a.ques?"b ":-2===a.qnum?"? ":a.qnum>=0?""+a.qnum.toString()+" ":". "}),this.encodeCell(function(a){return 1===a.ques||-1!==a.qnum?". ":-1!==a.anum?""+a.anum.toString()+" ":"0 "})}},AnsCheck:{checkAns:function(){return this.checkAroundPrenums()?this.checkNumber()?this.checkAroundNumbers()?this.checkEmptyCell_kakuru()?null:"ceEmpty":"nmAround":"nqAroundSumNe":"nqAroundDup"},check1st:function(){return this.checkEmptyCell_kakuru()?null:"ceEmpty"},checkEmptyCell_kakuru:function(){return this.checkAllCell(function(a){return 0===a.getQues()&&a.noNum()})},checkAroundPrenums:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(!(1===d.getQues()||d.getQnum()<=0)){var e=d.bx,f=d.by,g={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},h=new this.owner.CellList,i=b.cellinside(e-2,f-2,e+2,f+2);h.add(d);for(var j=0;j<i.length;j++){var k=i[j];if(d!==k&&0===k.ques&&-1===k.qnum){var l=k.anum;l>0&&(g[l]++,h.add(k))}}for(var m=1;9>=m;m++)if(g[m]>1){if(this.checkOnly)return!1;d.seterr(1),h.filter(function(a){return a.getAnum()===m}).seterr(1),a=!1}}}return a},checkNumber:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(!(1===d.getQues()||d.getQnum()<=0)){var e=0,f=d.bx,g=d.by,h=new this.owner.CellList,i=b.cellinside(f-2,g-2,f+2,g+2);h.add(d);for(var j=0;j<i.length;j++){var k=i[j];if(d!==k&&0===k.ques&&-1===k.qnum){var l=k.anum;if(!(l>0)){e=d.getQnum();break}e+=l,h.add(k)}}if(d.getQnum()!==e){if(this.checkOnly)return!1;h.seterr(1),a=!1}}}return a},checkAroundNumbers:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(!(d.getAnum()<=0)){var e=d.bx,f=d.by,g=new this.owner.CellList,h=b.cellinside(e,f,e+2,f+2);g.add(d),h.add(b.getc(e-2,f+2));for(var i=0;i<h.length;i++){var j=h[i];d!==j&&d.anum===j.anum&&g.add(j)}if(g.length>1){if(this.checkOnly)return!1;g.seterr(1),a=!1}}}return a}},FailCode:{nqAroundDup:["初めから出ている数字の周りに同じ数字が入っています。","There are same numbers around the pre-numbered cell."],nqAroundSumNe:["初めから出ている数字の周りに入る数の合計が正しくありません。","A sum of numbers around the pre-numbered cell is incorrect."]}});