/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("tateyoko",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart||this.mousemove?this.inputTateyoko():this.mouseend&&this.notInputted()&&this.clickTateyoko():this.owner.editmode&&this.mousestart&&this.inputqnum()},inputTateyoko:function(){var b=this.getcell();if(!b.isnull){var c=b.getaddr(),d=!1;if(this.mouseCell.isnull)this.firstPoint.set(this.inputPoint);else if(1===b.getQues());else if(null===this.inputData){if(b===this.mouseCell){var e=Math.abs(this.inputPoint.px-this.firstPoint.px),f=Math.abs(this.inputPoint.py-this.firstPoint.py);f>=8?(this.inputData=12,d=!0):e>=8&&(this.inputData=13,d=!0)}else{var g=this.getdir(this.prevPos,c);g===a.UP||g===a.DN?(this.inputData=12,d=!0):(g===a.LT||g===a.RT)&&(this.inputData=13,d=!0)}d&&(b.getQans()===this.inputData&&(this.inputData=0),this.firstPoint.reset())}else if(b!==this.mouseCell)if(0==this.inputData)this.inputData=0,d=!0;else{var g=this.getdir(this.prevPos,c);g===a.UP||g===a.DN?(this.inputData=12,d=!0):(g===a.LT||g===a.RT)&&(this.inputData=13,d=!0)}d&&(b.setQans(0!==this.inputData?this.inputData:0),b.draw()),this.prevPos=c,this.mouseCell=b}},clickTateyoko:function(){var a=this.getcell();a.isnull||1===a.getQues()||(a.setQans((this.btn.Left?{0:12,12:13,13:0}:{0:13,12:0,13:12})[a.getQans()]),a.draw())}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputqnum_tateyoko(a)||this.key_inputqnum(a)},key_inputqnum_tateyoko:function(a){var b=this.cursor.getTCC();return"q"!=a&&"q1"!=a&&"q2"!=a?!1:("q"==a&&(a=1!=b.getQues()?"q1":"q2"),"q1"==a?(b.setQues(1),b.setQans(0),b.setQnum()>4&&b.setQnum(-1)):"q2"==a&&b.setQues(0),this.prev=b,b.draw(),!0)}},Cell:{nummaxfunc:function(){var a=this.owner.board;return 1===this.ques?4:Math.max(a.qcols,a.qrows)},minnum:0},Board:{getBarInfo:function(){var a=new this.owner.AreaBarManager;return a.getBarInfo()}},BoardExec:{adjustBoardData:function(b,c){if(b&a.TURN)for(var d={0:0,12:13,13:12},e=this.owner.board.cellinside(c.x1,c.y1,c.x2,c.y2),f=0;f<e.length;f++){var g=e[f];g.setQans(d[g.getQans()])}}},AreaBarManager:{getBarInfo:function(){for(var a=this.owner.board,b=new this.owner.AreaInfo,c=0;c<a.cellmax;c++){var d=a.cell[c];b.id[c]=1===d.getQues()||0===d.getQans()?null:0}for(var c=0;c<a.cellmax;c++){var d=a.cell[c];if(b.emptyCell(d)){b.addRoom();for(var e=d.getaddr(),f=d.qans;!d.isnull&&d.qans===f;)b.addCell(d),12===f?e.move(0,2):e.move(2,0),d=e.getc()}}return b}},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.linecolor=this.linecolor_LIGHT,this.errbcolor1=this.errbcolor1_DARK},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawTateyokos(),this.drawBcellsAtNumber(),this.drawNumbers_tateyoko(),this.drawChassis(),this.drawTarget()},drawTateyokos:function(){for(var a=this.vinc("cell_tateyoko","crispEdges"),b=["c_bar1_","c_bar2_"],c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=e.id,g=(e.bx-1)*this.bw,h=(e.by-1)*this.bh,i=Math.max(this.cw/6,3),j=this.bw-i/2,k=e.error;1===k||4===k?(a.fillStyle=this.errlinecolor,i++):a.fillStyle=-1===k?this.errlinebgcolor:this.linecolor,12===e.qans?this.vnop(b[0]+f,this.FILL)&&a.fillRect(g+j,h,i,this.ch+1):this.vhide(b[0]+f),13===e.qans?this.vnop(b[1]+f,this.FILL)&&a.fillRect(g,h+j,this.cw+1,i):this.vhide(b[1]+f)}},drawBcellsAtNumber:function(){for(var a=this.vinc("cell_bcells","crispEdges"),b="c_full_",c=this.range.cells,d=0;d<c.length;d++){var e=c[d];if(1===e.ques){if(a.fillStyle=1===e.error?this.errcolor1:this.cellcolor,this.vnop(b+e.id,this.FILL)){var f=(e.bx-1)*this.bw,g=(e.by-1)*this.bh;a.fillRect(f,g,this.cw+1,this.ch+1)}}else this.vhide(b+e.id)}},drawNumbers_tateyoko:function(){for(var a=(this.vinc("cell_number","auto"),this.range.cells),b=0;b<a.length;b++){var c=a[b],d="cell_"+c.id,e=c.qnum;if(-1!==e){var f=1!==c.ques?this.fontcolor:"white",g=c.bx*this.bw,h=c.by*this.bh;this.dispnum(d,1,-2!=e?""+e:"?",10>e?.8:.75,f,g,h)}else this.hidenum(d)}}},Encode:{decodePzpr:function(){this.decodeTateyoko()},encodePzpr:function(){this.encodeTateyoko()},decodeTateyoko:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if("x"===e?f.ques=1:this.include(e,"o","s")?(f.ques=1,f.qnum=parseInt(e,29)-24):this.include(e,"0","9")||this.include(e,"a","f")?f.qnum=parseInt(e,16):"-"===e?(f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"i"===e&&(a+=parseInt(c.charAt(b+1),16)-1,b++),a++,a>=d.cellmax)break}this.outbstr=c.substr(b)},encodeTateyoko:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].ques,g=c.cell[d].qnum;0===f?-1===g?b++:-2===g?e=".":16>g?e=""+g.toString(16):256>g?e="-"+g.toString(16):(e="",b++):1===f&&(e=g>=0?(g+24).toString(29):"x"),0===b?a+=e:(e||15===b)&&(a+=1===b?"n"+e:"i"+b.toString(16)+e,b=0)}1===b?a+="n":b>1&&(a+="i"+b.toString(16)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){b>="a"&&"f">=b?(a.ques=1,a.qnum={a:1,b:2,c:3,d:4,e:0,f:-1}[b]):"?"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))}),this.decodeCell(function(a,b){"1"===b?a.qans=12:"2"===b&&(a.qans=13)})},encodeData:function(){this.encodeCell(function(a){return 1===a.ques?-1==a.qnum||-2==a.qnum?"f ":{0:"e ",1:"a ",2:"b ",3:"c ",4:"d "}[a.qnum]:-2===a.qnum?"? ":a.qnum>=0?""+a.qnum+" ":". "}),this.encodeCell(function(a){if(1!==a.ques){if(0===a.qans)return"0 ";if(12===a.qans)return"1 ";if(13===a.qans)return"2 "}return". "})}},AnsCheck:{checkAns:function(){var a=this.owner.board;if(!this.checkBCell(1))return"nmConnBarGt";var b=a.getBarInfo();return a.cell.seterr(-1),this.checkDoubleNumber(b)?this.checkNumberAndSize(b)?(a.cell.seterr(0),this.checkBCell(2)?this.checkEmptyCell()?null:"ceEmpty":"nmConnBarLt"):"bkSizeNe":"baPlNum"},check1st:function(){return this.checkEmptyCell()?null:"ceEmpty"},checkBCell:function(a){for(var b=!0,c=this.owner.board,d=0;d<c.cellmax;d++){var e=c.cell[d],f=e.getQnum();if(!(1!==e.getQues()||0>f)){var g,h=0,i=0;if(g=e.up(),g.isnull||(12===g.getQans()?h++:13===g.getQans()&&i++),g=e.dn(),g.isnull||(12===g.getQans()?h++:13===g.getQans()&&i++),g=e.lt(),g.isnull||(13===g.getQans()?h++:12===g.getQans()&&i++),g=e.rt(),g.isnull||(13===g.getQans()?h++:12===g.getQans()&&i++),1===a&&(f>4-i||h>f)||2===a&&f!==h){if(this.checkOnly)return!1;e.seterr(1),b=!1}}}return b},checkEmptyCell:function(){return this.checkAllCell(function(a){return 0===a.getQues()&&0===a.getQans()})}},FailCode:{bkSizeNe:["数字と棒の長さが違います。","The number is different from the length of line."],baPlNum:["1つの棒に2つ以上の数字が入っています。","A line passes plural numbers."],nmConnBarGt:["黒マスに繋がる線の数が正しくありません。","The number of lines connected to a black cell is wrong."],nmConnBarLt:["黒マスに繋がる線の数が正しくありません。","The number of lines connected to a black cell is wrong."]}})}();