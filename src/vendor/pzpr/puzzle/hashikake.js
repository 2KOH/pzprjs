/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("hashikake",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.btn.Left?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputpeke():this.owner.editmode&&this.mousestart&&this.inputqnum()},inputLine:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)){var b=this.getnb(this.prevPos,a);if(!b.isnull){var c=this.getdir(this.prevPos,a),d=b.getlinesize(),e=this.owner.board.borderinside(d.x1,d.y1,d.x2,d.y2),f=pzpr.consts;0!==this.prevblist.length&&this.prevblist.include(b)||(this.inputData=null),null===this.inputData&&(this.inputData=[1,2,0][b.getLineVal()]),this.inputData>0&&(c===f.UP||c===f.LT)&&e.reverse();for(var g=0;g<e.length;g++)e[g].setLineVal(this.inputData),e[g].setQsub(0);this.prevblist=e,this.owner.painter.paintRange(d.x1-1,d.y1-1,d.x2+1,d.y2+1)}this.prevPos=a}},prevblist:null,inputpeke:function(){var a=this.getpos(.22);if(!this.prevPos.equals(a)){var b=a.getb();if(!b.isnull){null===this.inputData&&(this.inputData=2!==b.getQsub()?2:0),b.setQsub(this.inputData);for(var c=b.getlinesize(),d=this.owner.board.borderinside(c.x1,c.y1,c.x2,c.y2),e=0;e<d.length;e++)d[e].setLineVal(0);this.prevPos=a,this.owner.painter.paintRange(c.x1-1,c.y1-1,c.x2+1,c.y2+1)}}},mousereset:function(){this.Common.prototype.mousereset.call(this),this.prevblist=new this.owner.BorderList}},KeyEvent:{enablemake:!0},Cell:{maxnum:8,getCountOfBridges:function(){for(var a=0,b=this.getdir4cblist(),c=0;c<b.length;c++){var d=b[c][1];!d.isnull&&d.line>0&&(a+=d.line)}return a},iscrossing:function(){return this.noNum()}},Border:{getlinesize:function(){var a=this.getaddr(),b=a.clone();if(this.isVert()){for(;a.move(-1,0).getc().noNum();)a.move(-1,0);for(;b.move(1,0).getc().noNum();)b.move(1,0)}else{for(;a.move(0,-1).getc().noNum();)a.move(0,-1);for(;b.move(0,1).getc().noNum();)b.move(0,1)}return a.getc().isnull||b.getc().isnull?{x1:-1,y1:-1,x2:-1,y2:-1}:{x1:a.bx,y1:a.by,x2:b.bx,y2:b.by}}},Board:{qcols:9,qrows:9,isborder:1},LineManager:{isCenterLine:!0,isLineCross:!0},AreaLineManager:{enabled:!0},Flags:{irowake:!0},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_THIN,this.bcolor="silver",this.fontsizeratio=.85,this.circleratio=[.47,.42],this.lwratio=8},paint:function(){this.drawGrid(!1,this.owner.editmode&&!this.outputImage),this.drawPekes(),this.drawLines_hashikake(),this.drawCircles(),this.drawNumbers(),this.drawTarget()},drawLines_hashikake:function(a){for(var b=this.vinc("line","crispEdges"),c=this.lw+this.addlw,d=this.lm,e=1.5*c,f=["b_line_","b_dline1_","b_dline2_"],g=this.range.borders,h=0;h<g.length;h++){var i=g[h],a=i.id,j=this.getLineColor(i);if(j){b.fillStyle=j;var k=i.isVert(),l=i.bx*this.bw,m=i.by*this.bh;1===i.line?this.vnop(f[0]+a,this.FILL)&&(k?b.fillRect(l-this.bw-d,m-d,this.cw+c,c):b.fillRect(l-d,m-this.bh-d,c,this.ch+c)):this.vhide(f[0]+a),2===i.line?(this.vnop(f[1]+a,this.FILL)&&(k?b.fillRect(l-this.bw-d,m-d-e,this.cw+c,c):b.fillRect(l-d-e,m-this.bh-d,c,this.ch+c)),this.vnop(f[2]+a,this.FILL)&&(k?b.fillRect(l-this.bw-d,m-d+e,this.cw+c,c):b.fillRect(l-d+e,m-this.bh-d,c,this.ch+c))):this.vhide([f[1]+a,f[2]+a])}else this.vhide([f[0]+a,f[1]+a,f[2]+a])}},getCircleStrokeColor:function(a){return a.isNum()?this.cellcolor:null},getCircleFillColor:function(a){if(a.isNum()){var b=this.getConfig("circolor")&&a.qnum===a.getCountOfBridges();return b?this.bcolor:1===a.error?this.errbcolor1:this.circledcolor}return null},repaintLines:function(a){this.range.borders=a,this.drawLines_hashikake(),this.use.canvas&&this.repaintParts(a)},repaintParts:function(a){this.range.cells=a.cellinside(),this.drawCirclesAtNumber_hashikake(),this.drawNumbers()}},Encode:{decodePzpr:function(){this.decodeNumber16()},encodePzpr:function(){this.encodeNumber16()},decodeKanpen:function(){this.owner.fio.decodeCellQnum_kanpen()},encodeKanpen:function(){this.owner.fio.encodeCellQnum_kanpen()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderLine()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderLine()},kanpenOpen:function(){this.decodeCell(function(a,b){b>="1"&&"8">=b?a.qnum=parseInt(b):"9"===b&&(a.qnum=-2)}),this.decodeCell(function(a,b){if("0"!==b){var c=parseInt(b),d=3&c;if(d>0){var e=a.ub(),f=a.db();e.isnull||(e.line=d),f.isnull||(f.line=d)}var g=(12&c)>>2;if(g>0){var h=a.lb(),i=a.rb();h.isnull||(h.line=g),i.isnull||(i.line=g)}}})},kanpenSave:function(){this.encodeCell(function(a){return a.qnum>0?a.qnum.toString()+" ":-2===a.qnum?"9 ":". "}),this.encodeCell(function(a){if(-1!==a.qnum)return"0 ";var b=a.ub(),c=a.lb(),d=b.isnull?0:b.line,e=c.isnull?0:c.line;return""+((d>0?d:0)+(e>0?e<<2:0))+" "})}},AnsCheck:{checkAns:function(){if(!this.checkCellNumberNotOver())return"nmLineCntGt";var a=this.owner.board.getLareaInfo();return this.checkOneLine(a)?this.checkCellNumberNotLess()?null:"nmLineCntLt":"lcDivided"},checkCellNumberNotOver:function(){return this.checkAllCell(function(a){return a.isValidNum()&&a.getQnum()<a.getCountOfBridges()})},checkCellNumberNotLess:function(){return this.checkAllCell(function(a){return a.isValidNum()&&a.getQnum()>a.getCountOfBridges()})}},FailCode:{nmLineCntGt:["数字につながる橋の数が違います。","The number of connecting bridges to a number is not correct."],nmLineCntLt:["数字につながる橋の数が違います。","The number of connecting bridges to a number is not correct."]}});