/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("amibo",{MouseEvent:{mouseinput:function(){this.owner.playmode?((this.mousestart||this.mousemove)&&(this.btn.Left?this.inputTateyoko():this.btn.Right&&this.inputpeke()),this.mouseend&&this.notInputted()&&this.clickTateyoko()):this.owner.editmode&&this.mousestart&&this.inputqnum()},inputTateyoko:function(){var b=this.getcell();if(!b.isnull){var c=b.getaddr(),d=!1;if(this.mouseCell.isnull)this.firstPoint.set(this.inputPoint);else if(b.isNum());else if(null===this.inputData){if(b===this.mouseCell){var e=Math.abs(this.inputPoint.px-this.firstPoint.px),f=Math.abs(this.inputPoint.py-this.firstPoint.py);f>=8?(this.inputData=1,d=!0):e>=8&&(this.inputData=2,d=!0)}else{var g=this.getdir(this.prevPos,c);g===a.UP||g===a.DN?(this.inputData=1,d=!0):(g===a.LT||g===a.RT)&&(this.inputData=2,d=!0)}d&&(b.getQans()&this.inputData&&(this.inputData*=-1),this.firstPoint.reset())}else if(b!==this.mouseCell){var g=this.getdir(this.prevPos,c);g===a.UP||g===a.DN?(this.inputData=this.inputData>0?1:-1,d=!0):(g===a.LT||g===a.RT)&&(this.inputData=this.inputData>0?2:-2,d=!0)}d&&(1===this.inputData?b.setQans([1,1,3,3][b.getQans()]):2===this.inputData?b.setQans([2,3,2,3][b.getQans()]):-1===this.inputData?b.setQans([0,0,2,2][b.getQans()]):-2===this.inputData&&b.setQans([0,1,0,1][b.getQans()]),b.draw()),this.prevPos=c,this.mouseCell=b}},clickTateyoko:function(){var a=this.getcell();a.isnull||a.isNum()||(a.setQans((this.btn.Left?[1,2,3,0]:[3,0,1,2])[a.getQans()]),a.draw())}},KeyEvent:{enablemake:!0},Cell:{numberIsWhite:!0,nummaxfunc:function(){var a=this.owner.board,b=this.bx,c=this.by,d=(b<a.maxbx>>1?a.maxbx-b:b)>>1,e=(c<a.maxby>>1?a.maxby-c:c)>>1;return Math.max(d,e)},minnum:2},Board:{isborder:1,qcols:8,qrows:8,initialize:function(){this.Common.prototype.initialize.call(this),this.barinfo=this.addInfoList("AreaBarManager")},irowakeRemake:function(){this.barinfo.newIrowake()},getBarInfo:function(){return this.barinfo.getBarInfo()}},BoardExec:{adjustBoardData:function(b){if(b&a.TURN)for(var c=this.owner.board.cell,d=0;d<c.length;d++){var e=c[d];e.setQans([0,2,1,3][e.getQans()])}}},"AreaBarManager:AreaManager":{enabled:!0,relation:["cell"],isvalid:function(a){return a.getQans()>0},rebuild:function(){pzpr.common.AreaManager.prototype.rebuild.call(this),this.newIrowake()},calcLinkInfo:function(a){var b=a.getQans(),c=[0,3,12,15][b];return(b>0?16:0)+c},irowakeEnable:function(){return this.owner.flags.irowake},irowakeValid:function(){return this.getConfig("irowake")},getNewColor:function(){return this.owner.painter.getNewLineColor()},getBarInfo:function(){function a(a,b,d){var g=a.getQans();g===b||3===g?(null===e&&(c.addRoom(d),e=c.max,null!==f&&c.pole[f.id].push(e)),c.addCell(a)):null!==e&&(c.pole[a.id].push(e),e=null),f=a}for(var b=this.owner.board,c=new this.owner.AreaBarInfo,d=b.minbx+1;d<=b.maxbx-1;d+=2)for(var e=null,f=null,g=b.minby+1;g<=b.maxby-1;g+=2)a(b.getc(d,g),1,!0);for(var g=b.minby+1;g<=b.maxby-1;g+=2)for(var e=null,f=null,d=b.minbx+1;d<=b.maxbx-1;d+=2)a(b.getc(d,g),2,!1);for(var h=0;h<b.cellmax;h++)if(2==c.id[h].length&&(c.room[c.id[h][0]].link.push(c.id[h][1]),c.room[c.id[h][1]].link.push(c.id[h][0])),b.cell[h].isNum())for(var i=0;i<c.pole[h].length;i++)c.room[c.pole[h][i]].pole.push(h);else c.pole[h]=[];return c}},"AreaBarInfo:AreaInfo":{initialize:function(){this.Common.prototype.initialize.call(this),this.pole=[];for(var a=0,b=this.owner.board.cellmax;b>a;a++)this.id[a]=[],this.pole[a]=[]},addRoom:function(a){var b={};b.clist=new this.owner.CellList,b.link=[],b.pole=[],b.vert=a,this.max++,this.room[this.max]=b},addCell:function(a){this.room[this.max].clist.add(a),this.id[a.id].push(this.max)}},CellList:{initialize:function(){this.link=[],this.pole=[],this.vert=!1},setErrorBar:function(){for(var a=this.vert,b=0;b<this.length;b++){var c=this[b],d=c.error;4===d||(5===d?a||c.seterr(4):6===d?a&&c.seterr(4):c.seterr(a?5:6))}}},Flags:{irowake:!0},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.linecolor=this.linecolor_LIGHT,this.fontcolor=this.fontErrcolor="black",this.fontsizeratio=.85,this.circleratio=[.45,.4]},setRange:function(a,b,c,d){this.Common.prototype.setRange.call(this,a-2,b-2,c+2,d+2)},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawTateyokos(),this.drawTateyokos_sub(),this.drawCircles(),this.drawNumbers(),this.drawPekeBorder(),this.drawChassis(),this.drawTarget()},getBarColor:function(a,b){var c=a.error,d="";return d=1===c||4===c||5===c&&b||6===c&&!b?this.errlinecolor:0!==c?this.errlinebgcolor:this.getConfig("irowake")&&a.color?a.color:this.linecolor},drawTateyokos:function(){for(var a=this.vinc("cell_tateyoko","crispEdges"),b=["c_bar1_","c_bar2_"],c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=e.id,g=Math.max(this.cw/6,3),h=this.bw-g/2,i=e.qans;if(-1!==i){var j=(e.bx-1)*this.bw,k=(e.by-1)*this.bh;1===i||3===i?(a.fillStyle=this.getBarColor(e,!0),this.vnop(b[0]+f,this.FILL)&&a.fillRect(j+h,k,g,this.ch+1)):this.vhide(b[0]+f),2===i||3===i?(a.fillStyle=this.getBarColor(e,!1),this.vnop(b[1]+f,this.FILL)&&a.fillRect(j,k+h,this.cw+1,g)):this.vhide(b[1]+f)}else this.vhide([b[0]+f,b[1]+f])}},drawTateyokos_sub:function(){var a=this.vinc("cell_tateyoko","crispEdges");a.fillStyle=this.linecolor;for(var b=["c_bars1_","c_bars2_","c_bars3_","c_bars4_"],c=this.range.cells,d=this.bw,e=this.bh,f=0;f<c.length;f++){var g=c[f],h=g.id;if(g.isNum()){var i=Math.max(this.cw/6,3),j=this.bw-i/2,k=g.bx*this.bw,l=g.by*this.bh,m=g.up(),n=m.qans;1===n||3===n?(a.fillStyle=this.getBarColor(m,!0),this.vnop(b[0]+h,this.FILL)&&a.fillRect(k-d+j,l-e,i,e)):this.vhide(b[0]+h);var m=g.dn(),n=m.qans;1===n||3===n?(a.fillStyle=this.getBarColor(m,!0),this.vnop(b[1]+h,this.FILL)&&a.fillRect(k-d+j,l+1,i,e)):this.vhide(b[1]+h);var m=g.lt(),n=m.qans;2===n||3===n?(a.fillStyle=this.getBarColor(m,!1),this.vnop(b[2]+h,this.FILL)&&a.fillRect(k-d,l-e+j,d,i)):this.vhide(b[2]+h);var m=g.rt(),n=m.qans;2===n||3===n?(a.fillStyle=this.getBarColor(m,!1),this.vnop(b[3]+h,this.FILL)&&a.fillRect(k+1,l-e+j,d,i)):this.vhide(b[3]+h)}else this.vhide([b[0]+h,b[1]+h,b[2]+h,b[3]+h])}},drawPekeBorder:function(){var a=this.vinc("border_pbd","crispEdges");a.fillStyle="rgb(64,64,64)";for(var b="b_qsub2_",c=.6*this.bw,d=this.range.borders,e=0;e<d.length;e++){var f=d[e];if(2===f.qsub){if(this.vnop(b+f.id,this.NONE)){var g=this.lw+this.addlw,h=this.lm,i=f.bx*this.bw,j=f.by*this.bh;f.isVert()?a.fillRect(i-h,j-c-h,g,2*c+g):a.fillRect(i-c-h,j-h,2*c+g,g)}}else this.vhide(b+f.id)}}},Encode:{decodePzpr:function(){this.decodeNumber10()},encodePzpr:function(){this.encodeNumber10()}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"l"===b?a.qans=1:"-"===b?a.qans=2:"+"===b?a.qans=3:"#"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(a){return 1===a.qans?"l ":2===a.qans?"- ":3===a.qans?"+ ":a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"# ":". "}),this.encodeBorderLine()}},AnsCheck:{checkAns:function(){var a=this.owner.board,b=a.getBarInfo();if(!this.checkOutgoingBars(b,1))return"nmLineGt1";if(a.cell.filter(function(a){return a.noNum()}).seterr(-1),!this.checkLoop())return"lbLoop";if(!this.checkPoleLength(b,1))return"lbLenGt";if(!this.checkCrossedLength(b))return"lbNotCrossEq";if(!this.checkPoleLength(b,2))return"lbLenLt";if(a.cell.seterr(0),!this.checkOutgoingBars(b,2))return"nmIsolate";var c=a.barinfo.getAreaInfo();return this.checkOneArea(c)?null:"lbDivide"},check1st:function(){var a=this.owner.board.barinfo.getAreaInfo();return this.checkOneArea(a)?null:"amiboDivided"},checkOutgoingBars:function(a,b){for(var c=!0,d=this.owner.board,e=0;e<d.cellmax;e++){var f=d.cell[e];if(f.isNum()){var g=a.pole[e];if(1===b&&g.length>1||2===b&&0===g.length){if(this.checkOnly)return!1;f.seterr(1),c=!1}}}return c},checkPoleLength:function(a,b){for(var c=!0,d=this.owner.board,e=0;e<d.cellmax;e++){var f=d.cell[e];if(f.isValidNum())for(var g=0,h=a.pole[e].length;h>g;g++){var i=f.getNum(),j=a.pole[e][g],k=a.room[j].clist,l=k.length;if(1===b&&l>i||2===b&&i>l){if(this.checkOnly)return!1;f.seterr(1),k.setErrorBar(),c=!1}}}return c},checkCrossedLength:function(a){for(var b=!0,c=1,d=a.max;d>=c;c++){for(var e=!1,f=a.room[c].link,g=a.room[c].clist,h=0,i=f.length;i>h;h++)if(g.length===a.room[f[h]].clist.length){e=!0;break}if(!e){if(this.checkOnly)return!1;g.setErrorBar(),b=!1}}return b},checkLoop:function(){for(var a={cell:[]},b=this.owner.board,c=0;c<b.cellmax;c++)a.cell[c]=b.barinfo.getLinkCell(b.cell[c]);for(var d=[],c=0;c<b.cellmax;c++)d[c]=0!==b.cell[c].getQans()?0:null;for(var c=0;c<b.cellmax;c++)0===d[c]&&this.searchloop(c,a,d);var e=b.cell.filter(function(a){return 1===d[a.id]});return e.length>0?(e.seterr(4),!1):!0},searchloop:function(a,b,c){for(var d=[],e=[a],f=0;f<this.owner.board.cellmax;f++)d[f]=!1;for(;e.length>0;){var f=e[e.length-1];d[f]=!0;var g=b.cell[f].length>0?b.cell[f][0]:null;if(null!==g){for(var h=0;h<b.cell[f].length;h++)b.cell[f][h]===g&&b.cell[f].splice(h,1);for(var h=0;h<b.cell[g].length;h++)b.cell[g][h]===f&&b.cell[g].splice(h,1);if(d[g]){c[g]=1;for(var h=e.length-1;h>=0&&e[h]!==g;h--)c[e[h]]=1}else e.push(g)}else{var i=e.pop();0===c[i]&&(c[i]=2)}}}},FailCode:{lbDivide:["棒が１つに繋がっていません。","Bars are devided."],lbLenGt:["白丸から出る棒の長さが長いです。","The length of the bar is long."],lbLenLt:["白丸から出る棒の長さが短いです。","The length of the bar is short."],lbLoop:["棒で輪っかができています。","There is a looped bars."],lbNotCrossEq:["同じ長さの棒と交差していません。","A bar doesn't cross the bar whose length is the same."],nmLineGt1:["白丸に線が2本以上つながっています。","Prural lines connect to a white circle."],nmIsolate:["白丸に線がつながっていません。","No bar connects to a white circle."]}})}();