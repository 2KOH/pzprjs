/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){pzpr.consts;pzpr.createCustoms("yosenabe",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart||this.mousemove?this.btn.Left?this.inputMoveLine():this.btn.Right&&this.inputpeke():this.mouseend&&this.notInputted()&&this.inputlight():this.owner.editmode&&(this.mousestart||this.mousemove?this.btn.Right&&this.inputNabe():this.mouseend&&this.notInputted()&&this.inputqnum_yosenabe())},inputlight:function(){var a=this.getcell();!a.isnull&&this.getConfig("circolor")&&this.inputdark(a)},inputdark:function(a){var b=this.getConfig("dispmove")?a.base:a;pc=this.owner.painter,distance=.3*pc.cw,dx=this.inputPoint.px-a.bx*pc.bw,dy=this.inputPoint.py-a.by*pc.bh,distance*distance>dx*dx+dy*dy&&(b.setQdark(0===b.getQdark()?1:0),b.draw())},inputNabe:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){if(a.isNum())return this.inputqnum(),void 0;if(-1!==a.getQnum2())return this.inputqnum_yosenabe(),void 0;null===this.inputData&&(this.inputData=a.ice()?0:6),a.setQues(this.inputData),a.drawaround(),this.mouseCell=a}},inputqnum_yosenabe:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(a!==this.cursor.getTCC()?this.setcursor(a):this.inputnumber_yosenabe(a),this.mouseCell=a)},inputnumber_yosenabe:function(a){var b,c,d=a.nummaxfunc(),e=-1;-1!==a.getQnum()?(b=a.getQnum(),c=1):-1!==a.getQnum2()?(b=a.getQnum2(),c=2):(b=-1,c=a.ice()?2:1),this.btn.Left?e=b===d?-1:-1===b?-2:-2===b?1:b+1:this.btn.Right&&(e=-1===b?d:-2===b?-1:1===b?-2:b-1),1===c?a.setQnum(e):2===c&&a.setQnum2(e),a.draw()}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputqnum_yosenabe(a)},key_inputqnum_yosenabe:function(a){var b,c=this.cursor.getTCC();if("q"===a||"q1"===a||"q2"===a)"q"===a&&(a=-1!==c.getQnum()?"q1":"q2"),"q1"===a&&-1!==c.getQnum()?(c.setQnum2(c.getQnum()),c.setQnum(-1)):"q2"===a&&-1!==c.getQnum2()&&(c.setQnum(c.getQnum2()),c.setQnum2(-1));else if("w"==a)c.setQues(c.ice()?0:6);else{var d=c.nummaxfunc(),e=-1,f=-1;if(-1!==c.getQnum()?(f=c.getQnum(),type=1):-1!==c.getQnum2()?(f=c.getQnum2(),type=2):(f=-1,type=c.ice()?2:1),a>="0"&&"9">=a){var b=parseInt(a);if((0>=f||10*f+b>d||this.prev!==c)&&(f=0),e=10*f+b,e>d)return}else if("-"===a)e=-2;else{if(" "!==a)return;e=-1}1===type?c.setQnum(e):2===type&&c.setQnum2(e)}this.prev=c,c.draw()}},Cell:{isDark:function(){return 1===(this.getConfig("dispmove")?this.base:this).qdark}},CellList:{getDeparture:function(){return this.map(function(a){return a.base}).notnull()},getSumOfFilling:function(){for(var a=0,b=0,c=this.length;c>b;b++)this[b].base.isValidNum()&&(a+=this[b].base.qnum);return a}},Board:{qcols:8,qrows:8,isborder:1,initialize:function(){this.Common.prototype.initialize.call(this),this.iceinfo=this.addInfoList("AreaCrockManager")}},LineManager:{isCenterLine:!0},AreaLineManager:{enabled:!0,moveline:!0},"AreaCrockManager:AreaManager":{enabled:!0,relation:["cell"],isvalid:function(a){return a.ice()}},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.icecolor="rgb(224,224,224)",this.setBGCellColorFunc("icebarn"),this.setBorderColorFunc("ice"),this.fontsizeratio=.85},paint:function(){this.drawBGCells(),this.drawGrid(),this.drawBorders(),this.drawTip(),this.drawDepartures(),this.drawLines(),this.drawCircles(),this.drawNumbers(),this.drawFillingNumBase(),this.drawFillingNumbers(),this.drawPekes(),this.drawChassis(),this.drawTarget()},drawNumber1:function(a){var b="cell_"+a.id,c=a.qnum;if(this.getConfig("dispmove")&&(c=a.base.qnum),c>0){var d=""+c,e=10>c?.8:100>c?.7:.55,f=this.getCellNumberColor(a);this.dispnum(b,1,d,e,f,a.bx*this.bw,a.by*this.bh)}else this.hidenum(b)},getCellNumberColor:function(a){return a===this.owner.mouse.mouseCell?this.movecolor:1===a.error||4===a.error?this.fontErrcolor:this.fontcolor},getCircleFillColor:function(a){var b=a.error,c=this.getConfig("dispmove"),d=(c?a.base:a).qnum;return-1!==d?1===b||4===b?this.errbcolor1:this.getConfig("circolor")&&a.isDark()?"silver":this.circledcolor:null},drawFillingNumBase:function(){for(var a=this.vinc("cell_filling_back","crispEdges"),b="c_full_nb_",c=this.getConfig("dispmove"),d=this.range.cells,e=0;e<d.length;e++){var f=d[e],g=this.getBGCellColor(f);if(g&&-1!==f.qnum2&&c&&f.isDestination()){if(a.fillStyle=g,this.vnop(b+f.id,this.FILL)){var h=(f.bx-.9)*this.bw,i=(f.by-.9)*this.bh;a.fillRect(h,i,.4*this.cw,.4*this.ch)}}else this.vhide(b+f.id)}},drawFillingNumbers:function(){this.vinc("cell_filling_number","auto");this.boldreq=!0;for(var a=this.getConfig("dispmove"),b=this.range.cells,c=0;c<b.length;c++){var d=b[c],e="cell5_"+d.id,f=d.qnum2;if(-1!==f){var g=f>=0?""+f:"?",h=1,i=.9*(10>f?.8:100>f?.7:.55),j=this.getCellNumberColor(d);a&&d.isDestination()&&(i*=.6,h=5),this.dispnum(e,h,g,i,j,d.bx*this.bw,d.by*this.bh)}else this.hidenum(e)}this.boldreq=!1}},Encode:{decodePzpr:function(){this.decodeIcelom(),this.decodeNumber16_yosenabe()},encodePzpr:function(){this.encodeIcelom(),this.encodeNumber16_yosenabe()},decodeIcelom:function(){for(var a=this.outbstr,b=this.owner.board,c=0,d=0,e=[16,8,4,2,1],f=0;f<a.length;f++){for(var g=parseInt(a.charAt(f),32),h=0;5>h;h++)d<b.cellmax&&(b.cell[d].ques=g&e[h]?6:0,d++);if(d>=b.cellmax){c=f+1;break}}this.outbstr=a.substr(c)},encodeIcelom:function(){for(var a="",b=0,c=0,d=[16,8,4,2,1],e=this.owner.board,f=0;f<e.cellmax;f++)6===e.cell[f].ques&&(c+=d[b]),b++,5==b&&(a+=c.toString(32),b=0,c=0);b>0&&(a+=c.toString(32)),this.outbstr+=a},decodeNumber16_yosenabe:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","9")||this.include(f,"a","f")?e.qnum=parseInt(f,16):"-"==f?(e.qnum=parseInt(c.substr(b+1,2),16),b+=2):"."==f?e.qnum=-2:"i"==f?(e.qnum2=parseInt(c.substr(b+1,1),16),b+=1):"g"==f?(e.qnum2=parseInt(c.substr(b+1,2),16),b+=2):"h"==f?e.qnum2=-2:f>="j"&&"z">=f&&(a+=parseInt(f,36)-19),a++,a>=d.cellmax)break}this.outbstr=c.substr(b+1)},encodeNumber16_yosenabe:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qnum,g=c.cell[d].qnum2;-2==f?e=".":f>=0&&16>f?e=f.toString(16):f>=16&&256>f?e="-"+f.toString(16):-2==g?e="h":g>=0&&16>g?e="i"+g.toString(16):g>=16&&256>g?e="g"+g.toString(16):a++,0==a?b+=e:(e||17==a)&&(b+=(18+a).toString(36)+e,a=0)}a>0&&(b+=(18+a).toString(36)),this.outbstr+=b}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"i"==b.charAt(0)&&(a.ques=6,b=b.substr(1)),"o"==b.charAt(0)?(b=b.substr(1),a.qnum=b?parseInt(b):-2):b&&"."!==b&&(a.qnum2=parseInt(b))}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(a){var b="";return 6===a.ques&&(b+="i"),-1!==a.qnum?(b+="o",a.qnum>=0&&(b+=a.qnum.toString())):a.qnum2>0&&(b+=a.qnum2.toString()),(b?b:".")+" "}),this.encodeBorderLine()}},AnsCheck:{checkAns:function(){var a=this.owner.board;if(!this.checkLineCount(3))return"lnBranch";if(!this.checkLineCount(4))return"lnCross";var b=a.getLareaInfo();if(!this.checkDoubleObject(b))return"nmConnected";if(!this.checkLineOverLetter())return"laOnNum";if(!this.checkCurveLine(b))return"laCurve";if(!this.checkQuesNumber())return"bnIllegalPos";var c=a.iceinfo.getAreaInfo();return this.checkDoubleNumberInNabe(c)?this.checkFillingCount(c)?this.checkNoMovedObjectInRoom(c)?this.checkFillingOutOfNabe()?this.checkDisconnectLine(b)?null:"laIsolate":"nmOutOfBk":"bkNoNum":"bkSumNeBn":"bkDoubleBn"},checkCurveLine:function(a){return this.checkAllArea(a,function(a,b){return 1===a||1===b})},checkQuesNumber:function(){return this.checkAllCell(function(a){return!a.ice()&&-1!==a.getQnum2()})},checkDoubleNumberInNabe:function(a){return this.checkAllBlock(a,function(a){return-1!==a.getQnum2()},function(a,b,c){return 2>c})},checkFillingOutOfNabe:function(){return this.checkAllCell(function(a){return a.isDestination()&&!a.ice()})},checkFillingCount:function(a){for(var b=!0,c=1;c<=a.max;c++){for(var d=a.room[c].clist,e=null,f=0;f<d.length;f++){var g=d[f].getQnum2();if(-1!==g){if(null!==e&&e!==g){e=null;break}e=g}}if(null!==e){var h=d.getSumOfFilling();if(h>0&&e!==h){if(this.checkOnly)return!1;d.getDeparture().seterr(4),d.seterr(1),b=!1}}}return b}},FailCode:{laOnNum:["具材の上を線が通過しています。","A line goes through a filling."],laIsolate:["具材につながっていない線があります。","A line doesn't connect any filling."],nmConnected:["具材が繋がっています。","There are connected fillings."],nmOutOfBk:["鍋に入っていない具材があります。","A filling isn't in a crock."],bnIllegalPos:["鍋の外に数字が書いてあります。","There is a number out of a crock."],bkDoubleBn:["鍋に数字が２つ以上書いてあります。","There is two or more numbers in a crock."],bkSumNeBn:["具材の合計値が正しくありません。","Sum of filling is not equal to a crock."],bkNoNum:["具材のない鍋があります。","A crock has no circle."]}})}();