/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("shakashaka",{MouseEvent:{mouseinput:function(){if(this.owner.playmode){var a=+this.getConfig("use_tri");1===a?this.btn.Left?this.mousestart?this.inputTriangle_corner():this.mousemove&&null!==this.inputData&&this.inputMove():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputDot():2===a?this.btn.Left?this.mousestart?this.inputTriangle_pull_start():this.mousemove&&null===this.inputData?this.inputTriangle_pull_move():this.mousemove&&null!==this.inputData?this.inputMove():this.mouseend&&this.notInputted()&&this.inputTriangle_pull_end():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputDot():3===a&&this.mousestart&&this.inputTriangle_onebtn()}else this.owner.editmode&&this.mousestart&&this.inputqnum()},inputMove:function(){this.inputData>=2&&this.inputData<=5?this.inputTriangle_drag():(0===this.inputData||-1===this.inputData)&&this.inputDot()},inputTriangle_corner:function(){var a=this.getcell();a.isnull||a.isNum()||(this.inputData=this.checkCornerData(a),this.inputData===a.getQans()&&(this.inputData=0),a.setAnswer(this.inputData),this.mouseCell=a,a.draw())},checkCornerData:function(a){var b=this.owner.painter.bw,c=this.owner.painter.bh,d=this.inputPoint.px-a.bx*b,e=this.inputPoint.py-a.by*c;return 0>=d?0>=e?5:2:0>=e?4:3},inputTriangle_pull_start:function(){var a=this.getcell();return a.isnull||a.isNum()?(this.mousereset(),void 0):(this.firstPoint.set(this.inputPoint),this.mouseCell=a,void 0)},inputTriangle_pull_move:function(){var a=this.mouseCell,b=this.inputPoint.px-this.firstPoint.px,c=this.inputPoint.py-this.firstPoint.py,d=12;-d>=b&&c>=d?this.inputData=2:-d>=b&&-d>=c?this.inputData=5:b>=d&&c>=d?this.inputData=3:b>=d&&-d>=c&&(this.inputData=4),null!==this.inputData&&(this.inputData===a.getQans()&&(this.inputData=0),a.setAnswer(this.inputData)),a.draw()},inputTriangle_pull_end:function(){var a=this.inputPoint.px-this.firstPoint.px,b=this.inputPoint.py-this.firstPoint.py;if(Math.abs(a)<=3&&Math.abs(b)<=3){var c=this.mouseCell;c.setAnswer(1!==c.getQsub()?-1:0),c.draw()}},inputTriangle_drag:function(){if(!(null===this.inputData||this.inputData<=0)){var a=this.getcell();if(!a.isnull&&!a.isNum()){var b=a.bx-this.mouseCell.bx,c=a.by-this.mouseCell.by,d=this.checkCornerData(a),e=null,f=this.inputData;2===b&&2===c||-2===b&&-2===c?(2===f||4===f)&&(e=f):2===b&&-2===c||-2===b&&2===c?(3===f||5===f)&&(e=f):0===b&&-2===c?((2===f||3===f)&&d!==f||(4===f||5===f)&&d===f)&&(e=[null,null,5,4,3,2][f]):0===b&&2===c?((4===f||5===f)&&d!==f||(2===f||3===f)&&d===f)&&(e=[null,null,5,4,3,2][f]):-2===b&&0===c?((3===f||4===f)&&d!==f||(2===f||5===f)&&d===f)&&(e=[null,null,3,2,5,4][f]):2===b&&0===c&&((2===f||5===f)&&d!==f||(3===f||4===f)&&d===f)&&(e=[null,null,3,2,5,4][f]),null!==e&&(a.setAnswer(e),this.inputData=e,this.mouseCell=a,a.draw())}}},inputDot:function(){var a=this.getcell();a.isnull||a.isNum()||(null===this.inputData&&(this.inputData=1===a.getQsub()?0:-1),a.setAnswer(this.inputData),this.mouseCell=a,a.draw())},inputTriangle_onebtn:function(){var a=this.getcell();if(!a.isnull&&!a.isNum()){var b=a.getAnswer();this.btn.Left?this.inputData=[0,2,1,3,4,5,-1][b+1]:this.btn.Right&&(this.inputData=[5,-1,1,0,2,3,4][b+1]),a.setAnswer(this.inputData),this.mouseCell=a,a.draw()}}},KeyEvent:{enablemake:!0},Cell:{numberIsWhite:!0,maxnum:4,minnum:0,getAnswer:function(){return this.isNum()?0:this.qans>0?this.qans:1===this.qsub?-1:0},setAnswer:function(a){this.isNum()||(this.setQans(a>=2&&5>=a?a:0),this.setQsub(-1===a?1:0))},isTri:function(){return 0!==this.qans}},Board:{getSlopeWareaInfo:function(){for(var a=new this.owner.AreaInfo,b=0;b<this.cellmax;b++)a.id[b]=this.cell[b].noNum()?0:null;for(var b=0;b<this.cellmax;b++)if(a.emptyCell(this.cell[b])){a.addRoom();for(var c=[this.cell[b]];c.length>0;){var d=c.pop();if(a.emptyCell(d)){a.addCell(d);var e,f,g=d.getQans();f=d.up(),f.isnull||(e=f.getQans(),a.emptyCell(f)&&4!==g&&5!==g&&2!==e&&3!==e&&c.push(f)),f=d.dn(),f.isnull||(e=f.getQans(),a.emptyCell(f)&&2!==g&&3!==g&&4!==e&&5!==e&&c.push(f)),f=d.lt(),f.isnull||(e=f.getQans(),a.emptyCell(f)&&2!==g&&5!==g&&3!==e&&4!==e&&c.push(f)),f=d.rt(),f.isnull||(e=f.getQans(),a.emptyCell(f)&&3!==g&&4!==g&&2!==e&&5!==e&&c.push(f))}}}return a}},BoardExec:{adjustBoardData:function(a){var b=pzpr.consts,c=[];switch(a){case b.FLIPY:c=[0,1,5,4,3,2];break;case b.FLIPX:c=[0,1,3,2,5,4];break;case b.TURNR:c=[0,1,5,2,3,4];break;case b.TURNL:c=[0,1,3,4,5,2];break;default:return}for(var d=this.owner.board.cell,e=0;e<d.length;e++){var f=d[e],g=c[f.qans];g&&(f.qans=g)}}},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.fontcolor=this.fontErrcolor="white",this.setCellColorFunc("qnum")},paint:function(){this.drawBGCells(),this.drawDotCells(!1),this.drawDashedGrid(),this.drawBlackCells(),this.drawNumbers(),this.drawTriangle(),this.drawChassis(),this.drawTarget()}},Encode:{decodePzpr:function(){this.decode4Cell()},encodePzpr:function(){this.encode4Cell()},decodeKanpen:function(){this.owner.fio.decodeCellQnumb()},encodeKanpen:function(){this.owner.fio.encodeCellQnumb()}},FileIO:{decodeData:function(){this.decodeCellQnumb(),this.decodeCellQanssub()},encodeData:function(){this.encodeCellQnumb(),this.encodeCellQanssub()},kanpenOpen:function(){this.decodeCell(function(a,b){"5"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))}),this.decodeCell(function(a,b){"+"===b?a.qsub=1:"."!==b&&(a.qans=parseInt(b))})},kanpenSave:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"5 ":". "}),this.encodeCell(function(a){return 1===a.qsub?"+ ":a.qans>=2?a.qans.toString()+" ":". "})}},AnsCheck:{checkAns:function(){return this.checkOverTriangle()?this.checkWhiteArea()?this.checkLessTriangle()?null:"nmTriangleLt":"wcNotRectx":"nmTriangleGt"},checkOverTriangle:function(){return this.checkDir4Cell(function(a){return a.isTri()},2)},checkLessTriangle:function(){return this.checkDir4Cell(function(a){return a.isTri()},1)},checkWhiteArea:function(){for(var a=!0,b=this.owner.board.getSlopeWareaInfo(),c=1;c<=b.max;c++){var d=b.room[c].clist,e=d.getRectSize(),f=d.filter(function(a){return 0===a.getQans()}).length;if(e.cols*e.rows!=f&&!this.isAreaRect_slope(b,c)){if(this.checkOnly)return!1;d.seterr(1),a=!1}}return a},isAreaRect_slope:function(a,b){for(var c=a.room[b].clist,d=0;d<c.length;d++){var e=c[d],f=e.getQans();if((4==f||5==f)^(e.up().isnull||a.getRoomID(e.up())!=b)||(2==f||3==f)^(e.dn().isnull||a.getRoomID(e.dn())!=b)||(2==f||5==f)^(e.lt().isnull||a.getRoomID(e.lt())!=b)||(3==f||4==f)^(e.rt().isnull||a.getRoomID(e.rt())!=b))return!1}return!0}},FailCode:{wcNotRectx:["白マスが長方形(正方形)ではありません。","A mass of white cells is not rectangle."],nmTriangleGt:["数字のまわりにある黒い三角形の数が間違っています。","The number of triangles in four adjacent cells is bigger than it."],nmTriangleLt:["数字のまわりにある黒い三角形の数が間違っています。","The number of triangles in four adjacent cells is smaller than it."]}});