/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("tentaisho",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart||this.mousemove?(this.mousestart&&this.btn.Left&&this.checkBorderMode(),this.bordermode?this.inputborder_tentaisho():this.inputQsubLine()):this.mouseend&&this.notInputted()&&this.inputBGcolor3():this.owner.editmode&&(this.mousestart&&this.btn.Left?this.inputstar():(this.mousestart||this.mousemove)&&this.btn.Right&&this.inputBGcolor1())},inputBGcolor1:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(null===this.inputData&&(this.inputData=0===a.getQsub()?3:0),a.setQsub(this.inputData),this.mouseCell=a,a.draw())},inputBGcolor3:function(){if(!pzpr.EDITOR||!this.getConfig("discolor")){var a=this.getpos(.34),b=a.gets();if(null!==b&&0!==b.getStar()){var c=b.validcell();if(null!==c){var d=this.owner.board.rooms.getClistByCell(c);d.encolor()&&d.draw()}}}},inputborder_tentaisho:function(){var a=this.getpos(.34);if(!this.prevPos.equals(a)){var b=this.getborderobj(this.prevPos,a);b.isnull||(null===this.inputData&&(this.inputData=0===b.getQans()?1:0),b.setQans(this.inputData),b.draw()),this.prevPos=a}},inputstar:function(){var a=this.getpos(.25);if(!this.prevPos.equals(a)){var b=a.gets();null!==b&&(this.btn.Left?b.setStar({0:1,1:2,2:0}[b.getStar()]):this.btn.Right&&b.setStar({0:2,1:0,2:1}[b.getStar()]),b.draw()),this.prevPos=a}}},KeyEvent:{enablemake:!0,moveTarget:function(a){return this.moveTBorder(a)},keyinput:function(a){this.key_inputstar(a)},key_inputstar:function(a){var b=this.cursor.getTCP(),c=b.gets();null!==c&&("1"==a?c.setStar(1):"2"==a?c.setStar(2):(" "==a||"-"==a||"0"==a||"3"==a)&&c.setStar(0),c.draw())}},Cell:{qnum:0,minnum:0,disInputHatena:!0,subclear:function(){1===this.qsub&&(this.owner.opemgr.addOpe_Object(this,pzpr.consts.QSUB,1,0),this.qsub=0),this.error=0}},Cross:{qnum:0,minnum:0},Border:{qnum:0,minnum:0},Star:{bx:null,by:null,isnull:!0,id:null,obj:null,getStar:function(){return this.obj.getQnum()},setStar:function(a){this.owner.opemgr.disCombine=!0,this.obj.setQnum(a),this.owner.opemgr.disCombine=!1},iserror:function(){return this.obj.error>0},validcell:function(){var a=this.obj,b=null;return a.iscellobj?b=a:a.iscrossobj&&0===this.owner.board.rooms.crosscnt[a.id]?b=a.relcell(-1,-1):a.isborderobj&&0===a.getQans()&&(b=a.sidecell[0]),b},draw:function(){this.owner.painter.paintRange(this.bx-1,this.by-1,this.bx+1,this.by+1)},getaddr:function(){return new this.owner.Address(this.bx,this.by)}},Address:{gets:function(){return this.owner.board.gets(this.bx,this.by)},getobj:function(){return this.owner.board.getobj(this.bx,this.by)}},CellList:{encolor:function(){for(var a=this.getAreaStarInfo().star,b=!1,c=null!==a?a.getStar():0,d=0;d<this.length;d++){var e=this[d];pzpr.EDITOR&&3===e.getQsub()&&2!=c||e.getQsub()!==(c>0?c:0)&&(e.setQsub(c>0?c:0),b=!0)}return b},getAreaStarInfo:function(){for(var a={star:null,err:-1},b=0;b<this.length;b++)for(var c=this[b],d=this.owner.board.starinside(c.bx,c.by,c.bx+1,c.by+1),e=0;e<d.length;e++){var f=d[e];if(f.getStar()>0&&null!==f.validcell()){if(0===a.err)return{star:null,err:-2};a={star:f,err:0}}}return a}},Board:{iscross:1,isborder:1,initialize:function(){this.Common.prototype.initialize.call(this),this.star=[]},initBoardSize:function(a,b){this.Common.prototype.initBoardSize.call(this,a,b),this.initStar(a,b)},starmax:0,star:[],initStar:function(a,b){this.starmax=(2*a-1)*(2*b-1),this.star=[];for(var c=(new this.owner.Address(0,0),0);c<this.starmax;c++){this.star[c]=new this.owner.Star;var d=this.star[c];d.id=c,d.isnull=!1,d.bx=c%(2*a-1)+1,d.by=(c/(2*a-1)|0)+1,d.obj=d.getaddr().getobj()}},gets:function(a,b,c,d){var e=null;return void 0===c&&(c=this.qcols,d=this.qrows),0>=a||a>=c<<1||0>=b||b>=d<<1||(e=a-1+(b-1)*(2*c-1)),null!==e?this.star[e]:null},starinside:function(a,b,c,d){for(var e=new this.owner.PieceList,f=b;d>=f;f++)for(var g=a;c>=g;g++){var h=this.gets(g,f);null!==h&&e.add(h)}return e},encolorall:function(){for(var a=this.getRoomInfo(),b=1;b<=a.max;b++)a.room[b].clist.encolor();this.owner.redraw()},getAreaStarInfoAll:function(){for(var a=this.getRoomInfo(),b=1;b<=a.max;b++){var c=a.room[b],d=c.clist.getAreaStarInfo();c.star=d.star,c.error=d.err}return a}},BoardExec:{adjustBoardData2:function(){var a=this.owner.board;a.initStar(a.qcols,a.qrows)}},AreaRoomManager:{enabled:!0},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.borderQanscolor="rgb(72, 72, 72)",this.qsubcolor1="rgb(176,255,176)",this.qsubcolor2="rgb(108,108,108)",this.errbcolor1=this.errbcolor1_DARK,this.setBGCellColorFunc("qsub3")},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawQansBorders(),this.drawBorderQsubs(),this.drawStars(),this.drawChassis(),this.drawTarget_tentaisho()},drawStars:function(){var a=this.vinc("star","auto");a.lineWidth=Math.max(.04*this.cw,1);for(var b=["s_star1_","s_star2_"],c=this.range,d=this.owner.board.starinside(c.x1,c.y1,c.x2,c.y2),e=0;e<d.length;e++){var f=d[e],g=f.id,h=f.bx,i=f.by;1===f.getStar()?(a.strokeStyle=f.iserror()?this.errcolor1:this.cellcolor,a.fillStyle="white",this.vnop(b[0]+g,this.STROKE)&&a.shapeCircle(h*this.bw,i*this.bh,.16*this.cw)):this.vhide(b[0]+g),2===f.getStar()?(a.fillStyle=f.iserror()?this.errcolor1:this.cellcolor,this.vnop(b[1]+g,this.FILL)&&a.fillCircle(h*this.bw,i*this.bh,.18*this.cw)):this.vhide(b[1]+g)}},drawTarget_tentaisho:function(){this.drawCursor(!1,this.owner.editmode)}},Encode:{decodePzpr:function(){this.decodeStar()},encodePzpr:function(){this.encodeStar()},decodeKanpen:function(){this.owner.fio.decodeStarFile()},encodeKanpen:function(){this.owner.fio.encodeStarFile()},decodeStar:function(a){var b=this.owner.board;b.disableInfo();for(var c=0,a=this.outbstr,d=0;d<a.length;d++){var e=b.star[c],f=a.charAt(d);if(this.include(f,"0","f")){var g=parseInt(f,16);e.setStar(g%2+1),c+=(g>>1)+1}else this.include(f,"g","z")&&(c+=parseInt(f,36)-15);if(c>=b.starmax)break}b.enableInfo(),this.outbstr=a.substr(d+1)},encodeStar:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.starmax;d++){var e="",f=c.star[d];if(f.getStar()>0){for(var g=1;7>=g;g++){var h=c.star[d+g];if(h&&h.getStar()>0){e=""+(2*(g-1)+(f.getStar()-1)).toString(16),d+=g-1;break}}""===e&&(e=(13+f.getStar()).toString(16),d+=7)}else a++;0==a?b+=e:(e||20==a)&&(b+=(a+15).toString(36)+e,a=0)}a>0&&(b+=(a+15).toString(36)),this.outbstr+=b}},FileIO:{decodeData:function(){this.decodeStarFile(),this.decodeBorderAns(),this.decodeCellQsub()},encodeData:function(){this.encodeStarFile(),this.encodeBorderAns(),this.encodeCellQsub()},kanpenOpen:function(){this.decodeStarFile(),this.decodeAnsAreaRoom()},kanpenSave:function(){this.encodeStarFile(),this.encodeAnsAreaRoom()},decodeStarFile:function(){var a=this.owner.board,b=this.readLines(2*a.qrows-1),c=0;a.disableInfo();for(var d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++){var f=a.star[c];"1"===b[d].charAt(e)?f.setStar(1):"2"===b[d].charAt(e)&&f.setStar(2),c++}a.enableInfo()},encodeStarFile:function(){for(var a=this.owner.board,b=0,c=1;c<=2*a.qrows-1;c++){for(var d=1;d<=2*a.qcols-1;d++){var e=a.star[b];this.datastr+=1===e.getStar()?"1":2===e.getStar()?"2":".",b++}this.datastr+="\n"}}},AnsCheck:{checkAns:function(){if(!this.checkStarOnLine())return"bkNoStar";var a=this.owner.board.getAreaStarInfoAll();return this.checkErrorFlag(a,-1)?this.checkFractal(a)?this.checkErrorFlag(a,-2)?null:"bkPlStar":"bkNotSymSt":"bdPassStar"},checkStarOnLine:function(){for(var a=!0,b=this.owner.board,c=0;c<b.starmax;c++){var d=b.star[c];if(!(d.getStar()<=0)&&null===d.validcell()){if(this.checkOnly)return!1;d.obj.iscrossobj?d.obj.setCrossBorderError():d.obj.isborderobj&&d.obj.seterr(1),a=!1}}return a},checkFractal:function(a){for(var b=!0,c=1;c<=a.max;c++){var d=a.room[c].clist,e=a.room[c].star;if(null!==e)for(var f=0;f<d.length;f++){var g=d[f],h=this.owner.board.getc(2*e.bx-g.bx,2*e.by-g.by);if(h.isnull||a.getRoomID(g)!==a.getRoomID(h)){if(this.checkOnly)return!1;d.seterr(1),b=!1}}}return b},checkErrorFlag:function(a,b){for(var c=!0,d=1;d<=a.max;d++)if(a.room[d].error===b){if(this.checkOnly)return!1;a.room[d].clist.seterr(1),c=!1}return c}},FailCode:{bkNoStar:["星が含まれていない領域があります。","A block has no stars."],bdPassStar:["星を線が通過しています。","A line goes over the star."],bkNotSymSt:["領域が星を中心に点対称になっていません。","An area is not point symmetric about the star."],bkPlStar:["星が複数含まれる領域があります。","A block has two or more stars."]}});