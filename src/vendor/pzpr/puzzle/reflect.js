/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("reflect",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.btn.Left?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputpeke():this.owner.editmode&&this.mousestart&&this.inputQues([0,2,3,4,5,11])},inputRed:function(){this.dispRedLine()}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputLineParts(a)||this.key_inputqnum(a)},key_inputLineParts:function(a){var b=this.cursor.getTCC();if("q"==a)b.setQues(2),b.setQnum(-1);else if("w"==a)b.setQues(3),b.setQnum(-1);else if("e"==a)b.setQues(4),b.setQnum(-1);else if("r"==a)b.setQues(5),b.setQnum(-1);else if("t"==a)b.setQues(11),b.setQnum(-1);else{if("y"!=a)return!1;b.setQues(0),b.setQnum(-1)}return b.drawaround(),!0}},Cell:{disInputHatena:!0,minnum:3,getTriLine:function(){var a,b=new this.owner.BorderList;for(a=this.lb();!a.isnull&&a.isLine();)b.add(a),a=a.relbd(-2,0);for(a=this.rb();!a.isnull&&a.isLine();)b.add(a),a=a.relbd(2,0);for(a=this.ub();!a.isnull&&a.isLine();)b.add(a),a=a.relbd(0,-2);for(a=this.db();!a.isnull&&a.isLine();)b.add(a),a=a.relbd(0,2);return b}},Border:{enableLineNG:!0},Board:{isborder:1},BoardExec:{adjustBoardData:function(a,b){var c=pzpr.consts;if(a&c.TURNFLIP){var d={};switch(a){case c.FLIPY:d={2:5,3:4,4:3,5:2};break;case c.FLIPX:d={2:3,3:2,4:5,5:4};break;case c.TURNR:d={2:5,3:2,4:3,5:4};break;case c.TURNL:d={2:3,3:4,4:5,5:2}}for(var e=this.owner.board.cellinside(b.x1,b.y1,b.x2,b.y2),f=0;f<e.length;f++){var g=e[f],h=d[g.getQues()];h&&g.setQues(h)}}}},LineManager:{isCenterLine:!0,isLineCross:!0},Flags:{redline:!0,irowake:1},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawPekes(),this.drawLines(),this.drawTriangle(),this.drawTriangleBorder(),this.drawNumbers(),this.draw11s(),this.drawChassis(),this.drawTarget()},drawTriangleBorder:function(){for(var a=this.vinc("cell_triangle_border","crispEdges"),b="b_tb_",c=this.range.borders,d=0;d<c.length;d++){var e=c[d],f=e.isVert(),g=e.sidecell[0].ques,h=e.sidecell[1].ques,i=e.bx*this.bw,j=e.by*this.bh;a.fillStyle=this.gridcolor,!f||3!==g&&4!==g||2!==h&&5!==h?f||2!==g&&3!==g||4!==h&&5!==h?this.vhide(b+e.id):this.vnop(b+e.id,this.NONE)&&a.fillRect(i-this.bw,j,this.cw,1):this.vnop(b+e.id,this.NONE)&&a.fillRect(i,j-this.bh,1,this.ch)}},draw11s:function(){for(var a=this.vinc("cell_ques","crispEdges"),b=["c_lp1_","c_lp2_"],c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=e.id;if(11===e.ques){var g=this.lw+2,h=(g-1)/2,i=.76*this.cw,j=e.bx*this.bw,k=e.by*this.bh;a.fillStyle=this.cellcolor,this.vnop(b[0]+f,this.NONE)&&a.fillRect(j+.5-h,k+.5-i/2,g,i),this.vnop(b[1]+f,this.NONE)&&a.fillRect(j+.5-i/2,k+.5-h,i,g)}else this.vhide([b[0]+f,b[1]+f])}},drawNumber1:function(a){var b=["cell",a.id].join("_");if(a.ques>=2&&a.ques<=5&&a.qnum>0){var c=a.bx*this.bw,d=a.by*this.bh;this.dispnum(b,a.ques,""+a.qnum,.45,"white",c,d)}else this.hidenum(b)},repaintParts:function(a){this.range.cells=a.cellinside(),this.draw11s()}},Encode:{decodePzpr:function(){this.decodeReflectlink()},encodePzpr:function(){this.encodeReflectlink()},decodeReflectlink:function(){for(var a=0,b=this.outbstr,c=this.owner.board,d=0;d<b.length;d++){var e=b.charAt(d),f=c.cell[a];if("5"===e?f.ques=11:this.include(e,"1","4")?(f.ques=parseInt(e)+1,f.qnum=parseInt(b.substr(d+1,1),16),d++):this.include(e,"6","9")?(f.ques=parseInt(e)-4,f.qnum=parseInt(b.substr(d+1,2),16),d+=2):this.include(e,"a","z")&&(a+=parseInt(e,36)-10),0===f.qnum&&(f.qnum=-1),a++,a>=c.cellmax)break}this.outbstr=b.substr(d)},encodeReflectlink:function(){for(var a="",b="",c=0,d=this.owner.board,e=0;e<d.cellmax;e++){var f=d.cell[e].ques;if(11===f)b="5";else if(f>=2&&5>=f){var g=d.cell[e].qnum;0>=g?b=""+(f-1)+"0":g>=1&&16>g?b=""+(f-1)+g.toString(16):g>=16&&256>g&&(b=""+(f+4)+g.toString(16))}else b="",c++;0===c?a+=b:(b||26===c)&&(a+=(9+c).toString(36)+b,c=0)}c>0&&(a+=(9+c).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"+"===b?a.ques=11:"."!==b&&(a.ques=parseInt(b.charAt(0))+1,b.length>1&&(a.qnum=parseInt(b.substr(1))))}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(a){return 11===a.ques?"+ ":a.ques>=2&&a.ques<=5?""+(a.ques-1)+(-1!==a.qnum?a.qnum:"")+" ":". "}),this.encodeBorderLine()}},AnsCheck:{checkAns:function(){return this.checkLineCount(3)?this.checkCrossOutOfMark()?this.checkTriNumber(1)?this.checkTriangle()?this.checkTriNumber(2)?this.checkNotCrossOnMark()?this.checkLineCount(1)?this.checkOneLoop()?null:"lnPlLoop":"lnDeadEnd":"lnNotCrossMk":"lnLenLt":"lnExTri":"lnLenGt":"lnCrossExMk":"lnBranch"},checkCrossOutOfMark:function(){return this.checkAllCell(function(a){return 4===a.lcnt()&&11!==a.getQues()})},checkNotCrossOnMark:function(){return this.checkAllCell(function(a){return 4!==a.lcnt()&&11===a.getQues()})},checkTriangle:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(0==d.lcnt()&&d.getQues()>=2&&d.getQues()<=5){if(this.checkOnly)return!1;d.seterr(4),a=!1}}return a},checkTriNumber:function(a){for(var b=!0,c=this.owner.board,d=0;d<c.cellmax;d++){var e=c.cell[d];if(!(e.getQues()<2||e.getQues()>5)&&e.isValidNum()){var f=e.getTriLine();if(1==a?e.getQnum()<f.length+1:e.getQnum()>f.length+1){if(this.checkOnly)return!1;e.seterr(4),b&&c.border.seterr(-1),f.seterr(1),b=!1}}}return b}},FailCode:{lnExTri:["線が三角形を通過していません。","A line doesn't goes through a triangle."],lnLenGt:["三角形の数字とそこから延びる線の長さが一致していません。","A number on triangle is not equal to sum of the length of lines from it."],lnLenLt:["三角形の数字とそこから延びる線の長さが一致していません。","A number on triangle is not equal to sum of the length of lines from it."]}});