/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("toichika",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart||this.mousemove?this.btn.Left?this.inputarrow_cell():this.btn.Right&&this.inputDot():this.mouseend&&this.notInputted()&&this.inputqnum():this.owner.editmode&&(this.mousestart||this.mousemove?this.isBorderMode()?this.inputborder():this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum())},inputDot:function(){var a=this.getcell();a.isnull||a===this.mouseCell||-1!==a.getQnum()||(null===this.inputData&&(this.inputData=1===a.getQsub()?0:1),a.setAnum(-1),a.setQsub(1===this.inputData?1:0),this.mouseCell=a,a.draw())}},KeyEvent:{enablemake:!0,moveTarget:function(a){return this.isSHIFT?!1:this.moveTCell(a)},keyinput:function(a){this.key_toichika(a)},key_toichika:function(a){"1"===a||"w"===a||this.isSHIFT&&a===this.KEYUP?a="1":"2"===a||"s"===a||this.isSHIFT&&a===this.KEYRT?a="4":"3"===a||"z"===a||this.isSHIFT&&a===this.KEYDN?a="2":"4"===a||"a"===a||this.isSHIFT&&a===this.KEYLT?a="3":"5"===a||"q"===a||"-"===a?a="s1":("6"===a||"e"===a||" "===a)&&(a=" "),this.key_inputqnum(a)}},Cell:{numberAsObject:!0,maxnum:4},Board:{hasborder:1,getPairedArrowsInfo:function(){for(var a=pzpr.consts,b=[],c=[],d=0;d<this.cellmax;d++)c[d]=this.cell[d].isNum();for(var d=0;d<this.cellmax;d++){var e=this.cell[d];if(!e.noNum())for(var f=e.getaddr(),g=e.getNum();;){f.movedir(g,2);var h=f.getc();if(h.isnull){b.push([e.id]);break}if(c[h.id]){b.push(h.getNum()!==[0,a.DN,a.UP,a.RT,a.LT][g]?[e.id]:[h.id,e.id]);break}}}return b}},BoardExec:{adjustBoardData:function(a,b){this.adjustCellArrow(a,b)}},AreaRoomManager:{enabled:!0},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.dotcolor=this.dotcolor_PINK},paint:function(){this.drawBGCells(),this.drawGrid(),this.drawBorders(),this.drawDotCells(!0),this.drawCellArrows(),this.drawHatenas(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(){this.decodeBorder(),this.decode4Cell_toichika()},encodePzpr:function(){this.encodeBorder(),this.encode4Cell_toichika()},decode4Cell_toichika:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"1","4")?e.qnum=parseInt(c.substr(b,1),10):"."===f?e.qnum=-2:a+=parseInt(f,36)-5,a++,a>=d.cellmax)break}this.outbstr=c.substr(b)},encode4Cell_toichika:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qnum;-2===f?e=".":f>=1&&4>=f?e=f.toString(10):b++,0===b?a+=e:(e||31===b)&&(a+=(4+b).toString(36)+e,b=0)}b>0&&(a+=(4+b).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAnumsub()}},AnsCheck:{checkAns:function(){var a=this.owner.board.getRoomInfo();if(!this.checkDoubleNumber(a))return"bkNumGe2";var b=this.owner.board.getPairedArrowsInfo();return this.checkAdjacentCountries(a,b)?this.checkDirectionOfArrow(b)?this.checkNoNumber(a)?null:"bkNoNum":"arAlone":"arAdjPair"},checkDirectionOfArrow:function(a){for(var b=!0,c=0;c<a.length;c++)1===a[c].length&&(this.owner.board.cell[a[c]].seterr(1),b=!1);return b},checkAdjacentCountries:function(a,b){for(var c=a.getSideAreaInfo(),d=[],e=1;e<=a.max-1;e++){d[e]=[];for(var f=0;f<c[e].length;f++)d[e][c[e][f]]=!0;for(var g=e+1;g<=a.max;g++)d[e][g]||(d[e][g]=!1)}for(var h=!0,f=0;f<b.length;f++)if(1!==b[f].length){var i=a.id[b[f][0]],j=a.id[b[f][1]];(j>i?d[i][j]:d[j][i])>0&&(a.room[i].clist.seterr(1),a.room[j].clist.seterr(1),h=!1)}return h}},FailCode:{bkNoNum:["国に矢印が入っていません。","A country has no arrow."],bkNumGe2:["1つの国に2つ以上の矢印が入っています。","A country has plural arrows."],arAdjPair:["辺を共有する国にペアとなる矢印が入っています。","There are paired arrows in adjacent countries."],arAlone:["矢印の先にペアとなる矢印がいません。","There is not paired arrow in the direction of an arrow."]}});