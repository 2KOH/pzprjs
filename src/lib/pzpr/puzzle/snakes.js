/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("snakes",{MouseEvent:{mouseinput:function(){this.owner.playmode?(this.mousestart||this.mousemove)&&(this.inputDot_snakes()||this.dragnumber_snakes()):this.owner.editmode&&(this.mousestart||this.mousemove&&this.notInputted())&&this.inputdirec(),this.mouseend&&this.notInputted()&&this.inputqnum_snakes()},dragnumber_snakes:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(this.mouseCell.isnull?(this.inputData=-1!==a.getAnum()?a.getAnum():10,this.mouseCell=a):-1==a.getQnum()&&this.inputData>=1&&this.inputData<=5?(this.btn.Left?this.inputData++:this.btn.Right&&this.inputData--,this.inputData>=1&&this.inputData<=5&&(a.setQdir(0),a.setAnum(this.inputData),a.setQsub(0),this.mouseCell=a,a.draw())):-1===a.getQnum()&&10==this.inputData&&(a.setAnum(-1),a.setQsub(0),a.draw()))},inputDot_snakes:function(){if(!this.btn.Right||null!==this.inputData&&this.inputData>=0)return!1;var a=this.getcell();return a.isnull||a===this.mouseCell?this.inputData<0:null===this.inputData?-1===a.getAnum()?(this.inputData=1!==a.getQsub()?-2:-3,!0):!1:(a.setAnum(-1),a.setQsub(-2===this.inputData?1:0),a.draw(),this.mouseCell=a,!0)},inputqnum_snakes:function(){var a=this.getcell();a.isnull||(this.owner.playmode&&(a.minnum=1),this.mouseCell=this.owner.board.emptycell,this.inputqnum(),a.minnum=0)}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.isSHIFT?!1:this.moveTCell(a)},keyinput:function(a){this.owner.editmode&&this.key_inputdirec(a)||(!this.owner.playmode||"q"!==a&&"-"!==a||(a="s1"),this.key_inputqnum(a))}},Cell:{maxnum:5,minnum:0,draw:function(){this.owner.getConfig("snakebd")?this.owner.painter.paintRange(this.bx-2,this.by-2,this.bx+2,this.by+2):this.getaddr().draw()}},Board:{hasborder:1,getSnakeInfo:function(){for(var a=new this.owner.AreaInfo,b=0;b<this.cellmax;b++)a.id[b]=this.cell[b].getAnum()>0?0:-1;for(var b=0;b<this.cellmax;b++)if(a.emptyCell(this.cell[b])){a.addRoom();for(var c=[this.cell[b]];c.length>0;){var d=c.pop();if(a.emptyCell(d)){a.addCell(d);for(var e=d.getdir4clist(),f=0;f<e.length;f++){var g=e[f][0];1===Math.abs(d.getAnum()-g.getAnum())&&c.push(g)}}}}return a}},BoardExec:{adjustBoardData:function(a,b){this.adjustNumberArrow(a,b)}},Flags:{use:!0},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.dotcolor=this.dotcolor_PINK,this.fontcolor=this.fontErrcolor="white",this.setCellColorFunc("qnum")},paint:function(){this.drawBGCells(),this.drawDotCells(!0),this.drawDashedGrid(),this.drawBorders(),this.drawBlackCells(),this.drawArrowNumbers(),this.drawAnswerNumbers(),this.drawChassis(),this.drawCursor()},getBorderColor:function(a){if(!this.owner.getConfig("snakebd"))return!1;var b=a.sidecell[0],c=a.sidecell[1];return b.isnull||c.isnull||-1!==b.qnum||-1!==c.qnum||-1===b.anum&&-1===c.anum||!(-1===b.anum^-1===c.anum||1!==Math.abs(b.anum-c.anum))?null:this.borderQanscolor},drawAnswerNumbers:function(){for(var a=(this.vinc("cell_number","auto"),this.range.cells),b=0;b<a.length;b++){var c=a[b],d="cell_"+c.id;if(-1===c.qnum&&c.anum>0){var e=c.bx*this.bw,f=c.by*this.bh;this.dispnum(d,1,""+c.anum,.8,this.fontAnscolor,e,f)}}}},Encode:{decodePzpr:function(){this.decodeArrowNumber16()},encodePzpr:function(){this.encodeArrowNumber16()}},FileIO:{decodeData:function(){this.decodeCellDirecQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeCellDirecQnum(),this.encodeCellAnumsub()}},AnsCheck:{checkAns:function(){var a=this.owner.board.getSnakeInfo();return this.checkSnakeSize(a)?this.checkDiffAnsNumberInRoom(a)?this.checkSideCell2(a)?this.checkArrowNumber()?this.checkSnakesView(a)?null:"snakeAttack":"anNumberNe":"sbSnake":"bkDupNum":"bkSizeNe5"},checkSnakeSize:function(a){return this.checkAllArea(a,function(a,b,c){return 5===c})},checkDiffAnsNumberInRoom:function(a){return this.checkDifferentNumberInRoom(a,function(a){return a.getAnum()})},checkSideCell2:function(a){for(var b=!0,c=this.owner.board,d=function(a,b,c){var d=a.getRoomID(b),e=a.getRoomID(c);return d>0&&e>0&&d!==e},e=0;e<c.cellmax;e++){var f=c.cell[e],g=f.rt();if(!g.isnull&&d(a,f,g)){if(this.checkOnly)return!1;a.getclistbycell(f).seterr(1),a.getclistbycell(g).seterr(1),b=!1}if(g=f.dn(),!g.isnull&&d(a,f,g)){if(this.checkOnly)return!1;a.getclistbycell(f).seterr(1),a.getclistbycell(g).seterr(1),b=!1}}return b},checkArrowNumber:function(){for(var a=!0,b=this.owner.board,c=function(){return i=j.getc(),!i.isnull&&-1===i.qnum&&-1===i.anum},d=function(a){return a.isnull||-1!==a.qnum||-1===a.anum},e=0;e<b.cellmax;e++){var f=b.cell[e],g=f.getQnum(),h=f.getQdir();if(!(0>g||0===h)){var i,j=f.getaddr();for(j.movedir(h,2);c();)j.movedir(h,2);if(0!==g||d(i)){if(g>0&&(d(i)||i.anum!==g)){if(this.checkOnly)return!1;f.seterr(1),i.seterr(1),a=!1}}else{if(this.checkOnly)return!1;f.seterr(1),0>=g&&i.seterr(1),a=!1}}}return a},checkSnakesView:function(a){for(var b=pzpr.consts,c=!0,d=1;d<=a.max;d++){var e=a.room[d].clist,f=e.filter(function(a){return 1===a.getAnum()})[0];if(f){var g,h=b.NDIR;if(g=f.dn(),g.isnull||2!==g.getAnum()||(h=b.UP),g=f.up(),g.isnull||2!==g.getAnum()||(h=b.DN),g=f.rt(),g.isnull||2!==g.getAnum()||(h=b.LT),g=f.lt(),g.isnull||2!==g.getAnum()||(h=b.RT),h!==b.NDIR){var i=f.getaddr(),j=new this.owner.CellList;for(j.add(f);!f.isnull&&(i.movedir(h,2),f=i.getc(),f.isnull||j.add(f),!f.isnull&&-1===f.qnum&&-1===f.anum););var k=a.getRoomID(f);if(!f.isnull&&f.getAnum()>0&&-1===f.getQnum()&&k>0&&d!=k){if(this.checkOnly)return!1;j.seterr(1),e.seterr(1),a.room[k].clist.seterr(1),c=!1}}}}return c}},FailCode:{bkDupNum:["同じ数字が入っています。","A Snake has same plural marks."],bkSizeNe5:["大きさが５ではない蛇がいます。","The size of a snake is not five."],sbSnake:["別々の蛇が接しています。","Other snakes are adjacent."],anNumberNe:["矢印の方向に境界線がありません。","There is no border in front of the arrowed number."],snakeAttack:["蛇の視線の先に別の蛇がいます。","A snake can see another snake."]}});