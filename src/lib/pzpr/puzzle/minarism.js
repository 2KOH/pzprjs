/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("minarism",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart&&this.inputqnum():this.owner.editmode&&(this.mousestart||this.mousemove?this.btn.Left&&this.inputmark_mousemove():this.mouseend&&this.notInputted()&&this.inputmark_mouseup())},inputmark_mousemove:function(){var a=this.getpos(0);if(!a.getc().isnull){var b=this.getnb(this.prevPos,a);return b.isnull?void(this.prevPos=a):(this.inputData=this.getdir(this.prevPos,a),b.setQdir(this.inputData!==b.getQdir()?this.inputData:0),b.draw(),void this.mousereset())}},inputmark_mouseup:function(){var a=this.getpos(.33);if(a.isinside())if(this.cursor.pos.equals(a)){var b=a.getb();if(!b.isnull)return;var c=b.getQnum(),d=b.getQdir(),e=b.isHorz()?0:2,f=Math.max(this.owner.board.qcols,this.owner.board.qrows)-1;this.btn.Left?-1===c&&0===d?(b.setQnum(-1),b.setQdir(e+1)):-1===c&&d===e+1?(b.setQnum(-1),b.setQdir(e+2)):-1===c&&d===e+2?(b.setQnum(1),b.setQdir(0)):c===f?(b.setQnum(-2),b.setQdir(0)):-2===c?(b.setQnum(-1),b.setQdir(0)):b.setQnum(id,c+1):this.btn.Right&&(-1===c&&0===d?(b.setQnum(-2),b.setQdir(0)):-2===c?(b.setQnum(f),b.setQdir(0)):1===c&&0===d?(b.setQnum(-1),b.setQdir(e+2)):-1===c&&d===e+2?(b.setQnum(-1),b.setQdir(e+1)):-1===c&&d===e+1?(b.setQnum(-1),b.setQdir(0)):b.setQnum(id,c-1)),b.draw()}else this.setcursorpos(a),a.draw()}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.owner.editmode?this.moveTBorder(a):this.owner.playmode?this.moveTCell(a):!1},keyinput:function(a){this.owner.editmode?this.key_inputmark(a):this.owner.playmode&&this.key_inputqnum(a)},key_inputmark:function(b){var c=this.cursor.getTBC();if(!c.isnull){if("q"==b||"w"==b||"e"==b||" "==b||"-"==b){var d=a.NDIR;"q"==b&&(d=c.isHorz()?a.UP:a.LT),"w"==b&&(d=c.isHorz()?a.DN:a.RT),c.setQdir(c.getQdir()!==d?d:a.NDIR),c.setQnum(-1)}else{if(!(b>="0"&&"9">=b))return;var e=parseInt(b),f=c.getQnum(),g=Math.max(this.owner.board.qcols,this.owner.board.qrows)-1;c.setQdir(a.NDIR),0>=f||this.prev!==c?g>=e&&c.setQnum(e):g>=10*f+e?c.setQnum(10*f+e):g>=e&&c.setQnum(e)}this.prev=c,c.draw()}}},TargetCursor:{adjust_modechange:function(){this.pos.bx-=(this.pos.bx+1)%2,this.pos.by-=(this.pos.by+1)%2}},Cell:{nummaxfunc:function(){return Math.max(this.owner.board.qcols,this.owner.board.qrows)}},Board:{qcols:7,qrows:7,hasborder:1},BoardExec:{adjustBoardData:function(a,b){this.adjustBorderArrow(a,b)}},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT},paint:function(){this.drawBDBase(),this.drawBGCells(),this.drawDashedGrid(),this.drawBDNumbers_and_IneqSigns(),this.drawNumbers(),this.drawChassis(),this.drawTarget_minarism()},drawBDBase:function(){var a=this.vinc("border_base","auto");if(a.use.canvas)for(var b=.29*this.cw,c=this.range.borders,d=0;d<c.length;d++){var e=c[d];if(0!==e.qdir||-1!==e.qnum){var f=e.bx*this.bw,g=e.by*this.bh;a.fillStyle="white",a.fillRect(f-b,g-b,2*b+1,2*b+1)}}},drawBDNumbers_and_IneqSigns:function(){var b=this.vinc("border_marks","auto"),c=.27*this.cw,d=.22*this.cw,e=["b_cp_","b_is1_","b_is2_"];b.lineWidth=1,b.strokeStyle=this.cellcolor;for(var f=this.range.borders,g=0;g<f.length;g++){var h=f[g],i=h.id,j=["border",i].join("_"),k=h.bx*this.bw,l=h.by*this.bh;if(-1!=h.qnum?(b.fillStyle=1===h.error?this.errcolor1:"white",this.vnop(e[0]+i,this.FILL)&&b.shapeCircle(k,l,c)):this.vhide([e[0]+i]),h.qnum>0?this.dispnum(j,1,""+h.qnum,.45,"black",k,l):this.hidenum(j),this.vhide([e[1]+i,e[2]+i]),h.qdir!==a.NDIR&&this.vnop(e[(h.qdir+1&1)+1]+i,this.NONE)){switch(h.qdir){case a.UP:b.setOffsetLinePath(k,l,-d,+d,0,-d,+d,+d,!1);break;case a.DN:b.setOffsetLinePath(k,l,-d,-d,0,+d,+d,-d,!1);break;case a.LT:b.setOffsetLinePath(k,l,+d,-d,-d,0,+d,+d,!1);break;case a.RT:b.setOffsetLinePath(k,l,-d,-d,+d,0,-d,+d,!1)}b.stroke()}}},drawTarget_minarism:function(){this.drawCursor(this.owner.playmode)}},Encode:{decodePzpr:function(a){this.decodeMinarism(a)},encodePzpr:function(a){this.encodeMinarism(a)},decodeMinarism:function(b){for(var c=0,d=0,e=0,f=this.outbstr,g=this.owner.board,h=0;h<f.length;h++){var i=f.charAt(h);b===a.URL_PZPRAPP&&(c<g.qcols*g.qrows?e=c/g.qcols|0:c<2*g.qcols*g.qrows&&(e=g.qrows));var j=g.border[c-e],k=0;if(this.include(i,"0","9")||this.include(i,"a","f")?j.qnum=parseInt(i,16):"-"===i?(j.qnum=parseInt(f.substr(h+1,2),16),h+=2):"."===i?j.qnum=-2:"g"===i?k=b===a.URL_PZPRV3||c<g.qcols*g.qrows?1:2:"h"===i?k=b===a.URL_PZPRV3||c<g.qcols*g.qrows?2:1:this.include(i,"i","z")?c+=parseInt(i,36)-18:b===a.URL_PZPRAPP&&"/"===i&&(c=g.cellmax-1),1===k?j.qdir=j.isHorz()?a.UP:a.LT:2===k&&(j.qdir=j.isHorz()?a.DN:a.RT),c++,c>=2*g.qcols*g.qrows){d=h+1;break}}this.outbstr=f.substr(d)},encodeMinarism:function(b){for(var c="",d=0,e=this.owner.board,f=0,g=e.bdmax+(b===a.URL_PZPRV3?0:e.qcols);g>f;f++){if(1===b&&(f>0&&f<=(e.qcols-1)*e.qrows&&f%(e.qcols-1)==0&&d++,f==(e.qcols-1)*e.qrows&&(d>0&&(c+=(17+d).toString(36),d=0),c+="/")),f<e.bdmax){var h="",i=e.border[f].qdir,j=e.border[f].qnum;i===a.UP||i===a.LT?h=b===a.URL_PZPRV3||f<e.cellmax?"g":"h":i===a.DN||i===a.RT?h=b===a.URL_PZPRV3||f<e.cellmax?"h":"g":-2===j?h=".":j>=0&&16>j?h=""+j.toString(16):j>=16&&256>j?h="-"+j.toString(16):d++}else d++;0==d?c+=h:(h||18==d)&&(c+=(17+d).toString(36)+h,d=0)}d>0&&(c+=(17+d).toString(36)),this.outbstr+=c}},FileIO:{decodeData:function(){this.decodeBorder(function(b,c){"a"===c?b.qdir=b.isHorz()?a.UP:a.LT:"b"===c?b.qdir=b.isHorz()?a.DN:a.RT:"."===c?b.qnum=-2:"0"!==c&&(b.qnum=parseInt(c))}),this.decodeCellAnumsub()},encodeData:function(){this.encodeBorder(function(b){var c=b.qdir;return c===a.UP||c===a.LT?"a ":c===a.DN||c===a.RT?"b ":-2===b.qnum?". ":-1!==b.qnum?""+b.qnum.toString()+" ":"0 "}),this.encodeCellAnumsub()}},AnsCheck:{checkAns:function(){return this.checkRowsColsSameNumber()?this.checkBDnumber()?this.checkBDmark()?this.checkNoNumCell()?null:"ceEmpty":"nmIneqNe":"nmSubNe":"nmDupRow"},check1st:function(){return this.checkNoNumCell()?null:"ceEmpty"},checkRowsColsSameNumber:function(){return this.checkRowsCols(this.isDifferentNumberInClist,function(a){return a.getNum()})},checkBDnumber:function(){return this.checkBDSideCell(function(a,b,c){return a.getQnum()>0&&a.getQnum()!==Math.abs(b-c)})},checkBDmark:function(){return this.checkBDSideCell(function(a,b,c){var d=a.getQdir();return!(0==d||(1===d||3===d)&&c>b||(2===d||4===d)&&b>c)})},checkBDSideCell:function(a){for(var b=!0,c=this.owner.board,d=0;d<c.bdmax;d++){var e=c.border[d],f=e.sidecell[0],g=e.sidecell[1],h=f.getNum(),i=g.getNum();if(h>0&&i>0&&a(e,h,i)){if(this.checkOnly)return!1;f.seterr(1),g.seterr(1),b=!1}}return b}},FailCode:{nmSubNe:["丸付き数字とその両側の数字の差が一致していません。","The Difference between two Adjacent cells is not equal to the number on circle."],nmIneqNe:["不等号と数字が矛盾しています。","A inequality sign is not correct."],ceEmpty:["数字の入っていないマスがあります。","There is an empty cell."]}})}();