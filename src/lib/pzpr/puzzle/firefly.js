/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("firefly",{MouseEvent:{mouseinput:function(){if(this.owner.playmode)this.btn.Left?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputpeke();else if(this.owner.editmode){if(!this.notInputted())return;this.mousestart||this.mousemove?this.inputdirec():this.mouseend&&this.prevPos.getc()===this.getcell()&&this.inputqnum()}}},KeyEvent:{enablemake:!0,moveTarget:function(a){return this.isSHIFT?!1:this.moveTCell(a)},keyinput:function(a){this.key_inputdirec(a)||this.key_inputqnum(a)}},Cell:{minnum:0},Board:{hasborder:1},BoardExec:{adjustBoardData:function(a,b){this.adjustNumberArrow(a,b)}},LineManager:{isCenterLine:!0},AreaLineManager:{enabled:!0},Flags:{irowake:!0},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.fontErrcolor=this.fontcolor,this.fontsizeratio=.85},paint:function(){this.drawDashedCenterLines(),this.drawLines(),this.drawPekes(),this.drawFireflies(),this.drawNumbers(),this.drawTarget()},drawFireflies:function(){var b=this.vinc("cell_firefly","auto");b.lineWidth=1.5,b.strokeStyle=this.cellcolor;for(var c=.4*this.cw,d=.1*this.cw,e=["c_cira_","c_cirb_"],f=this.range.cells,g=0;g<f.length;g++){var h=f[g],i=h.id;if(-1!==h.qnum){var j=h.bx*this.bw,k=h.by*this.bh;if(b.fillStyle=1===h.error?this.errbcolor1:"white",this.vnop(e[0]+i,this.FILL)&&b.shapeCircle(j,k,c),this.vdel([e[1]+i]),0!==h.qdir){switch(b.fillStyle=this.cellcolor,h.qdir){case a.UP:k-=c-1;break;case a.DN:k+=c-1;break;case a.LT:j-=c-1;break;case a.RT:j+=c-1}this.vnop(e[1]+i,this.NONE)&&b.fillCircle(j,k,d)}}else this.vhide([e[0]+i,e[1]+i])}},repaintParts:function(a){this.range.cells=a.cellinside(),this.drawFireflies(),this.drawNumbers()}},Encode:{decodePzpr:function(){this.decodeArrowNumber16()},encodePzpr:function(){this.encodeArrowNumber16()}},FileIO:{decodeData:function(){this.decodeCellDirecQnum(),this.decodeBorderLine()},encodeData:function(){this.encodeCellDirecQnum(),this.encodeBorderLine()}},AnsCheck:{checkAns:function(){if(!this.checkLineCount_firefly(3))return"lnBranch";if(!this.checkLineCount_firefly(4))return"lnCross";var a=this.getErrorFlag_line();if(!this.checkErrorFlag_line(a,4))return"lcInvDirB";if(!this.checkErrorFlag_line(a,3))return"lcInvDirW";if(!this.checkErrorFlag_line(a,2))return"lcCurveNe";if(!this.checkErrorFlag_line(a,1))return"lcDeadEnd";var b=this.owner.board.getLareaInfo();return this.checkOneArea(b)?this.checkLineCount_firefly(1)?this.checkFireflyBeam()?null:"nmNoLine":"lnDeadEnd":"lcDivided"},checkLineCount_firefly:function(a){return 0==this.owner.board.lines.ltotal[a]?!0:this.checkAllCell(function(b){return b.noNum()&&b.lcnt()==a})},checkFireflyBeam:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c],e=d.getQdir();if(!d.noNum()&&0!==e&&!d.getaddr().movedir(e,1).getb().isLine()){if(this.checkOnly)return!1;d.seterr(1),a=!1}}return a},isErrorFlag_line:function(b){var c=b.room[b.max],d=c.ccnt,e=(c.length,c.cells[0]),f=c.cells[1],g=c.dir1,h=c.dir2,i=e.getQdir(),j=f.isnull?a.NDIR:f.getQdir(),k=-1,l=0;g===i^h===j&&(k=(g===i?e:f).getQnum()),f.isnull||g!==i||h!==j?f.isnull||g===i||h===j?!f.isnull&&k>=0&&k!==d?(l=2,c.cells=[e]):f.isnull&&(l=1):l=3:l=4,c.error=l}},FailCode:{nmNoLine:["ホタルから線が出ていません。","There is a lonely firefly."],lcInvDirB:["黒点同士が線で繋がっています。","Black points are connected each other."],lcInvDirW:["白丸の、黒点でない部分どうしがくっついています。","Fireflies are connected without a line starting from black point."],lcCurveNe:["線の曲がった回数が数字と違っています。","The number of curves is different from a firefly's number."]}})}();