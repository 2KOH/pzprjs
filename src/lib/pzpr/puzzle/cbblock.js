/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("cbblock",{MouseEvent:{mouseinput:function(){this.owner.playmode?(this.mousestart||this.mousemove)&&(this.btn.Left&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.owner.editmode&&(this.mousestart||this.mousemove)&&this.inputborder()}},Border:{ques:1,enableLineNG:!0,isLineNG:function(){return 1===this.ques},isGround:function(){return this.ques>0}},Board:{qcols:8,qrows:8,hascross:1,hasborder:1,initialize:function(){this.Common.prototype.initialize.call(this),this.tiles=this.addInfoList(this.owner.AreaTileManager),this.blocks=this.addInfoList(this.owner.AreaBlockManager)},getBlockInfo:function(){for(var a=this.tiles.getAreaInfo(),b=this.blocks.getAreaInfo(),c=1;c<=b.max;c++){var d=[],e=0,f=b.room[c].clist;b.room[c].size=f.length;for(var g=1;g<=a.max;g++)d[g]=0;for(var g=0;g<f.length;g++)d[a.getRoomID(f[g])]++;for(var g=1;g<=a.max;g++)d[g]>0&&e++;b.room[c].dotcnt=e}return b}},"AreaTileManager:AreaManager":{enabled:!0,relation:["border"],bdfunc:function(a){return!a.isGround()}},"AreaBlockManager:AreaManager":{enabled:!0,relation:["border"],bdfunc:function(a){return a.qans>0}},CellList:{getBlockShapes:function(){for(var a=this.owner.board,b=this.getRectSize(),c=[[],[],[],[],[],[],[],[]],d={cols:b.cols,rows:b.rows,data:[]},e=0;e<2*b.rows;e+=2)for(var f=0;f<2*b.cols;f+=2)c[0].push(this.include(a.getc(b.x1+f,b.y1+e))?1:0),c[1].push(this.include(a.getc(b.x1+f,b.y2-e))?1:0);for(var f=0;f<2*b.cols;f+=2)for(var e=0;e<2*b.rows;e+=2)c[4].push(this.include(a.getc(b.x1+f,b.y1+e))?1:0),c[5].push(this.include(a.getc(b.x1+f,b.y2-e))?1:0);c[2]=c[1].concat().reverse(),c[3]=c[0].concat().reverse(),c[6]=c[5].concat().reverse(),c[7]=c[4].concat().reverse();for(var g=0;8>g;g++)d.data[g]=c[g].join("");return d}},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.borderQuescolor="white"},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawBorderQsubs(),this.drawBaseMarks(),this.drawChassis(),this.drawPekes()},getBorderColor:function(a){if(1===a.ques){var b=a.sidecell[1];return b.isnull||0===b.error?this.borderQuescolor:this.errbcolor1}return 1===a.qans?this.borderQanscolor:null}},Encode:{decodePzpr:function(){this.decodeCBBlock()},encodePzpr:function(){this.encodeCBBlock()},decodeCBBlock:function(){for(var a=this.outbstr,b=this.owner.board,c=[16,8,4,2,1],d=a?Math.min((b.bdmax+4)/5|0,a.length):0,e=0,f=0;d>f;f++)for(var g=parseInt(a.charAt(f),32),h=0;5>h;h++)e<b.bdmax&&(b.border[e].ques=g&c[h]?1:0,e++);this.outbstr=a.substr(d)},encodeCBBlock:function(){for(var a=0,b=0,c="",d=this.owner.board,e=[16,8,4,2,1],f=0,g=d.bdmax;g>f;f++)d.border[f].isGround()&&(b+=e[a]),a++,5===a&&(c+=b.toString(32),a=0,b=0);a>0&&(c+=b.toString(32)),this.outbstr+=c}},FileIO:{decodeData:function(){this.decodeBorder(function(a,b){"3"===b?(a.ques=0,a.qans=1,a.qsub=1):"1"===b?(a.ques=0,a.qans=1):"-1"===b?(a.ques=1,a.qsub=1):"-2"===b?(a.ques=0,a.qsub=1):a.ques="2"===b?0:1})},encodeData:function(){this.encodeBorder(function(a){return 1===a.qans&&1===a.qsub?"3 ":1===a.qans?"1 ":1===a.ques&&1===a.qsub?"-1 ":0===a.ques&&1===a.qsub?"-2 ":0===a.ques?"2 ":"0 "})}},AnsCheck:{checkAns:function(){var a=this.owner.board.getBlockInfo();return this.checkMiniBlockCount(a,1)?this.checkBlockNotRect(a)?this.checkDifferentShapeBlock(a)?this.checkMiniBlockCount(a,3)?null:"bkSubGt2":"sbSameShape":"bkRect":"bkSubLt2"},checkBlockNotRect:function(a){return this.checkAllArea(a,function(a,b,c){return a*b!==c})},checkMiniBlockCount:function(a,b){for(var c=!0,d=1;d<=a.max;d++){var e=a.room[d].dotcnt;if(1===b&&1===e||3===b&&e>=3){if(this.checkOnly)return!1;a.room[d].clist.seterr(1),c=!1}}return c},checkDifferentShapeBlock:function(a){for(var b=!0,c=a.getSideAreaInfo(),d={},e=1;e<=a.max-1;e++){var f=a.room[e];if(2===f.dotcnt)for(var g=0;g<c[e].length;g++){var h=c[e][g],i=a.room[h];if(2===i.dotcnt&&f.size===i.size&&!this.isDifferentShapeBlock(a,e,h,d)){if(this.checkOnly)return!1;f.clist.seterr(1),i.clist.seterr(1),b=!1}}}return b},isDifferentShapeBlock:function(a,b,c,d){d[b]||(d[b]=a.room[b].clist.getBlockShapes()),d[c]||(d[c]=a.room[c].clist.getBlockShapes());for(var e=d[b].cols===d[c].cols&&d[b].rows===d[c].rows?0:4,f=d[b].cols===d[c].rows&&d[b].rows===d[c].cols?8:4,g=e;f>g;g++)if(d[b].data[0]===d[c].data[g])return!1;return!0}},FailCode:{bkRect:["ブロックが四角形になっています。","A block is rectangle."],sbSameShape:["同じ形のブロックが接しています。","The blocks that has the same shape are adjacent."],bkSubLt2:["ブロックが1つの点線からなる領域で構成されています。","A block has one area framed by dotted line."],bkSubGt2:["ブロックが3つ以上の点線からなる領域で構成されています。","A block has three or more areas framed by dotted line."]}});