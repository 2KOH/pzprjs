/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("gokigen",{MouseEvent:{mouseinput:function(){var a=this.owner;a.playmode&&this.mousestart?this.inputslash():a.editmode&&this.mousestart&&("gokigen"===a.pid?this.inputcross():"wagiri"===a.pid&&this.inputquestion())},inputRed:function(){puzzle.playmode&&"gokigen"===puzzle.pid&&this.dispBlue()},inputslash:function(){var a=this.getcell();if(!a.isnull){var b=this.owner.getConfig("use"),c=this.btn.Left?31:32,d=a.getQans();1===b?a.setQans(d!==c?c:0):2===b&&a.setQans((this.btn.Left?{0:31,31:32,32:0}:{0:32,31:0,32:31})[d]),a.drawaround()}}},"MouseEvent@gokigen":{dispBlue:function(){var a=this.getcell();if(this.mousereset(),!a.isnull&&0!==a.getQans()){for(var b=a.relcross(31===a.qans?-1:1,-1),c=this.owner.board,d=c.searchline(b),e=0;e<c.cellmax;e++){var f=c.cell[e];31===f.getQans()&&1===d[f.relcross(-1,-1).id]&&f.seterr(2),32===f.getQans()&&1===d[f.relcross(1,-1).id]&&f.seterr(2)}c.haserror=!0,this.owner.redraw()}}},"MouseEvent@wagiri":{inputquestion:function(){var a=this.getpos(.33);a.isinside()&&(this.cursor.pos.equals(a)?a.oncross()?this.inputcross():a.oncell()&&this.inputwagiri(a):this.setcursorpos(a))},inputwagiri:function(a){var b=a.getc();if(!b.isnull){var c=this.btn.Left?[-1,1,0,2,-2]:[2,-2,0,-1,1];b.setNum(c[b.getQnum()+2]),b.draw()}}},"KeyEvent@gokigen":{enablemake:!0,moveTarget:function(a){return this.moveTCross(a)},keyinput:function(a){this.key_inputcross(a)}},"KeyEvent@wagiri":{enablemake:!0,moveTarget:function(a){return this.moveTBorder(a)},keyinput:function(a){this.key_wagiri(a)},key_wagiri:function(a){var b=this.cursor.getTCP();if(b.oncross())this.key_inputcross(a);else if(b.oncell()){var c=this.cursor.getTCC(),d=0;"1"==a?d=1:"2"==a?d=2:"-"==a?d=-2:" "==a&&(d=-1),c.isnull||0===d||(c.setNum(d),c.draw())}}},TargetCursor:{crosstype:!0},Cross:{maxnum:4,minnum:0},Board:{qcols:7,qrows:7,hascross:2,getSlashData:function(){for(var a=[],b=this.getSlashInfo(),c=0;c<this.cellmax;c++)a[c]=0!==this.cell[c].qans?0:-1;for(var c=0;c<this.cellmax;c++)if(0===a[c]){var d=this.cell[c],e=d.relcross(31===d.qans?-1:1,-1);this.searchloop(e.id,b,a)}for(var c=0;c<this.cellmax;c++)0===a[c]&&(a[c]=2);return a},searchloop:function(a,b,c){for(var d=[],e=0;e<this.crossmax;e++)d[e]=!1;for(var e=a,f=[{cell:null,cross:a}];f.length>0;){var g=null,e=f[f.length-1].cross;d[e]=!0;for(var h=0;h<b.cross[e].length;h++){var i=b.cross[e][h];if(b.cell[i].length){g=i;break}}if(null!==g){var j=b.cell[g][b.cell[g][0]!==e?0:1];if(f.push({cell:g,cross:null}),b.cell[g]=[],!d[j]){f[f.length-1].cross=j;continue}for(var h=f.length-1;h>=0&&f[h].cross!==j;h--)c[f[h].cell]=1}else b.cross[e]=[];var k=f.pop();0===c[k.cell]&&(c[k.cell]=2)}},getSlashInfo:function(){for(var a={cell:[],cross:[]},b=0;b<this.crossmax;b++)a.cross[b]=[];for(var b=0;b<this.cellmax;b++){a.cell[b]=[];var c,d,e=this.cell[b];if(31===e.qans)c=e.relcross(-1,-1),d=e.relcross(1,1);else{if(32!==e.qans)continue;c=e.relcross(-1,1),d=e.relcross(1,-1)}a.cell[b]=[c.id,d.id],a.cross[c.id].push(b),a.cross[d.id].push(b)}return a},searchline:function(a){for(var b=[],c=[a],d=0;d<this.crossmax;d++)b[d]=0;for(;c.length>0;){var e=c.pop();if(0===b[e.id]){b[e.id]=1;var f;f=e.relcross(-2,-2),f.isnull||0!==b[f.id]||31!==e.relcell(-1,-1).getQans()||c.push(f),f=e.relcross(2,-2),f.isnull||0!==b[f.id]||32!==e.relcell(1,-1).getQans()||c.push(f),f=e.relcross(-2,2),f.isnull||0!==b[f.id]||32!==e.relcell(-1,1).getQans()||c.push(f),f=e.relcross(2,2),f.isnull||0!==b[f.id]||31!==e.relcell(1,1).getQans()||c.push(f)}}return b}},BoardExec:{adjustBoardData:function(a){this.owner.board;if(a&pzpr.consts.TURNFLIP)for(var b=this.owner.board.cell,c=0;c<b.length;c++){var d=b[c];d.setQans({0:0,31:32,32:31}[d.getQans()])}}},Flags:{use:!0,disable_subclear:!0},Graphic:{margin:.5,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_DLIGHT,this.errcolor1="red","gokigen"===this.owner.pid?this.errcolor2="rgb(32, 32, 255)":"wagiri"===this.owner.pid&&(this.errcolor2="rgb(0, 0, 127)"),this.crosssize=.33},paintRange:function(a,b,c,d){var e=this.owner.board;!e.haserror&&this.owner.getConfig("autoerr")?this.setRange(e.minbx-2,e.minby-2,e.maxbx+2,e.maxby+2):this.setRange(a,b,c,d),this.prepaint()},paint:function(){this.drawBGCells(),this.drawDashedGrid(!1),"wagiri"===this.owner.pid&&this.drawNumbers(),this.drawSlashes(),this.drawCrosses(),this.drawTarget()},getBGCellColor:function(a){return 0===a.qans&&1===a.error?this.errbcolor1:null},drawSlashes:function(){var a=this.owner,b=a.board;if(!b.haserror&&a.getConfig("autoerr")){var c=b.getSlashData();"gokigen"===a.pid?b.cell.each(function(a){a.qinfo=1===c[a.id]?1:0}):"wagiri"===a.pid&&b.cell.each(function(a){a.qinfo=c[a.id]}),this.Common.prototype.drawSlashes.call(this),b.cell.setinfo(0)}else this.Common.prototype.drawSlashes.call(this)}},"Graphic@wagiri":{drawNumber1:function(a){var b=a.qnum,c="cell_"+a.id;if(-1!==b){var d=-2!==b?{1:"輪",2:"切"}[b]:"?",e=a.bx*this.bw,f=a.by*this.bh;this.dispnum(c,1,d,.7,this.fontcolor,e,f)}else this.hidenum(c)},drawTarget:function(){var a=!this.owner.cursor.pos.onborder();this.drawCursor(a,this.owner.editmode)}},"Encode@gokigen":{decodePzpr:function(b){var c=b===a.URL_PZPRAPP&&!this.checkpflag("c")||b===a.URL_PZPRV3&&this.checkpflag("d");c?this.decodecross_old():this.decode4Cross()},encodePzpr:function(b){b===a.URL_PZPRAPP&&(this.outpflag="c"),this.encode4Cross()}},"Encode@wagiri":{decodePzpr:function(){this.decode4Cross(),this.decodeNumber10()},encodePzpr:function(){this.encode4Cross(),this.encodeNumber10()}},FileIO:{decodeData:function(){this.decodeCrossNum(),"wagiri"===this.owner.pid&&this.decodeCellQnum(),this.decodeCell(function(a,b){"1"===b?a.qans=31:"2"===b&&(a.qans=32)})},encodeData:function(){this.encodeCrossNum(),"wagiri"===this.owner.pid&&this.encodeCellQnum(),this.encodeCell(function(a){return 31===a.qans?"1 ":32===a.qans?"2 ":". "})}},AnsCheck:{checkAns:function(){var a=this.owner.pid,b=this.owner.board.getSlashData();return"gokigen"!==a||this.checkLoopLine_gokigen(b)?"wagiri"!==a||this.checkLoopLine_wagiri(b,!1)?this.checkQnumCross()?"wagiri"!==a||this.checkLoopLine_wagiri(b,!0)?this.checkNoSlashCell()?null:"ceEmpty":"slNotLoopWa":"crConnSlNe":"slLoopGiri":"slLoop"},checkLoopLine_gokigen:function(a){var b=this.owner.board.cell.filter(function(b){return 1===a[b.id]});return b.seterr(1),0===b.length},checkLoopLine_wagiri:function(a,b){for(var c=!0,d=this.owner.board,e=0;e<d.cellmax;e++)b||1!=a[e]||2!==d.cell[e].getQnum()||(c=!1),b&&2==a[e]&&1===d.cell[e].getQnum()&&(c=!1);if(!c)for(var e=0;e<d.cellmax;e++)a[e]>0&&d.cell[e].seterr(a[e]);return c},checkQnumCross:function(){for(var a=!0,b=this.owner.board,c=b.getSlashInfo(),d=0;d<b.crossmax;d++){var e=b.cross[d],f=e.getQnum();if(f>=0&&f!=c.cross[d].length){if(this.checkOnly)return!1;e.seterr(1),a=!1}}return a},checkNoSlashCell:function(){return this.checkAllCell(function(a){return 0===a.getQans()})}},FailCode:{slLoop:["斜線で輪っかができています。","There is a loop consisted in some slashes."],slLoopGiri:["'切'が含まれた線が輪っかになっています。","There is a loop that consists '切'."],slNotLoopWa:["'輪'が含まれた線が輪っかになっていません。","There is not a loop that consists '輪'."],crConnSlNe:["数字に繋がる線の数が間違っています。","A number is not equal to count of lines that is connected to it."],ceEmpty:["斜線がないマスがあります。","There is an empty cell."]}})}();