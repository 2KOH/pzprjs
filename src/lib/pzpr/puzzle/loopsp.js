/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("loopsp",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.btn.Left?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputpeke():this.owner.editmode&&this.mousestart&&this.inputLoopsp()},inputRed:function(){this.dispRedLine()},inputLoopsp:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(a!==this.cursor.getTCC()?this.setcursor(a):this.inputcell_loopsp(a),this.mouseCell=a)},inputcell_loopsp:function(a){var b=a.getQues(),c=a.getQnum();this.btn.Left?-1===c?0==b?a.setQues(11):b>=11&&16>=b?a.setQues(b+1):17==b&&(a.setQues(0),a.setQnum(-2)):-2==c?a.setQnum(1):c<a.maxnum?a.setQnum(c+1):(a.setQues(0),a.setQnum(-1)):this.btn.Right&&(-1===c?0==b?(a.setQues(0),a.setQnum(-2)):11==b?(a.setQues(0),a.setQnum(-1)):b>=12&&17>=b&&a.setQues(b-1):-2==c?(a.setQues(17),a.setQnum(-1)):c>1?a.setQnum(c-1):(a.setQues(0),a.setQnum(-2))),a.draw()}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputLineParts(a)},key_inputLineParts:function(a){var b=this.cursor.getTCC();if("q"==a)b.setQues(11),b.setQnum(-1);else if("w"==a)b.setQues(12),b.setQnum(-1);else if("e"==a)b.setQues(13),b.setQnum(-1);else if("r"==a)b.setQues(0),b.setQnum(-1);else if(" "==a)b.setQues(0),b.setQnum(-1);else if("a"==a)b.setQues(14),b.setQnum(-1);else if("s"==a)b.setQues(15),b.setQnum(-1);else if("d"==a)b.setQues(16),b.setQnum(-1);else if("f"==a)b.setQues(17),b.setQnum(-1);else{if(!(a>="0"&&"9">=a||"-"==a))return;this.key_inputqnum_main(b,a)&&b.setQues(0)}this.prev=b,b.draw()}},Border:{enableLineNG:!0,enableLineCombined:!0},Board:{hasborder:1},BoardExec:{adjustBoardData:function(a,b){var c=pzpr.consts;if(a&c.TURNFLIP){var d={};switch(a){case c.FLIPY:d={14:17,15:16,16:15,17:14};break;case c.FLIPX:d={14:15,15:14,16:17,17:16};break;case c.TURNR:d={12:13,13:12,14:17,15:14,16:15,17:16};break;case c.TURNL:d={12:13,13:12,14:15,15:16,16:17,17:14}}for(var e=this.owner.board.cellinside(b.x1,b.y1,b.x2,b.y2),f=0;f<e.length;f++){var g=e[f],h=d[g.getQues()];h&&g.setQues(h)}}}},LineManager:{isCenterLine:!0,isLineCross:!0},Flags:{redline:!0,irowake:!0},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.linecolor=this.linecolor_LIGHT,this.fontsizeratio=.85,this.circleratio=[.4,.35],this.minYdeg=.36,this.maxYdeg=.74},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawLines(),this.drawCircles(),this.drawNumbers(),this.drawPekes(),this.drawLineParts(),this.drawChassis(),this.drawTarget()},repaintParts:function(a){this.range.cells=a.cellinside(),this.drawCircles(),this.drawNumbers(),this.drawLineParts()}},Encode:{decodePzpr:function(){this.decodeLoopsp()},encodePzpr:function(){this.encodeLoopsp()},decodeLoopsp:function(){for(var a=0,b=this.outbstr,c=this.owner.board,d=0;d<b.length;d++){var e=b.charAt(d),f=c.cell[a];if("."===e?f.qnum=-2:"-"===e?(f.qnum=parseInt(b.substr(d+1,2),16),d+=2):e>="0"&&"9">=e?f.qnum=parseInt(e,16):e>="a"&&"f">=e?f.qnum=parseInt(e,16):e>="g"&&"m">=e?f.ques=parseInt(e,36)-5:e>="n"&&"z">=e&&(a+=parseInt(e,36)-23),a++,a>=c.cellmax)break}this.outbstr=b.substr(d+1)},encodeLoopsp:function(){for(var a="",b="",c=0,d=this.owner.board,e=0;e<d.cellmax;e++){var f=d.cell[e].qnum,g=d.cell[e].ques;-2===f?b=".":f>=0&&16>f?b=f.toString(16):f>=16&&256>f?b="-"+f.toString(16):g>=11&&17>=g?b=(g+5).toString(36):(b="",c++),0===c?a+=b:(b||13===c)&&(a+=(22+c).toString(36)+b,c=0)}c>0&&(a+=(22+c).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"o"===b?a.ques=6:"-"===b?a.ques=-2:b>="a"&&"g">=b?a.ques=parseInt(b,36)+1:"."!==b&&(a.qnum=parseInt(b))}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(a){return 6===a.ques?"o ":a.ques>=11&&a.ques<=17?""+(a.ques-1).toString(36)+" ":-2===a.ques?"- ":-1!==a.qnum?a.qnum.toString()+" ":". "}),this.encodeBorderLine()}},AnsCheck:{checkAns:function(){return this.checkenableLineParts(1)?this.checkLineCount(3)?this.checkCrossOnNumber()?this.checkLoopNumber()?this.checkNumberLoop()?this.checkNumberInLoop()?this.checkCrossLineOnCross()?this.checkLineCount(0)?this.checkLineCount(1)?null:"lnDeadEnd":"ceEmpty":"lnNotCrossMk":"lpNoNum":"lpSepNum":"lpPlNum":"lnCrossOnNum":"lnBranch":"ceAddLine"},checkCrossOnNumber:function(){return this.checkAllCell(function(a){return 4===a.lcnt()&&a.isNum()})},checkLoopNumber:function(){return this.checkAllLoops(function(a){for(var b=a.filter(function(a){return a.isValidNum()}),c=null,d=0;d<b.length;d++)if(null===c)c=b[d].getNum();else if(c!==b[d].getNum())return b.seterr(1),!1;return!0})},checkNumberLoop:function(){var a=this.owner.board;return this.checkAllLoops(function(b){var c=b.filter(function(a){return a.isValidNum()});if(0===c.length)return!0;for(var d=c[0].getNum(),e=0;e<a.cellmax;e++){var f=a.cell[e];if(f.getNum()===d&&!c.include(f))return c.seterr(1),!1}return!0})},checkNumberInLoop:function(){return this.checkAllLoops(function(a){return a.filter(function(a){return a.isNum()}).length>0})},checkAllLoops:function(a){for(var b=!0,c=this.owner.board,d=c.getLineInfo(),e=1;e<=d.max;e++){var f=d.room[e].blist;if(!a(f.cellinside())){if(this.checkOnly)return!1;b&&c.border.seterr(-1),f.seterr(1),b=!1}}return b},checkCrossLineOnCross:function(){return this.checkAllCell(function(a){return 11===a.getQues()&&4!==a.lcnt()})}},FailCode:{ceEmpty:["線が引かれていないマスがあります。","there is an empty cell."],lnCrossOnNum:["○の部分で線が交差しています。","the lines are crossed on the number."],lpPlNum:["異なる数字を含んだループがあります。","A loop has plural kinds of number."],lpSepNum:["同じ数字が異なるループに含まれています。","A kind of numbers are in differernt loops."],lpNoNum:["○を含んでいないループがあります。","A loop has no numbers."]}});