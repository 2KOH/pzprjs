/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a=pzpr.consts;pzpr.createCustoms("kakuro",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.mousestart&&this.inputqnum():this.owner.editmode&&this.mousestart&&this.input51()}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(a){this.owner.editmode?this.inputnumber51(a,{2:45,4:45}):this.owner.playmode&&this.key_inputqnum(a)}},TargetCursor:{adjust_modechange:function(){this.owner.playmode&&(this.pos.bx<1&&(this.pos.bx=1),this.pos.by<1&&(this.pos.by=1))}},Cell:{qnum:0,qnum2:0,disInputHatena:!0,maxnum:9,getNum:function(){return this.anum},setNum:function(a){this.setAnum(a>0?a:-1)},prehook:{anum:function(a){return this.minnum>0&&0===a}}},EXCell:{qnum:0,qnum2:0},Board:{qcols:11,qrows:11,hasborder:1,hasexcell:1},BoardExec:{adjustBoardData:function(a,b){this.adjustQues51_1(a,b)},adjustBoardData2:function(a,b){this.adjustQues51_2(a,b)}},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.ttcolor="rgb(255,255,127)"},paint:function(){this.drawBGCells(),this.drawBGEXcells(),this.drawQues51(),this.drawGrid(),this.drawBorders(),this.drawChassis_ex1(!1),this.drawNumbersOn51(),this.drawNumbers_kakuro(),this.drawCursor()},getBGCellColor:function(a){return 1==a.error?this.errbcolor1:51===a.ques?"rgb(192,192,192)":null},getBGEXcellColor:function(a){return a.error?this.errbcolor1:"rgb(192,192,192)"},getBorderColor:function(a){var b=a.sidecell[0],c=a.sidecell[1];return!b.isnull&&!c.isnull&&51===b.ques^51===c.ques?this.cellcolor:null},drawNumbers_kakuro:function(){for(var a=(this.vinc("cell_number","auto"),this.range.cells),b=0;b<a.length;b++){var c=a[b],d=["cell",c.id,"anum"].join("_");if(!c.is51cell()&&c.anum>0){var e=1===c.error?this.fontErrcolor:this.fontAnscolor,f=""+c.anum,g=c.bx*this.bw,h=c.by*this.bh;this.dispnum(d,1,f,.8,e,g,h)}else this.hidenum(d)}}},Encode:{decodePzpr:function(){this.decodeKakuro()},encodePzpr:function(){this.encodeKakuro()},decodeKanpen:function(){this.owner.fio.decodeCellQnum51_kanpen()},encodeKanpen:function(){this.outsize=[this.owner.board.qrows+1,this.owner.board.qcols+1].join("/"),this.owner.fio.encodeCellQnum51_kanpen()},decodeKakuro:function(){for(var a=0,b=0,c=this.outbstr,d=this.owner.board,e=0;e<c.length;e++){var f=c.charAt(e),g=d.cell[a];if(f>="k"&&"z">=f?a+=parseInt(f,36)-19:(g.ques=51,"."!=f&&(g.qnum2=this.decval(f),g.qnum=this.decval(c.charAt(e+1)),e++),a++),a>=d.cellmax){b=e+1;break}}for(var e=b,h=1;h<d.maxbx;h+=2)d.getc(h,1).is51cell()||(d.getex(h,-1).qnum2=this.decval(c.charAt(e)),e++);for(var i=1;i<d.maxby;i+=2)d.getc(1,i).is51cell()||(d.getex(-1,i).qnum=this.decval(c.charAt(e)),e++);this.outbstr=c.substr(b)},encodeKakuro:function(){for(var a="",b=this.owner.board,c=0,d=0;d<b.cellmax;d++){var e="",f=b.cell[d];51===f.ques?e=f.qnum<=0&&f.qnum2<=0?".":""+this.encval(f.qnum2)+this.encval(f.qnum):c++,0===c?a+=e:(e||16===c)&&(a+=(c+19).toString(36)+e,c=0)}c>0&&(a+=(c+19).toString(36));for(var g=1;g<b.maxbx;g+=2)b.getc(g,1).is51cell()||(a+=this.encval(b.getex(g,-1).qnum2));for(var h=1;h<b.maxby;h+=2)b.getc(1,h).is51cell()||(a+=this.encval(b.getex(-1,h).qnum));this.outbstr+=a},decval:function(a){return a>="0"&&"9">=a?parseInt(a,36):a>="a"&&"j">=a?parseInt(a,36):a>="A"&&"Z">=a?parseInt(a,36)+10:""},encval:function(a){return a>=1&&19>=a?a.toString(36).toLowerCase():a>=20&&45>=a?(a-10).toString(36).toUpperCase():"0"}},FileIO:{decodeData:function(){this.decodeCellQnum51(),this.decodeCellAnumsub()},encodeData:function(){this.encodeCellQnum51(),this.encodeCellAnumsub()},kanpenOpen:function(){this.decodeCellQnum51_kanpen(),this.decodeQans_kanpen()},kanpenSave:function(){this.sizestr=[this.owner.board.qrows+1,this.owner.board.qcols+1].join("\n"),this.encodeCellQnum51_kanpen(),this.datastr+="\n",this.encodeQans_kanpen()},decodeCellQnum51_kanpen:function(){for(var a=this.owner.board;;){var b=this.readLine();if(!b)break;var c=b.split(" ");if(c.length<=1)return;if(0==c[0]&&0==c[1]);else if(0==c[0]||0==c[1]){var d=a.getex(2*parseInt(c[1])-1,2*parseInt(c[0])-1);0==c[0]?d.qnum2=parseInt(c[3]):0==c[1]&&(d.qnum=parseInt(c[2]))}else{var e=a.getc(2*parseInt(c[1])-1,2*parseInt(c[0])-1);e.ques=51,e.qnum2=parseInt(c[3]),e.qnum=parseInt(c[2])}}},encodeCellQnum51_kanpen:function(){for(var a=this.owner.board,b=a.minby+1;b<a.maxby;b+=2)for(var c=a.minbx+1;c<a.maxbx;c+=2){var d=[(b+1>>1).toString(),(c+1>>1).toString(),0,0];if(-1===c&&-1===b);else if(-1===c||-1===b){var e=a.getex(c,b);-1===c&&(d[2]=e.qnum.toString()),-1===b&&(d[3]=e.qnum2.toString())}else{var f=a.getc(c,b);if(51!==f.ques)continue;d[2]=f.qnum.toString(),d[3]=f.qnum2.toString()}this.datastr+=d.join(" ")+"\n"}},decodeQans_kanpen:function(){for(var a=this.owner.board,b=this.readLines(a.qrows+1),c=a.minby+1;c<a.maxby&&!(c+1>>1>=b.length);c+=2)for(var d=b[c+1>>1].split(" "),e=a.minbx+1;e<a.maxbx;e+=2)if(""!=d[e+1>>1]){var f=a.getc(e,c);f.isnull||"."==d[e+1>>1]||"0"==d[e+1>>1]||(f.anum=parseInt(d[e+1>>1]))}},encodeQans_kanpen:function(){for(var a=this.owner.board,b=a.minby+1;b<a.maxby;b+=2){for(var c=a.minbx+1;c<a.maxbx;c+=2){var d=a.getc(c,b);this.datastr+=d.isnull?". ":51===d.ques?". ":d.anum>0?d.anum.toString()+" ":"0 "}b<a.maxby-1&&(this.datastr+="\n")}}},AnsCheck:{checkAns:function(){return this.checkRowsColsSameNumber()?this.checkRowsColsTotalNumber()?this.checkEmptyCell_kakuro()?null:"ceEmpty":"nmSumRowNe":"nmDupRow"},check1st:function(){return this.checkEmptyCell_kakuro()?null:"ceEmpty"},checkEmptyCell_kakuro:function(){return this.checkAllCell(function(a){return!a.is51cell()&&a.getAnum()<=0})},checkRowsColsSameNumber:function(){return this.checkRowsColsPartly(this.isSameNumber,function(a){return a.is51cell()},!0)},isSameNumber:function(a,b){return this.isDifferentNumberInClist(b,function(a){return a.getAnum()})?!0:(this.owner.board.getobj(a[0],a[1]).seterr(1),!1)},checkRowsColsTotalNumber:function(){return this.checkRowsColsPartly(this.isTotalNumber,function(a){return a.is51cell()},!1)},isTotalNumber:function(b,c){var d,e=this.owner.board.getobj(b[0],b[1]),f=b[2];f===a.RT?d=e.getQnum():f===a.DN&&(d=e.getQnum2());for(var g=0,h=0;h<c.length;h++){if(!(c[h].getAnum()>0))return!0;g+=c[h].getAnum()}return d>0&&g!=d?(e.seterr(1),c.seterr(1),!1):!0}},FailCode:{nmSumRowNe:["数字の下か右にある数字の合計が間違っています。","The sum of the cells is not correct."],ceEmpty:["すべてのマスに数字が入っていません。","There is an empty cell."]}})}();