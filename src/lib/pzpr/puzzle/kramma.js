/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){var a="http://www.w3.org/2000/svg",b="http://www.w3.org/1999/xlink";pzpr.createCustoms("kramma",{MouseEvent:{mouseinput:function(){this.owner.playmode?(this.mousestart||this.mousemove)&&(this.btn.Left&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.owner.editmode&&(this.mousestart&&"kramma"!==this.owner.pid?this.inputcrossMark():this.mouseend&&this.notInputted()&&this.inputqnum())},inputborder:function(){var a=this.getpos(.35);if(!this.prevPos.equals(a)){var b=this.getborderobj(this.prevPos,a);if(!b.isnull){null===this.inputData&&(this.inputData=b.isBorder()?0:1);for(var c=b.getlinesize(),d=this.owner.board.borderinside(c.x1,c.y1,c.x2,c.y2),e=0;e<d.length;e++)1===this.inputData?d[e].setBorder():0===this.inputData&&d[e].removeBorder();this.owner.painter.paintRange(c.x1-1,c.y1-1,c.x2+1,c.y2+1)}this.prevPos=a}}},KeyEvent:{enablemake:!0},Cell:{numberAsObject:!0,maxnum:2},Cross:{noNum:function(){return null!==this.id&&-1===this.qnum}},Border:{getlinesize:function(){var a=this.getaddr(),b=a.clone();if(this.isVert()){for(;a.move(0,-1).getx().noNum();)a.move(0,-1);for(;b.move(0,1).getx().noNum();)b.move(0,1)}else{for(;a.move(-1,0).getx().noNum();)a.move(-1,0);for(;b.move(1,0).getx().noNum();)b.move(1,0)}return{x1:a.bx,y1:a.by,x2:b.bx,y2:b.by}}},Board:{hascross:1,hasborder:1},"Board@kramma,krammar":{qcols:8,qrows:8},AreaRoomManager:{enabled:!0},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_DLIGHT,this.borderQanscolor="rgb(64, 64, 255)",this.setBorderColorFunc("qans"),this.crosssize=.15,this.imgtile=null},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),"shwolf"!==this.owner.pid?this.drawCircles():this.drawSheepWolf(),"kramma"!==this.owner.pid&&this.drawCrossMarks(),this.drawHatenas(),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()},getCircleStrokeColor:function(a){return 1===a.qnum?1===a.error?this.errcolor1:this.cellcolor:null},getCircleFillColor:function(a){return 1===a.qnum?1===a.error?this.errbcolor1:"white":2===a.qnum?1===a.error?this.errcolor1:this.cellcolor:null}},"Graphic@shwolf":{initCanvas:function(a,b,c){var d=this;this.Common.prototype.initCanvas.call(this,a,b,function(){d.initImageTile(c)})},initImageTile:function(a){if(!this.imgtile){var b=pzpr.util.getpath()+"img/shwolf_obj.png";pzpr.env.API.dataURL&&(b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABABAMAAAAg+GJMAAAAMFBMVEUAAACtAADv97X/a/f//wD///////////////////////////////////////////81EdaHAAAAEHRSTlP///8A////////////////8M8+MgAAAk5JREFUeJzF10FywyAMBdDvuNmTG2RyAmZ8gS56AG96/6sUAYIPCDduOymbJLb1ImSCFWy/HPgzAC2F9STgW8A/BXg0AIeAPGAyz/ilBbi0AH0E7HQ8GMDlDj73IOBmCwgnChAiGuDyuBPgrEkASws86CJcyMMtCEMKPsQTECKOAGMSiIc7QMoiYwv5PBpgmERMgAGJoNEDveBjAg0Q466fMsKbSw90ZfDpIAF3jZaxSw4VWNLF0BlCj7kCyKlPHqDllwHHU9SsFOjjYw5NvWMKi77RpNYMeM6/Eu18aTglFRjDG0G/eXS2BHgY8SKssxRqAgJ4M4FYya4KXXzKXk7b8UFYFTAEp8A0gQqYKeT8MKtAqkK7GscKCDBPgFMwgHzmYAY1Bes+VGAeH1J4AigJIC3oHbSwFTCW0gCAgetJYIcAlPk1HTsE1grA+DHFfPYDwCmAazPrUn9RnwG2uHcM92IHP5IOgfRUHID4S2sA1J0FDORiWkAZEXAfH2knTK8OJwDkwHd5ffspECLfQ6R7S87tPOB0M19+CJhL8e+Abini5YDvge3lAL4HXP5FOOs2vh4AWqBbCHsHxMXHAM4CQhBQW6YZ0HV10sIsBFD7Ud4099FqLEuH4hZqGxnIW2vYDrsaFiED3HaWKz0DuwFob9j1jBXgIpiAPORdLCafpf8VhyVIl8S7p9vpAHCjeQjgCcCMD+2ay/8SLKA2CrME5Ckf62ADmz4hp3+ycpvQ7TX8vjbTk2Gc5k/+u/h0RTu/g6snQlefk8A4/h/4AjUhvQ8aixc0AAAAAElFTkSuQmCC"),this.imgtile=new this.owner.ImageTile(this,b,2,1)}if(!this.imgtile.loaded){var c=this;return void setTimeout(function(){c.initImageTile(a)},10)}a&&a()},resize_canvas_main:function(){this.Common.prototype.resize_canvas_main.call(this),this.imgtile&&this.imgtile.loaded&&this.imgtile.createStamp(this.context)},prepaint:function(){this.imgtile&&this.imgtile.loaded?this.Common.prototype.prepaint.call(this):this.suspendAll()},drawSheepWolf:function(){for(var a=this.vinc("cell_number_image","auto"),b=this.range.cells,c=0;c<b.length;c++){var d=b[c],e=["cell",d.id,"quesimg"].join("_");if(d.qnum>0){var f=(d.bx-1)*this.bw,g=(d.by-1)*this.bh;this.vshow(e),a.use.svg?this.imgtile.putStamp(d.qnum-1,a,f,g):this.imgtile.putImage(d.qnum-1,a,f,g,this.cw,this.ch)}else this.vhide(e)}}},Encode:{decodePzpr:function(){"shwolf"!==this.owner.pid&&this.checkpflag("c")?this.decodeCircle():(this.decodeCrossMark(),this.decodeCircle()),this.checkPuzzleid()},encodePzpr:function(){"kramma"!==this.owner.pid?(this.encodeCrossMark(),this.encodeCircle()):(this.outpflag="c",this.encodeCircle())},checkPuzzleid:function(){var a=this.owner,b=a.board;if("kramma"===a.pid)for(var c=0;c<b.crossmax;c++)if(1===b.cross[c].qnum){a.pid="kramman";break}}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCrossNum(),this.decodeBorderAns(),this.owner.enc.checkPuzzleid()},encodeData:function(){this.encodeCellQnum(),this.encodeCrossNum(),this.encodeBorderAns()}},AnsCheck:{checkAns:function(){var a=this.owner.pid;if("kramma"!==a&&!this.checkBorderCount(3,0))return"bdBranch";if("kramma"!==a&&!this.checkBorderCount(4,1))return"bdCrossBP";if("kramma"!==a&&!this.checkLcntCurve())return"bdCurveExBP";if("shwolf"===a&&!this.checkLineChassis())return"bdNotChassis";var b=this.owner.board.getRoomInfo();return this.checkNoNumber(b)?this.checkDiffObjectInArea(b)?"kramma"===a||this.checkBorderCount(1,0)?"kramman"!==a||this.checkBorderCount(0,1)?null:"bdIgnoreBP":"bdDeadEnd":"bkPlNum":"bkNoNum"},check1st:function(){return"kramma"===this.owner.pid||this.checkBorderCount(1,0)?null:"bdDeadEnd"},checkDiffObjectInArea:function(a){return this.checkSameObjectInRoom(a,function(a){return a.getNum()})},checkLcntCurve:function(){for(var a=!0,b=this.owner.board,c=b.minbx+2;c<=b.maxbx-2;c+=2)for(var d=b.minby+2;d<=b.maxby-2;d+=2){var e=b.getx(c,d);if(2===b.rooms.crosscnt[e.id]&&1!==e.getQnum()&&!(1===e.ub().getQans()&&1===e.db().getQans()||1===e.lb().getQans()&&1===e.rb().getQans())){if(this.checkOnly)return!1;e.setCrossBorderError(),a=!1}}return a},checkLineChassis:function(){for(var a=!0,b=this.owner.board,c=[],d=0;d<b.bdmax;d++)c[d]=b.border[d].getQans();var e=new this.owner.Address(0,0);for(e.bx=b.minbx;e.bx<=b.maxbx;e.bx+=2)for(e.by=b.minby;e.by<=b.maxby;e.by+=2)(e.bx===b.minbx||e.bx===b.maxbx)^(e.by===b.minby||e.by===b.maxby)&&(e.by===b.minby?this.clearLineInfo(c,e,2):e.by===b.maxby?this.clearLineInfo(c,e,1):e.bx===b.minbx?this.clearLineInfo(c,e,4):e.bx===b.maxbx&&this.clearLineInfo(c,e,3));for(var d=0;d<b.bdmax;d++)if(1===c[d]){if(this.checkOnly)return!1;a&&b.border.seterr(-1);for(var f=0;f<b.bdmax;f++)1==c[f]&&b.border[f].seterr(1);a=!1}return a},clearLineInfo:function(a,b,c){for(var d=[[b.clone(),c]];d.length>0;){var e=d.pop();for(b=e[0],c=e[1];;)if(b.movedir(c,1),b.oncross()){var f=b.getx();if(!f.isnull&&1===f.getQnum()){f.ub().getQans()&&d.push([b.clone(),1]),f.db().getQans()&&d.push([b.clone(),2]),f.lb().getQans()&&d.push([b.clone(),3]),f.rb().getQans()&&d.push([b.clone(),4]);break}}else{var g=b.getb();if(g.isnull||0===a[g.id])break;a[g.id]=0}}}},FailCode:{bkNoNum:["白丸も黒丸も含まれない領域があります。","An area has no marks."],bkPlNum:["白丸と黒丸が両方含まれる領域があります。","An area has both white and black circles."],bdBranch:["分岐している線があります。","there is a branch line."],bdCurveExBP:["黒点以外のところで線が曲がっています。","A line curves out of the black points."],bdCrossBP:["黒点上で線が交差しています。","There is a crossing line on the black point."],bdIgnoreBP:["黒点上を線が通過していません。","A black point has no line."]},"FailCode@shwolf":{bkNoNum:["ヤギもオオカミもいない領域があります。","An area has neither sheeps nor wolves."],bkPlNum:["ヤギとオオカミが両方いる領域があります。","An area has both sheeps and wolves."],bdNotChassis:["外枠につながっていない線があります。","A line doesn't connect to the chassis."]},"ImageTile@shwolf":{initialize:function(a,b,c,d){this.image=new Image,this.image.src=b,this.cols=c,this.rows=d,this.width=0,this.height=0,this.cwidth=0,this.cheight=0,this.loaded=!1,this.painter=a,this.key=this.owner.pid+"_img",this.waitload()},waitload:function(){if(this.image.height>0)this.load_func();else{var a=this;setTimeout(function(){a.waitload()},10)}},load_func:function(){var a=this.painter,b=a.context;this.width=this.image.width,this.height=this.image.height,this.cwidth=this.width/this.cols,this.cheight=this.height/this.rows,this.loaded=!0,b.use.svg&&this.createStamp(b),a.unsuspend()},createStamp:function(c){var d=document.createElementNS(a,"defs");c.child.insertBefore(d,c.child.firstChild?c.child.firstChild:null);var e=document.createElementNS(a,"image");e.setAttributeNS(null,"id",this.key),e.setAttributeNS(null,"width",this.image.width),e.setAttributeNS(null,"height",this.image.height),e.setAttributeNS(b,"xlink:href",this.image.src),d.appendChild(e);for(var f=0,g=this.cwidth,h=this.cheight,i=0;i<this.rows;i++)for(var j=0;j<this.cols;j++){var e=document.createElementNS(a,"svg");e.setAttribute("id",this.key+f),e.setAttribute("viewBox",[j*g,i*h,g,h].join(" ")),e.setAttribute("width",this.painter.cw),e.setAttribute("height",this.painter.ch),d.appendChild(e);var k=document.createElementNS(a,"use");k.setAttributeNS(b,"xlink:href","#"+this.key),e.appendChild(k),f++}},putImage:function(a,b,c,d,e,f){if(this.loaded){var g=this.cwidth,h=this.cheight;void 0===e&&(e=g,f=h);var i=a%this.cols,j=a/this.cols|0;b.drawImage(this.image,i*g,j*h,g,h,c,d,e,f)}return this.loaded},putStamp:function(c,d,e,f){if(this.loaded){var g=d.vid?d.elements[d.vid]:null,h=!g;h&&(g=document.createElementNS(a,"use")),g.setAttributeNS(b,"xlink:href","#"+this.key+c),g.setAttribute("x",e),g.setAttribute("y",f),h&&d.target.appendChild(g),h&&d.vid&&(d.elements[d.vid]=g),d.vid=""}return this.loaded}}})}();