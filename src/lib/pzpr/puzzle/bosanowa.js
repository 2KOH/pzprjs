/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("bosanowa",{MouseEvent:{mouseinput:function(){this.mousestart&&this.inputqnum_bosanowa()},inputqnum_bosanowa:function(){var a=this.getpos(.31);a.isinside()&&(this.cursor.pos.equals(a)?a.oncell()&&this.inputcell_bosanowa(a):this.setcursorpos(a))},inputcell_bosanowa:function(a){var b=a.getc();if(!b.isnull){var c=b.nummaxfunc(),d=b.getQues(),e=b.getNum();this.owner.editmode&&(this.btn.Left?7===d?(b.setNum(-1),b.setQues(0)):-1===e?(b.setNum(1),b.setQues(0)):e===c?(b.setNum(-1),b.setQues(7)):b.setNum(e+1):this.btn.Right&&(7===d?(b.setNum(c),b.setQues(0)):1===e?(b.setNum(-1),b.setQues(0)):-1===e?(b.setNum(-1),b.setQues(7)):b.setNum(e-1))),this.owner.playmode&&0===d&&(this.btn.Left?b.setNum(e===c?-1:-1===e?1:e+1):this.btn.Right&&b.setNum(-1===e?c:1===e?-1:e-1)),b.drawaround()}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.moveTBorder(a)},keyinput:function(a){this.key_inputqnum_bosanowa(a)},key_inputqnum_bosanowa:function(a){var b=this.cursor.getTCP();if(b.oncell()){var c=this.cursor.getTCC();if(this.owner.editmode)if("w"==a)c.setQues(7!==c.getQues()?7:0),c.setNum(-1);else if("-"==a||" "==a)c.setQues(0),c.setNum(-1);else{if(!(a>="0"&&"9">=a))return;0!==c.getQues()&&(c.setQues(0),c.setNum(-1)),this.key_inputqnum(a)}else if(this.owner.playmode){if(0!==c.getQues())return;this.key_inputqnum(a)}}else{if(!b.onborder())return;{var d=b.getb();d.sidecell[0],d.sidecell[1]}if(!d.isGrid())return;if(a>="0"&&"9">=a){var e=parseInt(a),f=d.getQsub(),g=99;0>=f||this.prev!==d?g>=e&&d.setQsub(e):g>=10*f+e?d.setQsub(10*f+e):g>=e&&d.setQsub(e),this.prev=d}else{if("-"!=a&&" "!=a)return;d.setQsub(-1)}}b.drawaround()}},TargetCursor:{initCursor:function(){var a=this.owner.board;this.pos=new this.owner.Address((a.qcols-1&-2)+1,(a.qrows-1&-2)+1)}},Cell:{ques:7},Border:{qsub:-1,isGrid:function(){return this.sidecell[0].isValid()&&this.sidecell[1].isValid()},isBorder:function(){return!!(this.sidecell[0].isEmpty()^this.sidecell[1].isEmpty())}},Board:{hasborder:2,initBoardSize:function(a,b){if(this.Common.prototype.initBoardSize.call(this,a,b),pzpr.EDITOR){var c=this.owner.cursor.getTCC();c.isnull||(c.ques=0)}}},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.circleratio=[.47,.42]},paint:function(){this.drawBGCells();var a=+this.owner.getConfig("disptype_bosanowa");1===a?(this.drawCircles(),this.drawBDnumbase()):2===a?(this.drawOutside_souko(),this.drawGrid_souko(),this.drawBDnumbase()):3===a&&(this.drawBorders(),this.drawGrid_waritai()),this.drawNumbers(),this.drawNumbersBD(),pzpr.EDITOR&&!this.outputImage&&this.drawChassis(),this.drawTarget_bosanowa()},getCanvasCols:function(){var a=this.owner.getConfig("disptype_bosanowa");return this.getBoardCols()+2*this.margin+(2==a?2:0)},getCanvasRows:function(){var a=this.owner.getConfig("disptype_bosanowa");return this.getBoardRows()+2*this.margin+(2==a?2:0)},drawErrorCells_bosanowa:function(){var a=this.vinc("cell_back","crispEdges"),b="c_fullerr_";a.fillStyle=this.errbcolor1;for(var c=this.range.cells,d=0;d<c.length;d++){var e=c[d];if(1===e.error){if(this.vnop(b+e.id,this.FILL)){var f=(e.bx-1)*this.bw,g=(e.by-1)*this.bh;a.fillRect(f,g,this.cw,this.ch)}}else this.vhide([b+e.id])}},getCircleStrokeColor:function(a){return a.isValid()&&!a.isNum()?1===a.error?this.errcolor1:this.cellcolor:null},getCircleFillColor:function(){return null},drawGrid_souko:function(){var a=this.vinc("grid_souko","crispEdges"),b="b_grids_";a.lineWidth=1,a.fillStyle="rgb(127,127,127)",a.strokeStyle="rgb(127,127,127)";for(var c=this.range.borders,d=0;d<c.length;d++){var e=c[d];if(e.isGrid()){var f=e.bx*this.bw,g=e.by*this.bh;if(this.vnop(b+e.id,this.NONE))if(e.isVert()){var h=g-this.bh,i=g+this.bh+1;a.strokeDashedLine(f+.5,h,f+.5,i,[3])}else{var j=f-this.bw,k=f+this.bw+1;a.strokeDashedLine(j,g+.5,k,g+.5,[3])}}else a.use.canvas||this.vhide([b+e.id])}},drawGrid_waritai:function(){for(var a=this.vinc("grid_waritai","crispEdges"),b=.2*this.cw,c=["b_grid_","b_grid2_"],d=this.range.borders,e=0;e<d.length;e++){var f=d[e],g=f.id;if(f.isGrid()){var h=f.bx*this.bw,i=f.by*this.bh;a.fillStyle=this.gridcolor,this.vnop(c[0]+g,this.NONE)&&(f.isVert()?a.fillRect(h,i-this.bh,1,this.ch+1):a.fillRect(h-this.bw,i,this.cw+1,1)),a.fillStyle=0===f.error?"white":this.errbcolor1,this.vnop(c[1]+g,this.FILL)&&(f.isVert()?a.fillRect(h,i-b,1,2*b+1):a.fillRect(h-b,i,2*b+1,1))}else this.vhide([c[0]+g,c[1]+g])}},drawBDnumbase:function(){for(var a=this.vinc("border_number_base","crispEdges"),b=.2*this.cw,c="b_bbse_",d=this.range.borders,e=0;e<d.length;e++){var f=d[e];if(f.qsub>=0&&f.isGrid()){if(a.fillStyle="white",this.vnop(c+f.id,this.NONE)){var g=f.bx*this.bw,h=f.by*this.bh;a.fillRect(g-b,h-b,2*b+1,2*b+1)}}else this.vhide(c+f.id)}},drawNumbersBD:function(){for(var a=(this.vinc("border_number","auto"),this.range.borders),b=0;b<a.length;b++){var c=a[b],d="border_"+c.id;if(c.qsub>=0){var e=c.bx*this.bw,f=c.by*this.bh;this.dispnum(d,1,""+c.qsub,.35,"blue",e,f)}else this.hidenum(d)}},drawOutside_souko:function(){for(var a=this.vinc("cell_outside_souko","crispEdges"),b="c_full_",c=this.range,d=c.x1-2|1;d<=c.x2+2;d+=2)for(var e=c.y1-2|1;e<=c.y2+2;e+=2){var f=this.owner.board.getc(d,e),g=new this.owner.Address(d,e);!f.isEmpty()||0!==g.rel(-2,0).getc().ques&&0!==g.rel(2,0).getc().ques&&0!==g.rel(0,-2).getc().ques&&0!==g.rel(0,2).getc().ques&&0!==g.rel(-2,-2).getc().ques&&0!==g.rel(2,-2).getc().ques&&0!==g.rel(-2,2).getc().ques&&0!==g.rel(2,2).getc().ques?this.vhide([b,d,e].join("_")):(a.fillStyle="rgb(127,127,127)",this.vnop([b,d,e].join("_"),this.NONE)&&a.fillRect((d-1)*this.bw,(e-1)*this.bh,this.cw+1,this.ch+1))}},drawTarget_bosanowa:function(){var a=this.owner.cursor.pos.oncell();this.drawCursor(a)}},Encode:{decodePzpr:function(){this.decodeBoard(),this.decodeNumber16();var a=this.owner;this.checkpflag("h")?a.setConfig("disptype_bosanowa",2):this.checkpflag("t")&&a.setConfig("disptype_bosanowa",3)},encodePzpr:function(){this.encodeBosanowa();var a=this.owner;2==a.getConfig("disptype_bosanowa")?this.outpflag="h":3==a.getConfig("disptype_bosanowa")&&(this.outpflag="t")},decodeBoard:function(){for(var a=this.outbstr,b=0,c=this.owner.board,d=[16,8,4,2,1],e=0;e<a.length;e++){for(var f=parseInt(a.charAt(e),32),g=0;5>g;g++)b<c.cellmax&&(c.cell[b].ques=f&d[g]?7:0,b++);if(b>=c.cellmax)break}this.outbstr=a.substr(e+1)},encodeBosanowa:function(){for(var a=9999,b=-1,c=9999,d=-1,e=this.owner.board,f=0;f<e.cellmax;f++){var g=e.cell[f];g.isEmpty()||(a>g.bx&&(a=g.bx),b<g.bx&&(b=g.bx),c>g.by&&(c=g.by),d<g.by&&(d=g.by))}for(var h="",i=0,j=0,k=[16,8,4,2,1],l=c;d>=l;l+=2)for(var m=a;b>=m;m+=2){var g=e.getc(m,l);g.isEmpty()&&(j+=k[i]),i++,5===i&&(h+=j.toString(32),i=0,j=0)}i>0&&(h+=j.toString(32)),this.outbstr+=h,h="",i=0;for(var l=c;d>=l;l+=2)for(var m=a;b>=m;m+=2){var n="",o=e.getc(m,l).qnum;-2===o?n=".":o>=0&&16>o?n=o.toString(16):o>=16&&256>o?n="-"+o.toString(16):i++,0==i?h+=n:(n||20==i)&&(h+=(15+i).toString(36)+n,i=0)}i>0&&(h+=(15+i).toString(36)),this.outbstr+=h,this.outsize=[(b-a+2)/2,(d-c+2)/2].join("/")}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){a.ques="."===b?7:0,"0"!==b&&"."!==b&&(a.qnum=parseInt(b))}),this.decodeCell(function(a,b){"0"!==b&&"."!==b&&(a.anum=parseInt(b))}),this.decodeBorder(function(a,b){"."!==b&&(a.qsub=parseInt(b))})},encodeData:function(){this.encodeCell(function(a){return 7===a.ques?". ":a.qnum>=0?""+a.qnum.toString()+" ":"0 "}),this.encodeCell(function(a){return 7===a.ques||-1!==a.qnum?". ":a.anum>=0?""+a.anum.toString()+" ":"0 "}),this.encodeBorder(function(a){return-1!==a.qsub?""+a.qsub.toString()+" ":". "})}},AnsCheck:{checkAns:function(){return this.checkSubsNumber()?this.checkValidFillCell()?null:"ceEmpty":"nmSumOfDiff"},check1st:function(){return this.checkValidFillCell()?null:"ceEmpty"},checkValidFillCell:function(){return this.checkAllCell(function(a){return a.isValid()&&a.noNum()})},checkSubsNumber:function(){for(var a=[],b=this.owner.board,c=-1,d=0;d<b.bdmax;d++){var e=b.border[d],f=e.sidecell[0],g=e.sidecell[1];a[d]=e.isGrid()?f.isValidNum()&&g.isValidNum()?Math.abs(f.getNum()-g.getNum()):c:null}for(var h=!0,i=0;i<b.cellmax;i++){var j=b.cell[i];if(!j.isEmpty()&&!j.noNum()){var k,l=j.getNum(),m=0;if(k=a[j.ub().id],k>0)m+=k;else if(k===c)continue;if(k=a[j.db().id],k>0)m+=k;else if(k===c)continue;if(k=a[j.lb().id],k>0)m+=k;else if(k===c)continue;if(k=a[j.rb().id],k>0)m+=k;else if(k===c)continue;if(l!==m){if(this.checkOnly)return!1;j.seterr(1),h=!1}}}return h}},FailCode:{nmSumOfDiff:["数字とその隣の数字の差の合計が合っていません。","Sum of the differences between the number and adjacent numbers is not equal to the number."],ceEmpty:["数字の入っていないマスがあります。","There is an empty cell."]}});