/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("shugaku",{MouseEvent:{mouseinput:function(){this.owner.playmode?this.btn.Left?this.mousestart||this.mousemove?this.inputFuton():this.mouseend&&this.inputFuton2():this.btn.Right&&(this.mousestart||this.mousemove)&&this.inputcell_shugaku():this.owner.editmode&&this.mousestart&&this.inputqnum()},inputFuton:function(){var a=this.getcell();if(null===this.firstPoint.bx){if(a.isnull||a.isNum())return;this.mouseCell=a,this.inputData=1,this.firstPoint.set(this.inputPoint),a.draw()}else{var b=this.inputData,c=null;if(a.isnull);else if(this.mouseCell===a)this.inputData=1;else{var d=this.inputPoint.bx-this.firstPoint.bx,e=this.inputPoint.by-this.firstPoint.by;d-e>0&&d+e>0?(c=this.mouseCell.rt(),this.inputData=5):d-e>0&&0>d+e?(c=this.mouseCell.up(),this.inputData=2):0>d-e&&d+e>0?(c=this.mouseCell.dn(),this.inputData=3):0>d-e&&0>d+e&&(c=this.mouseCell.lt(),this.inputData=4),(null===c||c.isnull||c.isNum())&&(this.inputData=6)}b!=this.inputData&&this.mouseCell.drawaround()}},inputFuton2:function(){if(!this.mouseCell.isnull){var a=this.mouseCell;this.changeHalf(a),1!==this.inputData&&6!==this.inputData?(a.setQans(40+this.inputData),a.setQsub(0)):6===this.inputData?(a.setQans(41),a.setQsub(0)):41===a.getQans()?(a.setQans(46),a.setQsub(0)):46===a.getQans()?(a.setQans(0),a.setQsub(1)):(a.setQans(41),a.setQsub(0));var b=this.currentTargetADJ();b.isnull||(this.changeHalf(b),b.setQans({2:48,3:47,4:50,5:49}[this.inputData]),b.setQsub(0)),this.mousereset(),a.drawaround(),this.mouseCell=this.owner.board.emptycell}},inputcell_shugaku:function(){var a=this.getcell();a.isnull||a===this.mouseCell||a.isNum()||(null===this.inputData&&(this.inputData=1===a.getQans()?2:1===a.getQsub()?3:1),this.changeHalf(a),this.mouseCell=a,a.setQans(1==this.inputData?1:0),a.setQsub(2==this.inputData?1:0),a.drawaround())},changeHalf:function(a){var b=a.getQans(),c=null;42===b||47===b?c=a.up():43===b||48===b?c=a.dn():44===b||49===b?c=a.lt():(45===b||50===b)&&(c=a.rt()),null===c||(c.getQans()>=42&&c.getQans()<=45?c.setQans(41):c.getQans()>=47&&c.getQans()<=50&&c.setQans(46))},currentTargetADJ:function(){if(!this.mouseCell.isnull){var a=this.mouseCell;switch(this.inputData){case 2:return a.up();case 3:return a.dn();case 4:return a.lt();case 5:return a.rt()}}return this.owner.board.emptycell}},KeyEvent:{enablemake:!0},Cell:{numberIsWhite:!0,maxnum:4,minnum:0,isPillow:function(){return this.qans>=41&&this.qans<=45}},Border:{isbdh_cc1:{41:1,42:1,44:1,45:1,46:1,47:1,49:1,50:1},isbdh_cc2:{41:1,43:1,44:1,45:1,46:1,48:1,49:1,50:1},isbdv_cc1:{41:1,42:1,43:1,44:1,46:1,47:1,48:1,49:1},isbdv_cc2:{41:1,42:1,43:1,45:1,46:1,47:1,48:1,50:1},isBorder:function(){var a=this.sidecell[0].qans,b=this.sidecell[1].qans;return this.isVert()?!!this.isbdv_cc1[a]||!!this.isbdv_cc2[b]:!!this.isbdh_cc1[a]||!!this.isbdh_cc2[b]}},Board:{hasborder:1},BoardExec:{adjustBoardData:function(a){var b=pzpr.consts,c={};switch(a){case b.FLIPY:c={42:43,43:42,47:48,48:47};break;case b.FLIPX:c={44:45,45:44,49:50,50:49};break;case b.TURNR:c={42:45,45:43,43:44,44:42,47:50,50:48,48:49,49:47};break;case b.TURNL:c={42:44,44:43,43:45,45:42,47:49,49:48,48:50,50:47};break;default:return}for(var d=this.owner.board.cell,e=0;e<d.length;e++){var f=d[e],g=c[f.qans];g&&(f.qans=g)}}},AreaBlackManager:{enabled:!0},Graphic:{hideHatena:!0,initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_LIGHT,this.errbcolor1=this.errbcolor1_DARK,this.bgcolor="rgb(208, 208, 208)",this.targetbgcolor="rgb(255, 192, 192)",this.circleratio=[.47,.42]},paint:function(){this.drawDotCells(!1),this.drawDashedGrid(),this.drawBlackCells(),this.drawFutons(),this.drawPillows(),this.drawBorders(),this.drawCircles(),this.drawNumbers(),this.drawChassis(),this.drawTarget()},drawFutons:function(){var a=this.vinc("cell_back","crispEdges"),b=this.owner.mouse,c=null,d=null,e=!b.mouseCell.isnull&&null!==b.firstPoint.bx;e&&(c=b.mouseCell,d=b.currentTargetADJ());for(var f="c_full_",g=this.range.cells,h=0;h<g.length;h++){var i=g[h],j=i.qans>=41,k=1===i.error?this.errbcolor1:"white";if(e&&(i===c||i===d)&&(j=!0,k=this.targetbgcolor),j){if(a.fillStyle=k,this.vnop(f+i.id,this.FILL)){var l=(i.bx-1)*this.bw,m=(i.by-1)*this.bh;a.fillRect(l+1,m+1,this.cw-1,this.ch-1)}}else this.vhide(f+i.id)}},drawPillows:function(){var a=this.vinc("cell_pillow","crispEdges"),b=this.owner.mouse,c=null,d=null,e=!b.mouseCell.isnull&&null!==b.firstPoint.bx;e&&(c=b.mouseCell,d=b.currentTargetADJ());for(var f="c_pillow_",g=this.range.cells,h=.7*this.bw-1,i=.7*this.bh-1,j=0;j<g.length;j++){var k=g[j],l=k.qans>=41&&k.qans<=45;if(e&&(l||c!==k?l&&d===k&&(l=!1):l=!0),l){if(a.lineWidth=1,a.strokeStyle="black",a.fillStyle=e&&c===k?this.targetbgcolor:1===k.error?this.errbcolor1:"white",this.vnop(f+k.id,this.FILL)){var m=k.bx*this.bw,n=k.by*this.bh;a.shapeRect(m-h,n-i,2*h+1,2*i+1)}}else this.vhide([f+k.id])}},getBorderColor:function(a){var b=a.isBorder(),c=this.owner.mouse;if(!c.mouseCell.isnull&&null!==c.firstPoint.bx){var d=a.sidecell[0],e=a.sidecell[1],f=c.mouseCell,g=c.currentTargetADJ(),h=d===f||e===f,i=d===g||e===g;h&&i?b=!1:(h||i)&&(b=!0)}return b?"black":null}},Encode:{decodePzpr:function(){this.decodeShugaku()},encodePzpr:function(){this.encodeShugaku()},decodeShugaku:function(){for(var a=0,b=this.outbstr,c=this.owner.board,d=0;d<b.length;d++){var e=b.charAt(d),f=c.cell[a];if(e>="0"&&"4">=e?f.qnum=parseInt(e,36):"5"===e?f.qnum=-2:a+=parseInt(e,36)-6,a++,a>=c.cellmax)break}this.outbstr=b.substr(d+1)},encodeShugaku:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qnum;-2===f?e="5":-1!==f?e=f.toString(36):b++,0===b?a+=e:(e||30===b)&&(a+=(5+b).toString(36)+e,b=0)}b>0&&(a+=(5+b).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"5"===b?a.qnum=-2:"#"===b?a.qans=1:"-"===b?a.qsub=1:b>="a"&&"j">=b?a.qans=parseInt(b,20)+31:"."!==b&&(a.qnum=parseInt(b))})},encodeData:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"5 ":1===a.qans?"# ":a.qans>=41?(a.qans-31).toString(20)+" ":1===a.qsub?"- ":". "})}},AnsCheck:{checkAns:function(){if(!this.checkKitamakura())return"kitamakura";if(!this.check2x2BlackCell())return"bc2x2";if(!this.checkDir4PillowOver())return"nmPillowGt";if(!this.checkFullSizeFuton())return"futonHalf";if(!this.checkFutonAisle())return"futonMidPos";var a=this.owner.board.getBCellInfo();return this.checkOneArea(a)?this.checkDir4PillowLess()?this.checkEmptyCell_shugaku()?null:"ceEmpty":"nmPillowLt":"bcDivide"},checkDir4PillowOver:function(){return this.checkDir4Cell(function(a){return a.isPillow()},2)},checkDir4PillowLess:function(){return this.checkDir4Cell(function(a){return a.isPillow()},1)},checkFullSizeFuton:function(){return this.checkAllCell(function(a){return 41===a.getQans()||46===a.getQans()})},checkEmptyCell_shugaku:function(){return this.checkAllCell(function(a){return a.noNum()&&0===a.getQans()})},checkKitamakura:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(43===d.getQans()){if(this.checkOnly)return!1;d.seterr(1),d.dn().seterr(1),a=!1}}return a},checkFutonAisle:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(!d.isNum()){var e=null;switch(d.getQans()){case 42:e=d.up();break;case 43:e=d.dn();break;case 44:e=d.lt();break;case 45:e=d.rt();break;default:continue}if(0===d.countDir4Cell(function(a){return a.isBlack()})&&0===e.countDir4Cell(function(a){return a.isBlack()})){if(this.checkOnly)return!1;d.seterr(1),e.seterr(1),a=!1}}}return a}},FailCode:{bcDivide:["通路が分断されています。","Aisle is divided."],nmPillowGt:["柱のまわりにある枕の数が間違っています。","The number of pillows around the number is wrong."],nmPillowLt:["柱のまわりにある枕の数が間違っています。","The number of pillows around the number is wrong."],kitamakura:["北枕になっている布団があります。","There is a 'Kita-makura' futon."],futonHalf:["布団が2マスになっていません。","There is a half-size futon."],futonMidPos:["通路に接していない布団があります。","There is a futon separated to aisle."],ceEmpty:["布団でも黒マスでもないマスがあります。","There is an empty cell."]}});