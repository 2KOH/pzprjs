/*! @license pzpr.js v3.4.0-pre (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
!function(){if(!window.Candle){var a=document,b=2*Math.PI,c=[],d=[],e=function(){for(var a=[],b=256;512>b;b++)a[b-256]=b.toString(16).substr(1);return a}(),f={version:"0.2.1",wrapper:{},addWrapper:function(a,b){a=a.replace(/\s+/g,"");var c=a.indexOf(":"),d="";c>=0&&(d=a.substr(c+1),a=a.substr(0,c));var e=function(){this.initialize&&this.initialize.apply(this,arguments)};if(d&&this.wrapper[d]){var f=this.wrapper[d];for(var g in f.prototype)e.prototype[g]=f.prototype[g]}for(var g in b)e.prototype[g]=b[g];e.prototype.constructor=e;var h={body:e,name:a,base:d};this.wrapper[h.name]=h.body},_order:[],enable:{},addTypes:function(a){this._order.push(a),this.enable[a]=!0,this.current||(this.current=a)},TypeList:function(a){for(var b=0;b<f._order.length;b++)this[f._order[b]]=f._order[b]===a},current:"",select:function(a){return this.enable[a]?(this.current=a,!0):!1},ME:null,initME:function(){var b=a.createElement("div");b.style.display="inline",b.style.position="absolute",b.style.left="-9000px",b.innerHTML="",a.body.appendChild(b),this.ME=b},color:c,parse:function(a){if(!c[a])if("rgb("===a.substr(0,4)){var b=a.match(/\d+/g);c[a]=["#",e[b[0]],e[b[1]],e[b[2]]].join("")}else c[a]=a;return c[a]},parsecolorrev:function(a){if(a.match(/\#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/)){var b=parseInt(RegExp.$1,16).toString(),c=parseInt(RegExp.$2,16).toString(),d=parseInt(RegExp.$3,16).toString();return["rgb(",b,",",c,",",d,")"].join("")}return a},getRectSize:function(a){return{width:a.offsetWidth||a.clientWidth,height:a.offsetHeight||a.clientHeight}},_counter:-1,getcanvasid:function(){return this._counter++,"_candle_canvas_"+this._counter},_initializing:0,initAllElements:function(){for(var b=a.getElementsByTagName("candle"),c=0;c<b.length;c++)this.start(b[c].id)},start:function(b,c,d){var e=a.getElementById(this.EL_ID_HEADER+b);if(e)return void(this.readyflag[b]===!0&&d(e.parentNode.getContext("2d")));this.ME||this.initME();var f=c;if(this.enable[f]||(f=this.current),this.enable[f]){this._initializing++,this.readyflag[b]=!1;var g=new this.wrapper[f](b),h=this;g&&d&&(h.isready(b)?d(g):setTimeout(function(){return h.isready(b)?void d(g):void setTimeout(arguments.callee,20)},20))}},readyflag:{},isready:function(a){return!!this.readyflag[a]},allready:function(){return 0===this._initializing},debugmode:!1,onload:function(){this.createCSS(),this.initAllElements()},sheet:null,createCSS:function(){if(!this.sheet){var b=a.getElementsByTagName("head")[0];if(b){var c=a.createElement("style");c.setAttribute("type","text/css"),b.appendChild(c)}else a.write("<style></style>");this.sheet=a.styleSheets[a.styleSheets.length-1];for(var e=0;e<d.length;e++)this.addCSS(d[e][0],d[e][1]);d=[]}},addCSS:function(a,b){if(this.sheet){var c=this.sheet;c.insertRule?c.insertRule(a+"{"+b+"}",c.cssRules.length):c.addRule&&c.addRule(a,b,-1)}else d.push(a,b)}};window.addEventListener?window.addEventListener("load",function(){f.onload()},!1):window.attachEvent&&window.attachEvent("onload",function(){f.onload()}),a.createElement("candle"),f.createCSS(),f.addCSS("candle","display:block;"),window.Candle=f,f.addWrapper("wrapperbase",{initialize:function(a){this.fillStyle="black",this.strokeStyle="black",this.lineWidth=1,this.font="14px system",this.textAlign="center",this.textBaseline="middle",this.canvas=null,this.idname=a,this.canvasid=f.getcanvasid(),this.child=null,this.currentLayerId="_empty",this.isedgearray={_empty:!1},this.isedge=!1}}),f.addWrapper("vector:wrapperbase",{initialize:function(a){f.wrapper.wrapperbase.prototype.initialize.call(this,a),this.vid="",this.elements=[],this.lastElement=null,this.target=null,this.cpath=[],this.lastpath=""},initElement:function(){},afterInit:function(){var a=this.canvas,b=(this.child,f.getRectSize(a)),c=this;a.style.display="block",a.style.position="relative",a.style.overflow="hidden",f.debugmode&&(a.style.backgroundColor="#efefef",a.style.border="solid 1px silver"),a.getContext=function(){return c},a.toDataURL=function(){return null},a.toBlob=function(){return null},this.target=this.child,this.rect(0,0,b.width,b.height),this.addVectorElement(!1,!1),this.setLayer(),f._initializing--,f.readyflag[this.idname]=!0},initTarget:function(){},clear:function(){this.resetElement()},resetElement:function(){this.vid="",this.elements=[],this.lastElement=null,this.initTarget()},setLayer:function(a){if(this.initTarget(),a){var b=[this.canvasid,"layer",a].join("_"),c=this.getLayerById(b);c||(c=this.createLayer(b)),this.target=c}this.currentLayerId=a?a:"_empty",this.setLayerEdge()},setLayerEdge:function(){this.isedge=void 0!==this.isedgearray[this.currentLayerId]?this.isedgearray[this.currentLayerId]:this.isedgearray._empty},getLayerById:function(){},createLayer:function(){return null},setRendering:function(){},setUnselectable:function(){},getContextElement:function(){return this.child},getLayerElement:function(){return this.target},changeSize:function(a,b){this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.changeChildSize(this.canvas.firstChild,a,b)},changeChildSize:function(){},beginPath:function(){this.cpath=[],this.lastpath=""},closePath:function(){this.cpath.push(this.PATH_CLOSE),this.lastpath=this.PATH_CLOSE},moveTo:function(a,b){this.cpath.push(this.PATH_MOVE,a,b),this.lastpath=this.PATH_MOVE},lineTo:function(a,b){this.lastpath!==this.PATH_LINE&&this.cpath.push(this.PATH_LINE),this.cpath.push(a,b),this.lastpath=this.PATH_LINE},rect:function(a,b,c,d){this.cpath.push(this.PATH_MOVE,a,b,this.PATH_LINE,a+c,b,a+c,b+d,a,b+d,this.PATH_CLOSE),this.lastpath=this.PATH_CLOSE},arc:function(a,c,d,e,f,g){var h,i,j,k;f-e>=b?(h=a+d,i=c,j=a+d,k=c):(h=a+d*Math.cos(e),i=c+d*Math.sin(e),j=a+d*Math.cos(f),k=c+d*Math.sin(f)),f-e>=b&&(i+=.125);var l=e>f^Math.abs(f-e)>Math.PI,m=g^l?1:0,n=0==m^l?1:0;this.cpath.push(this.PATH_MOVE,h,i,this.PATH_ARCTO,d,d,0,m,n,j,k),this.lastpath=this.PATH_ARCTO},fill:function(){this.addVectorElement(!0,!1)},stroke:function(){this.addVectorElement(!1,!0)},shape:function(){this.addVectorElement(!0,!0)},fillRect:function(a,b,c,d){var e=this.cpath;this.cpath=[],this.rect(a,b,c,d),this.addVectorElement(!0,!1),this.cpath=e},strokeRect:function(a,b,c,d){var e=this.cpath;this.cpath=[],this.rect(a,b,c,d),this.addVectorElement(!1,!0),this.cpath=e},shapeRect:function(a,b,c,d){var e=this.cpath;this.cpath=[],this.rect(a,b,c,d),this.addVectorElement(!0,!0),this.cpath=e},fillText:function(){},drawImage:function(){},translate:function(){},setLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2),d=[],e=0;c>e;e+=2)d[e>>1]=[a[e],a[e+1]];this.setLinePath_com.call(this,d),a[b-1]&&this.cpath.push(this.PATH_CLOSE)},setOffsetLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2),d=[],e=0;c-2>e;e+=2)d[e>>1]=[a[e+2]+a[0],a[e+3]+a[1]];this.setLinePath_com.call(this,d),a[b-1]&&this.cpath.push(this.PATH_CLOSE)},setLinePath_com:function(a){this.cpath=[];for(var b=0,c=a.length;c>b;b++)this.cpath.push(0===b?this.PATH_MOVE:this.PATH_LINE),this.cpath.push(a[b][0],a[b][1])},setDashSize:function(){},strokeLine:function(a,b,c,d){var e=this.cpath;this.cpath=[this.PATH_MOVE,a,b,this.PATH_LINE,c,d],this.addVectorElement(!1,!0),this.cpath=e},strokeDashedLine:function(a,b,c,d,e){var f=this.cpath;this.cpath=[this.PATH_MOVE,a,b,this.PATH_LINE,c,d],this.addVectorElement(!1,!0),this.setDashSize(e),this.cpath=f},strokeCross:function(a,b,c){var d=this.cpath;this.cpath=[this.PATH_MOVE,a-c,b-c,this.PATH_LINE,a+c,b+c,this.PATH_MOVE,a-c,b+c,this.PATH_LINE,a+c,b-c],this.addVectorElement(!1,!0),this.cpath=d},fillCircle:function(a,c,d){var e=this.cpath;this.cpath=[],this.arc(a,c,d,0,b,!1),this.cpath.push(this.PATH_CLOSE),this.addVectorElement(!0,!1),this.cpath=e},strokeCircle:function(a,c,d){var e=this.cpath;this.cpath=[],this.arc(a,c,d,0,b,!1),this.cpath.push(this.PATH_CLOSE),this.addVectorElement(!1,!0),this.cpath=e},shapeCircle:function(a,c,d){var e=this.cpath;this.cpath=[],this.arc(a,c,d,0,b,!1),this.cpath.push(this.PATH_CLOSE),this.addVectorElement(!0,!0),this.cpath=e},addVectorElement:function(){}}),function(){var b="http://www.w3.org/2000/svg",c="http://www.w3.org/1999/xlink";if(document.createElementNS&&document.createElementNS(b,"svg").suspendRedraw){var d=" M",e=" L",g=" A",h=" z",i="fill",j="stroke",k="stroke-width",l="shape-rendering",m="none",n={left:"start",center:"middle",right:"end"},o={top:-.7,hanging:-.6,middle:-.25,alphabetic:0,bottom:.1};f.addTypes("svg"),f.addWrapper("svg:vector",{initialize:function(a){f.wrapper.vector.prototype.initialize.call(this,a),this.use=new f.TypeList("svg"),this.PATH_MOVE=d,this.PATH_LINE=e,this.PATH_CLOSE=h,this.PATH_ARCTO=g,this.initElement()},initElement:function(){var d=this.canvas=a.getElementById(this.idname),e=f.getRectSize(this.canvas),g=a.createElementNS(b,"svg");g.setAttribute("xmlns",b),g.setAttribute("xmlns:xlink",c),g.setAttribute("id",this.canvasid),g.setAttribute("font-size","10"),g.setAttribute("font-family","sans-serif"),g.setAttribute("width",e.width),g.setAttribute("height",e.height),g.setAttribute("viewBox",[0,0,e.width,e.height].join(" ")),d.appendChild(g),this.child=g,this.afterInit(),d.toDataURL=function(){return"data:image/svg+xml;base64,"+window.btoa(g.outerHTML||(new XMLSerializer).serializeToString(g))},d.toBlob=function(){return new Blob([g.outerHTML||(new XMLSerializer).serializeToString(g)],{type:"image/svg+xml"})}},initTarget:function(){this.target=a.getElementById(this.canvasid)},clear:function(){for(var a=this.canvas.firstChild,b=a.firstChild;b;)a.removeChild(b),b=a.firstChild;this.resetElement()},setLayerEdge:function(){},createLayer:function(c){var d=a.createElementNS(b,"g");return d.setAttribute("id",c),this.target.appendChild(d),d},getLayerById:function(b){return a.getElementById(b)},setRendering:function(a){this.target.setAttribute(l,a)},setUnselectable:function(a){a=void 0===a?!0:!!a,this.canvas.style.MozUserSelect=a?"none":"text",this.canvas.style.WebkitUserSelect=a?"none":"text",this.canvas.style.userSelect=a?"none":"text"},changeChildSize:function(a,b,c){a.setAttribute("width",b),a.setAttribute("height",c);var d=a.getAttribute("viewBox").split(/ /);a.setAttribute("viewBox",[d[0],d[1],b,c].join(" "))},fillText:function(c,d,e){var g=!!this.vid&&!!this.elements[this.vid],h=f.ME;h.style.font=this.font,h.innerHTML=c;var j=e-h.offsetHeight*o[this.textBaseline.toLowerCase()],k=g?this.elements[this.vid]:a.createElementNS(b,"text");if(k.setAttribute("x",d),k.setAttribute("y",j),k.setAttribute(i,f.parse(this.fillStyle)),k.setAttribute("text-anchor",n[this.textAlign.toLowerCase()]),this.font.match(/(.+\s)?([0-9]+)px (.+)$/)){var l=RegExp.$1,m=RegExp.$2,p=RegExp.$3;k.setAttribute("font-size",m),p.match(/^sans\-serif$/i)||k.setAttribute("font-family",p),l.match(/(italic|oblique)/)&&k.setAttribute("font-style",RegExp.$1),l.match(/(bold|bolder|lighter|[1-9]00)/)&&k.setAttribute("font-weight",RegExp.$1)}else k.setAttribute("font",this.font);g?k.replaceChild(a.createTextNode(c),k.firstChild):(k.appendChild(a.createTextNode(c)),this.target.appendChild(k),this.lastElement=k),!g&&this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")},drawImage:function(d,e,f,g,h,i,j,k,l){void 0===g&&(g=d.width,h=d.height),void 0===i&&(i=e,e=0,j=f,f=0,k=g,l=h);var m=!!this.vid&&!!this.elements[this.vid],n=m?this.elements[this.vid]:a.createElementNS(b,"svg");n.setAttribute("viewBox",[e,f,g,h].join(" ")),n.setAttribute("x",i),n.setAttribute("y",j),n.setAttribute("width",k),n.setAttribute("height",l);var o=m?n.firstChild:a.createElementNS(b,"image");o.setAttributeNS(null,"width",d.width),o.setAttributeNS(null,"height",d.height),o.setAttributeNS(c,"xlink:href",d.src),m||(n.appendChild(o),this.target.appendChild(n),this.lastElement=n),!m&&this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")},translate:function(a,b){var c=this.canvas.firstChild,d=c.getAttribute("viewBox").split(/ /);d[0]=-a,d[1]=-b,c.setAttribute("viewBox",d.join(" "))},setDashSize:function(a){this.lastElement&&this.lastElement.setAttribute("stroke-dasharray",a.join(" "))},addVectorElement:function(c,d){var e=this.cpath.join(" "),g=a.createElementNS(b,"path");g.setAttribute("d",e),g.setAttribute(i,c?f.parse(this.fillStyle):m),g.setAttribute(j,d?f.parse(this.strokeStyle):m),d&&g.setAttribute(k,this.lineWidth),this.target.appendChild(g),this.lastElement=g,this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")}})}}(),function(){if(document.createElement("canvas").getContext){var c=CanvasRenderingContext2D.prototype;c.setLineDash||("mozDash"in c?c.setLineDash=function(a){this.mozDash=a}:"webkitLineDash"in c&&(c.setLineDash=function(a){this.webkitLineDash=a})),f.addTypes("canvas"),f.addWrapper("canvas:wrapperbase",{initialize:function(a){f.wrapper.wrapperbase.prototype.initialize.call(this,a),this.context=null,this.use=new f.TypeList("canvas"),this.x0=0,this.y0=0,this.initElement()},initElement:function(){this.canvas=a.getElementById(this.idname);var b=f.getRectSize(this.canvas),c=a.createElement("canvas");c.id=this.canvasid,c.width=b.width,c.height=b.height,c.style.position="relative",c.style.width=b.width+"px",c.style.height=b.height+"px",this.canvas.appendChild(c),this.child=c,this.afterInit()},afterInit:function(){var a=this.canvas,b=this.child,c=this;a.style.display="block",a.style.position="relative",a.style.overflow="hidden",f.debugmode&&(a.style.backgroundColor="#efefef",a.style.border="solid 1px silver"),a.getContext=function(){return c},a.toDataURL=function(a){return a?b.toDataURL(a):b.toDataURL()},a.toBlob=function(){try{return b.toBlob()}catch(a){}b.toDataURL().match(/data:(.*);base64,(.*)/);for(var c=window.atob(RegExp.$2),d=c.length,e=new Uint8Array(d),f=0;d>f;f++)e[f]=c.charCodeAt(f);return new Blob([e.buffer],{type:RegExp.$1})},b.toBlob=b.toBlob||b.msToBlob,this.setLayer(),this.context=this.child.getContext("2d"),f._initializing--,f.readyflag[this.idname]=!0},clear:function(){this.setProperties(),this.context.setTransform(1,0,0,1,0,0),this.context.translate(this.x0,this.y0);var a=f.getRectSize(this.canvas);this.context.clearRect(0,0,a.width,a.height)},setLayer:function(a){this.currentLayerId=a?a:"_empty",this.isedge=void 0!==this.isedgearray[this.currentLayerId]?this.isedgearray[this.currentLayerId]:this.isedgearray._empty,this.setEdgeStyle(a)},setEdgeStyle:function(){var a=this.canvas.style;"imageRendering"in a&&(a.imageRendering="",this.isedge&&(a.imageRendering="pixelated",a.imageRendering||(a.imageRendering="-webkit-optimize-contrast"),a.imageRendering||(a.imageRendering="-moz-crisp-edges"),a.imageRendering||(a.imageRendering="-o-crisp-edges")))},setRendering:function(a){this.isedgearray[this.currentLayerId]="crispEdges"===a,this.isedge=this.isedgearray[this.currentLayerId],this.setEdgeStyle(this.currentLayerId)},setUnselectable:function(a){a=void 0===a?!0:!!a;var b=this.canvas.style;b.MozUserSelect=b.WebkitUserSelect=b.userSelect=a?"none":"text"},getContextElement:function(){return this.child},getLayerElement:function(){return this.child},changeSize:function(a,b){var c=this.canvas;c.style.width=a+"px",c.style.height=b+"px";var d=this.child,e=parseInt(d.style.left),f=parseInt(d.style.top);a+=0>e?-e:0,b+=0>f?-f:0,d.style.width=a+"px",d.style.height=b+"px",d.width=a,d.height=b},setProperties:function(){var a=this.context;a.fillStyle=this.fillStyle,a.strokeStyle=this.strokeStyle,a.lineWidth=this.lineWidth,a.font=this.font,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline},beginPath:function(){this.context.beginPath()},closePath:function(){this.context.closePath()},moveTo:function(a,b){this.context.moveTo(a,b)},lineTo:function(a,b){this.context.lineTo(a,b)},rect:function(a,b,c,d){this.context.rect(a,b,c,d)},arc:function(a,b,c,d,e,f){this.context.arc(a,b,c,d,e,f)},fill:function(){this.setProperties(),this.context.fill()},stroke:function(){this.setProperties(),this.context.stroke()},shape:function(){this.setProperties(),this.context.fill(),this.context.stroke()},fillRect:function(a,b,c,d){this.setProperties(),this.context.fillRect(a,b,c,d)},strokeRect:function(a,b,c,d){this.setProperties(),this.context.strokeRect(a,b,c,d)},shapeRect:function(a,b,c,d){this.setProperties(),this.context.fillRect(a,b,c,d),this.context.strokeRect(a,b,c,d)},fillText:function(a,b,c){this.setProperties(),this.context.fillText(a,b,c)},drawImage:function(){this.context.drawImage.apply(this.context,arguments)},translate:function(a,b){this.x0=a,this.y0=b,this.context.translate(a,b)},setLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2),d=[],e=0;c>e;e+=2)d[e>>1]=[a[e],a[e+1]];this.setLinePath_com.call(this,d),a[b-1]&&this.context.closePath()},setOffsetLinePath:function(){for(var a=arguments,b=a.length,c=b-(1|b?1:2)-2,d=[],e=0;c>e;e+=2)d[e>>1]=[a[e+2]+a[0],a[e+3]+a[1]];this.context.beginPath(),this.setLinePath_com.call(this,d),a[b-1]&&this.context.closePath()},setLinePath_com:function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];0===b?this.context.moveTo(d[0],d[1]):this.context.lineTo(d[0],d[1])}},setDashSize:function(){},strokeLine:function(a,b,c,d){var e=this.context;this.setProperties(),e.beginPath(),e.moveTo(a,b),e.lineTo(c,d),e.stroke()},strokeDashedLine:function(a,b,c,d,e){var f=this;this.context,this.strokeDashedLine=this.context.setLineDash?function(a,b,c,d,e){var g=f.context;f.setProperties(),g.beginPath(),g.moveTo(a,b),g.lineTo(c,d),g.setLineDash(e),g.stroke(),g.setLineDash([])}:function(a,b,c,d,e){e.length%2===1&&(e=e.concat(e));var g=Math.sqrt((c-a)*(c-a)+(d-b)*(d-b)),h=0,i=0,j=(d-b)/(c-a),k=j*j+1,l=f.context;for(f.setProperties(),l.beginPath(),l.moveTo(a,b);g>h;){var m=Math.sqrt(h*h/k),n=a+m,o=b+j*m;0===(1&i)?l.moveTo(n,o):l.lineTo(n,o),h+=e[i],i++,i>=e.length&&(i=0)}l.stroke()},this.strokeDashedLine(a,b,c,d,e)},strokeCross:function(a,b,c){var d=this.context;this.setProperties(),d.beginPath(),d.moveTo(a-c,b-c),d.lineTo(a+c,b+c),d.moveTo(a-c,b+c),d.lineTo(a+c,b-c),d.stroke()},fillCircle:function(a,c,d){var e=this.context;this.setProperties(),e.beginPath(),e.arc(a,c,d,0,b,!1),e.fill()},strokeCircle:function(a,c,d){var e=this.context;this.setProperties(),e.beginPath(),e.arc(a,c,d,0,b,!1),e.stroke()},shapeCircle:function(a,c,d){var e=this.context;this.setProperties(),e.beginPath(),e.arc(a,c,d,0,b,!1),e.fill(),e.stroke()}})}}(),function(){try{if(!new ActiveXObject("AgControl.AgControl").IsVersionSupported("1.0"))return}catch(b){return}var c=" M",d=" L",e=" A",g=" z",h={left:0,center:.5,right:1},i={top:.2,hanging:.2,middle:.5,alphabetic:.7,bottom:.8};f.addTypes("sl"),f.addWrapper("sl:vector",{initialize:function(a){f.wrapper.vector.prototype.initialize.call(this,a),this.x0=0,this.y0=0,this.content=null,this.use=new f.TypeList("sl"),this.PATH_MOVE=c,this.PATH_LINE=d,this.PATH_CLOSE=g,this.PATH_ARCTO=e,this.initElement()},initElement:function(){this.canvas=a.getElementById(this.idname);var b=this,c="_function_"+this.canvasid+"_onload";window[c]=function(){b.content=document.getElementById([b.canvasid,"object"].join("_")).content,b.child=b.content.findName(b.canvasid),b.afterInit.call(b)},this.canvas.innerHTML=['<object type="application/x-silverlight" width="100%" height="100%" id="',this.canvasid,'_object">','<param name="windowless" value="true" />','<param name="background" value="#00000000" />','<param name="source" value="#',this.canvasid,'_script" />','<param name="onLoad" value="',c,'" />',"</object>",'<script type="text/xaml" id="',this.canvasid,'_script">','<Canvas xmlns="http://schemas.microsoft.com/client/2007" Name="',this.canvasid,'" />',"</script>"].join("")},initTarget:function(){this.target=this.content?this.content.findName(this.canvasid):null},clear:function(){this.content.findName(this.canvasid).children.clear(),this.resetElement()},createLayer:function(a){var b=this.content.createFromXaml(['<Canvas Name="',a,'"/>'].join(""));return this.target.children.add(b),b},getLayerById:function(a){return this.content.findName(a)},setRendering:function(a){this.isedgearray[this.currentLayerId]="crispEdges"===a,this.isedge=this.isedgearray[this.currentLayerId]},setUnselectable:function(a){a=void 0===a?!0:!!a,this.canvas.unselectable=a?"on":""},changeChildSize:function(a,b,c){a.height=c+1+"px",a.width=b+"px",a.height=c+"px"},moveTo:function(a,b){this.cpath.push(this.PATH_MOVE,a+this.x0,b+this.y0),this.lastpath=this.PATH_MOVE},lineTo:function(a,b){this.lastpath!==this.PATH_LINE&&this.cpath.push(this.PATH_LINE),this.cpath.push(a+this.x0,b+this.y0),this.lastpath=this.PATH_LINE},rect:function(a,b,c,d){a+=this.x0,b+=this.y0,this.cpath.push(this.PATH_MOVE,a,b,this.PATH_LINE,a+c,b,a+c,b+d,a,b+d,this.PATH_CLOSE),this.lastpath=this.PATH_CLOSE},arc:function(a,b,c,d,e,g){a+=this.x0,b+=this.y0,f.wrapper.vector.prototype.arc.call(this,a,b,c,d,e,g)},fillText:function(a,b,c){var d=!!this.vid&&!!this.elements[this.vid],e=f.ME;e.style.font=this.font;var g;if(d)g=this.elements[this.vid];else{var j=parseInt(this.canvas.offsetWidth),k=b+this.x0-j*h[this.textAlign.toLowerCase()],l=['<TextBlock Canvas.Left="',k,'" Canvas.Top="',c+this.y0,'" Width="',j,'" TextAlignment="',this.textAlign,'" Foreground="black" />'];g=this.content.createFromXaml(l.join(""))}g.Foreground=f.parse(this.fillStyle),g.FontFamily=e.style.fontFamily.replace(/\"/g,"'"),g.FontSize=parseInt(e.style.fontSize),g.Text=a;var m=g.ActualHeight*i[this.textBaseline.toLowerCase()];g["Canvas.Top"]=c+this.y0-(isNaN(m)?0:m),d||(this.target.children.add(g),this.lastElement=g),!d&&this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")},drawImage:function(a,b,c,d,e,f,g,h,i){void 0===d&&(d=a.width,e=a.height),void 0===f&&(f=b,b=0,g=c,c=0,h=d,i=e);var j,k=!!this.vid&&!!this.elements[this.vid];if(k)j=this.elements[this.vid],j.Source=a.src;else{var l=['<Image Source="',a.src,'" />'];j=this.content.createFromXaml(l.join(""))}j["Canvas.Left"]=f-b*(h/d)+this.x0,j["Canvas.Top"]=g-c*(i/e)+this.y0,j.Width=a.width*(h/d),j.Height=a.height*(i/e),j.Clip=this.content.createFromXaml(['<RectangleGeometry Rect="',b*(h/d),",",c*(i/e),",",h,",",i,'" />'].join("")),k||(this.target.children.add(j),this.lastElement=j),!k&&this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")},translate:function(a,b){this.canvas.firstChild,this.x0=a,this.y0=b},setDashSize:function(a){this.lastElement&&(this.lastElement.StrokeDashArray=a.join(","))},strokeLine:function(a,b,c,d){a+=this.x0,b+=this.y0,c+=this.x0,d+=this.y0,f.wrapper.vector.prototype.strokeLine.call(this,a,b,c,d)},strokeDashedLine:function(a,b,c,d,e){a+=this.x0,b+=this.y0,c+=this.x0,d+=this.y0,f.wrapper.vector.prototype.strokeDashedLine.call(this,a,b,c,d,e)},strokeCross:function(a,b,c){a+=this.x0,b+=this.y0,f.wrapper.vector.prototype.strokeCross.call(this,a,b,c)},addVectorElement:function(a,b){var c=this.cpath.join(" "),d=['<Path Data="',c,'"'];a&&d.push(' Fill="',f.parse(this.fillStyle),'"'),b&&d.push(' Stroke="',f.parse(this.strokeStyle),'" StrokeThickness="',this.lineWidth,'"'),d.push(" />");var e=this.content.createFromXaml(d.join(""));this.lastElement=e,this.target.children.add(e),this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")}})}(),function(){try{document.namespaces.add("v","urn:schemas-microsoft-com:vml")}catch(c){return}var d="<v:shape",e="<v:group",g="<v:image",h="<v:textpath",i="<v:polyline",j='<v:path textpathok="t" />',k="",l=">",m=" />",n="</v:group>",o="</v:polyline>",p=' path="',q=' points="',r=' style="',s=' string="',t=' coordsize="100,100"',u=' fillcolor="',v=' strokecolor="',w=' strokeweight="',x='"',y=' stroked="f" filled="t"',z=' on="t" xscale="t"',A="font:",B="v-text-align:",C=";",D=" m",E=" l",F=" x",G=" ?",H=" ns",I=" nf",J={left:0,center:.5,right:1},K={top:-.7,hanging:-.66,middle:-.3,alphabetic:0,bottom:.1},L=10,M=L/2,N="behavior: url(#default#VML);",O=N+" position:absolute; width:10px; height:10px;";f.addCSS("v\\:shape",O),f.addCSS("v\\:group",O),f.addCSS("v\\:polyline",O),f.addCSS("v\\:image",O),f.addCSS("v\\:path",N),f.addCSS("v\\:textpath",N),f.addCSS("v\\:stroke",N),f.addTypes("vml"),f.addWrapper("vml:vector",{initialize:function(a){f.wrapper.vector.prototype.initialize.call(this,a),this.use=new f.TypeList("vml"),this.PATH_MOVE=D,this.PATH_LINE=E,this.PATH_CLOSE=F,this.PATH_ARCTO=G,this.initElement()},initElement:function(){this.canvas=a.getElementById(this.idname);var b=f.getRectSize(this.canvas),c=a.createElement("div");c.id=this.canvasid,c.style.position="absolute",c.style.left="-2px",c.style.top="-2px",c.style.width=b.width+"px",c.style.height=b.height+"px",this.canvas.appendChild(c),this.child=c,this.afterInit()},initTarget:function(){this.target=a.getElementById(this.canvasid)},clear:function(){for(var a=this.canvas.firstChild,b=a.firstChild;b;)a.removeChild(b),b=a.firstChild;this.resetElement()},createLayer:function(b){var c=a.createElement("div");return c.id=b,c.unselectable=k?"on":"",c.style.position="absolute",c.style.left="0px",c.style.top="0px",this.target.appendChild(c),c},getLayerById:function(b){return a.getElementById(b)},setRendering:function(a){this.isedgearray[this.currentLayerId]="crispEdges"===a,this.isedge=this.isedgearray[this.currentLayerId]},setUnselectable:function(a){a=void 0===a?!0:!!a,k=a?' unselectable="on"':"",this.canvas.unselectable=a?"on":"",this.child.unselectable=a?"on":""},changeChildSize:function(a,b,c){a.style.width=b+"px",a.style.height=c+"px"},moveTo:function(a,b){this.cpath.push(this.PATH_MOVE,this.ePos(a,!0),this.ePos(b,!0)),this.lastpath=this.PATH_MOVE},lineTo:function(a,b){this.lastpath!==this.PATH_LINE&&this.cpath.push(this.PATH_LINE),this.cpath.push(this.ePos(a,!0),this.ePos(b,!0)),this.lastpath=this.PATH_LINE},rect:function(a,b,c,d){a=this.ePos(a,!0),b=this.ePos(b,!0),c=this.eLen(c),d=this.eLen(d),this.cpath.push(this.PATH_MOVE,a,b,this.PATH_LINE,a+c,b,a+c,b+d,a,b+d,this.PATH_CLOSE),this.lastpath=this.PATH_CLOSE},arc:function(a,c,d,e,f,g){var h,i,j,k;f-e>=b?(h=a+d,i=c,j=a+d,k=c):(h=a+d*Math.cos(e),i=c+d*Math.sin(e),j=a+d*Math.cos(f),k=c+d*Math.sin(f)),a=a*L-M|0,c=c*L-M|0,d=d*L|0,h=h*L-M|0,i=i*L-M|0,j=j*L-M|0,k=k*L-M|0;var l=g?"at":"wa";f-e>=b&&(h+=1),this.cpath.push(l,a-d,c-d,a+d,c+d,h,i,j,k),this.lastpath=l},fillText:function(a,b,c){var d=!!this.vid&&!!this.elements[this.vid],g=f.ME;b=b*L-M|0,c=c*L-M|0,g.style.font=this.font,g.innerHTML=a;var k=c-(g.offsetHeight*K[this.textBaseline.toLowerCase()]*L-M)|0,p=g.offsetWidth*L-M|0,v=b-p*J[this.textAlign.toLowerCase()]|0;if(d){var w=this.elements[this.vid];w.fillcolor=f.parse(this.fillStyle),w.lastChild.style.font=this.font,w.lastChild.string=a}else{var D=[e,t,l,i,q,[v,k,v+p,k].join(","),x,y,u,f.parse(this.fillStyle),x,l,j,h,z,s,a,x,r,A,this.font,C,B,this.textAlign,C,x,m,o,n];this.target.insertAdjacentHTML("BeforeEnd",D.join("")),this.lastElement=this.target.lastChild.lastChild}!d&&this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")},drawImage:function(a,b,c,d,e,f,h,i,j){void 0===d&&(d=a.width,e=a.height),void 0===f&&(f=b,b=0,h=c,c=0,i=d,j=e);var k,l=!!this.vid&&!!this.elements[this.vid];if(l)k=this.elements[this.vid],k.src=a.src;else{var n=[g,' src="',a.src,x,t,m];this.target.insertAdjacentHTML("BeforeEnd",n.join("")),this.lastElement=this.target.lastChild,k=this.lastElement}k.style.left=f,k.style.top=h,k.style.width=i,k.style.height=j,k.cropleft=b/a.width,k.croptop=c/a.height,k.cropright=1-(b+d)/a.width,k.cropbottom=1-(c+e)/a.height,!l&&this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")},translate:function(a,b){var c=this.canvas.firstChild;c.style.position="absolute",c.style.left=a+"px",c.style.top=b+"px"},setLinePath_com:function(a){this.cpath=[];for(var b=0,c=a.length;c>b;b++)this.cpath.push(0===b?this.PATH_MOVE:this.PATH_LINE),this.cpath.push(this.ePos(a[b][0],!0),this.ePos(a[b][1],!0))},setDashSize:function(b){if(this.lastElement){var c=a.createElement("v:stroke");c.dashstyle=b[0]<=2?"ShortDash":b[0]<=5?"Dash":"LongDash",this.lastElement.appendChild(c)}},strokeLine:function(a,b,c,d){a=this.ePos(a,!0),b=this.ePos(b,!0),c=this.ePos(c,!0),d=this.ePos(d,!0),f.wrapper.vector.prototype.strokeLine.call(this,a,b,c,d)},strokeDashedLine:function(a,b,c,d,e){a=this.ePos(a,!0),b=this.ePos(b,!0),c=this.ePos(c,!0),d=this.ePos(d,!0),f.wrapper.vector.prototype.strokeDashedLine.call(this,a,b,c,d,e)},strokeCross:function(a,b,c){a=this.ePos(a,!0),b=this.ePos(b,!0),c=this.eLen(c),f.wrapper.vector.prototype.strokeCross.call(this,a,b,c)},ePos:function(a,b){return a=b?a+(a>0?.5:-.5)-(this.lineWidth%2===1?.5:0)|0:a+(a>0?.5:-.5)|0,a*L-M|0},eLen:function(a){return a*L|0},addVectorElement:function(a,b){var c=this.cpath.join(" ");c=[c,a?"":I,b?"":H].join("");var e=[d,k,t,p,c,x];a&&e.push(u,f.parse(this.fillStyle),x),b&&e.push(v,f.parse(this.strokeStyle),x,w,this.lineWidth,"px",x),e.push(m),this.target.insertAdjacentHTML("BeforeEnd",e.join("")),this.lastElement=this.target.lastChild,this.vid&&(this.elements[this.vid]=this.lastElement,this.vid="")}})}()}}(),function(){function a(a){a=a.replace(/(\r|\n)/g,"");var c={id:"",type:d.URL_AUTO,qdata:""};if(a.match(/www\.kanpen\.net/)||a.match(/www\.geocities(\.co)?\.jp\/pencil_applet/))a.match(/([0-9a-z]+)\.html/),c.id=RegExp.$1,a.indexOf("?heyawake=")>=0?(c.qdata=a.substr(a.indexOf("?heyawake=")+10),c.type=d.URL_HEYAAPP):a.indexOf("?pzpr=")>=0?(c.qdata=a.substr(a.indexOf("?pzpr=")+6),c.type=d.URL_PZPRV3):(c.qdata=a.substr(a.indexOf("?problem=")+9),c.type=d.URL_KANPEN);else if(a.match(/www\.geocities(\.co)?\.jp\/heyawake/))c.id="heyawake",c.qdata=a.substr(a.indexOf("?problem=")+9),c.type=d.URL_HEYAAPP;else if(a.match(/indi\.s58\.xrea\.com\/(.+)\/(sa|sc)\//))c.id=RegExp.$1,c.qdata=a.substr(a.indexOf("?")),c.type=d.URL_PZPRAPP;else{var e=a.indexOf("/",a.indexOf("?"));e>-1?(c.id=a.substring(a.indexOf("?")+1,e),c.qdata=a.substr(e+1)):c.id=a.substr(a.indexOf("?")+1),c.id=c.id.replace(/(m\+|_edit|_test|_play)/,""),c.type=d.URL_PZPRV3}return c.id=pzpr.url.toPID(c.id),b(c)}function b(a){var b=a.qdata.split("/");switch(a.type){case d.URL_KANPEN:a.pflag="","sudoku"==a.id?a.rows=a.cols=parseInt(b.shift()):(a.rows=parseInt(b.shift()),a.cols=parseInt(b.shift()),"kakuro"==a.id&&(a.rows--,a.cols--)),a.bstr=b.join("/");break;case d.URL_HEYAAPP:var c=b.shift().split("x");a.pflag="",a.cols=parseInt(c[0]),a.rows=parseInt(c[1]),a.bstr=b.join("/");break;default:isNaN(parseInt(b[0]))||b.unshift(""),a.pflag=b.shift(),a.cols=parseInt(b.shift()),a.rows=parseInt(b.shift()),a.bstr=b.join("/")}return a}function c(a){var b="",c=a.type;c===d.URL_PZPRV3?b="http://%DOMAIN%/p.html?%PID%/":c===d.URL_PZPRV3E?b="http://%DOMAIN%/p.html?%PID%_edit/":c===d.URL_PZPRAPP?b="http://indi.s58.xrea.com/%PID%/sa/q.html?":c===d.URL_KANPEN?b="http://www.kanpen.net/%KID%.html?problem=":c===d.URL_KANPENP?b="http://www.kanpen.net/%KID%.html?pzpr=":c===d.URL_HEYAAPP&&(b="http://www.geocities.co.jp/heyawake/?problem=");var e=document.domain;e?"indi.s58.xrea.com"==e&&(e="indi.s58.xrea.com/pzpr/v3"):e="pzv.jp",c===d.URL_PZPRAPP&&("pipelinkr"===a.id?b=b.replace("%PID%","pipelink"):"heyabon"===a.id&&(b=b.replace("%PID%","bonsan")));var f=b.replace("%DOMAIN%",e).replace("%PID%",pzpr.url.toURLID(a.id)).replace("%KID%",pzpr.url.toKanpen(a.id));return f+a.qdata}window.pzpr={version:"3.4.0-pre",EDITOR:!1,PLAYER:!0,puzzles:[],createPuzzle:function(a,b){1!==arguments.length||a instanceof HTMLElement||(b=a,a=void 0);var c=new pzpr.Puzzle(a,b);return this.puzzles.push(c),c},deletePuzzle:function(a){for(var b=0,c=this.puzzles.length;c>b;b++)this.puzzles[b]===a&&(this.puzzles[b]=null)},consts:{},addConsts:function(a){for(var b in a)this.consts[b]||(this.consts[b]=a[b])},common:{},custom:{},createPuzzleClass:function(a,b){this.classmgr.createPuzzleClass(a,b)},extendPuzzleClass:function(a,b){this.classmgr.extendPuzzleClass(a,b)},createCustoms:function(a,b){this.classmgr.createCustoms(a,b)},keytarget:null,addKeyEvents:function(){pzpr.util.addEvent(document,"keydown",pzpr,pzpr.execKeyDown),pzpr.util.addEvent(document,"keyup",pzpr,pzpr.execKeyUp),pzpr.util.addEvent(document,"keypress",pzpr,pzpr.execKeyPress)},connectKeyEvents:function(a){this.keytarget=a},execKeyDown:function(a){var b=this.keytarget;b&&b.key&&b.key.e_keydown(a)},execKeyUp:function(a){var b=this.keytarget;
b&&b.key&&b.key.e_keyup(a)},execKeyPress:function(a){var b=this.keytarget;b&&b.key&&b.key.e_keypress(a)},preinit:!0,loadfun:[],addLoadListener:function(a){this.preinit?this.loadfun.push(a):a()},postload:function(){if(this.preinit)if(window.Candle){this.preinit=!1,this.addKeyEvents();for(var a=0;a<this.loadfun.length;a++)this.loadfun[a]();this.loadfun=[]}else setTimeout(function(){pzpr.postload()},10);else;}},document.addEventListener?document.addEventListener("DOMContentLoaded",function(){pzpr.postload()},!1):navigator.userAgent.test(/MSIE 8/)?document.attachEvent("onreadystatechange",function(){"interactive"===document.readyState&&pzpr.postload()}):!function(){try{document.documentElement.doScroll("left")}catch(a){return void setTimeout(arguments.callee,0)}pzpr.postload()}();var d=pzpr.consts;pzpr.classmgr={createPuzzleClass:function(a,b){var c=this._createClass(a,b);pzpr.common[c.name]=c.body},extendPuzzleClass:function(a,b){for(var c in b)pzpr.common[a].prototype[c]=b[c]},_createClass:function(a,b){a=a.replace(/\s+/g,"");var c=a.indexOf(":"),d="";c>=0&&(d=a.substr(c+1),a=a.substr(0,c));var e=function(){};if(d&&pzpr.common[d]){var f=pzpr.common[d];for(var g in f.prototype)e.prototype[g]=f.prototype[g]}for(var g in b)e.prototype[g]=b[g];return e.prototype.constructor=e,{body:e,name:a}},includeCustomFile:function(a){if(!pzpr.custom[a]&&!this.includedFile[a]){var b=document.createElement("script");b.type="text/javascript",b.src=pzpr.util.getpath()+"puzzle/"+pzpr.url.toScript(a)+".js",document.body.appendChild(b),this.includedFile[a]=!0}},includedFile:{},createCustoms:function(a,b){for(var c=pzpr.url.PIDlist(a),d=0;d<c.length;d++){var e=c[d],f=this.PIDfilter(e,b);this.createCustomSingle(e,f)}},PIDfilter:function(a,b){var c={};for(var d in b){var e=d,f=[],g=!1;if(d.match("@")){f=d.substr(d.indexOf("@")+1).split(/,/),e=d.substr(0,d.indexOf("@"));for(var h=0;h<f.length;h++)if(f[h]===a){g=!0;break}g||(e="")}if(e){var i=b[d];c[e]||(c[e]={});for(var j in i)c[e][j]=i[j]}}return c},createCustomSingle:function(a,b){var c={};for(var d in b){var e=b[d];if(c[d])for(var f in e)c[d].prototype[f]=e[f];else{pzpr.common[d]&&(d=d+":"+d);var g=this._createClass(d,e);c[g.name]=g.body}}for(var d in pzpr.common)c[d]||(c[d]=pzpr.common[d]);for(var d in pzpr.common)pzpr.common[d]&&(c[d].prototype.Common=pzpr.common[d]);pzpr.custom[a]=c},setPuzzleClass:function(a,b,c){return a.pid!=b&&this.includeCustomFile(b),pzpr.custom[b]?(a.pid!=b&&(this.setClasses(a,b),a.pid=b),void c()):void setTimeout(function(){pzpr.classmgr.setPuzzleClass(a,b,c)},10)},setClasses:function(a,b){for(var c in a.classlist)a[c]=null,delete a[c];a.classlist=[];var d=pzpr.custom[b];for(var e in d){var f=d[e],g=function(){var a=Array.prototype.slice.apply(arguments);this.initialize&&this.initialize.apply(this,a)};for(var c in f.prototype)g.prototype[c]=f.prototype[c];g.prototype.owner=a,a[e]=g,a.classlist.push(e)}}};try{"object"!=typeof localStorage&&"object"==typeof globalStorage&&(localStorage=globalStorage[location.host])}catch(e){}Array.prototype.forEach||(Array.prototype.forEach=function(a){for(var b=0;b<this.length;b++)a(this[b])}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),Array.prototype.some||(Array.prototype.some=function(a){for(var b=0;b<this.length;b++)if(a(this[b]))return!0;return!1}),pzpr.env=function(){var a=navigator.userAgent,b={IE:!!document.uniqueID,Presto:!!window.opera,WebKit:a.indexOf("AppleWebKit/")>-1,Gecko:a.indexOf("Gecko")>-1&&-1==a.indexOf("KHTML"),IE6:!(!a.match(/MSIE (\d+)/)||6!=parseInt(RegExp.$1)),IE7:!(!a.match(/MSIE (\d+)/)||7!=parseInt(RegExp.$1)),IE8:!(!a.match(/MSIE (\d+)/)||8!=parseInt(RegExp.$1)),IE9:!(!a.match(/MSIE (\d+)/)||9!=parseInt(RegExp.$1)),IE10:!(!a.match(/MSIE (\d+)/)||10!=parseInt(RegExp.$1))};b.legacyIE=b.IE6||b.IE7||b.IE8,b.oldGecko=b.Gecko&&a.match(/rv\:(\d+\.\d+)/)&&parseFloat(RegExp.$1)<1.9;var c=b.Gecko&&a.match(/rv\:(\d+\.\d+)/)&&parseFloat(RegExp.$1)<8,d=a.indexOf("like Mac OS X")>-1,e=a.indexOf("Android")>-1,f={iOS:d,mobile:d||e},g=function(){var a=0;try{window.sessionStorage&&(a|=16)}catch(b){}try{window.localStorage&&(a|=8)}catch(b){}try{window.indexedDB&&(a|=4)}catch(b){}try{if(window.openDatabase){var d=openDatabase("pzprv3_manage","1.0","manager",5242880);d&&(a|=2)}}catch(b){}return c&&!location.hostname&&(a=0),{session:!!(16&a),localST:!!(8&a),WebIDB:!!(4&a),WebSQL:!!(2&a)}}(),h={touchevent:!!window.ontouchstart||!!document.createTouch,pointerevent:!!navigator.pointerEnabled,mspointerevent:!!navigator.msPointerEnabled,anchor_download:void 0!==document.createElement("a").download,dataURL:!(b.legacyIE&&!b.IE8)};return{browser:b,OS:f,storage:g,API:h}}(),pzpr.util={getpath:function(){for(var a=document.getElementsByTagName("script"),b=0;b<a.length;b++){var c=a[b].src.match(/^(.*\/)pzpr\.js$/);if(c)return c[1]+(c[1].match(/\/$/)?"":"/")}return""},currentTime:function(){return(new Date).getTime()},getUserLang:function(){var a=navigator.browserLanguage||navigator.language||navigator.userLanguage;return"ja"===a.substr(0,2)?"ja":"en"},unselectable:function(a){return a.style.MozUserSelect="none",a.style.KhtmlUserSelect="none",a.style.webkitUserSelect="none",a.style.msUserSelect="none",a.style.userSelect="none",a.unselectable="on",this},addEvent:function(a,b,c,d,e){var f=function(a){d.call(c,a||window.event)};a.addEventListener?a.addEventListener(b,f,!!e):a.attachEvent("on"+b,f)},addMouseDownEvent:function(a,b,c){pzpr.env.API.pointerevent?this.addEvent(a,"pointerdown",b,c):pzpr.env.API.mspointerevent?this.addEvent(a,"MSPointerDown",b,c):(this.addEvent(a,"mousedown",b,c),pzpr.env.API.touchevent&&this.addEvent(a,"touchstart",b,c))},addMouseMoveEvent:function(a,b,c){pzpr.env.API.pointerevent?this.addEvent(a,"pointermove",b,c):pzpr.env.API.mspointerevent?this.addEvent(a,"MSPointerMove",b,c):(this.addEvent(a,"mousemove",b,c),pzpr.env.API.touchevent&&this.addEvent(a,"touchmove",b,c))},addMouseUpEvent:function(a,b,c){pzpr.env.API.pointerevent?this.addEvent(a,"pointerup",b,c):pzpr.env.API.mspointerevent?this.addEvent(a,"MSPointerUp",b,c):(this.addEvent(a,"mouseup",b,c),pzpr.env.API.touchevent&&this.addEvent(a,"touchend",b,c))},getMouseButton:function(a){var b=!1,c=!1,d=!1;return void 0!==a.touches?(b=1===a.touches.length,d=a.touches.length>1):pzpr.env.browser.legacyIE?(b=1===a.button,c=4===a.button,d=2===a.button):(b=a.which?1===a.which:0===a.button,c=a.which?2===a.which:1===a.button,d=a.which?3===a.which:2===a.button),{Left:b,Middle:c,Right:d}},getPagePos:function(a){return{px:this.pageX(a),py:this.pageY(a)}},pageX:function(a){function b(){return document.documentElement.scrollLeft||document.body.scrollLeft}if(void 0!==a.touches&&a.touches.length>0){var c=a.touches.length,d=0;if(c>0){for(var e=0;c>e;e++)d+=a.touches[e].pageX;return d/c}}else{if(!isNaN(a.pageX))return a.pageX;if(!isNaN(a.clientX))return a.clientX+b()}return 0},pageY:function(a){function b(){return document.documentElement.scrollTop||document.body.scrollTop}if(void 0!==a.touches&&a.touches.length>0){var c=a.touches.length,d=0;if(c>0){for(var e=0;c>e;e++)d+=a.touches[e].pageY;return d/c}}else{if(!isNaN(a.pageY))return a.pageY;if(!isNaN(a.clientY))return a.clientY+b()}return 0},getRect:function(a){return this.getRect=document.createElement("div").getBoundingClientRect?function(a){var b,c,d,e,f=a.getBoundingClientRect();void 0==!window.scrollX?(d=window.scrollX,e=window.scrollY):(b=document.documentElement,c=document.body,d=(c.scrollLeft||b.scrollLeft)-b.clientLeft,e=(c.scrollTop||b.scrollTop)-b.clientTop);var g=f.left+d,h=f.top+e,i=f.right+d,j=f.bottom+e;return{top:h,bottom:j,left:g,right:i}}:function(a){for(var b=0,c=0,d=a;d;)b+=+(isNaN(d.offsetLeft)?d.clientLeft:d.offsetLeft),c+=+(isNaN(d.offsetTop)?d.clientTop:d.offsetTop),d=d.offsetParent;var e=b+(a.offsetWidth||a.clientWidth),f=c+(a.offsetHeight||a.clientHeight);return{top:c,bottom:f,left:b,right:e}},this.getRect(a)},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}},function(){var a=pzpr.consts;pzpr.addConsts({MODE_EDITOR:1,MODE_PLAYER:3}),pzpr.Puzzle=function(a,b){b=b?b:{},this.opt=b,this.editmode=pzpr.EDITOR,this.playmode=!this.editmode,this.resetTime(),this.imgcanvas=[null,null],this.listeners={},this.config=new pzpr.util.Config(this),a&&this.setCanvas(a,b.graphic)},pzpr.Puzzle.prototype={pid:"",classlist:null,ready:!1,editmode:!1,playmode:!1,starttime:0,canvas:null,subcanvas:null,imgcanvas:null,listeners:null,config:null,initCanvasSize:!1,initCanvasEvent:!1,open:function(a,b){return-1===a.indexOf("\n",a.indexOf("\n"))&&0!==a.indexOf("pzprv3")?this.openURL(a,b):this.openFileData(a,b)},openURL:function(a,b){var c=pzpr.url.parseURL(a),d=c.id?c.id:this.pid;return this.init(d,function(b){b.enc.decodeURL(a)},b),this},openFileData:function(a,b){for(var c=a.replace(/[\t\r]*\n/g,"\n").replace(/\//g,"\n").split(/\n/),d="",e=0;e<c.length&&!c[e].match(/^http\:\/\//);e++)d+=c[e]+"\n";var f=c[0].match(/^pzprv3/)?c[1]:this.pid;return this.init(f,function(a){a.fio.filedecode(d)},b),this},getURL:function(b){return isNaN(b)&&(b=a.URL_AUTO),this.enc.encodeURL(b)},getFileData:function(b){return isNaN(b)&&(b=a.FILE_AUTO),this.fio.fileencode(b)},init:function(a,b,c){var d=this,e=this.Board?this.Board:null;d.ready=!1,pzpr.classmgr.setPuzzleClass(this,a,function(){e!==d.Board&&d.initObjects(),b(d),d.canvas?d.waitCanvasReady(c):d.postCanvasReady(c)})},initObjects:function(){this.board=new this.Board,this.checker=new this.AnsCheck,this.painter=new this.Graphic,this.cursor=new this.TargetCursor,this.mouse=new this.MouseEvent,this.key=new this.KeyEvent,this.opemgr=new this.OperationManager,this.enc=new this.Encode,this.fio=new this.FileIO,this.flags=new this.Flags,this.faillist=new this.FailCode},waitCanvasReady:function(a){var b=this;b.painter.initCanvas(b.canvas,b.subcanvas,function(){b.postCanvasReady(a)})},postCanvasReady:function(a){this.painter.suspendAll(),this.firstCanvasReady(),a&&a(this),this.painter.unsuspend(),this.ready||(this.resetTime(),this.ready=!0)},firstCanvasReady:function(){this.initCanvasEvent||!this.canvas||this.opt.noinput||(this.setCanvasEvents(this.canvas),this.initCanvasEvent=!0),this.initCanvasSize||(this.opt.width&&this.opt.height?this.setCanvasSize(this.opt.width,this.opt.height):this.opt.cellsize&&this.setCanvasSizeByCellSize(this.opt.cellsize),this.initCanvasSize=!0)},setCanvasEvents:function(a){var b=this;pzpr.util.addMouseDownEvent(a,b,b.execMouseDown),pzpr.util.addMouseMoveEvent(a,b,b.execMouseMove),pzpr.util.addMouseUpEvent(a,b,b.execMouseUp),pzpr.util.addEvent(a,"mouseout",b,b.execMouseOut),a.oncontextmenu=function(){return!1}},execMouseDown:function(a){this.mouse.e_mousedown(a)},execMouseMove:function(a){this.mouse.e_mousemove(a)},execMouseUp:function(a){this.mouse.e_mouseup(a)},execMouseOut:function(a){this.mouse.e_mouseout(a)},setSLKeyEvents:function(a){var b=this,c=a.content.findName(a.canvasid);c.AddEventListener("KeyDown",function(a,c){b.execSLKeyDown(a,c)}),c.AddEventListener("KeyUp",function(a,c){b.execSLKeyUp(a,c)})},execSLKeyDown:function(a,b){var c={keyCode:b.platformKeyCode,shiftKey:b.shift,ctrlKey:b.ctrl,altKey:!1,returnValue:!1,preventDefault:function(){}};return this.key.e_keydown(c)},execSLKeyUp:function(a,b){var c={keyCode:b.platformKeyCode,shiftKey:b.shift,ctrlKey:b.ctrl,altKey:!1,returnValue:!1,preventDefault:function(){}};return this.key.e_keyup(c)},addListener:function(a,b){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},execListener:function(){var a=Array.prototype.slice.apply(arguments),b=a.shift(),c=this.listeners[b],d=!0;if(c){a.unshift(this);for(var e=0;e<c.length;e++)c[e].apply(window,a)||(d=!1)}return d},setCanvas:function(a,b,c){if(a){2===arguments.length&&"string"!=typeof b&&(c=b,b=void 0),b=b||this.opt.graphic||"","canvas"!==b||CanvasRenderingContext2D.prototype.fillText||(b="svg");var d=this;d.canvas=a,Candle.start(a.id,b,function(a){pzpr.util.unselectable(a.canvas),a.child.style.pointerEvents="none",a.use.sl&&d.setSLKeyEvents(a),a.use.canvas&&!d.subcanvas&&(d.subcanvas=d.addSubCanvas("canvas")),d.ready&&d.waitCanvasReady(c),d.opt.imagesave&&(d.imgcanvas[0]=d.subcanvas?d.subcanvas:d.addSubCanvas("canvas"),d.imgcanvas[1]=d.addSubCanvas("svg"))})}},addSubCanvas:function(a){if(!Candle.enable[a])return null;var b=null;return b=document.createElement("div"),b.id="_"+(new Date).getTime()+a,b.style.left="-10000px",b.style.top="0px",document.body.appendChild(b),Candle.start(b.id,a,function(a){a.canvas.style.position="absolute",a.use.svg&&(a.child.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.child.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"))}),b},setCanvasSize:function(a,b){this.painter?this.painter.resizeCanvas(a,b):(this.opt.width=a,this.opt.height=b)},setCanvasSizeByCellSize:function(a){this.painter?this.painter.resizeCanvasByCellSize(a):this.opt.cellsize=a},adjustCanvasSize:function(){this.getConfig("fixsize")?this.painter.resizeCanvas():this.painter.resizeCanvasByCellSize()},toDataURL:function(a,b){return a=a?a:"",a.match(/svg/)?"data:image/svg+xml;base64,"+window.btoa(this.getLocalCanvas(this.imgcanvas[1],b).innerHTML):this.getLocalCanvas(this.imgcanvas[0],b).toDataURL()},toBlob:function(a,b){if(a=a?a:"",a.match(/svg/))return new Blob([this.getLocalCanvas(this.imgcanvas[1],b).innerHTML],{type:"image/svg+xml"});try{return this.getLocalCanvas(this.imgcanvas[0],b).toBlob()}catch(c){}this.getLocalCanvas(this.imgcanvas[0],b).toDataURL().match(/data:(.*);base64,(.*)/);for(var d=window.atob(RegExp.$2),e=new Uint8Array(d.length),f=0,g=e.length;g>f;f++)e[f]=d.charCodeAt(f);return new Blob([e.buffer],{type:RegExp.$1})},getLocalCanvas:function(a,b){var c=new this.Graphic;return c.initCanvas(a),c.outputImage=!0,c.resizeCanvasByCellSize(b||this.painter.cw),c.unsuspend(),c.context.canvas},redraw:function(){this.ready&&this.painter.paintAll()},irowake:function(){this.board.irowakeRemake(),this.getConfig("irowake")&&this.redraw()},resetTime:function(){this.starttime=pzpr.util.currentTime()},getTime:function(){return pzpr.util.currentTime()-this.starttime},undo:function(){return this.opemgr.undo()},redo:function(){return this.opemgr.redo()},undoall:function(){for(;this.opemgr.undo(););},redoall:function(){for(;this.opemgr.redo(););},ismodified:function(){return this.opemgr.isModified()},check:function(a){return a&&(this.key.keyreset(),this.mouse.mousereset()),this.checker.check(!!a)},checkAndAlert:function(a){var b=this.check(!!a);return alert(this.getFailDescription(b)),b},getFailDescription:function(a){return this.faillist.getStr(a)},ansclear:function(){this.board.ansclear(),this.board.resetInfo(),this.redraw()},subclear:function(){this.board.subclear(),this.redraw()},modechange:function(b){this.editmode=b==a.MODE_EDITOR,this.playmode=b==a.MODE_PLAYER,this.execListener("modechange"),this.ready&&(this.key.keyreset(),this.board.errclear(),this.cursor.adjust_modechange(),this.board.haserror=!0,this.redraw())},getConfig:function(a){return this.config.get(a)},setConfig:function(a,b){return this.config.set(a,b)},saveConfig:function(){return this.config.getAll()},restoreConfig:function(a){this.config.setAll(a)}},pzpr.util.Config=function(a){this.owner=a,this.init()},pzpr.util.Config.prototype={list:{},get:function(a){return this.list[a]?this.list[a].val:null},set:function(a,b){this.configevent(a,b),this.owner.execListener("config",a,b)},getAll:function(){var a={};for(var b in this.list)a[b]=this.list[b].val;return JSON.stringify(a)},setAll:function(a){var b=JSON.parse(a);for(var c in this.list)void 0!==b[c]&&(this.list[c].val=b[c])},init:function(){this.add("language",pzpr.util.getUserLang(),["ja","en"]),this.add("font",1,[1,2]),this.add("cursor",!0),this.add("irowake",!1),this.add("irowakeblk",!1),this.add("dispmove",!0),this.add("disptype_pipelinkr",1,[1,2]),this.add("disptype_bosanowa",1,[1,2,3]),this.add("snakebd",!1),this.add("squarecell",!0),this.add("fixsize",!1),this.add("use",pzpr.env.API.touchevent?2:1,[1,2]),this.add("use_tri",1,[1,2,3]),this.add("lrcheck",!1),this.add("bgcolor",!1),this.add("enline",!0),this.add("lattice",!0),this.add("redline",!1),this.add("redblk",!1),this.add("redblkrb",!1),this.add("redroad",!1),this.add("autocmp",!1),this.add("autoerr",!1),this.add("enbnonum",!1),this.add("bdpadding",!0),this.add("discolor",!1)},add:function(a,b,c){this.list[a]=c?{val:b,option:c}:{val:b}},configevent:function(a,b){if(this.list[a]){this.list[a].val=b;var c=!0,d=this.owner;switch(a){case"irowake":case"cursor":case"autocmp":case"autoerr":case"snakebd":case"disptype_pipelinkr":case"dispmove":case"font":d.redraw();break;case"disptype_bosanowa":d.adjustCanvasSize();break;default:c=!1}return c}}},pzpr.createPuzzleClass("Flags",{use:!1,redline:!1,redblk:!1,redblkrb:!1,bgcolor:!1,irowake:!1,irowakeblk:!1,disable_subclear:!1})}(),pzpr.addConsts({CELL:"cell",CROSS:"cross",BORDER:"border",EXCELL:"excell",QUES:"ques",QNUM:"qnum",QNUM2:"qnum2",QCHAR:"qchar",QDIR:"qdir",QANS:"qans",ANUM:"anum",LINE:"line",QSUB:"qsub",QCMP:"qcmp",NDIR:0,UP:1,DN:2,LT:3,RT:4}),pzpr.createPuzzleClass("BoardPiece",{bx:-1,by:-1,group:"none",id:null,isnull:!0,iscell:!1,iscross:!1,isborder:!1,isexcell:!1,ques:0,qdir:0,qnum:-1,qnum2:-1,qchar:0,qans:0,anum:-1,line:0,qsub:0,qcmp:0,color:"",error:0,qinfo:0,propques:["ques","qdir","qnum","qnum2","qchar"],propans:["qans","anum","line","color"],propsub:["qsub","qcmp"],propinfo:["error","qinfo"],propnorec:{color:1,error:1,qinfo:1},maxnum:255,minnum:1,getaddr:function(){return new this.owner.Address(this.bx,this.by)},relcell:function(a,b){return this.owner.board.getc(this.bx+a,this.by+b)},relcross:function(a,b){return this.owner.board.getx(this.bx+a,this.by+b)},relbd:function(a,b){return this.owner.board.getb(this.bx+a,this.by+b)},relexcell:function(a,b){return this.owner.board.getex(this.bx+a,this.by+b)},ub:function(){return this.owner.board.getb(this.bx,this.by-1)},db:function(){return this.owner.board.getb(this.bx,this.by+1)},lb:function(){return this.owner.board.getb(this.bx-1,this.by)},rb:function(){return this.owner.board.getb(this.bx+1,this.by)},getQues:function(){return this.ques},setQues:function(a){this.setdata(d.QUES,a)},getQans:function(){return this.qans},setQans:function(a){this.setdata(d.QANS,a)},getQdir:function(){return this.qdir},setQdir:function(a){this.setdata(d.QDIR,a)},getQnum:function(){return this.qnum},setQnum:function(a){this.setdata(d.QNUM,a)},getQnum2:function(){return this.qnum2},setQnum2:function(a){this.setdata(d.QNUM2,a)},getQchar:function(){return this.qchar},setQchar:function(a){this.setdata(d.QCHAR,a)},getAnum:function(){return this.anum},setAnum:function(a){this.setdata(d.ANUM,a)},getLineVal:function(){return this.line},setLineVal:function(a){this.setdata(d.LINE,a)},getQsub:function(){return this.qsub},setQsub:function(a){this.setdata(d.QSUB,a)},getQcmp:function(){return this.qcmp},setQcmp:function(a){this.setdata(d.QCMP,a)},setdata:function(a,b){this.prehook[a]&&this.prehook[a].call(this,b)||(this.owner.opemgr.addOpe_Object(this,a,this[a],b),this[a]=b,this.posthook[a]&&this.posthook[a].call(this,b))},nummaxfunc:function(){return this.maxnum},numminfunc:function(){return this.minnum},prehook:{},posthook:{},draw:function(){this.getaddr().draw()},seterr:function(a){this.owner.board.isenableSetError()&&(this.error=a)},setinfo:function(a){this.qinfo=a}}),pzpr.createPuzzleClass("Cell:BoardPiece",{group:"cell",iscell:!0,base:null,disInputHatena:!1,numberWithMB:!1,numberAsObject:!1,numberIsWhite:!1,up:function(){return this.owner.board.getc(this.bx,this.by-2)},dn:function(){return this.owner.board.getc(this.bx,this.by+2)},lt:function(){return this.owner.board.getc(this.bx-2,this.by)},rt:function(){return this.owner.board.getc(this.bx+2,this.by)},prehook:{ques:function(a){return this.owner.Border.prototype.enableLineCombined&&this.setCombinedLine(a),!1},qnum:function(a){return this.minnum>0&&0===a},qnum2:function(a){return this.minnum>0&&0===a},anum:function(a){return this.minnum>0&&0===a}},posthook:{ques:function(){this.owner.board.setInfoByCell(this)},qnum:function(){this.owner.board.setInfoByCell(this)},qnum2:function(){this.owner.board.setInfoByCell(this)},anum:function(){this.owner.board.setInfoByCell(this)},qans:function(){this.owner.board.setInfoByCell(this)},qsub:function(){this.numberWithMB&&this.owner.board.setInfoByCell(this)}},lcnt:function(){return this.owner.board.lines.lcnt[this.id]?this.owner.board.lines.lcnt[this.id]:0},iscrossing:function(){return this.owner.board.lines.isLineCross},drawaround:function(){this.getaddr().drawaround()},isBlack:function(){return 1===this.qans},isWhite:function(){return 1!==this.qans},setBlack:function(){this.setQans(1)},setWhite:function(){this.setQans(0)},getNum:function(){return-1!==this.qnum?this.qnum:this.anum},setNum:function(a){if(!(this.minnum>0&&0===a))if(this.owner.editmode)a=!this.numberAsObject&&-2!==a||this.qnum!==a?a:-1,this.setQnum(a),this.setAnum(-1),this.numberIsWhite&&this.setQans(0),"white"===this.owner.painter.bcolor&&this.setQsub(0);else if(-1===this.qnum){var b=a>-1&&(!this.numberAsObject||this.anum!==a)?a:-1,c=-1>a&&(!this.numberAsObject||this.qsub!==-a-1)?-a-1:0;this.setAnum(b),this.setQsub(c),this.setQdir(0)}},isNum:function(){return!this.isnull&&(-1!==this.qnum||-1!==this.anum)},noNum:function(){return!this.isnull&&-1===this.qnum&&-1===this.anum},isValidNum:function(){return!this.isnull&&(this.qnum>=0||this.anum>=0&&-1===this.qnum)},isNumberObj:function(){return-1!==this.qnum||-1!==this.anum||this.numberWithMB&&1===this.qsub},sameNumber:function(a){return this.isValidNum()&&this.getNum()===a.getNum()},is51cell:function(){return 51===this.ques},set51cell:function(){this.setQues(51),this.setQnum(0),this.setQnum2(0),this.setAnum(-1)},remove51cell:function(){this.setQues(0),this.setQnum(0),this.setQnum2(0),this.setAnum(-1)},ice:function(){return 6===this.ques},isEmpty:function(){return this.isnull||7===this.ques},isValid:function(){return!this.isnull&&7!==this.ques},isDeparture:function(){return!this.isnull&&this.base.isnull&&this.isNum()},isDestination:function(){return!this.isnull&&!this.base.isnull},isLineStraight:function(){return this.ub().isLine()&&this.db().isLine()?!0:this.lb().isLine()&&this.rb().isLine()?!0:!1},setCombinedLine:function(){if(this.owner.Border.prototype.enableLineCombined)for(var a=this.bx,b=this.by,c=this.owner.board.borderinside(a-1,b-1,a+1,b+1),d=0;d<c.length;d++){var e=c[d];0===e.line&&e.isLineEX()&&e.setLineVal(1)}},isLPobj:{1:{11:1,12:1,14:1,15:1},2:{11:1,12:1,16:1,17:1},3:{11:1,13:1,15:1,16:1},4:{11:1,13:1,14:1,17:1}},noLPobj:{1:{1:1,4:1,5:1,13:1,16:1,17:1,21:1},2:{1:1,2:1,3:1,13:1,14:1,15:1,21:1},3:{1:1,2:1,5:1,12:1,14:1,17:1,22:1},4:{1:1,3:1,4:1,12:1,15:1,16:1,22:1}},isLP:function(a){return!!this.isLPobj[a][this.ques]},noLP:function(a){return!!this.noLPobj[a][this.ques]},countDir4Cell:function(a){var b,c=0;return b=this.up(),!b.isnull&&a(b)&&c++,b=this.dn(),!b.isnull&&a(b)&&c++,b=this.lt(),!b.isnull&&a(b)&&c++,b=this.rt(),!b.isnull&&a(b)&&c++,c},getdir4clist:function(){var a,b=[];return a=this.up(),a.isnull||b.push([a,d.UP]),a=this.dn(),a.isnull||b.push([a,d.DN]),a=this.lt(),a.isnull||b.push([a,d.LT]),a=this.rt(),a.isnull||b.push([a,d.RT]),b},getdir4cblist:function(){var a,b,c=[];return a=this.up(),b=this.ub(),a.isnull&&b.isnull||c.push([a,b,d.UP]),a=this.dn(),b=this.db(),a.isnull&&b.isnull||c.push([a,b,d.DN]),a=this.lt(),b=this.lb(),a.isnull&&b.isnull||c.push([a,b,d.LT]),a=this.rt(),b=this.rb(),a.isnull&&b.isnull||c.push([a,b,d.RT]),c},setCellLineError:function(a){var b=this.bx,c=this.by;a&&this.seterr(1),this.owner.board.borderinside(b-1,c-1,b+1,c+1).seterr(1)}}),pzpr.createPuzzleClass("Cross:BoardPiece",{group:"cross",iscross:!0,lcnt:function(){return this.owner.board.lines.lcnt[this.id]?this.owner.board.lines.lcnt[this.id]:0},iscrossing:function(){return this.owner.board.lines.isLineCross},setCrossBorderError:function(){this.seterr(1),this.owner.board.borderinside(this.bx-1,this.by-1,this.bx+1,this.by+1).seterr(1)}}),pzpr.createPuzzleClass("Border:BoardPiece",{initialize:function(){this.sidecell=[null,null],this.sidecross=[null,null],this.lineedge=[]},group:"border",isborder:!0,isvert:!1,enableLineNG:!1,enableLineCombined:!1,prehook:{qans:function(){return 0!==this.ques},line:function(a){return this.checkStableLine(a)}},posthook:{ques:function(){this.owner.board.setInfoByBorder(this)},qans:function(){this.owner.board.setInfoByBorder(this)},line:function(){this.owner.board.setInfoByLine(this)}},draw:function(){this.owner.painter.paintRange(this.bx-2,this.by-2,this.bx+2,this.by+2)},isLine:function(){return this.line>0},setLine:function(){this.setLineVal(1),this.setQsub(0)},setPeke:function(){this.setLineVal(0),this.setQsub(2)},removeLine:function(){this.setLineVal(0),this.setQsub(0)},isBorder:function(){return this.ques>0||this.qans>0},setBorder:function(){this.owner.editmode?(this.setQues(1),this.setQans(0)):1!==this.ques&&this.setQans(1)},removeBorder:function(){this.owner.editmode?(this.setQues(0),this.setQans(0)):1!==this.ques&&this.setQans(0)},isVert:function(){return this.isvert},isHorz:function(){return!this.isvert},checkStableLine:function(a){return this.enableLineNG?this.enableLineCombined?0!==a&&this.isLineNG()||0===a&&this.isLineEX():0!==a&&this.isLineNG():!1},isLineEX:function(){var a=this.sidecell[0],b=this.sidecell[1];return this.isVert()?a.isLP(d.RT)&&b.isLP(d.LT):a.isLP(d.DN)&&b.isLP(d.UP)},isLineNG:function(){var a=this.sidecell[0],b=this.sidecell[1];return this.isVert()?a.noLP(d.RT)||b.noLP(d.LT):a.noLP(d.DN)||b.noLP(d.UP)}}),pzpr.createPuzzleClass("EXCell:BoardPiece",{group:"excell",isexcell:!0}),pzpr.createPuzzleClass("RawAddress",{initialize:function(a,b){arguments.length>=2&&this.init(a,b)},bx:null,by:null,reset:function(){this.bx=null,this.by=null},equals:function(a){return this.bx===a.bx&&this.by===a.by},clone:function(){return new this.constructor(this.bx,this.by)},set:function(a){return this.bx=a.bx,this.by=a.by,this},init:function(a,b){return this.bx=a,this.by=b,this},move:function(a,b){return this.bx+=a,this.by+=b,this},rel:function(a,b){return new this.constructor(this.bx+a,this.by+b)},movedir:function(a,b){switch(a){case d.UP:this.by-=b;break;case d.DN:this.by+=b;break;case d.LT:this.bx-=b;break;case d.RT:this.bx+=b}return this},draw:function(){this.owner.painter.paintRange(this.bx-1,this.by-1,this.bx+1,this.by+1)},drawaround:function(){this.owner.painter.paintRange(this.bx-3,this.by-3,this.bx+3,this.by+3)},isinside:function(){var a=this.owner.board;return this.bx>=a.minbx&&this.bx<=a.maxbx&&this.by>=a.minby&&this.by<=a.maxby}}),pzpr.createPuzzleClass("Address:RawAddress",{oncell:function(){return!!(1&this.bx&&1&this.by)},oncross:function(){return!(1&this.bx||1&this.by)},onborder:function(){return!!(this.bx+this.by&1)},getc:function(){return this.owner.board.getc(this.bx,this.by)},getx:function(){return this.owner.board.getx(this.bx,this.by)},getb:function(){return this.owner.board.getb(this.bx,this.by)},getex:function(){return this.owner.board.getex(this.bx,this.by)},setCrossBorderError:function(){var a=this.owner.board;0!==a.hascross&&this.getx().seterr(1),a.borderinside(this.bx-1,this.by-1,this.bx+1,this.by+1).seterr(1)}}),pzpr.createPuzzleClass("PieceList",{length:0,add:Array.prototype.push,extend:function(a){var b=this;a.each(function(a){b.add(a)})},unshift:Array.prototype.unshift,pop:Array.prototype.pop,reverse:Array.prototype.reverse,each:Array.prototype.forEach,some:Array.prototype.some,include:function(a){return this.some(function(b){return b===a})},filter:function(a){for(var b=new this.constructor,c=0;c<this.length;c++)a(this[c])&&b.add(this[c]);return b},notnull:function(){return this.filter(function(a){return!a.isnull})},map:function(a){for(var b=new this.constructor,c=0;c<this.length;c++)b.add(a(this[c]));return b},indexOf:Array.prototype.indexOf,remove:function(a){var b=this.indexOf(a);b>=0&&Array.prototype.splice.call(this,b,1)},seterr:function(a){if(this.owner.board.isenableSetError())for(var b=0;b<this.length;b++)this[b].error=a},setinfo:function(a){for(var b=0;b<this.length;b++)this[b].qinfo=a},allclear:function(a){this.propclear(this.getprop("all"),a)},ansclear:function(){this.propclear(this.getprop("ans"),!0)},subclear:function(){this.propclear(this.getprop("sub"),!0)},errclear:function(){this.propclear(this.getprop("err"),!1)},propclear:function(a,b){for(var c=this.length>0?this[0].propnorec:{},d=0;d<this.length;d++)for(var e=this[d],f=0;f<a.length;f++){var g=a[f],h=e.constructor.prototype[g];e[g]!==h&&(b&&!c[g]&&this.owner.opemgr.addOpe_Object(e,g,e[g],h),e[g]=h)}},getprop:function(a){var b=[];if(this.length>0){var c={all:3,ans:2,sub:1,err:0}[a];c>=3&&(b=b.concat(this[0].propques)),c>=2&&(b=b.concat(this[0].propans)),c>=1&&(b=b.concat(this[0].propsub)),c>=0&&(b=b.concat(this[0].propinfo))}return b}}),pzpr.createPuzzleClass("CellList:PieceList",{getRectSize:function(){for(var a=this.owner.board,b={x1:a.maxbx+1,x2:a.minbx-1,y1:a.maxby+1,y2:a.minby-1,cols:0,rows:0,cnt:0},c=0;c<this.length;c++){var d=this[c];b.x1>d.bx&&(b.x1=d.bx),b.x2<d.bx&&(b.x2=d.bx),b.y1>d.by&&(b.y1=d.by),b.y2<d.by&&(b.y2=d.by),b.cnt++}return b.cols=(b.x2-b.x1+2)/2,b.rows=(b.y2-b.y1+2)/2,b},getQnumCell:function(){for(var a=0,b=this.length;b>a;a++)if(this[a].isNum())return this[a];return this.owner.board.emptycell},draw:function(){var a=this.getRectSize();this.owner.painter.paintRange(a.x1-1,a.y1-1,a.x2+1,a.y2+1)}}),pzpr.createPuzzleClass("CrossList:PieceList",{}),pzpr.createPuzzleClass("BorderList:PieceList",{cellinside:function(){for(var a=new this.owner.CellList,b=[],c=0;c<this.length;c++){var d=this[c],e=d.sidecell[0],f=d.sidecell[1];e.isnull||b[e.id]===!0||(a.add(e),b[e.id]=!0),f.isnull||b[f.id]===!0||(a.add(f),b[f.id]=!0)}return a},crossinside:function(){for(var a=new this.owner.CrossList,b=[],c=0;c<this.length;c++){var d=this[c],e=d.sidecross[0],f=d.sidecross[1];e.isnull||b[e.id]===!0||(a.add(e),b[e.id]=!0),f.isnull||b[f.id]===!0||(a.add(f),b[f.id]=!0)}return a}}),pzpr.createPuzzleClass("EXCellList:PieceList",{}),pzpr.createPuzzleClass("Board",{initialize:function(){var a=this.owner;this.minbx=0,this.minby=0,this.maxbx=0,this.maxby=0,this.diserror=0,this.haserror=!1,this.cell=new a.CellList,this.cross=new a.CrossList,this.border=new a.BorderList,this.excell=new a.EXCellList,this.cellmax=0,this.crossmax=0,this.bdmax=0,this.excellmax=0,this.bdinside=0,this.nullobj=new a.BoardPiece,this.emptycell=new a.Cell,this.emptycross=new a.Cross,this.emptyborder=new a.Border,this.emptyexcell=new a.EXCell,this.disrecinfo=0,this.validinfo={cell:[],border:[],line:[],all:[]},this.infolist=[],this.lines=this.addInfoList(a.LineManager),this.rooms=this.addInfoList(a.AreaRoomManager),this.linfo=this.addInfoList(a.AreaLineManager),this.bcell=this.addInfoList(a.AreaBlackManager),this.wcell=this.addInfoList(a.AreaWhiteManager),this.ncell=this.addInfoList(a.AreaNumberManager),this.exec=new a.BoardExec,this.exec.insex.cross=1===this.hascross?{2:!0}:{0:!0}},addInfoList:function(a){var b=new a;return this.infolist.push(b),b},initInfoList:function(){for(var a=0;a<this.infolist.length;a++)this.infolist[a].init()},infolist:[],qcols:10,qrows:10,hascross:0,hasborder:0,hasexcell:0,initBoardSize:function(a,b){(void 0===a||isNaN(a))&&(a=this.qcols,b=this.qrows),this.allclear(!1),this.initGroup(d.CELL,a,b),this.hascross&&this.initGroup(d.CROSS,a,b),this.hasborder&&this.initGroup(d.BORDER,a,b),this.hasexcell&&this.initGroup(d.EXCELL,a,b),this.qcols=a,this.qrows=b,this.setminmax(),this.setposAll(),this.initInfoList(),this.resetInfo(),this.owner.cursor.initCursor(),this.owner.opemgr.allerase()},initGroup:function(a,b,c){var d=this.getGroup(a),e=this.estimateSize(a,b,c),f=d.length;if(f>e)for(var g=f-1;g>=e;g--)d.pop();else if(e>f){for(var h=new d.constructor,g=f;e>g;g++){var i=this.newObject(a,g);d.add(i),h.add(i)}h.allclear(!1)}return d.length=e,this.setposGroup(a),e-f},getGroup:function(a){return a===d.CELL?this.cell:a===d.CROSS?this.cross:a===d.BORDER?this.border:a===d.EXCELL?this.excell:new this.owner.PieceList
},estimateSize:function(a,b,c){if(a===d.CELL)return b*c;if(a===d.CROSS)return(b+1)*(c+1);if(a===d.BORDER){if(1===this.hasborder)return 2*b*c-(b+c);if(2===this.hasborder)return 2*b*c+(b+c)}else if(a===d.EXCELL){if(1===this.hasexcell)return b+c+1;if(2===this.hasexcell)return 2*b+2*c+4}return 0},newObject:function(a,b){var c=this.nullobj,e=this.owner;return a===d.CELL?c=new e.Cell:a===d.CROSS?c=new e.Cross:a===d.BORDER?c=new e.Border:a===d.EXCELL&&(c=new e.EXCell),c!==this.nullobj&&void 0!==b&&(c.id=b),c},setposAll:function(){this.setposCells(),this.setposCrosses(),this.setposBorders(),this.setposEXcells(),this.latticemax=(this.qcols+1)*(this.qrows+1)},setposGroup:function(a){a===d.CELL?this.setposCells():a===d.CROSS?this.setposCrosses():a===d.BORDER?this.setposBorders():a===d.EXCELL&&this.setposEXcells()},setposCells:function(){var a=this.qcols;this.cellmax=this.cell.length;for(var b=0;b<this.cellmax;b++){var c=this.cell[b];c.id=b,c.isnull=!1,c.bx=b%a*2+1,c.by=(b/a<<1)+1}},setposCrosses:function(){var a=this.qcols;this.crossmax=this.cross.length;for(var b=0;b<this.crossmax;b++){var c=this.cross[b];c.id=b,c.isnull=!1,c.bx=b%(a+1)*2,c.by=b/(a+1)<<1}},setposBorders:function(){var a=this.qcols,b=this.qrows;this.bdmax=this.border.length,this.bdinside=this.bdmax-(2===this.hasborder?2*(a+b):0);for(var c=0;c<this.bdmax;c++){var d=this.border[c],e=c;d.id=c,d.isnull=!1,e>=0&&(a-1)*b>e&&(d.bx=e%(a-1)*2+2,d.by=(e/(a-1)<<1)+1),e-=(a-1)*b,e>=0&&a*(b-1)>e&&(d.bx=e%a*2+1,d.by=(e/a<<1)+2),e-=a*(b-1),2===this.hasborder&&(e>=0&&a>e&&(d.bx=2*e+1,d.by=0),e-=a,e>=0&&a>e&&(d.bx=2*e+1,d.by=2*b),e-=a,e>=0&&b>e&&(d.bx=0,d.by=2*e+1),e-=b,e>=0&&b>e&&(d.bx=2*a,d.by=2*e+1),e-=b),d.isvert=!(1&d.bx),d.isvert?(d.sidecell[0]=d.relcell(-1,0),d.sidecell[1]=d.relcell(1,0),d.sidecross[0]=d.relcross(0,-1),d.sidecross[1]=d.relcross(0,1)):(d.sidecell[0]=d.relcell(0,-1),d.sidecell[1]=d.relcell(0,1),d.sidecross[0]=d.relcross(-1,0),d.sidecross[1]=d.relcross(1,0)),d.lineedge=this.lines.borderAsLine?d.sidecross:d.sidecell}},setposEXcells:function(){var a=this.qcols,b=this.qrows;this.excellmax=this.excell.length;for(var c=0;c<this.excellmax;c++){var d=this.excell[c],e=c;d.id=c,d.isnull=!1,1===this.hasexcell?(e>=0&&a>e&&(d.bx=2*e+1,d.by=-1),e-=a,e>=0&&b>e&&(d.bx=-1,d.by=2*e+1),e-=b,0===e&&(d.bx=-1,d.by=-1),e--):2===this.hasexcell&&(e>=0&&a>e&&(d.bx=2*e+1,d.by=-1),e-=a,e>=0&&a>e&&(d.bx=2*e+1,d.by=2*b+1),e-=a,e>=0&&b>e&&(d.bx=-1,d.by=2*e+1),e-=b,e>=0&&b>e&&(d.bx=2*a+1,d.by=2*e+1),e-=b,0===e&&(d.bx=-1,d.by=-1),e--,0===e&&(d.bx=2*a+1,d.by=-1),e--,0===e&&(d.bx=-1,d.by=2*b+1),e--,0===e&&(d.bx=2*a+1,d.by=2*b+1),e--)}},setminmax:function(){var a=this.hasexcell>0,b=2===this.hasexcell;this.minbx=a?-2:0,this.minby=a?-2:0,this.maxbx=b?2*this.qcols+2:2*this.qcols,this.maxby=b?2*this.qrows+2:2*this.qrows,this.owner.cursor.setminmax()},allclear:function(a){this.cell.allclear(a),this.cross.allclear(a),this.border.allclear(a),this.excell.allclear(a)},ansclear:function(){this.owner.opemgr.newOperation(),this.cell.ansclear(),this.cross.ansclear(),this.border.ansclear(),this.excell.ansclear()},subclear:function(){this.owner.opemgr.newOperation(),this.cell.subclear(),this.cross.subclear(),this.border.subclear(),this.excell.subclear()},errclear:function(){this.cell.errclear(),this.cross.errclear(),this.border.errclear(),this.excell.errclear(),this.haserror=!1},getObjectPos:function(a,b,c,e,f){return a===d.CELL?this.getc(b,c,e,f):a===d.CROSS?this.getx(b,c,e,f):a===d.BORDER?this.getb(b,c,e,f):a===d.EXCELL?this.getex(b,c,e,f):this.nullobj},getc:function(a,b,c,d){var e=null;return void 0===c&&(c=this.qcols,d=this.qrows),!(0>a||a>c<<1||0>b||b>d<<1)&&1&a&&1&b&&(e=(a>>1)+(b>>1)*c),null!==e?this.cell[e]:this.emptycell},getx:function(a,b,c,e){var f=null,g=this.emptycross;return void 0===c&&(c=this.qcols,e=this.qrows),0>a||a>c<<1||0>b||b>e<<1||1&a||1&b||(f=(a>>1)+(b>>1)*(c+1)),0!==this.hascross&&null!==f?g=this.cross[f]:0===this.hascross&&(g=this.newObject(d.CROSS,f),g.isnull=!1,g.bx=a,g.by=b),g},getb:function(a,b,c,d){var e=null;return void 0===c&&(c=this.qcols,d=this.qrows),a>=1&&2*c-1>=a&&b>=1&&2*d-1>=b?!(1&a)&&1&b?e=(a>>1)-1+(b>>1)*(c-1):1&a&&!(1&b)&&(e=(a>>1)+((b>>1)-1)*c+(c-1)*d):2===this.hasborder&&(0===b&&1&a&&a>=1&&2*c-1>=a?e=(c-1)*d+c*(d-1)+(a>>1):b===2*d&&1&a&&a>=1&&2*c-1>=a?e=(c-1)*d+c*(d-1)+c+(a>>1):0===a&&1&b&&b>=1&&2*d-1>=b?e=(c-1)*d+c*(d-1)+2*c+(b>>1):a===2*c&&1&b&&b>=1&&2*d-1>=b&&(e=(c-1)*d+c*(d-1)+2*c+d+(b>>1))),null!==e?this.border[e]:this.emptyborder},getex:function(a,b,c,d){var e=null;return void 0===c&&(c=this.qcols,d=this.qrows),1===this.hasexcell?-1===a&&-1===b?e=c+d:-1===b&&a>0&&2*c>a?e=a>>1:-1===a&&b>0&&2*d>b&&(e=c+(b>>1)):2===this.hasexcell&&(-1===b&&a>0&&2*c>a?e=a>>1:b===2*d+1&&a>0&&2*c>a?e=c+(a>>1):-1===a&&b>0&&2*d>b?e=2*c+(b>>1):a===2*c+1&&b>0&&2*d>b?e=2*c+d+(b>>1):-1===a&&-1===b?e=2*c+2*d:a===2*c+1&&-1===b?e=2*c+2*d+1:-1===a&&b===2*d+1?e=2*c+2*d+2:a===2*c+1&&b===2*d+1&&(e=2*c+2*d+3)),null!==e?this.excell[e]:this.emptyexcell},getobj:function(a,b,c,d){if(a+b&1)return this.getb(a,b,c,d);if(!(1&a||1&b))return this.getx(a,b,c,d);var e=this.getc(a,b,c,d);return e.isnull?this.getex(a,b,c,d):e},objectinside:function(a,b,c,e,f){return a===d.CELL?this.cellinside(b,c,e,f):a===d.CROSS?this.crossinside(b,c,e,f):a===d.BORDER?this.borderinside(b,c,e,f):a===d.EXCELL?this.excellinside(b,c,e,f):new this.owner.PieceList},cellinside:function(a,b,c,d){for(var e=new this.owner.CellList,f=1|b;d>=f;f+=2)for(var g=1|a;c>=g;g+=2){var h=this.getc(g,f);h.isnull||e.add(h)}return e},crossinside:function(a,b,c,d){var e=new this.owner.CrossList;if(this.hascross)for(var f=b+(1&b);d>=f;f+=2)for(var g=a+(1&a);c>=g;g+=2){var h=this.getx(g,f);h.isnull||e.add(h)}return e},borderinside:function(a,b,c,d){var e=new this.owner.BorderList;if(this.hasborder)for(var f=b;d>=f;f++)for(var g=a+(a+f&1^1);c>=g;g+=2){var h=this.getb(g,f);h.isnull||e.add(h)}return e},excellinside:function(a,b,c,d){var e=new this.owner.EXCellList;if(this.hasexcell)for(var f=1|b;d>=f;f+=2)for(var g=1|a;c>=g;g+=2){var h=this.getex(g,f);h.isnull||e.add(h)}return e},disableInfo:function(){this.owner.opemgr.disableRecord(),this.disrecinfo++},enableInfo:function(){this.owner.opemgr.enableRecord(),this.disrecinfo>0&&this.disrecinfo--},isenableInfo:function(){return 0===this.disrecinfo},resetInfo:function(){for(var a=0,b=this.validinfo.all.length;b>a;a++)this.validinfo.all[a].reset()},setInfoByCell:function(a){if(this.isenableInfo())for(var b=0,c=this.validinfo.cell.length;c>b;b++)this.validinfo.cell[b].setCell(a)},setInfoByBorder:function(a){if(this.isenableInfo())for(var b=0,c=this.validinfo.border.length;c>b;b++)this.validinfo.border[b].setBorder(a)},setInfoByLine:function(a){if(this.isenableInfo())for(var b=0,c=this.validinfo.line.length;c>b;b++)this.validinfo.line[b].setLine(a)},irowakeRemake:function(){this.lines.newIrowake()},getLineInfo:function(){return this.lines.getLineInfo()},getRoomInfo:function(){return this.rooms.getAreaInfo()},getLareaInfo:function(){return this.linfo.getAreaInfo()},getBCellInfo:function(){return this.bcell.getAreaInfo()},getWCellInfo:function(){return this.wcell.getAreaInfo()},getNumberInfo:function(){return this.ncell.getAreaInfo()},disableSetError:function(){this.diserror++},enableSetError:function(){this.diserror--},isenableSetError:function(){return this.diserror<=0}}),pzpr.addConsts({EXPAND:16,REDUCE:32,TURN:64,FLIP:128,TURNFLIP:192,EXPANDUP:17,EXPANDDN:18,EXPANDLT:19,EXPANDRT:20,REDUCEUP:33,REDUCEDN:34,REDUCELT:35,REDUCERT:36,TURNL:65,TURNR:66,FLIPX:129,FLIPY:130}),pzpr.createPuzzleClass("BoardExec",{boardtype:{expandup:[d.REDUCEUP,d.EXPANDUP],expanddn:[d.REDUCEDN,d.EXPANDDN],expandlt:[d.REDUCELT,d.EXPANDLT],expandrt:[d.REDUCERT,d.EXPANDRT],reduceup:[d.EXPANDUP,d.REDUCEUP],reducedn:[d.EXPANDDN,d.REDUCEDN],reducelt:[d.EXPANDLT,d.REDUCELT],reducert:[d.EXPANDRT,d.REDUCERT],turnl:[d.TURNR,d.TURNL],turnr:[d.TURNL,d.TURNR],flipy:[d.FLIPY,d.FLIPY],flipx:[d.FLIPX,d.FLIPX]},qnumw:[],qnumh:[],insex:{cell:{1:!0},cross:{},border:{1:!0,2:!0},excell:{1:!0}},execadjust:function(a){var b=this.owner,c=b.board;if(0===a.indexOf("reduce"))if("reduceup"===a||"reducedn"===a){if(c.qrows<=1)return}else if(("reducelt"===a||"reducert"===a)&&c.qcols<=1)return;b.opemgr.newOperation(),b.painter.suspendAll();var e={x1:0,y1:0,x2:2*c.qcols,y2:2*c.qrows},f=this.boardtype[a][1];f&d.TURNFLIP?(this.turnflip(f,e),b.opemgr.addOpe_BoardFlip(e,a)):(this.expandreduce(f,e),b.opemgr.addOpe_BoardAdjust(a)),c.setminmax(),c.resetInfo(),b.adjustCanvasSize(),b.painter.unsuspend()},expandreduce:function(a,b){var c=this.owner.board;c.disableInfo(),this.adjustBoardData(a,b),c.rooms.hastop&&a&d.REDUCE&&this.reduceRoomNumber(a,b),a&d.EXPAND?(a===d.EXPANDUP||a===d.EXPANDDN?c.qrows++:(a===d.EXPANDLT||a===d.EXPANDRT)&&c.qcols++,this.expandGroup(d.CELL,a),c.hascross&&this.expandGroup(d.CROSS,a),c.hasborder&&this.expandGroup(d.BORDER,a),c.hasexcell&&this.expandGroup(d.EXCELL,a)):a&d.REDUCE&&(this.reduceGroup(d.CELL,a),c.hascross&&this.reduceGroup(d.CROSS,a),c.hasborder&&this.reduceGroup(d.BORDER,a),c.hasexcell&&this.reduceGroup(d.EXCELL,a),a===d.REDUCEUP||a===d.REDUCEDN?c.qrows--:(a===d.REDUCELT||a===d.REDUCERT)&&c.qcols--),c.setposAll(),this.adjustBoardData2(a,b),c.enableInfo()},expandGroup:function(a,b){for(var c=this.owner.board,e=c.initGroup(a,c.qcols,c.qrows),f=c.getGroup(a),g=new f.constructor,h=f.length-1;h>=0;h--){var i=f[h];this.isdel(b,i)?(i=c.newObject(a,h),f[h]=i,g.add(i),e--):e>0&&(f[h]=f[h-e])}g.allclear(!1),a===d.BORDER&&this.expandborder(b)},reduceGroup:function(a,b){var c=this.owner.board;a===d.BORDER&&this.reduceborder(b);var e=this.owner.opemgr,f=0,g=c.getGroup(a),h=!e.undoExec&&!e.redoExec,i=new g.constructor;h&&(e.forceRecord=!0);for(var j=0;j<g.length;j++){var k=g[j];this.isdel(b,k)?(k.id=j,i.add(k),f++):f>0&&(g[j-f]=g[j])}i.allclear(h);for(var j=0;f>j;j++)g.pop();h&&(e.forceRecord=!1)},isdel:function(a,b){return!!this.insex[b.group][this.distObj(a,b)]},turnflip:function(a,b){var c=this.owner.board;if(c.disableInfo(),this.adjustBoardData(a,b),a&d.TURN){var e=c.qcols;c.qcols=c.qrows,c.qrows=e,c.setposAll(),b={x1:0,y1:0,x2:2*c.qcols,y2:2*c.qrows}}if(this.turnflipGroup(d.CELL,a,b),c.hascross&&this.turnflipGroup(d.CROSS,a,b),c.hasborder&&this.turnflipGroup(d.BORDER,a,b),2===c.hasexcell)this.turnflipGroup(d.EXCELL,a,b);else if(1===c.hasexcell&&a&d.FLIP){var f={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};a===d.FLIPY?f.x1=f.x2=-1:a===d.FLIPX&&(f.y1=f.y2=-1),this.turnflipGroup(d.EXCELL,a,f)}c.setposAll(),this.adjustBoardData2(a,b),c.enableInfo()},turnflipGroup:function(a,b,c){for(var e=this.owner.board,f=[],g=e.objectinside(a,c.x1,c.y1,c.x2,c.y2),h=0;h<g.length;h++)f[g[h].id]=!1;for(var i=e.getGroup(a),j=c.x1+c.x2,k=c.y1+c.y2,l=0;l<i.length;l++)if(f[l]===!1)for(var m,n=i[l],o=l;f[o]===!1;){switch(f[o]=!0,b){case d.FLIPY:m=e.getObjectPos(a,i[o].bx,k-i[o].by).id;break;case d.FLIPX:m=e.getObjectPos(a,j-i[o].bx,i[o].by).id;break;case d.TURNR:m=e.getObjectPos(a,i[o].by,j-i[o].bx,e.qrows,e.qcols).id;break;case d.TURNL:m=e.getObjectPos(a,k-i[o].by,i[o].bx,e.qrows,e.qcols).id}if(f[m]!==!1){i[o]=n;break}i[o]=i[m],o=m}},distObj:function(a,b){var c=this.owner.board;return b.isnull?-1:(a&=15,a===d.UP?b.by:a===d.DN?2*c.qrows-b.by:a===d.LT?b.bx:a===d.RT?2*c.qcols-b.bx:-1)},expandborder:function(a){var b=this.owner.board;if(b.lines.borderAsLine||!b.owner.opemgr.undoExec){var c=new this.owner.BorderList;b.setposBorders();for(var d=b.lines.borderAsLine?2:1,e=0;e<b.bdmax;e++){var f=b.border[e];if(this.distObj(a,f)===d){var g=b.lines.borderAsLine?this.outerBorder(e,a):this.innerBorder(e,a);this.copyBorder(f,g),c.add(g)}}b.lines.borderAsLine&&c.allclear(!1)}},reduceborder:function(a){var b=this.owner.board;if(b.lines.borderAsLine)for(var c=0;c<b.bdmax;c++){var d=b.border[c];if(0===this.distObj(a,d)){var e=this.innerBorder(c,a);this.copyBorder(d,e)}}},copyBorder:function(a,b){a.ques=b.ques,a.qans=b.qans,this.owner.board.lines.borderAsLine&&(a.line=b.line,a.qsub=b.qsub,a.color=b.color)},innerBorder:function(a,b){var c=this.owner.board.border[a];return b&=15,b===d.UP?c.relbd(0,2):b===d.DN?c.relbd(0,-2):b===d.LT?c.relbd(2,0):b===d.RT?c.relbd(-2,0):null},outerBorder:function(a,b){var c=this.owner.board.border[a];return b&=15,b===d.UP?c.relbd(0,-2):b===d.DN?c.relbd(0,2):b===d.LT?c.relbd(-2,0):b===d.RT?c.relbd(2,0):null},reduceRoomNumber:function(a){for(var b=[],c=this.owner.board,e=0;e<c.cell.length;e++){var f=c.cell[e];this.insex[d.CELL][this.distObj(a,f)]&&(-1!==f.qnum&&(b.push({cell:f,areaid:c.rooms.getRoomID(f),pos:[f.bx,f.by],val:f.qnum}),f.qnum=-1),c.rooms.removeCell(f))}for(var g=0;g<b.length;g++){var h=b[g].areaid,i=c.rooms.calcTopOfRoom(h);if(null===i){var j=this.owner.opemgr;j.undoExec||j.redoExec||(j.forceRecord=!0,j.addOpe_Object(b[g].cell,d.QNUM,b[g].val,-1),j.forceRecord=!1)}else c.cell[i].qnum=b[g].val}},adjustBoardData:function(){},adjustBoardData2:function(){}}),pzpr.createPuzzleClass("LineManager",{initialize:function(){this.lcnt=[],this.ltotal=[],this.blist=[],this.id=[],this.max=0,this.invalidid=[],this.enabled=this.isCenterLine||this.borderAsLine},init:function(){this.enabled&&(this.owner.board.validinfo.line.push(this),this.owner.board.validinfo.all.push(this))},isCenterLine:!1,borderAsLine:!1,isLineCross:!1,typeA:"A",typeB:"B",typeC:"C",reset:function(){var a=this.owner.board;if(this.isCenterLine){for(var b=0;b<a.cellmax;b++)this.lcnt[b]=0;this.ltotal=[a.qcols*a.qrows,0,0,0,0]}else{for(var b=0,c=(a.qcols+1)*(a.qrows+1);c>b;b++)this.lcnt[b]=0;this.ltotal=[(a.qcols+1)*(a.qrows+1),0,0,0,0]}this.max=0;for(var d=0;d<a.bdmax;d++)this.id[d]=null;this.invalidid=[],this.rebuild()},rebuild:function(){if(this.enabled){for(var a=this.owner.board,b=new this.owner.BorderList,c=0;c<a.bdmax;c++){var d=a.border[c];if(d.isLine()){b.add(d);var e=d.lineedge[0].id,f=d.lineedge[1].id;null!==e&&(this.ltotal[this.lcnt[e]]--,this.lcnt[e]++,this.ltotal[this.lcnt[e]]++),null!==f&&(this.ltotal[this.lcnt[f]]--,this.lcnt[f]++,this.ltotal[this.lcnt[f]]++)}}this.searchLine(b),this.owner.flags.irowake&&this.newIrowake()}},newIrowake:function(){for(var a=1;a<=this.max;a++){var b=this.blist[a];if(b.length>0)for(var c=this.owner.painter.getNewLineColor(),d=0;d<b.length;d++)b[d].color=c}},gettype:function(a,b,c){var d=c?0:1;if(a.isnull)return this.typeA;if(a.iscrossing()){var e=a.lcnt();return e===1-d||e===3-d&&this.isTpos(a,b)?this.typeA:e===2-d||e===4-d?this.typeB:this.typeC}return a.lcnt()===1-d?this.typeA:this.typeB},isTpos:function(a,b){return!this.owner.board.getb(2*a.bx-b.bx,2*a.by-b.by).isLine()},setLine:function(a){if(this.enabled){var a=a,b=a.isLine();if(b!==(null!==this.id[a.id])){var c=a.lineedge[0],d=a.lineedge[1];b?(c.isnull||(this.ltotal[this.lcnt[c.id]]--,this.lcnt[c.id]++,this.ltotal[this.lcnt[c.id]]++),d.isnull||(this.ltotal[this.lcnt[d.id]]--,this.lcnt[d.id]++,this.ltotal[this.lcnt[d.id]]++)):(c.isnull||(this.ltotal[this.lcnt[c.id]]--,this.lcnt[c.id]--,this.ltotal[this.lcnt[c.id]]++),d.isnull||(this.ltotal[this.lcnt[d.id]]--,this.lcnt[d.id]--,this.ltotal[this.lcnt[d.id]]++));var e=this.gettype(c,a,b),f=this.gettype(d,a,b);b?e===this.typeA&&f===this.typeA?this.assignLineInfo(a,null):e===this.typeA&&f===this.typeB||e===this.typeB&&f===this.typeA?this.assignLineInfo(a,this.getbid(a)[0]):this.remakeLineInfo(a):(e===this.typeA&&f===this.typeA||e===this.typeA&&f===this.typeB||e===this.typeB&&f===this.typeA?this.removeLineInfo(a):this.remakeLineInfo(a),a.color="")}}},assignLineInfo:function(a,b){var c=this.id[a.id];(null===c||0===c)&&(null===b?(c=this.addPath(),a.color=this.owner.painter.getNewLineColor()):(c=this.id[b.id],a.color=b.color),this.blist[c].add(a),this.id[a.id]=c)},removeLineInfo:function(a){var b=this.id[a.id];null!==b&&0!==b&&(this.blist[b].remove(a),this.id[a.id]=null,0===this.blist[b].length&&this.removePath(b),a.color="")},remakeLineInfo:function(a){var b=this.getbid(a);b.add(a);for(var c=this.getLongColor(b),d=new this.owner.BorderList,e=0;e<b.length;e++){var f=b[e].id,g=this.id[f],h=this.owner.board;null!==g&&0!==g?d.extend(this.removePath(g)):null===g&&d.add(h.border[f])}var i=this.searchLine(d);this.setLongColor(i,c)},addPath:function(){var a;return this.invalidid.length>0?a=this.invalidid.shift():(this.max++,a=this.max),this.blist[a]=new this.owner.BorderList,a},removePath:function(a){for(var b=this.getBlist(a),c=0;c<b.length;c++)this.id[b[c].id]=null;return this.blist[a]=new this.owner.BorderList,this.invalidid.push(a),b},getLongColor:function(a){for(var b=null,c="",d=0,e=a.length;e>d;d++){var f=this.id[a[d].id];null===f||0>=f||(null===b||this.blist[b].length<this.blist[f].length)&&(b=f,c=a[d].color)}return c?c:this.owner.painter.getNewLineColor()},setLongColor:function(a,b){for(var c=this.owner,d=new c.BorderList,e=a[0],f=1;f<a.length;f++){var g=this.blist[a[f]];this.blist[e].length<g.length&&(e=a[f])}for(var f=0;f<a.length;f++){for(var h=a[f]===e?b:c.painter.getNewLineColor(),g=this.getBlist(a[f]),i=0,j=g.length;j>i;i++)g[i].color=h;d.extend(g)}c.getConfig("irowake")&&c.painter.repaintLines(d)},getbid:function(a){var b=this.isCenterLine^a.isVert()?2:0,c=2-b,d=a.lineedge[0],e=a.lineedge[1],f=a.isLine()?0:1,g=new this.owner.BorderList;if(!d.isnull){var h=d.iscrossing(),i=d.lcnt();h&&i>=4-f?g.add(a.relbd(-c,-b)):!(i>=2-f)||h&&i===3-f&&this.isTpos(d,a)||(g.add(a.relbd(-c,-b)),g.add(a.relbd(-1,-1)),g.add(a.relbd(b-1,c-1)))}if(!e.isnull){var h=e.iscrossing(),i=e.lcnt();h&&i>=4-f?g.add(a.relbd(c,b)):!(i>=2-f)||h&&i===3-f&&this.isTpos(e,a)||(g.add(a.relbd(c,b)),g.add(a.relbd(1,1)),g.add(a.relbd(-b+1,-c+1)))}return g.filter(function(a){return a.isLine()})},searchLine:function(a){for(var b=[],c=0,d=a.length;d>c;c++)this.id[a[c].id]=a[c].isLine()?0:null;for(var c=0,d=a.length;d>c;c++){var e=a[c];if(0===this.id[e.id]){var f=this.addPath();this.searchSingle(e,f),b.push(f)}}return b},searchSingle:function(a,b){for(var c=a.bx,d=a.by,e=new this.owner.Address(null,null),f=!this.isCenterLine^a.isHorz()?[[c,d+1,1],[c,d,2]]:[[c+1,d,3],[c,d,4]];f.length>0;){var g=f.pop(),h=g[2];for(e.init(g[0],g[1]);;)if(e.movedir(h,1),e.onborder()){var a=e.getb();if(0!==this.id[a.id])break;this.id[a.id]=b,this.blist[b].add(a)}else{var c=e.bx,d=e.by,i=this.isCenterLine?e.getc():e.getx();if(i.isnull)break;if(i.lcnt()>=3){if(!i.iscrossing()){i.ub().isLine()&&f.push([c,d,1]),i.db().isLine()&&f.push([c,d,2]),i.lb().isLine()&&f.push([c,d,3]),i.rb().isLine()&&f.push([c,d,4]);break}}else 1!==h&&i.db().isLine()?h=2:2!==h&&i.ub().isLine()?h=1:3!==h&&i.rb().isLine()?h=4:4!==h&&i.lb().isLine()&&(h=3)}}},getLineInfo:function(){for(var a=this.owner.board,b=new this.owner.LineInfo,c=0;c<a.bdmax;c++)b.id[c]=a.border[c].isLine()?0:null;for(var c=0;c<a.bdmax;c++){var d=a.border[c];if(b.emptyBorder(d)){b.addRoom();for(var e=this.getBlistByBorder(d),f=0;f<e.length;f++)b.addBorder(e[f])}}return b},getBlistByBorder:function(a){return this.getBlist(this.id[a.id])},getBlist:function(a){return this.blist[a]}}),pzpr.createPuzzleClass("LineInfo",{initialize:function(){this.max=0,this.id=[],this.room=[]},addRoom:function(){this.max++,this.room[this.max]={blist:new this.owner.BorderList}},getRoomID:function(a){return this.id[a.id]},setRoomID:function(a,b){this.room[b].blist.add(a),this.id[a.id]=b},addBorder:function(a){this.setRoomID(a,this.max)},emptyBorder:function(a){return 0===this.id[a.id]},getblist:function(a){return this.room[a].blist}}),pzpr.createPuzzleClass("AreaManager",{initialize:function(){this.max,this.invalidid,this.id,this.linkinfo,this.separate=[]},init:function(){if(this.enabled)for(var a=0;a<this.relation.length;a++)this.owner.board.validinfo[this.relation[a]].push(this),this.owner.board.validinfo.all.push(this)},enabled:!1,relation:["cell"],isvalid:function(a){return 7!==a.ques},bdfunc:function(){return!1},reset:function(){this.max=0,this.invalidid=[],this.id=[],this.linkinfo=[],this.separate=[],this.rebuild()},rebuild:function(){if(this.enabled){if(this.owner.board.hasborder)for(var a=0;a<this.owner.board.bdmax;a++)this.separate[a]=!1,this.checkSeparateInfo(this.owner.board.border[a]);for(var b=0;b<this.owner.board.cellmax;b++)this.linkinfo[b]=0,this.checkLinkInfo(this.owner.board.cell[b]),this.id[b]=0;this.searchIdlist(this.owner.board.cell)}},setCell:function(a){if(this.enabled){if(this.owner.board.hasborder)for(var b=a.getdir4cblist(),c=0;c<b.length;c++)this.checkLinkInfo(b[c][0]),this.checkSeparateInfo(b[c][1]);var d=this.calcLinkInfo(a),e=this.linkinfo[a.id];if(this.checkLinkInfo(a)){var f=this.getRemakeCell(a,d|e),g=!(!(16&d)||16&e),h=!(16&d||!(16&e));g&&f.length<=1?this.assignCell(a,1===f.length?this.owner.board.cell[f[0]]:null):h&&f.length<=1?this.removeCell(a):(f.push(a.id),this.remakeInfo(f))}}},checkLinkInfo:function(a){var b=this.calcLinkInfo(a);return this.linkinfo[a.id]!==b?(this.linkinfo[a.id]=b,!0):!1},calcLinkInfo:function(a){var b=0;return a.up().isnull||this.bdfunc(a.ub())||(b+=1),a.dn().isnull||this.bdfunc(a.db())||(b+=2),a.lt().isnull||this.bdfunc(a.lb())||(b+=4),a.rt().isnull||this.bdfunc(a.rb())||(b+=8),this.isvalid(a)&&(b+=16),b},setBorder:function(a){if(this.enabled&&this.checkSeparateInfo(a)){var b=a.sidecell[0],c=a.sidecell[1];if(b.isnull||this.checkLinkInfo(b),c.isnull||this.checkLinkInfo(c),b.isnull||c.isnull||!this.checkExecSearch(a))return;this.remakeInfo([b.id,c.id])}},checkSeparateInfo:function(a){var b=this.bdfunc(a);return this.separate[a.id]!==b?(this.separate[a.id]=b,!0):!1},checkExecSearch:function(a){var b=a.sidecell[0].id,c=a.sidecell[1].id;if(this.separate[a.id]){if(null===this.id[b]||null===this.id[c]||this.id[b]!==this.id[c])return!1}else if(null!==this.id[b]&&this.id[b]===this.id[c])return!1;return!0},getRemakeCell:function(a,b){for(var c=[],d=a.getdir4clist(),e=[0,1,2,4,8],f=[0,2,1,8,4],g=0;g<d.length;g++){var h=d[g][0],i=d[g][1],j=this.linkinfo[h.id];null!==this.id[h.id]&&b&e[i]&&j&f[i]&&c.push(h.id)}return c},getLinkCell:function(a){return this.getRemakeCell(a,this.linkinfo[a.id])},assignCell:function(a,b){var c=this.id[a.id];(null===c||0===c)&&(null===b?(c=this.addArea(),this.irowakeEnable()&&(a.color=this.getNewColor())):(c=this.id[b.id],this.irowakeEnable()&&(a.color=b.color)),this[c].clist.add(a),this.id[a.id]=c)},removeCell:function(a){var b=this.id[a.id];null!==b&&0!==b&&(this[b].clist.remove(a),this.id[a.id]=null,0===this[b].clist.length&&this.removeArea(b),this.irowakeEnable()&&(a.color=""))},remakeInfo:function(a){for(var b=this.irowakeEnable()?this.getLongColor(a):"",c=new this.owner.CellList,d=0;d<a.length;d++){var e=this.id[a[d]],f=this.owner.board;null!==e&&0!==e?c.extend(this.removeArea(e)):null===e&&c.add(f.cell[a[d]])}var g=this.searchIdlist(c);this.irowakeEnable()&&this.setLongColor(g,b)},addArea:function(){var a;return this.invalidid.length>0?a=this.invalidid.shift():(this.max++,a=this.max),this[a]={clist:new this.owner.CellList},a},removeArea:function(a){for(var b=this[a].clist,c=0;c<b.length;c++)this.id[b[c].id]=null;return this[a]={clist:new this.owner.CellList},this.invalidid.push(a),b},irowakeEnable:function(){return this.owner.flags.irowakeblk},irowakeValid:function(){return this.owner.getConfig("irowakeblk")},getNewColor:function(){return""},newIrowake:function(){for(var a=1;a<=this.max;a++){var b=this[a].clist;if(b.length>0)for(var c=this.getNewColor(),d=0;d<b.length;d++)b[d].color=c}},getLongColor:function(a){for(var b=null,c="",d=0;d<a.length;d++){var e=this.id[a[d]];null!==e&&(null===b||this[b].clist.length<this[e].clist.length)&&(b=e,c=this.owner.board.cell[a[d]].color)}return c?c:this.getNewColor()},setLongColor:function(a,b){for(var c=new this.owner.CellList,d=a[0],e=1;e<a.length;e++)this[d].clist.length<this[a[e]].clist.length&&(d=a[e]);for(var e=0;e<a.length;e++){for(var f=a[e]===d?b:this.getNewColor(),g=this[a[e]].clist,h=0,i=g.length;i>h;h++)g[h].color=f;c.extend(g)}this.irowakeValid()&&this.owner.painter.repaintBlocks(c)},searchIdlist:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];this.id[d.id]=this.isvalid(d)?0:null}for(var c=0;c<a.length;c++){var d=a[c];if(0===this.id[d.id]){var e=this.addArea();this.searchSingle(d,e),b.push(e)}}return b},searchSingle:function(a,b){for(var c=[a],d=this.id[a.id];c.length>0;){var a=c.pop();if(this.id[a.id]===d){this.id[a.id]=b,this[b].clist.add(a);for(var e=this.getLinkCell(a),f=0;f<e.length;f++)0===this.id[e[f]]&&c.push(this.owner.board.cell[e[f]])}}},getAreaInfo:function(){for(var a=this.owner.board,b=new this.owner.AreaInfo,c=0;c<a.cellmax;c++)b.id[c]=this.id[c]>0?0:null;for(var c=0;c<a.cellmax;c++){var d=a.cell[c];if(b.emptyCell(d)){b.addRoom(),this.hastop&&b.setTop(this.getTopOfRoomByCell(d));for(var e=this.getClistByCell(d),f=0;f<e.length;f++)b.addCell(e[f])}}return b},getClistByCell:function(a){return this.getClist(this.id[a.id])},getClist:function(a){if(!this[a])throw"Invalid Area ID:"+a;return this[a].clist}}),pzpr.createPuzzleClass("AreaBlackManager:AreaManager",{isvalid:function(a){return a.isBlack()}}),pzpr.createPuzzleClass("AreaWhiteManager:AreaManager",{isvalid:function(a){return a.isWhite()}}),pzpr.createPuzzleClass("AreaNumberManager:AreaManager",{isvalid:function(a){return a.isNumberObj()}}),pzpr.createPuzzleClass("AreaRoomManager:AreaManager",{initialize:function(){this.crosscnt=[],pzpr.common.AreaManager.prototype.initialize.call(this)},relation:["cell","border"],bdfunc:function(a){return a.isBorder()},hastop:!1,rebuild:function(){if(this.enabled){for(var a=this.owner.board,b=0,c=2*a.qcols,d=0,e=2*a.qrows,f=d;e>=f;f+=2)for(var g=b;c>=g;g+=2){var h=(g>>1)+(f>>1)*(a.qcols+1),i=1===a.hasborder?g===b||g===c||f===d||f===e:!1;this.crosscnt[h]=i?2:0}pzpr.common.AreaManager.prototype.rebuild.call(this),this.enabled&&this.hastop&&this.resetRoomNumber()}},checkSeparateInfo:function(a){var b=this.bdfunc(a);if(this.separate[a.id]!==b){var c=a.sidecross[0].id,d=a.sidecross[1].id;if(null!==c&&(this.crosscnt[c]+=b?1:-1),null!==d&&(this.crosscnt[d]+=b?1:-1),this.separate[a.id]=b,a.id<this.owner.board.bdinside)return!0}return!1},checkExecSearch:function(a){if(!pzpr.common.AreaManager.prototype.checkExecSearch.call(this,a))return!1;var b=a.sidecross[0].id,c=a.sidecross[1].id;if(this.separate[a.id]&&(1===this.crosscnt[b]||1===this.crosscnt[c]))return!1;if(!this.separate[a.id]&&(0===this.crosscnt[b]||0===this.crosscnt[c]))return!1;var d=a.sidecell[0],e=a.sidecell[1];return!this.separate[a.id]&&this.hastop&&this.setTopOfRoom_combine(d,e),!0},searchSingle:function(a,b){pzpr.common.AreaManager.prototype.searchSingle.call(this,a,b),this.hastop&&this.setTopOfRoom(b)},setTopOfRoom_combine:function(a,b){var c,d,e=this.getTopOfRoomByCell(a),f=this.getTopOfRoomByCell(b);a.bx>b.bx||a.bx===b.bx&&a.id>b.id?(c=e,d=f):(c=f,d=e),c.isNum()&&(d.noNum()&&(d.setQnum(c.getQnum()),d.draw()),c.setQnum(-1),c.draw())},calcTopOfRoom:function(a){for(var b=this.owner.board,c=null,d=b.maxbx,e=b.maxby,f=this[a].clist,g=0;g<f.length;g++){var h=f[g];h.bx>d||h.bx===d&&h.by>=e||(c=f[g].id,d=h.bx,e=h.by)}return c},setTopOfRoom:function(a){this[a].top=this.calcTopOfRoom(a)},resetRoomNumber:function(){for(var a=1;a<=this.max;a++){for(var b=-1,c=this[a].clist,d=this.getTopOfRoom(a),e=0,f=c.length;f>e;e++){var g=c[e];this.id[g.id]===a&&-1!==g.qnum&&(-1===b&&(b=g.qnum),d!==g.id&&(g.qnum=-1))}-1!==b&&-1===d.qnum&&(d.qnum=b)}},getRoomID:function(a){return this.id[a.id]},getTopOfRoomByCell:function(a){return this.owner.board.cell[this[this.id[a.id]].top]},getTopOfRoom:function(a){return this.owner.board.cell[this[a].top]},getCntOfRoomByCell:function(a){return this[this.id[a.id]].clist.length}}),pzpr.createPuzzleClass("AreaLineManager:AreaManager",{initialize:function(){this.bdcnt=[],pzpr.common.AreaManager.prototype.initialize.call(this)},relation:["cell","line"],isvalid:function(a){return this.bdcnt[a.id]<4||this.moveline&&a.isNum()},bdfunc:function(a){return!a.isLine()},moveline:!1,reset:function(){this.bdcnt=[],pzpr.common.AreaManager.prototype.reset.call(this)},rebuild:function(){if(this.enabled){for(var a=this.owner.board,b=0;b<a.cellmax;b++){var c=a.cell[b].bx,d=a.cell[b].by;this.bdcnt[b]=0,(c===a.minbx+1||c===a.maxbx-1)&&this.bdcnt[b]++,(d===a.minby+1||d===a.maxby-1)&&this.bdcnt[b]++}pzpr.common.AreaManager.prototype.rebuild.call(this),this.moveline&&this.resetMovedBase()}},checkSeparateInfo:function(a){var b=this.bdfunc(a);if(this.separate[a.id]!==b){var c=a.sidecell[0].id,d=a.sidecell[1].id;if(null!==c&&(this.bdcnt[c]+=b?1:-1),null!==d&&(this.bdcnt[d]+=b?1:-1),this.separate[a.id]=b,a.id<this.owner.board.bdinside)return!0}return!1},setCell:function(a){pzpr.common.AreaManager.prototype.setCell.call(this,a);var b=this.id[a.id];this.moveline&&null!==b&&this.setMovedBase(b)},setLine:function(a){this.setBorder(a)},assignCell:function(a,b){pzpr.common.AreaManager.prototype.assignCell.call(this,a,b),this.moveline&&(a.base=a.isNum()?a:this.owner.board.emptycell)},removeCell:function(a){pzpr.common.AreaManager.prototype.removeCell.call(this,a),this.moveline&&(a.base=this.owner.board.emptycell)},searchIdlist:function(a){for(var b=0;b<a.length;b++)a[b].base=a[b].isNum()?a[b]:this.owner.board.emptycell;pzpr.common.AreaManager.prototype.searchIdlist.call(this,a)},searchSingle:function(a,b){pzpr.common.AreaManager.prototype.searchSingle.call(this,a,b),this.moveline&&this.setMovedBase(b)},resetMovedBase:function(){for(var a=this.owner.board,b=0;b<a.cellmax;b++)a.cell[b].base=a.emptycell;for(var c=1;c<=this.max;c++)this.setMovedBase(c)},setMovedBase:function(a){var b=this[a].clist,c=this.owner.board;if(!(b.length<1)){if(1===b.length)return void(b[0].base=b[0]);for(var d=null,e=null,f=0,g=0;g<b.length;g++){var h=b[g];h.base=c.emptycell,1===h.lcnt()&&(f++,h.isNum()?d=h:e=h)}null!==d&&null!==e&&2===f&&(e.base=d)}},eraseLineByCell:function(a){if(null!==this.id[a.id]){for(var b=this.getClistByCell(a),c=0,d=0,e=b.length;e>d;d++)for(var f=d+1;e>f;f++){var g=this.owner.mouse.getnb(b[d].getaddr(),b[f].getaddr());g.isnull||(g.removeLine(),c++)}c>0&&b.draw()}}}),pzpr.createPuzzleClass("AreaInfo",{initialize:function(){this.max=0,this.id=[],this.room=[]},addRoom:function(){this.max++,this.room[this.max]={clist:new this.owner.CellList}},getRoomID:function(a){return this.id[a.id]},setRoomID:function(a,b){this.room[b].clist.add(a),this.id[a.id]=b},setTop:function(a){this.room[this.max].top=a},addCell:function(a){this.setRoomID(a,this.max)},emptyCell:function(a){return 0===this.id[a.id]},getclistbycell:function(a){return this.room[this.id[a.id]].clist},getSideAreaInfo:function(){for(var a=[],b=[],c=this.max,d=this.owner.board,e=1;c-1>=e;e++)a[e]=[];for(var f=0;f<d.bdmax;f++){var g=d.border[f].sidecell[0],h=d.border[f].sidecell[1];if(!g.isnull&&!h.isnull){var i=this.getRoomID(g),j=this.getRoomID(h);null!==i&&null!==j&&(j>i&&(a[i][j]=!0),i>j&&(a[j][i]=!0))}}for(var e=1;c-1>=e;e++){b[e]=[];for(var k=e+1;c>=k;k++)a[e][k]&&b[e].push(k)}return b},setErrLareaByCell:function(a,b){this.setErrLareaById(this.id[a.id],b)},setErrLareaById:function(a,b){var c=this;this.owner.board.border.filter(function(b){var d=b.sidecell[0].id,e=b.sidecell[1].id;return b.isLine()&&c.id[d]===a&&c.id[e]===a}).seterr(b),this.owner.board.cell.filter(function(b){return c.id[b.id]===a&&b.isNum()}).seterr(4)}}),pzpr.createPuzzleClass("Graphic",{initialize:function(){this.context=null,this.subcontext=null,this.gridcolor="black",this.cellcolor="black",this.errcolor1="rgb(224, 0, 0)",this.circledcolor="white",this.mbcolor="rgb(255, 160, 127)",this.qsubcolor1="rgb(160,255,160)",this.qsubcolor2="rgb(255,255,127)",this.qsubcolor3="rgb(192,192,192)",this.fontcolor="black",this.fontAnscolor="rgb(0, 160, 0)",this.fontErrcolor="rgb(191, 0, 0)",this.fontBCellcolor="rgb(224, 224, 224)",this.bcolor="white",this.dotcolor="black",this.errbcolor1="rgb(255, 160, 160)",this.errbcolor2="rgb(64, 255, 64)",this.icecolor="rgb(192, 224, 255)",this.ttcolor="rgb(127,255,127)",this.borderQuescolor="black",this.borderQanscolor="rgb(0, 191, 0)",this.borderQsubcolor="rgb(255, 0, 255)",this.errborderbgcolor="rgb(160, 160, 160)",this.bbcolor="rgb(96, 96, 96)",this.linecolor="rgb(0, 160, 0)",this.pekecolor="rgb(32, 32, 255)",this.errlinecolor="rgb(255, 0, 0)",this.errlinebgcolor="rgb(160, 160, 160)",this.targetColor1="rgb(255, 64,  64)",this.targetColor3="rgb(64,  64, 255)",this.movecolor="red",this.bgcolor="",this.gridcolor_BLACK="black",this.gridcolor_LIGHT="rgb(127, 127, 127)",this.gridcolor_DLIGHT="rgb(160, 160, 160)",this.gridcolor_SLIGHT="rgb(191, 191, 191)",this.gridcolor_THIN="rgb(224, 224, 224)",this.bcolor_GREEN="rgb(160, 255, 160)",this.dotcolor_PINK="rgb(255, 96, 191)",this.errbcolor1_DARK="rgb(255, 127, 127)",this.linecolor_LIGHT="rgb(0, 192, 0)",this.fontsizeratio=1,this.crosssize=.4,this.circleratio=[.4,.35],this.range={},this.resetRange(),this.suspended=!0,this.suspendedAll=!0,this.canvasWidth=null,this.canvasHeight=null,this.pageX=0,this.pageY=0,this.x0=0,this.y0=0,this.cw=36,this.ch=36,this.bw=18,this.bh=18,this.lw=1,this.lm=1,this.lwratio=12,this.addlw=0,this.lastHdeg=0,this.lastYdeg=0,this.minYdeg=.18,this.maxYdeg=.7,this.zidx=1,this.zidx_array=[],this.use={},this.numobj={},this.useBuffer=!1,this.outputImage=!1,this.isdrawBC=!1,this.isdrawBD=!1,this.boldreq=!1,this.pendingResize=!1
},margin:.15,hideHatena:!1,STROKE:0,FILL:1,FILL_STROKE:2,NONE:3,vnop_FILL:[!1,!0,!0,!1],vnop_STROKE:[!0,!1,!0,!1],initCanvas:function(a,b,c){if(a&&!a.getContext||b&&!b.getContext){var d=this;return void setTimeout(function(){d.initCanvas(a,b,c)},10)}this.context=a?a.getContext("2d"):null,this.subcontext=b?b.getContext("2d"):null;var e=this.context;for(var f in e.use)this.use[f]=e.use[f];this.useBuffer=!!e.use.canvas&&!!this.subcontext,c&&c()},resizeCanvas:function(a,b){var c=this.suspended;c||this.suspendAll(),this.canvasWidth=a||this.canvasWidth,this.canvasHeight=b||this.canvasHeight,this.context?(this.resize_canvas_main(),c||this.unsuspend()):this.pendingResize=!0},resizeCanvasByCellSize:function(a){var b=this.suspended;b||this.suspendAll(),this.cw=a||this.cw,this.ch=a||this.ch,this.canvasWidth=this.cw*this.getCanvasCols(),this.canvasHeight=this.ch*this.getCanvasRows(),this.context?(this.resize_canvas_main(),b||this.unsuspend()):this.pendingResize=!0},resize_canvas_main:function(){var a=this.canvasWidth,b=this.canvasHeight,c=this.getCanvasCols(),d=this.getCanvasRows(),e=a/c|0,f=b/d|0;this.owner.getConfig("squarecell")?this.cw=this.ch=Math.min(e,f):(this.cw=e,this.ch=f),this.bw=this.cw/2,this.bh=this.ch/2,this.lw=Math.max(this.cw/this.lwratio,3),this.lm=(this.lw-1)/2;{var g=this.context;this.owner.board}this.x0=(a-this.cw*this.getBoardCols())/2+this.cw*this.getOffsetCols()|0,this.y0=(b-this.ch*this.getBoardRows())/2+this.ch*this.getOffsetRows()|0;for(var h=[g,this.subcontext],i=0;2>i;i++)if(h[i]){h[i].changeSize(0|a,0|b);var j=this.x0,k=this.y0;if(!g.use.canvas&&h[i]===g){var l=pzpr.util.getRect(g.canvas);j-=l.left%1,k-=l.top%1}h[i].translate(j,k)}this.owner.execListener("resize");var l;pzpr.env.browser.oldGecko?(l=pzpr.util.getRect(g.canvas),l.left+=parseInt(g.canvas.style.paddingLeft),l.top+=parseInt(g.canvas.style.paddingTop)):l=pzpr.util.getRect(g.use.sl?g.canvas:g.child),this.pageX=this.x0+(0|l.left),this.pageY=this.y0+(0|l.top),this.resetVectorFunctions(),this.context.clear()},getCanvasCols:function(){return this.getBoardCols()+2*this.margin},getCanvasRows:function(){return this.getBoardRows()+2*this.margin},getBoardCols:function(){var a=this.owner.board;return(a.maxbx-a.minbx)/2},getBoardRows:function(){var a=this.owner.board;return(a.maxby-a.minby)/2},getOffsetCols:function(){return(0-this.owner.board.minbx)/2},getOffsetRows:function(){return(0-this.owner.board.minby)/2},suspend:function(){this.suspended=!0},suspendAll:function(){this.suspendedAll=!0,this.suspended=!0},unsuspend:function(){if(!this.context)return!1;if(null===this.canvasWidth||null===this.canvasHeight){var a=pzpr.util.getRect(this.context.canvas);this.resizeCanvas(a.right-a.left,a.bottom-a.top)}else this.pendingResize&&(this.pendingResize=!1,this.resize_canvas_main());if(this.suspendedAll){var b=this.owner.board;this.setRange(b.minbx-2,b.minby-2,b.maxbx+2,b.maxby+2),this.suspendedAll=!1}return this.suspended&&(this.suspended=!1,this.prepaint()),!0},prepaint:function(){if(!this.suspended&&this.context){var a=this.range.x1,b=this.range.y1,c=this.range.x2,d=this.range.y2;if(!(a>c||b>d)){if(this.useBuffer){var e=this.context,f=this.subcontext;this.context=f,this.setRangeObject(a-1,b-1,c+1,d+1),this.flushCanvas(),this.paint(),this.context=e;var g=this.x0+a*this.bw-1,h=this.y0+b*this.bh-1,i=this.x0+c*this.bw+2,j=this.y0+d*this.bh+2;0>g&&(g=0),i>f.child.width&&(i=f.child.width),0>h&&(h=0),j>f.child.height&&(j=f.child.height),e.drawImage(f.child,g,h,i-g,j-h,g-this.x0,h-this.y0,i-g,j-h)}else this.setRangeObject(a,b,c,d),this.flushCanvas(),this.paint();this.resetRange()}}},paint:function(){},setRange:function(a,b,c,d){this.range.x1>a&&(this.range.x1=a),this.range.y1>b&&(this.range.y1=b),this.range.x2<c&&(this.range.x2=c),this.range.y2<d&&(this.range.y2=d)},setRangeObject:function(a,b,c,d){var e=this.owner.board;this.range.cells=e.cellinside(a,b,c,d),this.range.crosses=e.crossinside(a,b,c,d),this.range.borders=e.borderinside(a,b,c,d),this.range.excells=e.excellinside(a,b,c,d)},resetRange:function(){var a=this.owner,b=a.board;this.range={x1:b.maxbx+1,y1:b.maxby+1,x2:b.minbx-1,y2:b.minby-1,cells:new a.CellList,crosses:new a.CrossList,borders:new a.BorderList,excells:new a.EXCellList}},paintRange:function(a,b,c,d){this.setRange(a,b,c,d),this.prepaint()},paintAll:function(){this.suspended&&(this.suspendedAll=!0);var a=this.owner.board;this.paintRange(a.minbx-2,a.minby-2,a.maxbx+2,a.maxby+2)},getNewLineColor:function(){for(var a=0;;){var b=(384*Math.random()|0)-64;0>b&&(b=0),b>255&&(b=255);var c=(384*Math.random()|0)-64;0>c&&(c=0),c>255&&(c=255);var d=(384*Math.random()|0)-64;0>d&&(d=0),d>255&&(d=255);var e=Math.max(b,Math.max(c,d)),f=Math.min(b,Math.min(c,d)),g=0,h=.5*(e+f)/255,i=e===f?0:(e-f)/(.5>=h?e+f:510-e-f);e==f?g=0:b>=c&&b>=d?g=(60*(c-d)/(e-f)+360)%360:c>=b&&c>=d?g=(120+60*(d-b)/(e-f)+360)%360:d>=c&&d>=b&&(g=(240+60*(b-c)/(e-f)+360)%360);var j=(.29891*b+.58661*c+.11448*d)/255;if(this.minYdeg<j&&j<this.maxYdeg&&Math.abs(this.lastYdeg-j)>.15&&(.02>i||i>.4)&&(360+this.lastHdeg-g)%360>=45&&(360+this.lastHdeg-g)%360<=315)return this.lastHdeg=g,this.lastYdeg=j,"rgb("+b+","+c+","+d+")";if(a++,a>100)return"rgb("+b+","+c+","+d+")"}},repaintBlocks:function(a){a.draw()},repaintLines:function(a){this.range.borders=a,this.drawLines(),this.use.canvas&&this.repaintParts(a)},repaintParts:function(){},resetVectorFunctions:function(){var a=this.owner.Graphic.prototype;this.flushCanvas=a.flushCanvas,this.vnop=a.vnop,this.vhide=a.vhide,this.vdel=a.vdel,this.vinc=a.vinc},flushCanvas:function(){this.context;this.flushCanvas=this.use.canvas?function(){var a=this.range,b=this.context,c=a.x1*this.bw,d=a.y1*this.bh,e=(a.x2-a.x1)*this.bw+1,f=(a.y2-a.y1)*this.bh+1,g=-this.x0,h=-this.y0,i=b.canvas.clientWidth,j=b.canvas.clientHeight;c=c>=g?c:g,d=d>=h?d:h,e=i>=c+e?e:i-c,f=j>=d+f?f:j-d,b.fillStyle=this.bgcolor?this.bgcolor:"rgb(255, 255, 255)",b.fillRect(c,d,e,f)}:function(){this.zidx=1},this.flushCanvas()},vnop:function(a,b){return this.vnop=this.use.canvas?function(){return!0}:this.use.vml?function(a,b){var c=this.context;c.vid=a;var d=c.elements[a];return d?(d.style.display="inline",this.vnop_FILL[b]&&(d.fillcolor=Candle.parse(c.fillStyle)),this.vnop_STROKE[b]&&(d.strokecolor=Candle.parse(c.strokeStyle)),!1):!0}:this.use.sl?function(a,b){var c=this.context;c.vid=a;var d=c.elements[a];return d?(d.Visibility="Visible",this.vnop_FILL[b]&&(d.fill=Candle.parse(c.fillStyle)),this.vnop_STROKE[b]&&(d.stroke=Candle.parse(c.strokeStyle)),!1):!0}:function(a,b){var c=this.context;c.vid=a;var d=c.elements[a];return d?(d.removeAttribute("opacity"),this.vnop_FILL[b]&&d.setAttribute("fill",Candle.parse(c.fillStyle)),this.vnop_STROKE[b]&&d.setAttribute("stroke",Candle.parse(c.strokeStyle)),!1):!0},this.vnop(a,b)},vshow:function(a){this.vshow=this.use.canvas?function(){}:function(a){var b=this.context;b.vid=a,b.elements[a]&&(b.use.svg?b.elements[a].removeAttribute("opacity"):b.use.vml?b.elements[a].style.display="inline":b.elements[a].Visibility="Visible")},this.vshow(a)},vhide:function(a){this.context;this.vhide=this.use.canvas?function(){}:function(a){var b=this.context;"string"==typeof a&&(a=[a]);for(var c=0;c<a.length;c++)b.elements[a[c]]&&(b.use.svg?b.elements[a[c]].setAttribute("opacity",0):b.use.vml?b.elements[a[c]].style.display="none":b.elements[a[c]].Visibility="Collapsed")},this.vhide(a)},vdel:function(a){this.context;this.vdel=this.use.canvas?function(){}:function(a){for(var b=this.context,c=0;c<a.length;c++)b.elements[a[c]]&&(b.use.sl?b.elements[a[c]].Visibility="Collapsed":b.target.removeChild(b.elements[a[c]]),b.elements[a[c]]=null)},this.vdel(a)},vinc:function(a,b){this.context;return this.vinc=this.use.canvas?function(a,b){var c=this.context;return c.setLayer(a),b&&c.setRendering(b),c}:function(a,b){var c=this.context;return c.vid="",c.setLayer(a),this.zidx_array[a]||(this.zidx++,this.zidx_array[a]=this.zidx,b&&c.setRendering(b),c.use.sl?c.getLayerElement()["Canvas.ZIndex"]=this.zidx:c.getLayerElement().style.zIndex=this.zidx),c},this.vinc(a,b)}}),pzpr.createPuzzleClass("MouseEvent",{initialize:function(){this.cursor=this.owner.cursor,this.enableMouse=!0,this.mouseoffset={px:0,py:0};var a=pzpr.env.browser;a.legacyIE?this.mouseoffset={px:2,py:2}:a.WebKit&&(this.mouseoffset={px:1,py:1}),this.mouseCell,this.firstCell,this.inputPoint=new this.owner.RawAddress,this.firstPoint=new this.owner.RawAddress,this.prevPos=new this.owner.Address,this.btn={},this.inputData,this.bordermode,this.mousestart,this.mousemove,this.mouseend,this.mousereset()},RBBlackCell:!1,mousereset:function(){var a=this.owner.board,b=this.mouseCell;this.mouseCell=a.emptycell,this.firstCell=a.emptycell,this.firstPoint.reset(),this.prevPos.reset(),this.btn={Left:!1,Middle:!1,Right:!1},this.inputData=null,this.bordermode=!1,this.mousestart=!1,this.mousemove=!1,this.mouseend=!1,a.linfo.moveline&&this.owner.getConfig("dispmove")&&b&&!b.isnull&&b.draw()},e_mousedown:function(a){return this.enableMouse?(this.setMouseButton(a),this.mouseevent(this.getBoardAddress(a),0),pzpr.util.stopPropagation(a),pzpr.util.preventDefault(a),!1):!0},e_mouseup:function(a){return this.enableMouse?(this.mouseevent(this.inputPoint,2),this.mousereset(),pzpr.util.stopPropagation(a),pzpr.util.preventDefault(a),!1):!0},e_mousemove:function(a){return this.enableMouse?(this.mouseevent(this.getBoardAddress(a),1),pzpr.util.stopPropagation(a),pzpr.util.preventDefault(a),!1):!0},e_mouseout:function(){},setMouseButton:function(a){this.btn=pzpr.util.getMouseButton(a);var b=this.owner.key;b.checkmodifiers(a),(b.isSHIFT||b.isMETA)^this.owner.getConfig("lrcheck")&&this.btn.Left!==this.btn.Right&&(this.btn.Left=!this.btn.Left,this.btn.Right=!this.btn.Right)},getBoardAddress:function(a){var b=this.owner,c=b.painter,d=pzpr.util.getPagePos(a),e=d.px-c.pageX-this.mouseoffset.px,f=d.py-c.pageY-this.mouseoffset.py,g=new b.RawAddress(e/c.bw,f/c.bh),h=c.context;return h&&(h.use.vml||h.use.sl)&&g.move(.33,.33),g},mouseevent:function(a,b){if(this.inputPoint.set(a),this.mousestart=0===b,this.mousemove=1===b,this.mouseend=2===b,this.owner.execListener("mouse")&&(this.btn.Left||this.btn.Right)){var c=this.owner;if(this.mousestart){if(c.opemgr.newOperation(),c.board.errclear(),c.redraw(),this.isDispred())return void this.inputRed()}else c.opemgr.newChain();this.mouseinput()}},isDispred:function(){var a=this.owner,b=a.flags,c=!1;return b.redline&&a.getConfig("redline")?c=!0:b.redblk&&a.getConfig("redblk")?c=!0:b.redblkrb&&a.getConfig("redblkrb")?c=!0:"roma"===a.pid&&a.getConfig("redroad")&&(c=!0),a.key.isZ^c},mouseinput:function(){},inputRed:function(){return!1},notInputted:function(){return!this.owner.opemgr.changeflag},getcell:function(){return this.getpos(0).getc()},getcell_excell:function(){var a=this.getpos(0),b=a.getex();return b.isnull?a.getc():b},getcross:function(){return this.getpos(.5).getx()},getpos:function(a){var b=this.inputPoint,c=2*a,d=2*(1-a),e=b.bx+4,f=b.by+4,g=e%2,h=f%2;return e=(-2&e)+ +(g>=c)+ +(g>=d)-4,f=(-2&f)+ +(h>=c)+ +(h>=d)-4,new this.owner.Address(e,f)},getborder:function(a){var b=this.inputPoint,c=(-2&b.bx)+1,d=(-2&b.by)+1,e=b.bx+1-c,f=b.by+1-d,g=this.owner.board;if(g.lines.isLineCross)if(g.lines.borderAsLine){var h=2*(.5-a),i=2*(.5+a);if(e>h&&i>e&&f>h&&i>f)return g.emptyborder}else{var h=2*a,i=2*(1-a);if((h>e||e>i)&&(h>f||f>i))return g.emptyborder}return 2-f>e?e>f?g.getb(c,d-1):g.getb(c-1,d):e>f?g.getb(c+1,d):g.getb(c,d+1)},isBorderMode:function(){return this.mousestart&&(this.bordermode=!this.getpos(.25).oncell()),this.bordermode},setcursor:function(a){var b=this.cursor.getOBJ();this.cursor.setOBJ(a),b.draw(),a.draw()},setcursorpos:function(a){var b=this.cursor.getTCP();this.cursor.setTCP(a),b.draw(),a.draw()}}),pzpr.createPuzzleClass("KeyEvent",{initialize:function(){this.cursor=this.owner.cursor,this.enableKey=!0,this.keyreset()},enablemake:!1,enableplay:!1,keyup_event:!1,KEYUP:"up",KEYDN:"down",KEYLT:"left",KEYRT:"right",keyreset:function(){this.isCTRL=!1,this.isMETA=!1,this.isALT=!1,this.isSHIFT=!1,this.isZ=!1,this.isX=!1,this.isY=!1,this.keydown=!1,this.keyup=!1,this.ca="",this.event=null,this.prev=null},isenablemode:function(){return this.owner.editmode&&this.enablemake||this.owner.playmode&&this.enableplay},e_keydown:function(a){if(this.enableKey){this.event=a;var b=this.getchar(a);b&&this.keyevent(b,0)}},e_keyup:function(a){if(this.enableKey){this.event=a;var b=this.getchar(a);b&&this.keyevent(b,1)}},e_keypress:function(a){if(this.enableKey){this.event=a;var b=this.getcharp(a);b&&this.keyevent(b,0)}},checkmodifiers:function(a){this.isSHIFT^a.shiftKey&&(this.isSHIFT=a.shiftKey),this.isCTRL^a.ctrlKey&&(this.isCTRL=a.ctrlKey),this.isMETA^a.metaKey&&(this.isMETA=a.metaKey),this.isALT^a.altKey&&(this.isALT=a.altKey)},checkbutton:function(a){this.keydown?("z"!==a||this.isZ||(this.isZ=!0),"x"!==a||this.isX||(this.isX=!0),"y"!==a||this.isY||(this.isY=!0)):("z"===a&&this.isZ&&(this.isZ=!1),"x"===a&&this.isX&&(this.isX=!1),"y"===a&&this.isY&&(this.isY=!1))},getchar:function(a){if(this.checkmodifiers(a),38==a.keyCode)return this.KEYUP;if(40==a.keyCode)return this.KEYDN;if(37==a.keyCode)return this.KEYLT;if(39==a.keyCode)return this.KEYRT;var b=a.keyCode?a.keyCode:a.charCode;return b>=48&&57>=b?(b-48).toString(36):b>=65&&90>=b?(b-55).toString(36):b>=96&&105>=b?(b-96).toString(36):b>=112&&123>=b?"F"+(b-111).toString(10):32==b||46==b?" ":8==b?"BS":a.shiftKey?"shift":""},getcharp:function(a){return this.checkmodifiers(a),45==(a.keyCode?a.keyCode:a.charCode)?"-":""},keyevent:function(a,b){var c=this.owner;this.keydown=0===b,this.keyup=1===b,this.keydown?c.opemgr.newOperation():c.opemgr.newChain(),this.ca=a,this.checkbutton(a),this.keydown&&!this.isZ&&(c.board.errclear(),c.redraw()),c.execListener("key",a)&&this.isenablemode()&&(this.keydown&&this.moveTarget(a)||(this.keydown||this.keyup&&this.keyup_event)&&this.keyinput(a))},stopEvent:function(){pzpr.util.preventDefault(this.event),this.keyreset()},keyinput:function(a){this.key_inputqnum(a)},moveTarget:function(a){return this.moveTCell(a)},moveTCell:function(a){return this.moveTC(a,2)},moveTCross:function(a){return this.moveTC(a,2)},moveTBorder:function(a){return this.moveTC(a,1)},moveTC:function(a,b){var c=this.cursor.getTCP(),e=this.owner.board.BDIR;switch(a){case this.KEYUP:c.by-b>=this.cursor.miny&&(e=d.UP);break;case this.KEYDN:c.by+b<=this.cursor.maxy&&(e=d.DN);break;case this.KEYLT:c.bx-b>=this.cursor.minx&&(e=d.LT);break;case this.KEYRT:c.bx+b<=this.cursor.maxx&&(e=d.RT);break;default:return!1}return this.cursor.movedir_cursor(e,b),c.draw(),this.cursor.getTCP().draw(),this.stopEvent(),!0}}),pzpr.createPuzzleClass("TargetCursor",{initialize:function(){this.pos=new this.owner.Address(1,1),this.minx,this.miny,this.maxx,this.maxy},crosstype:!1,setminmax:function(){var a=this.owner.board,b=this.crosstype?0:1;this.minx=a.minbx+b,this.miny=a.minby+b,this.maxx=a.maxbx-b,this.maxy=a.maxby-b,this.adjust_init()},initCursor:function(){this.pos=this.crosstype?new this.owner.Address(0,0):new this.owner.Address(1,1),this.adjust_init()},adjust_init:function(){void 0!==this.pos&&(this.pos.bx<this.minx&&(this.pos.bx=this.minx),this.pos.by<this.miny&&(this.pos.by=this.miny),this.pos.bx>this.maxx&&(this.pos.bx=this.maxx),this.pos.by>this.maxy&&(this.pos.by=this.maxy))},adjust_modechange:function(){},movedir_cursor:function(a,b){this.pos.movedir(a,b)},getTCP:function(){return this.pos.clone()},setTCP:function(a){a.bx<this.minx||this.maxx<a.bx||a.by<this.miny||this.maxy<a.by||this.pos.set(a)},getTCC:function(){return this.pos.getc()},setTCC:function(a){this.pos.init(a.bx,a.by)},getTXC:function(){return this.pos.getx()},setTXC:function(a){this.pos.init(a.bx,a.by)},getTBC:function(){return this.pos.getb()},setTBC:function(a){this.pos.init(a.bx,a.by)},getTEC:function(){return this.pos.getex()},setTEC:function(a){this.pos.init(a.bx,a.by)},getOBJ:function(){return this.owner.board.getobj(this.pos.bx,this.pos.by)},setOBJ:function(a){a.isnull||this.pos.init(a.bx,a.by)},targetdir:2,chtarget:function(a){return"shift"!=a?!1:(this.targetdir=2==this.targetdir?4:2,this.getTCC().draw(),!0)},detectTarget:function(a){var b=this.owner.board;if(a.isnull)return 0;if(a.iscell){if(51!==a.ques||a.id===b.cellmax-1)return 0;if((a.rt().isnull||51===a.rt().getQues())&&(a.dn().isnull||51===a.dn().getQues()))return 0;if(a.rt().isnull||51===a.rt().getQues())return 4;if(a.dn().isnull||51===a.dn().getQues())return 2}else{if(!a.isexcell)return 0;if(a.id===b.qcols+b.qrows)return 0;if(-1===a.by&&51===a.relcell(0,2).getQues()||-1===a.bx&&51===a.relcell(2,0).getQues())return 0;if(-1===a.by)return 4;if(-1===a.bx)return 2}return this.targetdir}}),pzpr.addConsts({URL_AUTO:0,URL_PZPRV3:6,URL_PZPRV3E:3,URL_PZPRAPP:1,URL_KANPEN:2,URL_KANPENP:5,URL_HEYAAPP:4}),pzpr.url={info:{},register:function(a){for(var b in a)pzpr.url.info[b]=new f(b,a[b])},exists:function(a){return!!this.toPID(a)},toPID:function(a){if(this.info[a]&&this.info[a].ja)return a;for(var b in this.info)if(this.info[b].alias)for(var c in this.info[b].alias)if(this.info[b].alias[c]===a)return b;return""},toScript:function(a){return this.info[a]?this.info[a].script:""},toURLID:function(a){return this.info[a].alias.pzprurl?this.info[a].alias.pzprurl:a},toKanpen:function(a){return this.info[a].alias.kanpen?!!this.info[a].alias.kanpen:a},PIDlist:function(a){var b=[];for(var c in this.info)this.info[c].script===a&&b.push(c);return b},parseURL:function(b){return a(b)},constructURL:function(a){return c(a)}};var f=function(){this.init.apply(this,arguments)};f.prototype={init:function(a,b){this.pzprid=a,this.script=b[4]?b[4]:this.pzprid,this.ja=b[2],this.en=b[3],this.exists={pzprapp:!!b[0],kanpen:!!b[1],pencilbox:!!b[1]},this.exists.kanpen=this.exists.kanpen&&"nanro"!==a&&"ayeheya"!==a&&"kurochute"!==a,this.alias=b[5]?b[5]:{}}},pzpr.url.register({aho:[0,0,"アホになり切れ","Aho-ni-Narikire","shikaku"],amibo:[0,0,"あみぼー","Amibo","amibo"],ayeheya:[0,1,"∀人∃ＨＥＹＡ","ekawayeh","heyawake"],bag:[1,0,"バッグ","BAG (Corral)"],barns:[1,0,"バーンズ","Barns"],bdblock:[1,0,"ボーダーブロック","Border Block"],bonsan:[1,0,"ぼんさん","Bonsan","bonsan"],bosanowa:[1,0,"ボサノワ","Bosanowa"],box:[0,0,"ボックス","Box"],cbblock:[0,0,"コンビブロック","Combi Block"],chocona:[0,0,"チョコナ","Chocona","shimaguni"],cojun:[0,0,"コージュン","Cojun","ripple"],country:[1,0,"カントリーロード","Country Road"],creek:[1,0,"クリーク","Creek"],factors:[0,0,"因子の部屋","Rooms of Factors"],fillmat:[1,0,"フィルマット","Fillmat","fillmat"],fillomino:[0,1,"フィルオミノ","Fillomino","",{kanpen2:"fillomino01"}],firefly:[1,0,"ホタルビーム","Hotaru Beam (Glow of Fireflies)"],fivecells:[0,0,"ファイブセルズ","FiveCells","nawabari"],fourcells:[0,0,"フォーセルズ","FourCells","nawabari"],goishi:[0,1,"碁石ひろい","Goishi"],gokigen:[1,0,"ごきげんななめ","Gokigen-naname","gokigen"],hakoiri:[1,0,"はこいり○△□","Triplets"],hanare:[0,0,"はなれ組","Hanare-gumi","hanare"],hashikake:[0,1,"橋をかけろ","Bridges","",{kanpen:"hashi"}],heyawake:[0,1,"へやわけ","Heyawake","heyawake"],heyabon:[1,0,"へやぼん","Heya-Bon","bonsan"],hitori:[0,1,"ひとりにしてくれ","Hitori"],icebarn:[1,0,"アイスバーン","Icebarn","icebarn"],icelom:[0,0,"アイスローム","Icelom","icebarn"],icelom2:[0,0,"アイスローム２","Icelom2","icebarn"],ichimaga:[0,0,"イチマガ","Ichimaga","ichimaga"],ichimagam:[0,0,"磁石イチマガ","Magnetic Ichimaga","ichimaga"],ichimagax:[0,0,"一回曲がって交差もするの","Crossing Ichimaga","ichimaga"],kaero:[1,0,"お家に帰ろう","Return Home"],kakuro:[0,1,"カックロ","Kakuro"],kakuru:[0,0,"カックル","Kakuru"],kinkonkan:[1,0,"キンコンカン","Kin-Kon-Kan"],kouchoku:[0,0,"交差は直角に限る","Kouchoku"],kramma:[0,0,"快刀乱麻","KaitoRamma","kramma"],kramman:[0,0,"新・快刀乱麻","New KaitoRamma","kramma"],kurochute:[0,1,"クロシュート","Kurochute"],kurodoko:[0,1,"黒どこ(黒マスはどこだ)","Kurodoko"],kurotto:[0,0,"クロット","Kurotto"],kusabi:[0,0,"クサビリンク","Kusabi"],lightup:[0,1,"美術館","Akari (Light Up)","",{pzprurl:"akari",kanpen:"bijutsukan"}],lits:[1,1,"ＬＩＴＳ","LITS","lits"],lookair:[0,0,"るっくえあ","Look-Air"],loopsp:[1,0,"環状線スペシャル","Loop Special"],loute:[0,0,"エルート","L-route"],mashu:[0,1,"ましゅ","Masyu (Pearl Puzzle)","",{kanpen:"masyu"}],mejilink:[0,0,"メジリンク","Mejilink"],minarism:[1,0,"マイナリズム","Minarism"],mochikoro:[1,0,"モチコロ","Mochikoro","nurikabe"],mochinyoro:[1,0,"モチにょろ","Mochinyoro","nurikabe"],nagenawa:[0,0,"なげなわ","Nagenawa","nagenawa"],nanro:[0,1,"ナンロー","Nanro"],nawabari:[1,0,"なわばり","Territory","nawabari"],norinori:[0,1,"のりのり","Norinori","lits"],numlin:[0,1,"ナンバーリンク","Numberlink","",{kanpen:"numberlink"}],nuribou:[1,0,"ぬりぼう","Nuribou","nurikabe"],nurikabe:[0,1,"ぬりかべ","Nurikabe","nurikabe"],paintarea:[1,0,"ペイントエリア","Paintarea"],pipelink:[1,0,"パイプリンク","Pipelink","pipelink"],pipelinkr:[1,0,"帰ってきたパイプリンク","Pipelink Returns","pipelink"],reflect:[1,0,"リフレクトリンク","Reflect Link"],renban:[0,0,"連番窓口","Renban-Madoguchi"],ringring:[0,0,"リングリング","Ring-ring","nagenawa"],ripple:[0,1,"波及効果","Ripple Effect","ripple",{kanpen:"hakyukoka"}],roma:[0,0,"ろーま","Roma"],sashigane:[0,0,"さしがね","Sashigane","loute"],shakashaka:[0,1,"シャカシャカ","ShakaShaka"],shikaku:[0,1,"四角に切れ","Shikaku","shikaku"],shimaguni:[1,0,"島国","Islands","shimaguni"],shugaku:[1,0,"修学旅行の夜","School Trip"],shwolf:[0,0,"ヤギとオオカミ","Sheeps and Wolves","kramma"],slalom:[1,1,"スラローム","Slalom"],slither:[0,1,"スリザーリンク","Slitherlink","",{kanpen:"slitherlink"}],snakes:[1,0,"へびいちご","Hebi-Ichigo"],sudoku:[0,1,"数独","Sudoku"],sukoro:[1,0,"数コロ","Sukoro","sukoro"],sukororoom:[0,0,"数コロ部屋","Sukoro-room","sukoro"],tasquare:[0,0,"たすくえあ","Tasquare"],tatamibari:[1,0,"タタミバリ","Tatamibari"],tateyoko:[1,0,"タテボーヨコボー","Tatebo-Yokobo"],tawa:[0,0,"たわむれんが","Tawamurenga"],tentaisho:[0,1,"天体ショー","Tentaisho"],tilepaint:[1,0,"タイルペイント","Tilepaint"],toichika:[0,0,"遠い誓い","Toichika"],triplace:[0,0,"トリプレイス","Tri-place"],usotatami:[0,0,"ウソタタミ","Uso-tatami","fillmat"],view:[1,0,"ヴィウ","View","sukoro"],wagiri:[0,0,"ごきげんななめ・輪切","Gokigen-naname:wagiri","gokigen"],wblink:[0,0,"シロクロリンク","Shirokuro-link"],yajikazu:[1,0,"やじさんかずさん","Yajisan-Kazusan"],yajirin:[0,1,"ヤジリン","Yajilin","",{pzprurl:"yajilin",kanpen:"yajilin"}],yajitatami:[0,0,"ヤジタタミ","Yajitatami"],yosenabe:[0,0,"よせなべ","Yosenabe"]}),pzpr.createPuzzleClass("Encode",{pflag:"",outpflag:"",outsize:"",outbstr:"",checkpflag:function(a){return this.pflag.indexOf(a)>=0},decodeURL:function(a){var b=pzpr.url.parseURL(a),c=this.owner;if(c.board.initBoardSize(b.cols,b.rows),b.bstr)switch(this.pflag=b.pflag,b.type){case d.URL_PZPRV3:case d.URL_PZPRAPP:case d.URL_PZPRV3E:this.outbstr=b.bstr,this.decodePzpr(b.type);break;case d.URL_KANPEN:c.fio.lineseek=0,c.fio.dataarray=b.bstr.replace(/_/g," ").split("/"),this.decodeKanpen();break;case d.URL_HEYAAPP:this.outbstr=b.bstr,this.decodeHeyaApp()}c.board.resetInfo()},encodeURL:function(a){var b=this.owner,c="",e=!1,f=b.board.qcols,g=b.board.qrows;switch((isNaN(a)||a===d.URL_AUTO)&&(a=d.URL_PZPRV3),a===d.URL_KANPEN&&"lits"==b.pid&&(a=d.URL_KANPENP),b.opemgr.disableRecord(),this.outpflag="",this.outsize="",this.outbstr="",a){case d.URL_PZPRV3:case d.URL_PZPRV3E:this.encodePzpr(d.URL_PZPRV3),c=this.outsize?this.outsize:[f,g].join("/"),e=!!this.outpflag;break;case d.URL_PZPRAPP:case d.URL_KANPENP:this.encodePzpr(d.URL_PZPRAPP),c=this.outsize?this.outsize:[f,g].join("/"),e=!0;break;case d.URL_KANPEN:b.fio.datastr="",this.encodeKanpen(),this.outbstr=b.fio.datastr.replace(/\r?\n/g,"/").replace(/ /g,"_"),c=this.outsize?this.outsize:[g,f].join("/");break;case d.URL_HEYAAPP:this.encodeHeyaApp(),c=[f,g].join("x");break;default:return""}b.opemgr.enableRecord();var h=(e?[this.outpflag]:[]).concat([c,this.outbstr]).join("/");return pzpr.url.constructURL({id:b.pid,type:a,qdata:h})},decodePzpr:function(){},encodePzpr:function(){},decodeKanpen:function(){},encodeKanpen:function(){},decodeHeyaApp:function(){},encodeHeyaApp:function(){}}),pzpr.addConsts({FILE_AUTO:0,FILE_PZPR:1,FILE_PBOX:2,FILE_PZPH:3}),pzpr.createPuzzleClass("FileIO",{filever:0,lineseek:0,dataarray:null,datastr:"",currentType:d.FILE_PZPR,filedecode:function(a){var b=this.owner;this.filever=0,this.lineseek=0,this.dataarray=a.split("\n"),this.readLine().match(/pzprv3\.?(\d+)?/)?(RegExp.$1&&(this.filever=parseInt(RegExp.$1)),this.readLine()!==this.owner.pid,this.currentType=d.FILE_PZPR):(this.lineseek=0,this.currentType=d.FILE_PBOX);var c,e;return"sudoku"!==b.pid?(c=parseInt(this.readLine(),10),e=parseInt(this.readLine(),10),this.currentType===d.FILE_PBOX&&"kakuro"===b.pid&&(c--,e--)):c=e=parseInt(this.readLine(),10),0>=c||0>=e?"":(this.owner.board.initBoardSize(e,c),this.currentType===d.FILE_PZPR?this.decodeData():this.currentType===d.FILE_PBOX&&this.kanpenOpen(),b.opemgr.decodeLines(),b.board.resetInfo(),this.dataarray=null,"")},fileencode:function(a){(isNaN(a)||a===d.FILE_AUTO)&&(a=d.FILE_PZPR),this.filever=0,this.sizestr="",this.datastr="",this.currentType=a,this.currentType===d.FILE_PZPH&&(this.currentType=d.FILE_PZPR);var b=this.owner;if(b.opemgr.disableRecord(),this.currentType===d.FILE_PZPR?this.encodeData():this.currentType===d.FILE_PBOX&&this.kanpenSave(),b.opemgr.enableRecord(),this.sizestr||(this.sizestr=[b.board.qrows,b.board.qcols].join("\n")),this.datastr=[this.sizestr,this.datastr].join("\n"),this.currentType===d.FILE_PZPR){var c=0===this.filever?"pzprv3":"pzprv3."+this.filever;this.datastr=[c,b.pid,this.datastr].join("\n")}var e=this.datastr;return a===d.FILE_PZPH&&(e+=b.opemgr.toString()),e},readLine:function(){return this.lineseek++,this.dataarray[this.lineseek-1]},readLines:function(a){return this.lineseek+=a,this.dataarray.slice(this.lineseek-a,this.lineseek)},getItemList:function(a){for(var b=[],c=this.readLines(a),d=0;d<c.length;d++){for(var e=c[d].split(" "),f=[],g=0;g<e.length;g++)""!=e[g]&&f.push(e[g]);b=b.concat(f)}return b},decodeObj:function(a,b,c,d,e,f){for(var g=c,h=d,i=2,j=this.getItemList((f-d)/i+1),k=0;k<j.length&&(a(this.owner.board.getObjectPos(b,g,h),j[k]),g+=i,g>e&&(g=c,h+=i),!(h>f));k++);},decodeCell:function(a){this.decodeObj(a,d.CELL,1,1,2*this.owner.board.qcols-1,2*this.owner.board.qrows-1)},decodeCross:function(a){this.decodeObj(a,d.CROSS,0,0,2*this.owner.board.qcols,2*this.owner.board.qrows)},decodeBorder:function(a){var b=this.owner,c=b.board;1===c.hasborder||"bosanowa"===b.pid||"fourcells"===b.pid&&0===this.filever?(this.decodeObj(a,d.BORDER,2,1,2*c.qcols-2,2*c.qrows-1),this.decodeObj(a,d.BORDER,1,2,2*c.qcols-1,2*c.qrows-2)):2===c.hasborder&&(this.currentType===d.FILE_PZPR?(this.decodeObj(a,d.BORDER,0,1,2*c.qcols,2*c.qrows-1),this.decodeObj(a,d.BORDER,1,0,2*c.qcols-1,2*c.qrows)):this.currentType===d.FILE_PBOX&&(this.decodeObj(a,d.BORDER,1,0,2*c.qcols-1,2*c.qrows),this.decodeObj(a,d.BORDER,0,1,2*c.qcols,2*c.qrows-1)))},encodeObj:function(a,b,c,d,e,f){for(var g=2,h=d;f>=h;h+=g){for(var i=c;e>=i;i+=g)this.datastr+=a(this.owner.board.getObjectPos(b,i,h));this.datastr+="\n"}},encodeCell:function(a){this.encodeObj(a,d.CELL,1,1,2*this.owner.board.qcols-1,2*this.owner.board.qrows-1)},encodeCross:function(a){this.encodeObj(a,d.CROSS,0,0,2*this.owner.board.qcols,2*this.owner.board.qrows)},encodeBorder:function(a){var b=this.owner,c=b.board;1===c.hasborder||"bosanowa"===b.pid?(this.encodeObj(a,d.BORDER,2,1,2*c.qcols-2,2*c.qrows-1),this.encodeObj(a,d.BORDER,1,2,2*c.qcols-1,2*c.qrows-2)):2===c.hasborder&&(this.currentType===d.FILE_PZPR?(this.encodeObj(a,d.BORDER,0,1,2*c.qcols,2*c.qrows-1),this.encodeObj(a,d.BORDER,1,0,2*c.qcols-1,2*c.qrows)):this.currentType===d.FILE_PBOX&&(this.encodeObj(a,d.BORDER,1,0,2*c.qcols-1,2*c.qrows),this.encodeObj(a,d.BORDER,0,1,2*c.qcols,2*c.qrows-1)))}}),pzpr.createPuzzleClass("AnsCheck",{initialize:function(){this.inCheck=!1,this.checkOnly=!1},failcode:void 0,check:function(a){var b=this.owner,c=b.board;return this.inCheck=!0,a?(this.checkOnly=!1,this.failcode=this.checkAns(),this.failcode&&(c.haserror=!0,b.redraw())):void 0===this.failcode&&(c.disableSetError(),this.checkOnly=!0,this.failcode=this.autocheck1st()||this.checkAns(),c.enableSetError()),this.inCheck=!1,this.failcode},checkAns:function(){return null},autocheck1st:function(){var a=this.owner.board;return!a.lines.enabled||a.linfo.enabled||!a.lines.isCenterLine&&!a.lines.borderAsLine||this.checkLineCount(1)?this.check1st():"lnDeadEnd"},check1st:function(){return null},resetCache:function(){this.failcode=void 0}}),pzpr.createPuzzleClass("FailCode",{getStr:function(a){a||(a="complete");var b="ja"===this.owner.getConfig("language")?0:1;return this[a][b]},complete:["正解です！","Complete!"],invalid:["不明なエラーです","Invalid Error"]}),function(){var a=pzpr.consts;pzpr.createPuzzleClass("Operation",{initialize:function(){this.manager=this.owner.opemgr},reqReset:!1,setData:function(a,b){this.old=a,this.num=b},decode:function(){return!1},toString:function(){return""},toJSON:function(){return this.toString()},undo:function(){this.exec(this.old)},redo:function(){this.exec(this.num)},exec:function(){}}),pzpr.createPuzzleClass("ObjectOperation:Operation",{group:"",property:"",STRGROUP:{C:"cell",X:"cross",B:"border",E:"excell"},STRPROP:{U:"ques",N:"qnum",Z:"qnum2",C:"qchar",M:"anum",D:"qdir",A:"qans",S:"qsub",K:"qcmp",L:"line"},setData:function(a,b,c,d){this.group=a.group,this.property=b,this.bx=a.bx,this.by=a.by,this.old=c,this.num=d},decode:function(a){return this.group=this.STRGROUP[a[0].charAt(0)],this.property=this.STRPROP[a[0].charAt(1)],this.group&&this.property?(this.bx=+a[1],this.by=+a[2],this.old=+a[3],this.num=+a[4],!0):!1},toString:function(){var a="";for(var b in this.STRGROUP)if(this.group==this.STRGROUP[b]){a+=b;break}for(var b in this.STRPROP)if(this.property==this.STRPROP[b]){a+=b;break}return[a,this.bx,this.by,this.old,this.num].join(",")},exec:function(b){var c=this.owner.board,d=c.getObjectPos(this.group,this.bx,this.by);if(this.group!==d.group)return!0;switch(d.setdata(this.property,b),d.draw(),this.property){case a.QCMP:c.cell.each(function(a){d===a.base&&a.draw()});break;case a.QSUB:break;default:this.owner.checker.resetCache()}}}),pzpr.createPuzzleClass("BoardAdjustOperation:Operation",{prefix:"AJ",reqReset:!0,setData:function(a){this.old=this.num=a},decode:function(a){return a[0]!==this.prefix?!1:(this.old=this.num=a[1],!0)},toString:function(){return[this.prefix,this.num].join(",")},undo:function(){var a=this.owner.board.exec.boardtype[this.old][0];this.exec(a)},redo:function(){var a=this.owner.board.exec.boardtype[this.num][1];this.exec(a)},exec:function(a){var b=this.owner,c=b.board,d={x1:0,y1:0,x2:2*c.qcols,y2:2*c.qrows};b.board.exec.expandreduce(a,d),b.redraw()}}),pzpr.createPuzzleClass("BoardFlipOperation:Operation",{prefix:"AT",reqReset:!0,area:{},setData:function(a,b){this.area=a,this.old=this.num=b},decode:function(a){return a[0]!==this.prefix?!1:(this.old=this.num=a[1],this.area.x1=+a[2],this.area.y1=+a[3],this.area.x2=+a[4],this.area.y2=+a[5],!0)},toString:function(){var a=this.area;return[this.prefix,this.num,a.x1,a.y1,a.x2,a.y2].join(",")},undo:function(){var b=this.area,c={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2},d=this.owner.board.exec.boardtype[this.old][0];if(d&a.TURN){var e=c.x1;c.x1=c.y1,c.y1=e}this.exec(d,c)},redo:function(){var a=this.area,b={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},c=this.owner.board.exec.boardtype[this.num][1];this.exec(c,b)},exec:function(a,b){var c=this.owner;c.board.exec.turnflip(a,b),c.redraw()}}),pzpr.createPuzzleClass("OperationManager",{initialize:function(){this.lastope,this.ope,this.position,this.broken=!1,this.initpos=0,this.disrec=0,this.disCombine=!1,this.forceRecord=!1,this.changeflag=!1,this.chainflag=!1,this.enableUndo=!1,this.enableRedo=!1,this.undoExec=!1,this.redoExec=!1,this.reqReset=!1},disableRecord:function(){this.disrec++},enableRecord:function(){this.disrec>0&&this.disrec--},isenableRecord:function(){return this.forceRecord||0===this.disrec},checkexec:function(){void 0!==this.ope&&(this.enableUndo=this.position>0,this.enableRedo=this.position<this.ope.length,this.owner.execListener("historymove"))},allerase:function(){this.lastope=null,this.ope=[],this.position=0,this.broken=!1,this.initpos=0,this.changeflag=!1,this.chainflag=!1,this.checkexec(),this.owner.checker.resetCache()},newOperation:function(){this.changeflag=!1,this.chainflag=!1},newChain:function(){this.chainflag=!1},isModified:function(){return this.isbroken||this.initpos<this.position},addOpe_common:function(b,c){if(this.isenableRecord()){if(this.enableRedo){this.position<this.initpos&&(this.broken=!0);
for(var d=this.ope.length-1;d>=this.position;d--)this.ope.pop();this.position=this.ope.length}if(void 0===c||c.call(this)){this.chainflag||(this.ope.push([]),this.position++,this.chainflag=!0);var e=b.call(this);this.ope[this.ope.length-1].push(e),this.lastope=e,this.changeflag=!0,e.property!==a.QSUB&&e.property!==a.QCMP&&this.owner.checker.resetCache(),this.checkexec()}}},addOpe_Object:function(b,c,d,e){d!==e&&this.addOpe_common(function(){var a=new this.owner.ObjectOperation;return a.setData(b,c,d,e),a},function(){var f=this.lastope;return this.disCombine||!f||!f.property||f.group!==b.group||f.property!==c||f.num!==d||f.bx!==b.bx||f.by!==b.by||c!==a.QNUM&&c!==a.QNUM2&&c!==a.QDIR&&c!==a.QCHAR&&c!==a.ANUM?!0:(this.changeflag=!0,f.num=e,this.owner.checker.resetCache(),this.owner.execListener("historychange"),!1)})},addOpe_BoardAdjust:function(a){this.addOpe_common(function(){var b=new this.owner.BoardAdjustOperation;return b.setData(a),b})},addOpe_BoardFlip:function(a,b){this.addOpe_common(function(){var c=new this.owner.BoardFlipOperation;return c.setData(a,b),c})},decodeLines:function(){this.allerase();for(var a=this.owner.fio.lineseek,b=[],c=!1;;){var d=this.owner.fio.readLine();if(void 0===d){this.owner.fio.lineseek=a;break}if(c){if(c&&(b.push(d),"}"===d))break}else"history:{"===d&&(c=!0,b=["{"])}if(b.length>0&&window.JSON)try{console.log(b.join(""));var e=b.join(""),f=JSON.parse(e);this.ope=[],this.initpos=this.position=f.current;for(var g=0,h=f.datas.length;h>g;g++){this.ope.push([]);for(var i=0,j=f.datas[g].length;j>i;i++){var k=this.decodeOpe(f.datas[g][i]);k&&(this.ope[this.ope.length-1].push(k),this.lastope=k)}}}catch(l){}this.checkexec()},decodeOpe:function(a){var b=this.owner,c=a.split(/,/),d=new b.ObjectOperation;return d.decode(c)?d:(d=new b.BoardAdjustOperation,d.decode(c)?d:(d=new b.BoardFlipOperation,d.decode(c)?d:null))},toString:function(){return window.JSON?(this.initpos=this.position,"\nhistory:"+JSON.stringify({type:"pzpr",version:.3,current:this.position,datas:this.ope},null,1)):""},undo:function(){if(!this.enableUndo)return!1;var a=this.ope[this.position-1];this.reqReset=this.checkReqReset(a),this.preproc(),this.undoExec=!0;for(var b=a.length-1;b>=0;b--)a[b]&&a[b].undo();return this.position--,this.undoExec=!1,this.postproc(),this.enableUndo},redo:function(){if(!this.enableRedo)return!1;var a=this.ope[this.position];this.reqReset=this.checkReqReset(a),this.preproc(),this.redoExec=!0;for(var b=0,c=a.length;c>b;b++)a[b]&&a[b].redo();return this.position++,this.redoExec=!1,this.postproc(),this.enableRedo},checkReqReset:function(a){for(var b=!1,c=0,d=a.length;d>c;c++)if(a[c].reqReset){b=!0;break}return b},preproc:function(){var a=this.owner,b=a.board;this.disableRecord(),a.painter.suspend(),b.haserror&&(b.errclear(),a.redraw()),this.reqReset&&b.disableInfo()},postproc:function(){var a=this.owner,b=a.board;this.reqReset&&(b.setposAll(),b.setminmax(),b.enableInfo(),b.resetInfo(),a.adjustCanvasSize()),a.painter.unsuspend(),this.enableRecord(),this.checkexec()}})}(),pzpr.extendPuzzleClass("Graphic",{drawBlackCells:function(){for(var a=this.vinc("cell_front","crispEdges"),b="c_fullb_",c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=this.getCellColor(e);if(f){if(a.fillStyle=f,this.vnop(b+e.id,this.FILL)){var g=(e.bx-1)*this.bw,h=(e.by-1)*this.bh;a.fillRect(g,h,this.cw+1,this.ch+1)}}else this.vhide(b+e.id)}this.isdrawBC=!0},getCellColor:function(a){if(1!==a.qans)return null;var b=a.error||a.qinfo;return 0===b?this.cellcolor:1===b?this.errcolor1:null},setCellColorFunc:function(a){switch(a){case"qnum":this.getCellColor=function(a){if(-1===a.qnum)return null;var b=a.error||a.qinfo;return 0===b?this.cellcolor:1===b?this.errcolor1:null}}},drawBGCells:function(){for(var a=this.vinc("cell_back","crispEdges"),b="c_full_",c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=this.getBGCellColor(e);if(f){if(a.fillStyle=f,this.vnop(b+e.id,this.FILL)){var g=(e.bx-1)*this.bw,h=(e.by-1)*this.bh;a.fillRect(g,h,this.cw,this.ch)}}else this.vhide(b+e.id)}},getBGCellColor:function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:null},setBGCellColorFunc:function(a){switch(a){case"error2":this.getBGCellColor=function(a){var b=a.error||a.qinfo;return 1===b?this.errbcolor1:2===b?this.errbcolor2:null};break;case"qans1":this.getBGCellColor=function(a){var b=a.error||a.qinfo;return 1===a.qans?1===b?this.errcolor1:this.cellcolor:1===b?this.errbcolor1:1===a.qsub&&"white"!==this.bcolor?this.bcolor:null};break;case"qans2":this.getBGCellColor=function(a){var b=a.error||a.qinfo;if(1===a.qans){if(0===b)return this.cellcolor;if(1===b)return this.errcolor1;if(2===b)return this.errcolor2}return 1===b?this.errbcolor1:1===a.qsub&&"white"!==this.bcolor?this.bcolor:null};break;case"qsub1":this.getBGCellColor=function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:1===a.qsub?this.bcolor:null};break;case"qsub2":this.getBGCellColor=function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:1===a.qsub?this.qsubcolor1:2===a.qsub?this.qsubcolor2:null},this.bcolor="silver";break;case"qsub3":this.getBGCellColor=function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:1===a.qsub?this.qsubcolor1:2===a.qsub?this.qsubcolor2:3===a.qsub?this.qsubcolor3:null};break;case"icebarn":this.getBGCellColor=function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:6===a.ques?this.icecolor:null}}},drawBGEXcells:function(){for(var a=this.vinc("excell_back","crispEdges"),b="ex_full_",c=this.range.excells,d=0;d<c.length;d++){var e=c[d],f=this.getBGEXcellColor(e);if(f){if(a.fillStyle=f,this.vnop(b+e.id,this.FILL)){var g=(e.bx-1)*this.bw,h=(e.by-1)*this.bh;a.fillRect(g+1,h+1,this.cw-1,this.ch-1)}}else this.vhide(b+e.id)}},getBGEXcellColor:function(a){return 1===a.error||1===a.qinfo?this.errbcolor1:null},drawDotCells:function(a){var b=this.vinc("cell_dot",a?"crispEdges":"auto"),c=Math.max(this.cw*(a?.075:.06),2),d="c_dot_";b.fillStyle=this.dotcolor;for(var e=this.range.cells,f=0;f<e.length;f++){var g=e[f];if(1===g.qsub){if(this.vnop(d+g.id,this.NONE)){var h=g.bx*this.bw,i=g.by*this.bh;a?b.fillRect(h-c,i-c,2*c,2*c):b.fillCircle(h,i,c)}}else this.vhide(d+g.id)}},drawCellArrows:function(){for(var a=this.vinc("cell_arrow","auto"),b=["c_arup_","c_ardn_","c_arlt_","c_arrt_"],c=.8*this.cw,e=Math.max(this.cw/18,2),f=.5*c,g=.5*e,h=.5*c-.3*c,i=Math.max(.2*c,5),j=this.range.cells,k=0;k<j.length;k++){var l=j[k],m=l.id,n=l.numberAsObject?l.getNum():l.qdir;if(this.vhide([b[0]+m,b[1]+m,b[2]+m,b[3]+m]),n>=1&&4>=n&&(a.fillStyle=-1!==l.qnum?this.fontcolor:this.fontAnscolor,this.vnop(b[n-1]+m,this.FILL))){var o=l.bx*this.bw,p=l.by*this.bh;switch(n){case d.UP:a.setOffsetLinePath(o,p,0,-f,-i,-h,-g,-h,-g,f,g,f,g,-h,i,-h,!0);break;case d.DN:a.setOffsetLinePath(o,p,0,f,-i,h,-g,h,-g,-f,g,-f,g,h,i,h,!0);break;case d.LT:a.setOffsetLinePath(o,p,-f,0,-h,-i,-h,-g,f,-g,f,g,-h,g,-h,i,!0);break;case d.RT:a.setOffsetLinePath(o,p,f,0,h,-i,h,-g,-f,-g,-f,g,h,g,h,i,!0)}a.fill()}}},drawSlashes:function(){var a=this.vinc("cell_slash","auto"),b=["c_sl1_","c_sl2_"];a.lineWidth=Math.max(this.cw/8,2);for(var c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=e.id;if(0!==e.qans){var g=e.error||e.qinfo;if(a.strokeStyle=1===g?this.errcolor1:2===g?this.errcolor2:this.cellcolor,31==e.qans){if(this.vnop(b[0]+f,this.STROKE)){var h=(e.bx-1)*this.bw,i=(e.by-1)*this.bh;a.setOffsetLinePath(h,i,0,0,this.cw,this.ch,!0),a.stroke()}}else this.vhide(b[0]+f);if(32==e.qans){if(this.vnop(b[1]+f,this.STROKE)){var h=(e.bx-1)*this.bw,i=(e.by-1)*this.bh;a.setOffsetLinePath(h,i,this.cw,0,0,this.ch,!0),a.stroke()}}else this.vhide(b[1]+f)}else this.vhide([b[0]+f,b[1]+f])}},drawNumbers:function(){for(var a=(this.vinc("cell_number","auto"),this.range.cells),b=0;b<a.length;b++)this.drawNumber1(a[b])},drawNumber1:function(a){var b=["cell",a.id].join("_"),c=a.getNum();if(this.owner.board.linfo.moveline&&this.owner.getConfig("dispmove")&&(c=a.base.getNum()),c>=0||!this.hideHatena&&-2===c){var d=c>=0?""+c:"?",e=10>c?.8:100>c?.7:.55,f=this.getCellNumberColor(a);this.dispnum(b,1,d,e,f,a.bx*this.bw,a.by*this.bh)}else this.hidenum(b)},getCellNumberColor:function(a){var b=this.fontcolor,c=this.owner;return a.ques>=1&&a.ques<=5||a.qans>=1&&a.qans<=5?b=this.fontBCellcolor:1===a.error||4===a.error||1===a.qinfo||4===a.qinfo?b=this.fontErrcolor:c.board.linfo.moveline&&c.getConfig("dispmove")&&c.mouse.mouseCell===a?b=this.movecolor:-1===a.qnum&&-1!==a.anum&&(b=this.fontAnscolor),b},drawArrowNumbers:function(){for(var a=this.vinc("cell_arrownumber","auto"),b=["c_ar1_","c_dt1_","c_dt2_","c_ar3_","c_dt3_","c_dt4_"],c=.7*this.cw,e=(this.cw-c)/2,f=Math.max(this.cw/24,1),g=f/2,h=this.range.cells,i=0;i<h.length;i++){var j=h[i],k=j.qnum,l=j.id;if(k>=0||!this.hideHatena&&-2===k){var m=(j.bx-1)*this.bw,n=(j.by-1)*this.bh,o=j.qdir,p=j.error||j.qinfo;a.fillStyle=1===j.qans?this.fontBCellcolor:1===p?this.fontErrcolor:this.fontcolor,o===d.UP||o===d.DN?(m+=this.cw-1.5*e-g,n+=e+1,this.vnop(b[0]+l,this.FILL)&&a.fillRect(m,n,f,c),m+=f/2,o===d.UP?this.vnop(b[1]+l,this.FILL)&&(a.setOffsetLinePath(m,n,0,0,-c/6,c/3,c/6,c/3,!0),a.fill()):this.vhide(b[1]+l),o===d.DN?this.vnop(b[2]+l,this.FILL)&&(a.setOffsetLinePath(m,n+c,0,0,-c/6,-c/3,c/6,-c/3,!0),a.fill()):this.vhide(b[2]+l)):this.vhide([b[0]+l,b[1]+l,b[2]+l]),o===d.LT||o===d.RT?(m+=e+1,n+=1.5*e-g,this.vnop(b[3]+l,this.FILL)&&a.fillRect(m,n,c,f),n+=f/2,o===d.LT?this.vnop(b[4]+l,this.FILL)&&(a.setOffsetLinePath(m,n,0,0,c/3,-c/6,c/3,c/6,!0),a.fill()):this.vhide(b[4]+l),o===d.RT?this.vnop(b[5]+l,this.FILL)&&(a.setOffsetLinePath(m+c,n,0,0,-c/3,-c/6,-c/3,c/6,!0),a.fill()):this.vhide(b[5]+l)):this.vhide([b[3]+l,b[4]+l,b[5]+l]);var q=k>=0?""+k:"?",r=10>k?.8:100>k?.7:.55,s=a.fillStyle,t=j.bx*this.bw,u=j.by*this.bh;o===d.UP||o===d.DN?(r*=.85,t-=.1*this.cw):(o===d.LT||o===d.RT)&&(r*=.85,u+=.1*this.ch),this.dispnum("cell_"+l,1,q,r,s,t,u)}else this.vhide([b[0]+l,b[1]+l,b[2]+l,b[3]+l,b[4]+l,b[5]+l]),this.hidenum("cell_"+l)}},drawHatenas:function(){for(var a=(this.vinc("cell_number","auto"),this.range.cells),b=0;b<a.length;b++){var c=a[b],d="cell_"+c.id;if(-2===c.ques||-2===c.qnum){var e=1===c.error||1===c.qinfo?this.fontErrcolor:this.fontcolor;this.dispnum(d,1,"?",.8,e,c.bx*this.bw,c.by*this.bh)}else this.hidenum(d)}},drawCrosses:function(){var a=this.vinc("cross_base","auto"),b=this.cw*this.crosssize+1,c="x_cp_";a.lineWidth=1;for(var d=this.range.crosses,e=0;e<d.length;e++){var f=d[e],g=f.id,h=["cross",g].join("_"),i=f.bx*this.bw,j=f.by*this.bh;-1!==f.qnum?(a.fillStyle=1===f.error||1===f.qinfo?this.errcolor1:"white",a.strokeStyle="black",this.vnop(c+g,this.FILL_STROKE)&&a.shapeCircle(i,j,b)):this.vhide([c+g]),f.qnum>=0?this.dispnum(h,1,""+f.qnum,.6,this.fontcolor,i,j):this.hidenum(h)}},drawCrossMarks:function(){for(var a=this.vinc("cross_mark","auto"),b=this.cw*this.crosssize,c="x_cm_",d=this.range.crosses,e=0;e<d.length;e++){var f=d[e];if(1===f.qnum){if(a.fillStyle=1===f.error||1===f.qinfo?this.errcolor1:this.cellcolor,this.vnop(c+f.id,this.FILL)){var g=f.bx*this.bw,h=f.by*this.bh;a.fillCircle(g,h,b)}}else this.vhide(c+f.id)}},drawBorders:function(){this.vinc("border","crispEdges");this.drawBorders_common("b_bd")},drawBorders_common:function(a){for(var b=this.context,c=this.range.borders,d=0;d<c.length;d++){var e=c[d],f=this.getBorderColor(e);if(f){if(b.fillStyle=f,this.vnop(a+e.id,this.FILL)){var g=this.lw+this.addlw,h=this.lm,i=e.bx*this.bw,j=e.by*this.bh;e.isVert()?b.fillRect(i-h,j-this.bh-h,g,this.ch+g):b.fillRect(i-this.bw-h,j-h,this.cw+g,g)}}else this.vhide(a+e.id)}this.isdrawBD=!0},getBorderColor:function(a){return a.isBorder()?this.borderQuescolor:null},setBorderColorFunc:function(a){switch(a){case"qans":this.getBorderColor=function(a){var b=a.error||a.qinfo;return a.isBorder()?1===b?this.errcolor1:-1===b?this.errborderbgcolor:this.borderQanscolor:null};break;case"ice":this.getBorderColor=function(a){var b=a.sidecell[0],c=a.sidecell[1];return!b.isnull&&!c.isnull&&b.ice()^c.ice()?this.cellcolor:null}}},drawQansBorders:function(){this.vinc("border_answer","crispEdges");this.getBorderColor=this.getQansBorderColor,this.drawBorders_common("b_bdans")},drawQuesBorders:function(){this.vinc("border_question","crispEdges");this.getBorderColor=this.getQuesBorderColor,this.drawBorders_common("b_bdques")},getQuesBorderColor:function(a){return 1===a.ques?this.borderQuescolor:null},getQansBorderColor:function(a){return 1===a.qans?this.borderQanscolor:null},drawBorderQsubs:function(){var a=this.vinc("border_qsub","crispEdges"),b=.15*this.cw,c="b_qsub1_";a.fillStyle=this.borderQsubcolor;for(var d=this.range.borders,e=0;e<d.length;e++){var f=d[e];if(1===f.qsub){if(this.vnop(c+f.id,this.NONE)){var g=f.bx*this.bw,h=f.by*this.bh;f.isHorz()?a.fillRect(g,h-this.bh+b,1,this.ch-2*b):a.fillRect(g-this.bw+b,h,this.cw-2*b,1)}}else this.vhide(c+f.id)}},drawBoxBorders:function(a){var b=this.vinc("boxborder","crispEdges"),c=this.lw,d=this.lm,e=this.cw,f=this.ch;b.fillStyle=this.bbcolor;for(var g=this.range.cells,h=0;h<g.length;h++){for(var i=g[h],j=[],k=0;12>k;k++)j[k]=["c_bb",k,i.id].join("_");if(1===i.qans){var l=(i.bx-1)*this.bw,m=(i.by-1)*this.bh,n=l+d+1,o=l+e-d-1,p=m+d+1,q=m+f-d-1,r=i.by>2,s=i.by<2*this.owner.board.qrows-2,t=i.bx>2,u=i.bx<2*this.owner.board.qcols-2,v=!r||1===i.ub().ques,w=!s||1===i.db().ques,x=!t||1===i.lb().ques,y=!u||1===i.rb().ques,z=!r||!t||1===i.relbd(-2,-1).ques||1===i.relbd(-1,-2).ques,A=!r||!u||1===i.relbd(2,-1).ques||1===i.relbd(1,-2).ques,B=!s||!t||1===i.relbd(-2,1).ques||1===i.relbd(-1,2).ques,C=!s||!u||1===i.relbd(2,1).ques||1===i.relbd(1,2).ques;v?this.vnop(j[0],this.NONE)&&b.fillRect(n,p,e-c,1):this.vhide(j[0]),w?this.vnop(j[1],this.NONE)&&b.fillRect(n,q,e-c,1):this.vhide(j[1]),x?this.vnop(j[2],this.NONE)&&b.fillRect(n,p,1,f-c):this.vhide(j[2]),y?this.vnop(j[3],this.NONE)&&b.fillRect(o,p,1,f-c):this.vhide(j[3]),a?(v||!z&&!x?this.vhide(j[4]):this.vnop(j[4],this.NONE)&&b.fillRect(n,m-d,1,c+1),v||!A&&!y?this.vhide(j[5]):this.vnop(j[5],this.NONE)&&b.fillRect(o,m-d,1,c+1),x||!z&&!v?this.vhide(j[6]):this.vnop(j[6],this.NONE)&&b.fillRect(l-d,p,c+1,1),x||!B&&!w?this.vhide(j[7]):this.vnop(j[7],this.NONE)&&b.fillRect(l-d,q,c+1,1)):(v||!z&&!x?this.vhide(j[4]):this.vnop(j[4],this.NONE)&&b.fillRect(n,m,1,d+1),v||!A&&!y?this.vhide(j[5]):this.vnop(j[5],this.NONE)&&b.fillRect(o,m,1,d+1),w||!B&&!x?this.vhide(j[6]):this.vnop(j[6],this.NONE)&&b.fillRect(n,q,1,d+1),w||!C&&!y?this.vhide(j[7]):this.vnop(j[7],this.NONE)&&b.fillRect(o,q,1,d+1),x||!z&&!v?this.vhide(j[8]):this.vnop(j[8],this.NONE)&&b.fillRect(l,p,d+1,1),x||!B&&!w?this.vhide(j[9]):this.vnop(j[9],this.NONE)&&b.fillRect(l,q,d+1,1),y||!A&&!v?this.vhide(j[10]):this.vnop(j[10],this.NONE)&&b.fillRect(o,p,d+1,1),y||!C&&!w?this.vhide(j[11]):this.vnop(j[11],this.NONE)&&b.fillRect(o,q,d+1,1))}else this.vhide(j)}},drawLines:function(){for(var a=this.vinc("line","crispEdges"),b=this.lw+this.addlw,c=this.lm,d="b_line_",e=this.range.borders,f=0;f<e.length;f++){var g=e[f],h=this.getLineColor(g);if(h){if(a.fillStyle=h,this.vnop(d+g.id,this.FILL)){var i=this.owner.board.lines.isCenterLine^g.isVert(),j=g.bx*this.bw,k=g.by*this.bh;i?a.fillRect(j-c,k-this.bh-c,b,this.ch+b):a.fillRect(j-this.bw-c,k-c,this.cw+b,b)}}else this.vhide(d+g.id)}this.addlw=0},getLineColor:function(a){if(this.addlw=0,a.isLine()){var b=a.error||a.qinfo,c=this.owner;return 1===b?(this.context.use.canvas&&(this.addlw=1),this.errlinecolor):-1===b?this.errlinebgcolor:c.board.linfo.moveline&&c.getConfig("dispmove")?"silver":c.flags.irowake&&c.getConfig("irowake")&&a.color?a.color:this.linecolor}return null},drawTip:function(){for(var a=this.vinc("cell_linetip","auto"),b=.3*this.cw,c=.05*this.cw,d="c_tip_",e=this.range.cells,f=0;f<e.length;f++){var g=e[f];if(this.vdel([d+g.id]),1===g.lcnt()&&-1===g.qnum&&this.owner.board.linfo.moveline&&!this.owner.getConfig("dispmove")){var h=0,i=null;if(g.ub().isLine())h=2,i=g.ub();else if(g.db().isLine())h=1,i=g.db();else if(g.lb().isLine())h=4,i=g.lb();else{if(!g.rb().isLine())continue;h=3,i=g.rb()}a.lineWidth=this.lw;var j=i.error||i.qinfo;if(1===j?(a.strokeStyle=this.errlinecolor,a.lineWidth=a.lineWidth+1):a.strokeStyle=-1===j?this.errlinebgcolor:this.linecolor,this.vnop(d+g.id,this.STROKE)){var k=g.bx*this.bw+1,l=g.by*this.bh+1;1===h?a.setOffsetLinePath(k,l,-b,b,0,-c,b,b,!1):2===h?a.setOffsetLinePath(k,l,-b,-b,0,c,b,-b,!1):3===h?a.setOffsetLinePath(k,l,b,-b,-c,0,b,b,!1):4===h&&a.setOffsetLinePath(k,l,-b,-b,c,0,-b,b,!1),a.stroke()}}}},drawPekes:function(){var a=this.vinc("border_peke","auto"),b=.15*this.cw+1;4>b&&(b=4);var c="b_peke_";a.fillStyle="white",a.strokeStyle=this.pekecolor,a.lineWidth=1+this.cw/40|0;for(var d=this.range.borders,e=0;e<d.length;e++){var f=d[e];2===f.qsub?this.vnop(c+f.id,this.NONE)&&a.strokeCross(f.bx*this.bw,f.by*this.bh,b-1):this.vhide(c+f.id)}},drawBaseMarks:function(){for(var a=this.vinc("cross_mark","auto"),b="x_cm_",c=this.range.crosses,d=0;d<c.length;d++){var e=c[d];if(a.fillStyle=this.cellcolor,this.vnop(b+e.id,this.NONE)){var f=e.bx*this.bw,g=e.by*this.bh;a.fillCircle(f,g,1.2*this.lw/2)}}},drawTriangle:function(){for(var a=this.vinc("cell_triangle","auto"),b=["c_tri2_","c_tri3_","c_tri4_","c_tri5_"],c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=e.id,g=0!==e.ques?e.ques:e.qans;if(this.vhide([b[0]+f,b[1]+f,b[2]+f,b[3]+f]),g>=2&&5>=g){a.fillStyle=this.getTriangleColor(e);var h=(e.bx-1)*this.bw,i=(e.by-1)*this.bh;this.drawTriangle1(h,i,g,b[g-2]+f)}}},getTriangleColor:function(){return this.cellcolor},drawTriangle1:function(a,b,c,d){var e=this.context;if(this.vnop(d,this.FILL)){var f=this.cw,g=this.ch,h="reflect"===this.owner.pid?1:0;switch(c){case 2:e.setOffsetLinePath(a,b,h,h,h,g+1,f+1,g+1,!0);break;case 3:e.setOffsetLinePath(a,b,f+1,h,h,g+1,f+1,g+1,!0);break;case 4:e.setOffsetLinePath(a,b,h,h,f+1,h,f+1,g+1,!0);break;case 5:e.setOffsetLinePath(a,b,h,h,f+1,h,h,g+1,!0)}e.fill()}},drawMBs:function(){var a=this.vinc("cell_mb","auto");a.strokeStyle=this.mbcolor,a.lineWidth=1;for(var b=.35*this.cw,c=["c_MB1_","c_MB2a_"],d=this.range.cells,e=0;e<d.length;e++){var f=d[e],g=f.id,h=f.bx*this.bw,i=f.by*this.bh;1===f.qsub?this.vnop(c[0]+g,this.NONE)&&a.strokeCircle(h,i,b):this.vhide(c[0]+g),2===f.qsub?this.vnop(c[1]+g,this.NONE)&&a.strokeCross(h,i,b):this.vhide(c[1]+g)}},drawCircles:function(){var a=this.vinc("cell_circle","auto"),b=this.circleratio,c=this.cw*(b[0]+b[1])/2,d=this.cw*b[0];a.lineWidth=Math.max(this.cw*(b[0]-b[1]),1),"loopsp"===this.owner.pid&&(d-=.1*this.cw);for(var e=["c_cira_","c_cirb_"],f=this.range.cells,g=0;g<f.length;g++){var h=f[g],i=h.id,j=h.bx*this.bw,k=h.by*this.bh,l=this.getCircleFillColor(h);l?(a.fillStyle=l,this.vnop(e[1]+i,this.FILL)&&a.fillCircle(j,k,d)):this.vhide(e[1]+i),l=this.getCircleStrokeColor(h),l?(a.strokeStyle=l,this.vnop(e[0]+i,this.STROKE)&&a.strokeCircle(j,k,c)):this.vhide(e[0]+i)}},getCircleStrokeColor:function(a){var b=this.owner,c=b.board,d=a.error||a.qinfo,e=c.linfo.moveline&&b.getConfig("dispmove"),f=(e?a.base:a).qnum;return-1!==f?e&&b.mouse.mouseCell===a?this.movecolor:1===d||4===d?this.errcolor1:this.cellcolor:null},getCircleFillColor:function(a){var b=this.owner.board,c=a.error||a.qinfo,d=b.linfo.moveline&&this.owner.getConfig("dispmove"),e=(d?a.base:a).qnum;return-1!==e?1===c||4===c?this.errbcolor1:this.circledcolor:null},drawDepartures:function(){for(var a=this.vinc("cell_depart","auto"),b=.15*this.cw,c="c_dcir_",d=this.owner.board.linfo.moveline&&this.owner.getConfig("dispmove"),e=this.range.cells,f=0;f<e.length;f++){var g=e[f],h=g.id,i=g.bx*this.bw,j=g.by*this.bh;d&&g.isDeparture()?(a.fillStyle="silver",this.vnop(c+h,this.FILL)&&a.fillCircle(i,j,b)):this.vhide(c+h)}},drawLineParts:function(){for(var a=this.vinc("cell_lineparts","crispEdges"),b=this.lw,c=this.lm,d=this.bw,e=this.bh,f=this.bh+this.lm,g=this.bw+this.lm,h=["c_lp1_","c_lp2_","c_lp3_","c_lp4_"],i=this.range.cells,j=0;j<i.length;j++){var k=i[j],l=k.id,m=k.ques;if(this.vhide([h[0]+l,h[1]+l,h[2]+l,h[3]+l]),m>=11&&17>=m){var n=k.bx*this.bw,o=k.by*this.bh;a.fillStyle=this.borderQuescolor;var p={11:15,12:3,13:12,14:9,15:5,16:6,17:10}[m];1&p&&this.vnop(h[0]+l,this.NONE)&&a.fillRect(n-c,o-e,b,f),2&p&&this.vnop(h[1]+l,this.NONE)&&a.fillRect(n-c,o-c,b,f),4&p&&this.vnop(h[2]+l,this.NONE)&&a.fillRect(n-d,o-c,g,b),8&p&&this.vnop(h[3]+l,this.NONE)&&a.fillRect(n-c,o-c,g,b)}}},drawQues51:function(){this.drawEXCellGrid(),this.drawSlash51Cells(),this.drawSlash51EXcells(),this.drawTargetTriangle()},drawSlash51Cells:function(){var a=this.vinc("cell_ques51","crispEdges"),b="c_slash51_";a.strokeStyle=this.cellcolor,a.lineWidth=1;for(var c=this.range.cells,d=0;d<c.length;d++){var e=c[d],f=(e.bx-1)*this.bw,g=(e.by-1)*this.bh;51===e.ques?this.vnop(b+e.id,this.NONE)&&a.strokeLine(f+1,g+1,f+this.cw,g+this.ch):this.vhide(b+e.id)}},drawSlash51EXcells:function(){var a=this.vinc("excell_ques51","crispEdges"),b="ex_slash51_";a.strokeStyle=this.cellcolor,a.lineWidth=1;for(var c=this.range.excells,d=0;d<c.length;d++){var e=c[d],f=(e.bx-1)*this.bw,g=(e.by-1)*this.bh;this.vnop(b+e.id,this.NONE)&&a.strokeLine(f+1,g+1,f+this.cw,g+this.ch)}},drawEXCellGrid:function(){var a=this.vinc("grid_excell","crispEdges");a.fillStyle=this.cellcolor;for(var b=["ex_bdx_","ex_bdy_"],c=this.range.excells,d=0;d<c.length;d++){var e=c[d],f=e.id,g=(e.bx-1)*this.bw,h=(e.by-1)*this.bh;-1===e.by&&e.bx<this.owner.board.maxbx&&this.vnop(b[0]+f,this.NONE)&&a.fillRect(g+this.cw,h,1,this.ch),-1===e.bx&&e.by<this.owner.board.maxby&&this.vnop(b[1]+f,this.NONE)&&a.fillRect(g,h+this.ch,this.cw,1)}},drawNumbersOn51:function(){for(var a=(this.vinc("cell_number51","auto"),this.range),b=1|a.x1;b<=a.x2;b+=2)for(var c=1|a.y1;c<=a.y2;c+=2){var d=this.owner.board.getobj(b,c);d.isnull||this.drawNumbersOn51_1(d)}},drawNumbersOn51_1:function(a){var b,c,d,e,f=[[a.group,a.id,"ques51","rt"].join("_"),[a.group,a.id,"ques51","dn"].join("_")];if(a.isexcell||51===a.ques)for(var g=0;2>g;g++)if(0===g?(b=a.qnum,c=a.by,d=a.relcell(2,0),e=4):1===g&&(b=a.qnum2,c=a.bx,d=a.relcell(0,2),e=2),-1===b||-1===c||d.isnull||d.is51cell())this.hidenum(f[g]);else{var h=1===a.error||1===a.qinfo?this.fontErrcolor:this.fontcolor,i=b>=0?""+b:"",j=a.bx*this.bw,k=a.by*this.bh;this.dispnum(f[g],e,i,.45,h,j,k)}else this.hidenum(f[0]),this.hidenum(f[1])},drawTarget:function(){this.drawCursor(!0,this.owner.editmode)},drawCursor:function(a,b){var c=this.vinc("target_cursor","crispEdges");if(b!==!1&&this.owner.getConfig("cursor")&&!this.outputImage){var d=this.range,e=this.owner.cursor;if(e.pos.bx<d.x1-1||d.x2+1<e.pos.bx)return;if(e.pos.by<d.y1-1||d.y2+1<e.pos.by)return;var f,g,h=e.pos.bx*this.bw+.5,i=e.pos.by*this.bh+.5;a!==!1?(f=0|Math.max(this.cw/16,2),g=this.bw-.5):(f=0|Math.max(this.cw/24,1),g=.56*this.bw),this.vdel(["ti1_","ti2_","ti3_","ti4_"]),c.fillStyle=this.owner.editmode?this.targetColor1:this.targetColor3,this.vnop("ti1_",this.FILL)&&c.fillRect(h-g,i-g,2*g,f),this.vnop("ti2_",this.FILL)&&c.fillRect(h-g,i-g,f,2*g),this.vnop("ti3_",this.FILL)&&c.fillRect(h-g,i+g-f,2*g,f),this.vnop("ti4_",this.FILL)&&c.fillRect(h+g-f,i-g,f,2*g)}else this.vhide(["ti1_","ti2_","ti3_","ti4_"])},drawTargetTriangle:function(){var a=this.vinc("target_triangle","auto"),b="target_triangle";if(this.vdel([b]),!this.owner.playmode){var c=this.range,d=this.owner.cursor;if(!(d.pos.bx<c.x1||c.x2<d.pos.bx||d.pos.by<c.y1||c.y2<d.pos.by)){var e=d.detectTarget(d.getOBJ());0!==e&&(a.fillStyle=this.ttcolor,this.drawTriangle1((d.pos.bx>>1)*this.cw,(d.pos.by>>1)*this.ch,2===e?4:2,b))}}},drawDashedCenterLines:function(){var a=this.vinc("centerline","crispEdges"),b=this.owner.board,c=this.range.x1,d=this.range.y1,e=this.range.x2,f=this.range.y2;c<b.minbx+1&&(c=b.minbx+1),e>b.maxbx-1&&(e=b.maxbx-1),d<b.minby+1&&(d=b.minby+1),f>b.maxby-1&&(f=b.maxby-1),c-=1&~c,d-=1&~d,e+=1&~e,f+=1&~f;var g=0|Math.max(this.cw/(this.cw/10+3),1),h=this.cw/(2*g);a.lineWidth=1,a.strokeStyle=this.gridcolor;for(var i=c;e>=i;i+=2)if(this.vnop("cliney_"+i,this.NONE)){var j=i*this.bw+.5,k=d*this.bh,l=f*this.bh;a.strokeDashedLine(j,k,j,l,[h])}for(var i=d;f>=i;i+=2)if(this.vnop("clinex_"+i,this.NONE)){var m=i*this.bh+.5,n=c*this.bw,o=e*this.bw;a.strokeDashedLine(n,m,o,m,[h])}},drawGrid:function(a,b){var c=this.vinc("grid","crispEdges"),d=this.owner.board,e=this.range.x1,f=this.range.y1,g=this.range.x2,h=this.range.y2;0>e&&(e=0),g>2*d.qcols&&(g=2*d.qcols),0>f&&(f=0),h>2*d.qrows&&(h=2*d.qrows),e-=1&e,f-=1&f;var i=2!==d.hasborder&&a!==!1?2:0,j=Math.max(e,0+i),k=Math.min(g,2*d.qcols-i),l=Math.max(f,0+i),m=Math.min(h,2*d.qrows-i);if(b!==!1){c.fillStyle=this.gridcolor;for(var n=j;k>=n;n+=2)this.vnop("bdy_"+n,this.NONE)&&c.fillRect(n*this.bw,f*this.bh,1,(h-f)*this.bh+1);for(var n=l;m>=n;n+=2)this.vnop("bdx_"+n,this.NONE)&&c.fillRect(e*this.bw,n*this.bh,(g-e)*this.bw+1,1)}else if(!c.use.canvas){for(var n=j;k>=n;n+=2)this.vhide("bdy_"+n);for(var n=l;m>=n;n+=2)this.vhide("bdx_"+n)}},drawDashedGrid:function(a){var b=this.vinc("grid","crispEdges"),c=this.owner.board,d=this.range.x1,e=this.range.y1,f=this.range.x2,g=this.range.y2;d<c.minbx&&(d=c.minbx),f>c.maxbx&&(f=c.maxbx),e<c.minby&&(e=c.minby),g>c.maxby&&(g=c.maxby),d-=1&d,e-=1&e,f+=1&f,g+=1&g;var h=0|Math.max(this.cw/(this.cw/10+3),1),i=this.cw/(2*h),j=a!==!1?2:0,k=Math.max(d,c.minbx+j),l=Math.min(f,c.maxbx-j),m=Math.max(e,c.minby+j),n=Math.min(g,c.maxby-j);b.lineWidth=1,b.strokeStyle=this.gridcolor;for(var o=k;l>=o;o+=2)if(this.vnop("bdy_"+o,this.NONE)){var p=o*this.bw+.5,q=e*this.bh,r=g*this.bh;b.strokeDashedLine(p,q,p,r,[i])}for(var o=m;n>=o;o+=2)if(this.vnop("bdx_"+o,this.NONE)){var s=o*this.bh+.5,t=d*this.bw,u=f*this.bw;b.strokeDashedLine(t,s,u,s,[i])}},drawChassis:function(){var a=this.vinc("chassis","crispEdges"),b=this.owner.board,c=this.range.x1,d=this.range.y1,e=this.range.x2,f=this.range.y2;0>c&&(c=0),e>2*b.qcols&&(e=2*b.qcols),0>d&&(d=0),f>2*b.qrows&&(f=2*b.qrows);var g="bosanowa"!==this.owner.pid?this.lw:1,h=this.bw,i=this.bh,j=b.qcols*this.cw,k=b.qrows*this.ch;a.fillStyle="black",a.use.canvas?(0===c&&a.fillRect(-g+1,d*i-g+1,g,(f-d)*i+2*g-2),e===2*b.qcols&&a.fillRect(j,d*i-g+1,g,(f-d)*i+2*g-2),0===d&&a.fillRect(c*h-g+1,-g+1,(e-c)*h+2*g-2,g),f===2*b.qrows&&a.fillRect(c*h-g+1,k,(e-c)*h+2*g-2,g)):(this.vnop("chs1_",this.NONE)&&a.fillRect(-g+1,-g+1,g,k+2*g-2),this.vnop("chs2_",this.NONE)&&a.fillRect(j,-g+1,g,k+2*g-2),this.vnop("chs3_",this.NONE)&&a.fillRect(-g+1,-g+1,j+2*g-2,g),this.vnop("chs4_",this.NONE)&&a.fillRect(-g+1,k,j+2*g-2,g))},drawChassis_ex1:function(a){var b=this.vinc("chassis_ex1","crispEdges"),c=this.owner.board,d=this.range.x1,e=this.range.y1,f=this.range.x2,g=this.range.y2;0>=d&&(d=c.minbx),f>c.maxbx&&(f=c.maxbx),0>=e&&(e=c.minby),g>c.maxby&&(g=c.maxby);var h=this.lw,i=this.lm,j=this.bw,k=this.bh,l=c.qcols*this.cw,m=c.qrows*this.ch;if(b.fillStyle="black",b.use.canvas?(d===c.minbx&&b.fillRect(-this.cw-h+1,e*k-h+1,h,(g-e)*k+2*h-2),f===c.maxbx&&b.fillRect(l,e*k-h+1,h,(g-e)*k+2*h-2),e===c.minby&&b.fillRect(d*j-h+1,-this.ch-h+1,(f-d)*j+2*h-2,h),g===c.maxby&&b.fillRect(d*j-h+1,m,(f-d)*j+2*h-2,h)):(this.vnop("chsex1_1_",this.NONE)&&b.fillRect(-this.cw-h+1,-this.ch-h+1,h,m+this.ch+2*h-2),this.vnop("chsex1_2_",this.NONE)&&b.fillRect(l,-this.ch-h+1,h,m+this.ch+2*h-2),this.vnop("chsex1_3_",this.NONE)&&b.fillRect(-this.cw-h+1,-this.ch-h+1,l+this.cw+2*h-2,h),this.vnop("chsex1_4_",this.NONE)&&b.fillRect(-this.cw-h+1,m,l+this.cw+2*h-2,h)),a)b.use.canvas?(0>=d&&b.fillRect(-h+1,e*k-h+1,h,(g-e)*k+h-1),0>=e&&b.fillRect(d*j-h+1,-h+1,(f-d)*j+h-1,h)):(this.vnop("chs1_",this.NONE)&&b.fillRect(-h+1,-h+1,h,m+h-1),this.vnop("chs2_",this.NONE)&&b.fillRect(-h+1,-h+1,l+h-1,h));else{b.use.canvas?(0>=d&&b.fillRect(0,e*k,1,(g-e)*k),0>=e&&b.fillRect(d*j,0,(f-d)*j,1)):(this.vnop("chs1_",this.NONE)&&b.fillRect(0,0,1,m),this.vnop("chs2_",this.NONE)&&b.fillRect(0,0,l,1));for(var n=["chs1_sub_","chs2_sub_"],o=this.range.cells,p=0;p<o.length;p++){var q=o[p],r=(q.bx-1)*this.bw,s=(q.by-1)*this.bh;1===q.bx&&(51!==q.ques?this.vnop(n[0]+q.by,this.NONE)&&b.fillRect(-i,s-i,h,this.ch+h):this.vhide([n[0]+q.by])),1===q.by&&(51!==q.ques?this.vnop(n[1]+q.bx,this.NONE)&&b.fillRect(r-i,-i,this.cw+h,h):this.vhide([n[1]+q.bx]))}}},dispnum:function(a,b,c,d,e,f,g){var h=this.context,i=this.cw*d*this.fontsizeratio|0,j=1==this.owner.getConfig("font")?"sans-serif":"serif";switch(h.font=(this.boldreq?"bold ":"")+i+"px "+j,h.fillStyle=e,b){case 1:h.textAlign="center";break;case 2:case 5:h.textAlign="left",f+=-this.bw+3;break;case 3:case 4:h.textAlign="right",f+=this.bw-1}switch(b){case 1:h.textBaseline="middle";break;case 4:case 5:h.textBaseline="top",g+=-this.bh+1;break;case 2:case 3:h.textBaseline="alphabetic",g+=this.bh-2}!h.use.vml&&!h.use.sl||1!==b&&4!==b&&5!==b||g++,h.use.vml&&(g-=.2*i);var k="text_"+a;h.use.vml?(h.elements[k]&&(this.hidenum(a),h.target.removeChild(h.elements[k].parentNode),h.elements[k]=null),h.vid=k):this.vshow(k),h.fillText(c,f,g)},hidenum:function(a){this.vhide(["text_"+a])}}),pzpr.extendPuzzleClass("KeyEvent",{key_inputcross:function(a){var b=this.cursor.getTXC(),c=b.nummaxfunc(),d=-1;if(a>="0"&&"9">=a){var e=parseInt(a),f=b.getQnum();if((0>=f||10*f+e>c)&&(f=0),d=10*f+e,d>c)return}else if("-"===a)b.setQnum(-2!==b.getQnum()?-2:-1);else{if(" "!==a)return;b.setQnum(-1)}b.setQnum(d),b.draw()},key_inputqnum:function(a){var b=this.cursor.getTCC(),c=b,d=this.owner,e=d.board;if(d.editmode&&e.rooms.hastop)c=b=e.rooms.getTopOfRoomByCell(b);else if(e.linfo.moveline&&d.getConfig("dispmove"))if(b.isDestination())b=b.base;else if(b.lcnt()>0)return;this.key_inputqnum_main(b,a)&&(this.prev=b,e.linfo.moveline&&d.getConfig("dispmove")&&b.noNum()&&e.linfo.eraseLineByCell(b),c.draw())},key_inputqnum_main:function(a,b){var c=a.nummaxfunc(),d=a.numminfunc(),e=-1;if(b>="0"&&"9">=b){var f=parseInt(b),g=a.getNum();if((0>=g||10*g+f>c||this.prev!==a)&&(g=0),e=10*g+f,e>c||d>0&&0===e)return!1}else if("-"===b)e=this.owner.editmode&&!a.disInputHatena?-2:-1;else if(" "===b)e=-1;else if("s1"===b)e=-2;else{if("s2"!==b)return!1;e=-3}return a.setNum(e),!0},key_inputdirec:function(a){if(!this.isSHIFT)return!1;var b=this.cursor.getTCC(),c=this.owner.pid;if(("firefly"===c||"snakes"===c||"yajikazu"===c||"yajirin"===c)&&-1===b.getQnum())return!1;var e=!0;switch(a){case this.KEYUP:b.setQdir(b.getQdir()!==d.UP?d.UP:0);break;case this.KEYDN:b.setQdir(b.getQdir()!==d.DN?d.DN:0);break;case this.KEYLT:b.setQdir(b.getQdir()!==d.LT?d.LT:0);break;case this.KEYRT:b.setQdir(b.getQdir()!==d.RT?d.RT:0);break;default:e=!1}return e&&(this.cursor.getTCP().draw(),this.stopEvent()),e},inputnumber51:function(a,b){var c=this.cursor;if(!c.chtarget(a)){var d=c.getOBJ(),e=c.detectTarget(d);if((0===e||d.iscell&&d.is51cell())&&"q"===a&&!d.isnull)return d.is51cell()?d.remove51cell():d.set51cell(),void c.getTCP().drawaround();if(0!=e){var f=this.owner.Cell.prototype[2===e?"qnum":"qnum2"],g=b[e],h=f;if(a>="0"&&"9">=a){var i=parseInt(a),j=this.getnum51(d,e);if((0>=j||10*j+i>g||this.prev!==(d.iscell?d:null))&&(j=0),h=10*j+i,h>g)return}else{if("-"!=a&&" "!=a)return;h=f}this.setnum51(d,e,h),this.prev=d.iscell?d:null,c.getTCP().draw()}}},setnum51:function(a,b,c){2==b?a.setQnum(c):a.setQnum2(c)},getnum51:function(a,b){return 2==b?a.getQnum():a.getQnum2()}}),pzpr.extendPuzzleClass("MouseEvent",{inputcell:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell&&(null===this.inputData&&this.decIC(a),this.mouseCell=a,!a.numberIsWhite||-1===a.getQnum()||1!==this.inputData&&(2!==this.inputData||"white"!==this.owner.painter.bcolor))){if(this.RBBlackCell&&1===this.inputData){this.firstCell.isnull&&(this.firstCell=a);var b=this.firstCell;if((2&b.bx^2&b.by)!==(2&a.bx^2&a.by))return}(1==this.inputData?a.setBlack:a.setWhite).call(a),a.setQsub(2===this.inputData?1:0),a.draw()}},decIC:function(a){1==this.owner.getConfig("use")?this.btn.Left?this.inputData=a.isWhite()?1:0:this.btn.Right&&(this.inputData=1!==a.getQsub()?2:0):2==this.owner.getConfig("use")&&(a.numberIsWhite&&-1!==a.getQnum()?this.inputData=1!==a.getQsub()?2:0:this.btn.Left?this.inputData=a.isBlack()?2:1===a.getQsub()?0:1:this.btn.Right&&(this.inputData=a.isBlack()?0:1===a.getQsub()?1:2))},inputqnum:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(a!==this.cursor.getTCC()?this.setcursor(a):this.inputqnum_main(a),this.mouseCell=a)
},inputqnum_main:function(a){var b=a,c=this.owner,d=c.board;if(c.editmode&&d.rooms.hastop)b=a=d.rooms.getTopOfRoomByCell(a);else if(d.linfo.moveline&&c.getConfig("dispmove"))if(a.isDestination())a=a.base;else if(a.lcnt()>0)return;var e=0;if(c.editmode?e=-1:a.numberWithMB?e=2:a.numberAsObject&&(e=1),"roma"===c.pid&&c.playmode&&(e=0),!c.playmode||a.qnum===c.Cell.prototype.qnum){var f=a.nummaxfunc(),g=a.numminfunc(),h=a.getNum(),i=c.editmode?0:a.getQsub(),j=-1,k=c.editmode&&!a.disInputHatena;this.btn.Left?j=h>=f?e>=1?-2:-1:1===i?e>=2?-3:-1:2===i?-1:-1===h?k?-2:g:g>h?g:h+1:this.btn.Right&&(j=1===i?f:2===i?-2:-1===h?1===e?-2:2===e?-3:f:h>f?f:g>=h?k?-2:-1:-2===h?-1:h-1),a.setNum(j),d.linfo.moveline&&c.getConfig("dispmove")&&a.noNum()&&d.linfo.eraseLineByCell(a),b.draw()}},inputQues:function(a){var b=this.getcell();b.isnull||(b!==this.cursor.getTCC()?this.setcursor(b):this.inputQues_main(a,b))},inputQues_main:function(a,b){var c=b.getQues(),d=a.length;if(this.btn.Left){for(var e=0;d-1>=e;e++)if(c===a[e]){b.setQues(a[d-1>e?e+1:0]);break}}else if(this.btn.Right)for(var e=d-1;e>=0;e--)if(c===a[e]){b.setQues(a[e>0?e-1:d-1]);break}b.draw()},inputMB:function(){var a=this.getcell();a.isnull||(a.setQsub((this.btn.Left?[1,2,0]:[2,0,1])[a.getQsub()]),a.draw())},inputdirec:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)){var b=this.prevPos.getc();if(!b.isnull&&-1!==b.getQnum()){var c=this.getdir(this.prevPos,a);c!==d.NDIR&&(b.setQdir(b.getQdir()!==c?c:0),b.draw())}this.prevPos=a}},inputarrow_cell:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)||1!==this.inputData){var b=d.NDIR,c=this.prevPos.getc();if(!c.isnull){var b=this.getdir(this.prevPos,a);if(b!==d.NDIR)return c.numberAsObject?c.setNum(b):c.setQdir(b),c.draw(),void this.mousereset()}this.prevPos=a}},getdir:function(a,b){var c=b.bx-a.bx,e=b.by-a.by;return 0===c&&-2===e?d.UP:0===c&&2===e?d.DN:-2===c&&0===e?d.LT:2===c&&0===e?d.RT:d.NDIR},inputtile:function(){var a=this.getcell();if(!a.isnull&&!a.is51cell()&&a!==this.mouseCell){null===this.inputData&&this.decIC(a),this.mouseCell=a;for(var b=this.owner.board.rooms.getClistByCell(a),c=0;c<b.length;c++){var d=b[c];(1===this.inputData||3!==d.getQsub())&&((1===this.inputData?d.setBlack:d.setWhite).call(d),d.setQsub(2==this.inputData?1:0))}b.draw()}},input51:function(){var a=this.getcell_excell();a.isnull||(a.isexcell||a.iscell&&a!==this.cursor.getTCC()?this.setcursor(a):a.iscell&&this.input51_main(a))},input51_main:function(a){this.btn.Left?a.is51cell()?this.cursor.chtarget("shift"):a.set51cell():this.btn.Right&&a.remove51cell(),a.drawaround()},inputcross:function(){var a=this.getcross();a.isnull||a===this.mouseCell||(a!==this.cursor.getTXC()?this.setcursor(a):this.inputcross_main(a),this.mouseCell=a)},inputcross_main:function(a){this.btn.Left?a.setQnum(4!==a.getQnum()?a.getQnum()+1:-2):this.btn.Right&&a.setQnum(-2!==a.getQnum()?a.getQnum()-1:4),a.draw()},inputcrossMark:function(){var a=this.getpos(.24);if(a.oncross()){var b=this.owner.board,c=2===b.hascross?0:2;if(!(a.bx<b.minbx+c||a.bx>b.maxbx-c||a.by<b.minby+c||a.by>b.maxby-c)){var d=a.getx();d.isnull||(this.owner.opemgr.disCombine=!0,d.setQnum(1===d.getQnum()?-1:1),this.owner.opemgr.disCombine=!1,d.draw())}}},inputborder:function(){var a=this.getpos(.35);if(!this.prevPos.equals(a)){var b=this.getborderobj(this.prevPos,a);b.isnull||(null===this.inputData&&(this.inputData=b.isBorder()?0:1),1===this.inputData?b.setBorder():0===this.inputData&&b.removeBorder(),b.draw()),this.prevPos=a}},inputQsubLine:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)){var b=this.getnb(this.prevPos,a);b.isnull||(null===this.inputData&&(this.inputData=0===b.getQsub()?1:0),1===this.inputData?b.setQsub(1):0===this.inputData&&b.setQsub(0),b.draw()),this.prevPos=a}},inputLine:function(){if(this.owner.board.lines.isCenterLine){var a=this.getpos(0);if(this.prevPos.equals(a))return;var b=this.getnb(this.prevPos,a)}else{var a=this.getpos(.35);if(this.prevPos.equals(a))return;var b=this.getborderobj(this.prevPos,a)}b.isnull||(null===this.inputData&&(this.inputData=b.isLine()?0:1),1===this.inputData?b.setLine():0===this.inputData&&b.removeLine(),b.draw()),this.prevPos=a},inputMoveLine:function(){if(!this.owner.board.linfo.moveline||!this.owner.getConfig("dispmove"))return void this.inputLine();var a=this.getcell();if(!a.isnull){var b=this.mouseCell,c=a.getaddr();if(this.mousestart&&a.isDestination())this.mouseCell=a,this.prevPos=c,a.draw();else if(this.mousemove&&!b.isnull&&!a.isDestination()){var d=this.getnb(this.prevPos,c);!d.isnull&&(!d.isLine()&&0===a.lcnt()||d.isLine()&&1===b.lcnt())&&(this.mouseCell=a,this.prevPos=c,d.isLine()?d.removeLine():d.setLine(),d.draw())}}},getnb:function(a,b){return b.bx-a.bx===0&&b.by-a.by===-2?a.rel(0,-1).getb():b.bx-a.bx===0&&b.by-a.by===2?a.rel(0,1).getb():b.bx-a.bx===-2&&b.by-a.by===0?a.rel(-1,0).getb():b.bx-a.bx===2&&b.by-a.by===0?a.rel(1,0).getb():this.owner.board.emptyborder},getborderobj:function(a,b){return 0===(1&b.bx)&&a.bx===b.bx&&1===Math.abs(a.by-b.by)||0===(1&b.by)&&a.by===b.by&&1===Math.abs(a.bx-b.bx)?(a.onborder()?a:b).getb():this.owner.board.nullobj},inputpeke:function(){var a=this.getpos(.22);if(!this.prevPos.equals(a)){var b=a.getb();b.isnull||(null===this.inputData&&(this.inputData=0===b.getQsub()?2:3),2===this.inputData&&b.isLine()&&this.owner.board.linfo.moveline&&this.owner.getConfig("dispmove")||(2===this.inputData?b.setPeke():3===this.inputData&&b.removeLine()),b.draw()),this.prevPos=a}},dispRed:function(){var a=this.getcell();this.mousereset(),!a.isnull&&a.isBlack()&&(this.RBBlackCell?this.dispRed8(a):this.owner.board.bcell.getClistByCell(a).setinfo(1),this.owner.board.haserror=!0,this.owner.redraw())},dispRed8:function(a){for(var b=[a];b.length>0;){var c=b.pop();if(0===c.qinfo){c.setinfo(1);for(var d=c.bx,e=c.by,f=this.owner.board.cellinside(d-2,e-2,d+2,e+2),g=0;g<f.length;g++){var h=f[g];0===h.qinfo&&h.isBlack()&&b.push(h)}}}},dispRedLine:function(){var a=this.owner.board,b=this.getborder(.15);if(this.mousereset(),!b.isnull){if(!b.isLine()){var c=a.lines.borderAsLine?this.getcross():this.getcell();if(c.isnull||c.iscrossing()&&(3===c.lcnt()||4===c.lcnt()))return;if(c.lb().isLine())b=c.lb();else if(c.rb().isLine())b=c.rb();else if(c.ub().isLine())b=c.ub();else{if(!c.db().isLine())return;b=c.db()}}if(!b.isnull){var d=a.lines.getBlistByBorder(b);a.border.setinfo(-1),d.setinfo(1),a.haserror=!0,this.owner.redraw()}}}}),pzpr.extendPuzzleClass("AnsCheck",{checkAllCell:function(a){for(var b=!0,c=0;c<this.owner.board.cellmax;c++){var d=this.owner.board.cell[c];if(a(d)){if(this.checkOnly)return!1;d.seterr(1),b=!1}}return b},checkNoNumCell:function(){return this.checkAllCell(function(a){return a.noNum()})},checkIceLines:function(){return this.checkAllCell(function(a){return 2===a.lcnt()&&a.ice()&&!a.isLineStraight()})},checkDir4Cell:function(a,b){for(var c=!0,d=0;d<this.owner.board.cellmax;d++){var e=this.owner.board.cell[d];if(e.isValidNum()){var f=e.getNum(),g=e.countDir4Cell(a);if(1!==b&&g>f||2!==b&&f>g){if(this.checkOnly)return!1;e.seterr(1),c=!1}}}return c},checkSideCell:function(a){for(var b=!0,c=this.owner.board,d=0;d<c.cellmax;d++){var e=c.cell[d];if(e.bx<c.maxbx-1&&a(e,e.rt())){if(this.checkOnly)return!1;e.seterr(1),e.rt().seterr(1),b=!1}if(e.by<c.maxby-1&&a(e,e.dn())){if(this.checkOnly)return!1;e.seterr(1),e.dn().seterr(1),b=!1}}return b},checkAdjacentBlackCell:function(){return this.checkSideCell(function(a,b){return a.isBlack()&&b.isBlack()})},check2x2Block:function(a){for(var b=!0,c=this.owner.board,d=0;d<c.cellmax;d++){var e=c.cell[d];if(e.bx<c.maxbx-1&&e.by<c.maxby-1){var f=e.bx,g=e.by,h=c.cellinside(f,g,f+2,g+2).filter(function(b){return a(b)});if(4===h.length){if(this.checkOnly)return!1;h.seterr(1),b=!1}}}return b},check2x2BlackCell:function(){return this.check2x2Block(function(a){return a.isBlack()})},checkOneArea:function(a){this.owner.board;return a.max>1?(a.room[1].clist.seterr(1),!1):!0},checkOneLine:function(a){var b=this.owner.board;return a.max>1?(b.border.seterr(-1),a.setErrLareaByCell(b.cell[1],1),!1):!0},checkOneLoop:function(){var a=this.owner.board,b=a.getLineInfo();return b.max>1?(a.border.seterr(-1),b.room[1].blist.seterr(1),!1):!0},checkLineCount:function(a){var b=!0,c=this.owner.board;if(0==c.lines.ltotal[a])return!0;if(c.lines.isCenterLine)for(var d=0;d<c.cellmax;d++){var e=c.cell[d];if(e.lcnt()==a){if(this.checkOnly)return!1;b&&c.border.seterr(-1),e.setCellLineError(!0),b=!1}}else if(c.lines.borderAsLine)for(var f=c.minby;f<=c.maxby;f+=2)for(var g=c.minbx;g<=c.maxbx;g+=2){var h=(g>>1)+(f>>1)*(c.qcols+1),i=c.lines.lcnt[h];if(i==a){if(this.checkOnly)return!1;b&&c.border.seterr(-1),new this.owner.Address(g,f).setCrossBorderError(),b=!1}}return b},checkenableLineParts:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var e=b.cell[c];if(e.ub().isLine()&&e.noLP(d.UP)||e.db().isLine()&&e.noLP(d.DN)||e.lb().isLine()&&e.noLP(d.LT)||e.rb().isLine()&&e.noLP(d.RT)){if(this.checkOnly)return!1;e.seterr(1),a=!1}}return a},checkRBBlackCell:function(a){if(a.max>1){for(var b=new this.owner.CellList,c=this.owner.board.cell.filter(function(a){return a.isBlack()}),d=0;d<c.length;d++)for(var e=c[d],f=e.getdir4clist(),g=null,h=0;h<f.length;h++){var i=f[h][0];if(null===g)g=a.getRoomID(i);else if(g!==a.getRoomID(i)){b.add(e);break}}return b.seterr(1),!1}return!0},checkAllArea:function(a,b){return this.checkAllBlock(a,function(){return!0},b)},checkAllBlock:function(a,b,c){for(var d=!0,e=1;e<=a.max;e++){var f=a.room[e],g=f.clist,h=f.top?f.top:g.getQnumCell(),i=g.getRectSize(),j=g.filter(b).length,k=h.isnull?-1:h.getQnum();if(!c(i.cols,i.rows,j,k)){if(this.checkOnly)return!1;g.seterr("tateyoko"!=this.owner.pid?1:4),d=!1}}return d},checkNumberAndSize:function(a){return this.checkAllArea(a,function(a,b,c,d){return 0>=d||d===c})},checkAreaRect:function(a){return this.checkAllArea(a,function(a,b,c){return a*b===c})},checkAreaSquare:function(a){return this.checkAllArea(a,function(a,b,c){return a*b===c&&a===b})},checkNoNumber:function(a){return this.checkAllBlock(a,function(a){return a.isNum()},function(a,b,c){return 0!=c})},checkDoubleNumber:function(a){return this.checkAllBlock(a,function(a){return a.isNum()},function(a,b,c){return 2>c})},checkBlackCellCount:function(a){return this.checkAllBlock(a,function(a){return a.isBlack()},function(a,b,c,d){return 0>d||d===c})},checkNoBlackCellInArea:function(a){return this.checkAllBlock(a,function(a){return a.isBlack()},function(a,b,c){return c>0})},checkLinesInArea:function(a,b){return this.checkAllBlock(a,function(a){return a.lcnt()>0},b)},checkNoMovedObjectInRoom:function(a){return this.checkAllBlock(a,function(a){return-1!==a.base.qnum},function(a,b,c){return 0!=c})},checkDisconnectLine:function(a){return this.checkConnectObjectCount(a,function(a){return a>0})},checkDoubleObject:function(a){return this.checkConnectObjectCount(a,function(a){return 2>a})},checkTripleObject:function(a){return this.checkConnectObjectCount(a,function(a){return 3>a})},checkConnectObjectCount:function(a,b){for(var c=!0,d=1;d<=a.max;d++){var e=a.room[d].clist.filter(function(a){return a.isNum(a)}).length;if(!b(e)){if(this.checkOnly)return!1;c&&this.owner.board.border.seterr(-1),a.setErrLareaById(d,1),c=!1}}return c},checkSideAreaSize:function(a,b){for(var c=a.getSideAreaInfo(),d=1;d<=a.max-1;d++)for(var e=0;e<c[d].length;e++){var f=c[d][e],g=b(a.room[d]),h=b(a.room[f]);if(g>0&&h>0&&g==h)return a.room[d].clist.seterr(1),a.room[f].clist.seterr(1),!1}return!0},checkSideAreaCell:function(a,b,c){for(var d=0;d<this.owner.board.bdmax;d++){var e=this.owner.board.border[d];if(e.isBorder()){var f=e.sidecell[0],g=e.sidecell[1];if(!f.isnull&&!g.isnull&&b(f,g))return c?(a.getclistbycell(f).seterr(1),a.getclistbycell(g).seterr(1)):(f.seterr(1),g.seterr(1)),!1}}return!0},checkSameObjectInRoom:function(a,b){for(var c=!0,d=[],e=[],f=this.owner.board,g=0;g<f.cellmax;g++)e[g]=b(f.cell[g]);for(var h=1;h<=a.max;h++)d[h]=-1;for(var g=0;g<f.cellmax;g++)if(null!==a.id[g]&&-1!==e[g])if(-1===d[a.id[g]]&&-1!==e[g])d[a.id[g]]=e[g];else if(d[a.id[g]]!==e[g]){if(this.checkOnly)return!1;a.getclistbycell(f.cell[g]).seterr(1),c=!1}return c},checkDifferentNumberInRoom:function(a,b){for(var c=!0,d=1;d<=a.max;d++){var e=a.room[d].clist;if(!this.isDifferentNumberInClist(e,b)){if(this.checkOnly)return!1;e.seterr(1),c=!1}}return c},isDifferentNumberInClist:function(a,b){if(a.length<=0)return!0;for(var c=!0,d=[],e=[],f=a[0].nummaxfunc(),g=a[0].numminfunc(),h=g;f>=h;h++)d[h]=0;for(var i=0;i<a.length;i++)e[a[i].id]=b(a[i]);for(var i=0;i<a.length;i++)e[a[i].id]>=g&&d[e[a[i].id]]++;var j=a.filter(function(a){return e[a.id]>=g&&d[e[a.id]]>=2});return j.length>0&&(j.seterr(1),c=!1),c},checkRowsCols:function(a,b){for(var c=!0,d=this.owner.board,e=1;e<=d.maxby;e+=2){var f=d.cellinside(d.minbx+1,e,d.maxbx-1,e);if(!a.call(this,f,b)){if(this.checkOnly)return!1;c=!1}}for(var g=1;g<=d.maxbx;g+=2){var f=d.cellinside(g,d.minby+1,g,d.maxby-1);if(!a.call(this,f,b)){if(this.checkOnly)return!1;c=!1}}return c},checkRowsColsPartly:function(a,b,c){for(var e=!0,f=this.owner.board,g=1;g<=f.maxby;g+=2)for(var h=1;h<=f.maxbx;h+=2){for(var i=h;i<=f.maxbx&&!b(f.getc(i,g));i+=2);if(i>h&&!a.call(this,[h-2,g,d.RT],f.cellinside(h,g,i-2,g))){if(!c||this.checkOnly)return!1;e=!1}h=i}for(var h=1;h<=f.maxbx;h+=2)for(var g=1;g<=f.maxby;g+=2){for(var j=g;j<=f.maxby&&!b(f.getc(h,j));j+=2);if(j>g&&!a.call(this,[h,g-2,d.DN],f.cellinside(h,g,h,j-2))){if(!c||this.checkOnly)return!1;e=!1}g=j}return e},checkBorderCount:function(a,b){for(var c=!0,d=this.owner.board,e=1===d.hascross?2:0,f=e;f<=d.maxby-e;f+=2)for(var g=e;g<=d.maxbx-e;g+=2){var h=(g>>1)+(f>>1)*(d.qcols+1),i=d.rooms.crosscnt[h];if(i==a&&(0===b||1==b&&1===d.getx(g,f).getQnum()||2===b&&1!==d.getx(g,f).getQnum())){if(this.checkOnly)return!1;c&&d.border.seterr(-1),new this.owner.Address(g,f).setCrossBorderError(),c=!1}}return c},checkLineOverLetter:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(d.lcnt()>=2&&d.isNum()){if(this.checkOnly)return!1;a&&b.border.seterr(-1),d.setCellLineError(!0),a=!1}}return a},checkErrorFlag_cell:function(a,b){for(var c=!0,d=1;d<=a.max;d++)if(a.room[d].error===b){if(this.checkOnly)return!1;a.room[d].clist.seterr(1),c=!1}return c},checkErrorFlag_line:function(a,b){for(var c=!0,d=1;d<=a.max;d++)if(a.room[d].error===b){if(this.checkOnly)return!1;var e=a.room[d].cells;e[0]&&null!==e[0]&&e[0].seterr(1),e[1]&&null!==e[1]&&e[1].seterr(1),c&&this.owner.board.border.seterr(-1),a.room[d].blist.seterr(1),c=!1}return c},getErrorFlag_line:function(){for(var a=this.owner.board,b=new this.owner.LineInfo,c=0;c<a.bdmax;c++)b.id[c]=a.border[c].isLine()?0:null;for(var d=a.cell.filter(function(a){return a.isNum()}),e=0;e<d.length;e++)for(var f=d[e],g=[f.ub(),f.db(),f.lb(),f.rb()],h=0;4>h;h++){var i=g[h];i.isnull||(b.max++,b.room[b.max]={blist:new this.owner.BorderList,error:0,cells:[f,null],ccnt:0,length:[],dir1:h+1,dir2:0},this.searchErrorFlag_line(b,b.max),0!==b.room[b.max].blist.length&&this.isErrorFlag_line(b))}return b},searchErrorFlag_line:function(a,b){for(var c=a.room[b],d=c.dir1,e=c.cells[0].getaddr();;)if(e.movedir(d,1),e.oncell()){var f=e.getc();if(f.isnull||f.isNum())break;f.iscrossing()&&f.lcnt()>=3||(1!==d&&f.db().isLine()?(2!==d&&c.ccnt++,d=2):2!==d&&f.ub().isLine()?(1!==d&&c.ccnt++,d=1):3!==d&&f.rb().isLine()?(4!==d&&c.ccnt++,d=4):4!==d&&f.lb().isLine()&&(3!==d&&c.ccnt++,d=3))}else{var g=e.getb();if(g.isnull||0!==a.getRoomID(g))break;a.setRoomID(g,b),isNaN(c.length[c.ccnt])?c.length[c.ccnt]=0:c.length[c.ccnt]++}c.cells[1]=e.getc(),c.dir2=[0,2,1,4,3][d]},isErrorFlag_line:function(){}}),pzpr.extendPuzzleClass("FailCode",{bc2x2:["2x2の黒マスのかたまりがあります。","There is a 2x2 block of black cells."],bcNotSquare:["正方形でない黒マスのカタマリがあります。","A mass of black cells is not regular rectangle."],bcAdjacent:["黒マスがタテヨコに連続しています。","Black cells are adjacent."],bcDivide:["黒マスが分断されています。","Black cells are devided,"],wcDivide:["白マスが分断されています。","White cells are devided."],wcDivideRB:["白マスが分断されています。","White cells are devided."],bkNoNum:["数字のないブロックがあります。","A block has no number."],bkNumGe2:["1つのブロックに2つ以上の数字が入っています。","A block has plural numbers."],bkDupNum:["同じブロックに同じ数字が入っています。","There are same numbers in a block."],bkPlNum:["複数種類の数字が入っているブロックがあります。","A block has two or more kinds of numbers."],bkSepNum:["同じ数字が異なるブロックに入っています。","One kind of numbers is included in dirrerent blocks."],bkSizeNe:["数字とブロックの大きさが違います。","The size of the block is not equal to the number."],bkSizeLt:["ブロックの大きさより数字のほうが大きいです。","A number is bigger than the size of block."],bkSizeGt:["ブロックの大きさよりも数字が小さいです。","A number is smaller than the size of block."],bkBcellNe:["部屋の数字と黒マスの数が一致していません。","The number of Black cells in the room and The number written in the room is different."],bkBcDivide:["1つの部屋に入る黒マスが2つ以上に分裂しています。","Black cells are devided in one room."],bkNoBcell:["黒マスがない部屋があります。","A room has no black cell."],bkMixed:["白マスと黒マスの混在したタイルがあります。","A tile includes both black and white cells."],bkWidthGt1:["幅が１マスではないタタミがあります。","The width of the tatami is not one."],brNoLine:["線が引かれていません。","There is no line on the board."],bkNoLine:["線の通っていない国があります。","There is a country that is not passed any line."],bkNotRect:["四角形ではない部屋があります。","There is a room whose shape is not square."],bdDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],bdCross:["十字の交差点があります。","There is a crossing border line."],nmBorderNe:["数字の周りにある境界線の本数が違います。","The number is not equal to the number of border lines around it."],lnDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],lnBranch:["分岐している線があります。","There is a branch line."],lnCross:["線が交差しています。","There is a crossing line."],lnCrossExMk:["十字以外の場所で線が交差しています。","There is a crossing line out of cross mark."],lnNotCrossMk:["十字の場所で線が交差していません。","A cross-joint cell doesn't have four-way lines."],lnCrossExIce:["氷の部分以外で線が交差しています。","A Line is crossed outside of ice."],lnCurveOnIce:["氷の部分で線が曲がっています。","A Line curve on ice."],lnPlLoop:["輪っかが一つではありません。","There are plural loops."],lnOnBcell:["黒マスの上に線が引かれています。","There is a line on the black cell."],lcDeadEnd:["線が途中で途切れています。","There is a dead-end line."],lcDivided:["線が全体で一つながりになっていません。","All lines and numbers are not connected each other."],lcTripleNum:["3つ以上の数字がつながっています。","Three or more numbers are connected."],lcIsolate:["数字につながっていない線があります。","A line doesn't connect any number."],lcOnNum:["数字の上を線が通過しています。","A line goes through a number."],nmIsolate:["どこにもつながっていない数字があります。","A number is not connected another number."],nmConnected:["アルファベットが繋がっています。","There are connected letters."],laIsolate:["アルファベットにつながっていない線があります。","A line doesn't connect any letter."],laOnNum:["アルファベットの上を線が通過しています。","A line goes through a letter."],laCurve:["曲がっている線があります。","A line has curve."],laLenNe:["数字と線の長さが違います。","The length of a line is wrong."],ceEmpty:["何も入っていないマスがあります。","There is an empty cell."],ceAddLine:["最初から引かれている線があるマスに線が足されています。","Lines are added to the cell that the mark lie in by the question."],anBcellNe:["矢印の方向にある黒マスの数が正しくありません。","The number of black cells are not correct."],nmSameNum:["同じ数字がタテヨコに連続しています。","Same numbers are adjacent."],nmAround:["同じ数字がタテヨコナナメに隣接しています。","Same numbers are adjacent."],nmDupRow:["同じ列に同じ数字が入っています。","There are same numbers in a row."],nmDivide:["タテヨコにつながっていない数字があります。","Numbers are devided."]}),pzpr.extendPuzzleClass("BoardExec",{adjustNumberArrow:function(a,b){if(a&d.TURNFLIP){var c={};switch(a){case d.FLIPY:c={1:2,2:1};break;case d.FLIPX:c={3:4,4:3};break;case d.TURNR:c={1:4,2:3,3:1,4:2};break;case d.TURNL:c={1:3,2:4,3:2,4:1}}for(var e=this.owner.board.cellinside(b.x1,b.y1,b.x2,b.y2),f=0;f<e.length;f++){var g=e[f],h=c[g.getQdir()];h&&g.setQdir(h)}}},adjustCellArrow:function(a,b){if(a&d.TURNFLIP){var c={};switch(a){case d.FLIPY:c={1:2,2:1};break;case d.FLIPX:c={3:4,4:3};break;case d.TURNR:c={1:4,2:3,3:1,4:2};break;case d.TURNL:c={1:3,2:4,3:2,4:1};break;default:return}for(var e=this.owner.board.cellinside(b.x1,b.y1,b.x2,b.y2),f=0;f<e.length;f++){var g=e[f],h=c[g.getQnum()];h&&g.setQnum(h);var h=c[g.getAnum()];h&&g.setAnum(h)}}},adjustBorderArrow:function(a,b){if(a&d.TURNFLIP){var c={};switch(a){case d.FLIPY:c={1:2,2:1};break;case d.FLIPX:c={3:4,4:3};break;case d.TURNR:c={1:4,2:3,3:1,4:2};break;case d.TURNL:c={1:3,2:4,3:2,4:1};break;default:return}for(var e=this.owner.board.borderinside(b.x1,b.y1,b.x2,b.y2),f=0;f<e.length;f++){var g,h=e[f];g=c[h.getQdir()],g&&h.setQdir(g)}}},adjustQues51_1:function(a,b){var c=1|b.x1,d=1|b.y1;this.qnumw=[],this.qnumh=[];for(var e=this.owner.board,f=d;f<=b.y2;f+=2){this.qnumw[f]=[e.getex(-1,f).getQnum()];for(var g=c;g<=b.x2;g+=2){var h=e.getc(g,f);h.is51cell()&&this.qnumw[f].push(h.getQnum())}}for(var g=c;g<=b.x2;g+=2){this.qnumh[g]=[e.getex(g,-1).getQnum2()];for(var f=d;f<=b.y2;f+=2){var h=e.getc(g,f);h.is51cell()&&this.qnumh[g].push(h.getQnum2())}}},adjustQues51_2:function(a,b){var c,e=b.x1+b.x2,f=b.y1+b.y2,g=1|b.x1,h=1|b.y1,i=this.owner.board;switch(a){case d.FLIPY:for(var j=g;j<=b.x2;j+=2){c=1,this.qnumh[j]=this.qnumh[j].reverse(),i.getex(j,-1).setQnum2(this.qnumh[j][0]);for(var k=h;k<=b.y2;k+=2){var l=i.getc(j,k);l.is51cell()&&(l.setQnum2(this.qnumh[j][c]),c++)}}break;case d.FLIPX:for(var k=h;k<=b.y2;k+=2){c=1,this.qnumw[k]=this.qnumw[k].reverse(),i.getex(-1,k).setQnum(this.qnumw[k][0]);for(var j=g;j<=b.x2;j+=2){var l=i.getc(j,k);l.is51cell()&&(l.setQnum(this.qnumw[k][c]),c++)}}break;case d.TURNR:for(var k=h;k<=b.y2;k+=2){c=1,this.qnumh[k]=this.qnumh[k].reverse(),i.getex(-1,k).setQnum(this.qnumh[k][0]);for(var j=g;j<=b.x2;j+=2){var l=i.getc(j,k);l.is51cell()&&(l.setQnum(this.qnumh[k][c]),c++)}}for(var j=g;j<=b.x2;j+=2){c=1,i.getex(j,-1).setQnum2(this.qnumw[e-j][0]);for(var k=h;k<=b.y2;k+=2){var l=i.getc(j,k);l.is51cell()&&(l.setQnum2(this.qnumw[e-j][c]),c++)}}break;case d.TURNL:for(var k=h;k<=b.y2;k+=2){c=1,i.getex(-1,k).setQnum(this.qnumh[f-k][0]);for(var j=g;j<=b.x2;j+=2){var l=i.getc(j,k);l.is51cell()&&(l.setQnum(this.qnumh[f-k][c]),c++)}}for(var j=g;j<=b.x2;j+=2){c=1,this.qnumw[j]=this.qnumw[j].reverse(),i.getex(j,-1).setQnum2(this.qnumw[j][0]);for(var k=h;k<=b.y2;k+=2){var l=i.getc(j,k);l.is51cell()&&(l.setQnum2(this.qnumw[j][c]),c++)}}}},getAfterPos:function(a,b,c){var e,f,g=this.owner.board,h=b.x1+b.x2,i=b.y1+b.y2,j=c.bx,k=c.by;switch(a){case d.FLIPY:e=j,f=i-k;break;case d.FLIPX:e=h-j,f=k;break;case d.TURNR:e=i-k,f=j;break;case d.TURNL:e=k,f=h-j;break;case d.EXPANDUP:e=j,f=k+(k===g.minby?0:2);break;case d.EXPANDDN:e=j,f=k+(k===g.maxby?2:0);break;case d.EXPANDLT:e=j+(j===g.minbx?0:2),f=k;break;case d.EXPANDRT:e=j+(j===g.maxbx?2:0),f=k;break;case d.REDUCEUP:e=j,f=k-(k<=g.minby+2?0:2);break;case d.REDUCEDN:e=j,f=k-(k>=g.maxby-2?2:0);break;case d.REDUCELT:e=j-(j<=g.minbx+2?0:2),f=k;break;case d.REDUCERT:e=j-(j>=g.maxbx-2?2:0),f=k;break;default:e=j,f=k}return{bx1:j,by1:k,bx2:e,by2:f,isdel:this.isdel(a,c)}}}),pzpr.extendPuzzleClass("Encode",{include:function(a,b,c){return a>=b&&c>=a},decode4Cell:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","4")?e.qnum=parseInt(f,16):this.include(f,"5","9")?(e.qnum=parseInt(f,16)-5,a++):this.include(f,"a","e")?(e.qnum=parseInt(f,16)-10,a+=2):this.include(f,"g","z")?a+=parseInt(f,36)-16:"."==f&&(e.qnum=-2),a++,a>=d.cellmax)break}this.outbstr=c.substr(b+1)},encode4Cell:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qnum;f>=0?c.cell[d+1]&&-1!==c.cell[d+1].qnum?e=""+f.toString(16):c.cell[d+2]&&-1!==c.cell[d+2].qnum?(e=""+(5+f).toString(16),d++):(e=""+(10+f).toString(16),d+=2):-2===f?e=".":a++,0===a?b+=e:(e||20===a)&&(b+=(a+15).toString(36)+e,a=0)}a>0&&(b+=(a+15).toString(36)),this.outbstr+=b},decode4Cross:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cross[a],f=c.charAt(b);if(this.include(f,"0","4")?e.qnum=parseInt(f,16):this.include(f,"5","9")?(e.qnum=parseInt(f,16)-5,a++):this.include(f,"a","e")?(e.qnum=parseInt(f,16)-10,a+=2):this.include(f,"g","z")?a+=parseInt(f,36)-16:"."==f&&(e.qnum=-2),a++,a>=d.crossmax)break}this.outbstr=c.substr(b+1)},encode4Cross:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.crossmax;d++){var e="",f=c.cross[d].qnum;f>=0?c.cross[d+1]&&-1!==c.cross[d+1].qnum?e=""+f.toString(16):c.cross[d+2]&&-1!==c.cross[d+2].qnum?(e=""+(5+f).toString(16),d++):(e=""+(10+f).toString(16),d+=2):-2===f?e=".":a++,0===a?b+=e:(e||20===a)&&(b+=(a+15).toString(36)+e,a=0)}a>0&&(b+=(a+15).toString(36)),this.outbstr+=b},decodeNumber10:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if("."==f?e.qnum=-2:this.include(f,"0","9")?e.qnum=parseInt(f,10):this.include(f,"a","z")&&(a+=parseInt(f,36)-10),a++,a>=d.cellmax)break}this.outbstr=c.substr(b+1)},encodeNumber10:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qnum;-2===f?e=".":f>=0&&10>f?e=f.toString(10):b++,0==b?a+=e:(e||26==b)&&(a+=(9+b).toString(36)+e,b=0)}b>0&&(a+=(9+b).toString(36)),this.outbstr+=a},decodeNumber16:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","9")||this.include(f,"a","f")?e.qnum=parseInt(f,16):"-"==f?(e.qnum=parseInt(c.substr(b+1,2),16),b+=2):"+"==f?(e.qnum=parseInt(c.substr(b+1,3),16),b+=3):"="==f?(e.qnum=parseInt(c.substr(b+1,3),16)+4096,b+=3):"%"==f?(e.qnum=parseInt(c.substr(b+1,3),16)+8192,b+=3):"."==f?e.qnum=-2:f>="g"&&"z">=f&&(a+=parseInt(f,36)-16),a++,a>=d.cellmax)break}this.outbstr=c.substr(b+1)},encodeNumber16:function(){for(var a=0,b="",c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qnum;-2==f?e=".":f>=0&&16>f?e=f.toString(16):f>=16&&256>f?e="-"+f.toString(16):f>=256&&4096>f?e="+"+f.toString(16):f>=4096&&8192>f?e="="+(f-4096).toString(16):f>=8192?e="%"+(f-8192).toString(16):a++,0==a?b+=e:(e||20==a)&&(b+=(15+a).toString(36)+e,a=0)}a>0&&(b+=(15+a).toString(36)),this.outbstr+=b},decodeRoomNumber16:function(){var a=1,b=0,c=this.outbstr,d=this.owner.board;for(d.rooms.reset(),b=0;b<c.length;b++){var e=c.charAt(b),f=d.rooms.getTopOfRoom(a);if(this.include(e,"0","9")||this.include(e,"a","f")?f.qnum=parseInt(e,16):"-"==e?(f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"+"==e?(f.qnum=parseInt(c.substr(b+1,3),16),b+=3):"="==e?(f.qnum=parseInt(c.substr(b+1,3),16)+4096,b+=3):"%"==e?(f.qnum=parseInt(c.substr(b+1,3),16)+8192,b+=3):"*"==e?(f.qnum=parseInt(c.substr(b+1,3),16)+12240,b+=4):"$"==e?(f.qnum=parseInt(c.substr(b+1,3),16)+77776,b+=5):e>="g"&&"z">=e&&(a+=parseInt(e,36)-16),a++,a>d.rooms.max)break}this.outbstr=c.substr(b+1)},encodeRoomNumber16:function(){var a=0,b="",c=this.owner.board;c.rooms.reset();for(var d=1;d<=c.rooms.max;d++){var e="",f=c.rooms.getTopOfRoom(d).qnum;f>=0&&16>f?e=f.toString(16):f>=16&&256>f?e="-"+f.toString(16):f>=256&&4096>f?e="+"+f.toString(16):f>=4096&&8192>f?e="="+(f-4096).toString(16):f>=8192&&12240>f?e="%"+(f-8192).toString(16):f>=12240&&77776>f?e="*"+(f-12240).toString(16):f>=77776?e="$"+(f-77776).toString(16):a++,0==a?b+=e:(e||20==a)&&(b+=(15+a).toString(36)+e,a=0)}a>0&&(b+=(15+a).toString(36)),this.outbstr+=b},decodeArrowNumber16:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if(this.include(e,"0","4")){var g=c.charAt(b+1);f.qdir=parseInt(e,16),f.qnum="."!=g?parseInt(g,16):-2,b++}else this.include(e,"5","9")?(f.qdir=parseInt(e,16)-5,f.qnum=parseInt(c.substr(b+1,2),16),b+=2):e>="a"&&"z">=e&&(a+=parseInt(e,36)-10);if(a++,a>=d.cellmax)break}this.outbstr=c.substr(b+1)},encodeArrowNumber16:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qdir,g=c.cell[d].qnum;-2===g?e=f+".":g>=0&&16>g?e=f+g.toString(16):g>=16&&256>g?e=f+5+g.toString(16):b++,0===b?a+=e:(e||26===b)&&(a+=(b+9).toString(36)+e,b=0)}b>0&&(a+=(b+9).toString(36)),this.outbstr+=a},decodeBorder:function(){var a,b,c,d=this.outbstr,e=[16,8,4,2,1],f=this.owner.board;d?(a=Math.min(((f.qcols-1)*f.qrows+4)/5|0,d.length),b=Math.min(((f.qcols*(f.qrows-1)+4)/5|0)+a,d.length)):(a=0,b=0),c=0;for(var g=0;a>g;g++)for(var h=parseInt(d.charAt(g),32),i=0;5>i;i++)c<(f.qcols-1)*f.qrows&&(f.border[c].ques=h&e[i]?1:0,c++);c=(f.qcols-1)*f.qrows;for(var g=a;b>g;g++)for(var h=parseInt(d.charAt(g),32),i=0;5>i;i++)c<f.bdinside&&(f.border[c].ques=h&e[i]?1:0,c++);f.rooms.reset(),this.outbstr=d.substr(b)},encodeBorder:function(){for(var a="",b=[16,8,4,2,1],c=0,d=0,e=this.owner.board,f=0;f<(e.qcols-1)*e.qrows;f++)d+=e.border[f].ques*b[c],c++,5===c&&(a+=d.toString(32),c=0,d=0);c>0&&(a+=d.toString(32)),c=0,d=0;for(var f=(e.qcols-1)*e.qrows;f<e.bdinside;f++)d+=e.border[f].ques*b[c],c++,5===c&&(a+=d.toString(32),c=0,d=0);c>0&&(a+=d.toString(32)),this.outbstr+=a},decodeCrossMark:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board,e=2===d.hascross?1:0,f=e<<1,g=d.qrows-1+f,h=d.qcols-1+f;for(b=0;b<c.length;b++){var i=c.charAt(b);if(this.include(i,"0","9")||this.include(i,"a","z")){a+=parseInt(i,36);var j=a%h+(1-e)<<1,k=(a/h|0)+(1-e)<<1;if(k>d.maxby-2*(1-e)){b++;break}d.getx(j,k).qnum=1}else"."==i&&(a+=35);if(a++,a>=h*g){b++;break}}this.outbstr=c.substr(b)},encodeCrossMark:function(){for(var a="",b=0,c=this.owner.board,d=2===c.hascross?1:0,e=d<<1,f=c.qrows-1+e,g=c.qcols-1+e,h=0,i=g*f;i>h;h++){var j="",k=h%g+(1-d)<<1,l=(h/g|0)+(1-d)<<1;1===c.getx(k,l).qnum?j=".":b++,j?(a+=b.toString(36),b=0):36==b&&(a+=".",b=0)}b>0&&(a+=b.toString(36)),this.outbstr+=a},decodeCircle:function(){for(var a=this.owner.board,b=this.outbstr,c=0,d=[9,3,1],e=a.qcols*a.qrows,f=b?Math.min((a.qcols*a.qrows+2)/3|0,b.length):0,g=0;f>g;g++)for(var h=parseInt(b.charAt(g),27),i=0;3>i;i++)if(e>c){var j=(h/d[i]|0)%3;j>0&&(a.cell[c].qnum=j),c++}this.outbstr=b.substr(f)},encodeCircle:function(){for(var a=this.owner.board,b="",c=0,d=0,e=[9,3,1],f=0;f<a.cellmax;f++)a.cell[f].qnum>0&&(d+=a.cell[f].qnum*e[c]),c++,3===c&&(b+=d.toString(27),c=0,d=0);c>0&&(b+=d.toString(27)),this.outbstr+=b},decodecross_old:function(){for(var a=this.outbstr,b=0,c=this.owner.board,d=0;d<a.length;d++){var e=a.charAt(d);if(this.include(e,"0","4")&&(c.cross[b].qnum=parseInt(e)),b++,b>=c.crossmax){d++;break}}this.outbstr=a.substr(d)}}),pzpr.extendPuzzleClass("FileIO",{decodeCellQnum:function(){this.decodeCell(function(a,b){"-"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))})},encodeCellQnum:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"- ":". "})},decodeCellQnumb:function(){this.decodeCell(function(a,b){"5"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))})},encodeCellQnumb:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"5 ":". "})},decodeCellQnumAns:function(){this.decodeCell(function(a,b){"#"===b?a.qans=1:"+"===b?a.qsub=1:"-"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))})},encodeCellQnumAns:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"- ":1===a.qans?"# ":1===a.qsub?"+ ":". "})},decodeCellDirecQnum:function(){this.decodeCell(function(a,b){if("."!==b){var c=b.split(",");a.qdir="0"!==c[0]?parseInt(c[0]):0,a.qnum="-"!==c[1]?parseInt(c[1]):-2}})},encodeCellDirecQnum:function(){this.encodeCell(function(a){if(-1!==a.qnum){var b=0!==a.qdir?a.qdir.toString():"0",c=-2!==a.qnum?a.qnum.toString():"-";return[b,",",c," "].join("")}return". "})},decodeCellAns:function(){this.decodeCell(function(a,b){"#"===b?a.qans=1:"+"===b&&(a.qsub=1)})},encodeCellAns:function(){this.encodeCell(function(a){return 1===a.qans?"# ":1===a.qsub?"+ ":". "})},decodeCellQanssub:function(){this.decodeCell(function(a,b){"+"===b?a.qsub=1:"-"===b?a.qsub=2:"="===b?a.qsub=3:"%"===b?a.qsub=4:"."!==b&&(a.qans=parseInt(b))})},encodeCellQanssub:function(){this.encodeCell(function(a){return 0!==a.qans?a.qans.toString()+" ":1===a.qsub?"+ ":2===a.qsub?"- ":3===a.qsub?"= ":4===a.qsub?"% ":". "})},decodeCellAnumsub:function(){this.decodeCell(function(a,b){"+"===b?a.qsub=1:"-"===b?a.qsub=2:"="===b?a.qsub=3:"%"===b?a.qsub=4:"."!==b&&(a.anum=parseInt(b))})},encodeCellAnumsub:function(){this.encodeCell(function(a){return-1!==a.anum?a.anum.toString()+" ":1===a.qsub?"+ ":2===a.qsub?"- ":3===a.qsub?"= ":4===a.qsub?"% ":". "
})},decodeCellQsub:function(){this.decodeCell(function(a,b){"0"!==b&&(a.qsub=parseInt(b))})},encodeCellQsub:function(){this.encodeCell(function(a){return a.qsub>0?a.qsub.toString()+" ":"0 "})},decodeCrossNum:function(){this.decodeCross(function(a,b){"-"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))})},encodeCrossNum:function(){this.encodeCross(function(a){return a.qnum>=0?a.qnum.toString()+" ":-2===a.qnum?"- ":". "})},decodeBorderQues:function(){this.decodeBorder(function(a,b){"1"===b&&(a.ques=1)})},encodeBorderQues:function(){this.encodeBorder(function(a){return(1===a.ques?"1":"0")+" "})},decodeBorderAns:function(){this.decodeBorder(function(a,b){"2"===b?(a.qans=1,a.qsub=1):"1"===b?a.qans=1:"-1"===b&&(a.qsub=1)})},encodeBorderAns:function(){this.encodeBorder(function(a){return 1===a.qans&&1===a.qsub?"2 ":1===a.qans?"1 ":1===a.qsub?"-1 ":"0 "})},decodeBorderLine:function(){this.decodeBorder(function(a,b){"-1"===b?a.qsub=2:"0"!==b&&(a.line=parseInt(b))})},encodeBorderLine:function(){this.encodeBorder(function(a){return a.line>0?""+a.line+" ":2===a.qsub?"-1 ":"0 "})},decodeAreaRoom:function(){this.decodeAreaRoom_com(!0)},encodeAreaRoom:function(){this.encodeAreaRoom_com(!0)},decodeAnsAreaRoom:function(){this.decodeAreaRoom_com(!1)},encodeAnsAreaRoom:function(){this.encodeAreaRoom_com(!1)},decodeAreaRoom_com:function(a){this.readLine(),this.rdata2Border(a,this.getItemList(this.owner.board.qrows)),this.owner.board.rooms.reset()},encodeAreaRoom_com:function(){var a=this.owner.board,b=a.getRoomInfo();this.datastr+=b.max+"\n";for(var c=0;c<a.cellmax;c++)this.datastr+=""+(b.id[c]-1)+" ",(c+1)%a.qcols===0&&(this.datastr+="\n")},rdata2Border:function(a,b){for(var c=this.owner.board,d=0;d<c.bdmax;d++){var e=c.border[d],f=e.sidecell[0],g=e.sidecell[1],h=!f.isnull&&!g.isnull&&b[f.id]!=b[g.id];e[a?"ques":"qans"]=h?1:0}},decodeCellQnum51:function(){var a=this.owner.board,b=this.getItemList(a.qrows+1);a.disableInfo();for(var c=0;c<b.length;c++)if("."!=b[c]){var d=2*(c%(a.qcols+1)-1)+1,e=2*((c/(a.qcols+1)|0)-1)+1;if(-1===d||-1===e){var f=a.getex(d,e),g=-1===f.by?"qnum2":"qnum";f[g]=parseInt(b[c])}else{var h=b[c].split(","),i=a.getc(d,e);i.set51cell(),i.qnum=parseInt(h[0]),i.qnum2=parseInt(h[1])}}a.enableInfo()},encodeCellQnum51:function(){for(var a=this.owner.board,b="",c=a.minby+1;c<a.maxby;c+=2){for(var d=a.minbx+1;d<a.maxbx;d+=2)if(-1===d&&-1===c)b+="0 ";else if(-1===d||-1===c){var e=a.getex(d,c),f=-1===e.by?"qnum2":"qnum";b+=""+e[f].toString()+" "}else{var g=a.getc(d,c);b+=51===g.ques?""+g.qnum.toString()+","+g.qnum2.toString()+" ":". "}b+="\n"}this.datastr+=b},decodeCellQnum_kanpen:function(){this.decodeCell(function(a,b){"."!==b&&(a.qnum=parseInt(b))})},encodeCellQnum_kanpen:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":". "})},decodeCellAnum_kanpen:function(){this.decodeCell(function(a,b){"."!==b&&"0"!==b&&(a.anum=parseInt(b))})},encodeCellAnum_kanpen:function(){this.encodeCell(function(a){return-1!==a.qnum?". ":-1===a.anum?"0 ":""+a.anum.toString()+" "})},decodeCellQnumAns_kanpen:function(){this.decodeCell(function(a,b){"#"===b?a.qans=1:"+"===b?a.qsub=1:"."!==b&&(a.qnum=parseInt(b))})},encodeCellQnumAns_kanpen:function(){this.encodeCell(function(a){return a.qnum>=0?a.qnum.toString()+" ":1===a.qans?"# ":1===a.qsub?"+ ":". "})},decodeSquareRoom:function(){this.decodeSquareRoom_com(!0)},encodeSquareRoom:function(){this.encodeSquareRoom_com(!0)},decodeAnsSquareRoom:function(){this.decodeSquareRoom_com(!1)},encodeAnsSquareRoom:function(){this.encodeSquareRoom_com(!1)},decodeSquareRoom_com:function(a){for(var b=parseInt(this.readLine()),c=this.readLines(b),d=[],e=0;e<c.length&&""!=c[e];e++){for(var f=c[e].split(" "),g=0;4>g;g++)isNaN(f[g])||(f[g]=parseInt(f[g]));var h={y1:2*f[0]+1,x1:2*f[1]+1,y2:2*f[2]+1,x2:2*f[3]+1};if(a&&""!=f[4]){var i=this.owner.board.getc(h.x1,h.y1);i.qnum=parseInt(f[4],10)}this.setRdataRect(d,e,h)}this.rdata2Border(a,d),this.owner.board.rooms.reset()},setRdataRect:function(a,b,c){for(var d=c.x1;d<=c.x2;d+=2)for(var e=c.y1;e<=c.y2;e+=2)a[this.owner.board.getc(d,e).id]=b},encodeSquareRoom_com:function(a){var b=this.owner.board,c=b.getRoomInfo();this.datastr+=c.max+"\n";for(var d=1;d<=c.max;d++){var e=c.room[d].clist.getRectSize(),f=a?b.rooms.getTopOfRoom(d).qnum:-1;this.datastr+=""+(e.y1>>1)+" "+(e.x1>>1)+" "+(e.y2>>1)+" "+(e.x2>>1)+" "+(f>=0?""+f:"")+"\n"}}})}();